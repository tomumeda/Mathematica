(************** Content-type: application/mathematica **************
                     CreatedBy='Mathematica 5.2'

                    Mathematica-Compatible Notebook

This notebook can be used with any Mathematica-compatible
application, such as Mathematica, MathReader or Publicon. The data
for the notebook starts with the line containing stars above.

To get the notebook into a Mathematica-compatible application, do
one of the following:

* Save the data starting with the line of stars above into a file
  with a name ending in .nb, then open the file inside the
  application;

* Copy the data starting with the line of stars above to the
  clipboard, then use the Paste menu command inside the application.

Data for notebooks contains only printable 7-bit ASCII and can be
sent directly in email or through ftp in text mode.  Newlines can be
CR, LF or CRLF (Unix, Macintosh or MS-DOS style).

NOTE: If you modify the data for this notebook not in a Mathematica-
compatible application, you must delete the line below containing
the word CacheID, otherwise Mathematica-compatible applications may
try to use invalid cache data.

For more information on notebooks and Mathematica-compatible 
applications, contact Wolfram Research:
  web: http://www.wolfram.com
  email: info@wolfram.com
  phone: +1-217-398-0700 (U.S.)

Notebook reader applications are available free of charge from 
Wolfram Research.
*******************************************************************)

(*CacheID: 232*)


(*NotebookFileLineBreakTest
NotebookFileLineBreakTest*)
(*NotebookOptionsPosition[     62484,       1292]*)
(*NotebookOutlinePosition[     63508,       1328]*)
(*  CellTagsIndexPosition[     63432,       1322]*)
(*WindowFrame->Normal*)



Notebook[{

Cell[CellGroupData[{
Cell["EvaluateAtPattern", "ObjectName",
  CellTags->"Function?"],

Cell[TextData[{
  "\[FilledSmallSquare] ",
  Cell[BoxData[
      RowBox[{
        RowBox[{"EvaluateAtPattern", 
          StyleBox["[",
            "MR"], 
          StyleBox[\(pattern, levelspec : \[Infinity], function : Identity\),
            "TI"], 
          StyleBox["]",
            "MR"]}], 
        StyleBox["[",
          "MR"], 
        StyleBox["expr",
          "TI"], 
        StyleBox["]",
          "MR"]}]]],
  " will evaluate held expressions at the positions within the level \
specification which match the pattern."
}], "Usage",
  CellTags->"Function?"],

Cell["\<\
A pure function given by function may be applied to the results of the \
evaluations.\
\>", "MathCaption"],

Cell[TextData[{
  "See also:  ",
  ButtonBox["HoldOp",
    ButtonData:>{"HoldOp"},
    ButtonStyle->"AddOnsLink"],
  "."
}], "MathCaption"],

Cell[CellGroupData[{

Cell["Examples", "ExampleSection"],

Cell[BoxData[
    \(Needs["\<TensorCalculus4`Tensorial`\>"]\)], "Input",
  CellLabel->"In[1]:="],

Cell[BoxData[
    \(DefineTensorShortcuts[{{q}, 1}, {{p}, 2}]\)], "Input",
  CellLabel->"In[2]:="],

Cell[TextData[{
  "In the following a covariant expression is held from further expansion. \
The internal expression is then simplified using ",
  Cell[BoxData[
      \(SymmetrizeSlots\)]],
  ". We might want to follow such an evaluation path for didactic purposes."
}], "Text"],

Cell[CellGroupData[{

Cell[BoxData[{
    \(CovariantD[pdd[a, b] qu[a] + pdd[b, a] qu[a], c] // 
      HoldOp[CovariantD]\), "\[IndentingNewLine]", 
    \(% // EvaluateAtPattern[HoldPattern[Plus[_, __]], \[Infinity], 
        SymmetrizeSlots[p, 2, Symmetric[1, 2]]]\), "\[IndentingNewLine]", 
    \(% // ReleaseHold\)}], "Input",
  CellLabel->"In[3]:="],

Cell[BoxData[
    TagBox[
      InterpretationBox[
        SubscriptBox[
          RowBox[{"(", 
            RowBox[{
              RowBox[{
                InterpretationBox[
                  SubsuperscriptBox["p", \(a  b\), 
                    RowBox[{
                      TagBox[
                        StyleBox["a",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)], 
                      TagBox[
                        StyleBox["b",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)]}]],
                  Tensor[ p, {Void, Void}, {a, b}],
                  Editable->False], " ", 
                InterpretationBox[
                  SubsuperscriptBox["q", 
                    TagBox[
                      StyleBox["a",
                        ShowContents->False],
                      (StyleForm[ #, ShowContents -> False]&)], "a"],
                  Tensor[ q, {a}, {Void}],
                  Editable->False]}], "+", 
              RowBox[{
                InterpretationBox[
                  SubsuperscriptBox["p", \(b  a\), 
                    RowBox[{
                      TagBox[
                        StyleBox["b",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)], 
                      TagBox[
                        StyleBox["a",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)]}]],
                  Tensor[ p, {Void, Void}, {b, a}],
                  Editable->False], " ", 
                InterpretationBox[
                  SubsuperscriptBox["q", 
                    TagBox[
                      StyleBox["a",
                        ShowContents->False],
                      (StyleForm[ #, ShowContents -> False]&)], "a"],
                  Tensor[ q, {a}, {Void}],
                  Editable->False]}]}], ")"}], \(\(;\)\(c\)\)],
        Plus[ 
          Times[ 
            CovariantD[ 
              Tensor[ q, {a}, {Void}], c], 
            Tensor[ p, {Void, Void}, {a, b}]], 
          Times[ 
            CovariantD[ 
              Tensor[ q, {a}, {Void}], c], 
            Tensor[ p, {Void, Void}, {b, a}]], 
          Times[ 
            CovariantD[ 
              Tensor[ p, {Void, Void}, {a, b}], c], 
            Tensor[ q, {a}, {Void}]], 
          Times[ 
            CovariantD[ 
              Tensor[ p, {Void, Void}, {b, a}], c], 
            Tensor[ q, {a}, {Void}]]],
        Editable->False],
      HoldForm]], "Output",
  CellLabel->"Out[3]="],

Cell[BoxData[
    TagBox[
      InterpretationBox[
        SubscriptBox[
          RowBox[{"(", 
            RowBox[{"2", " ", 
              InterpretationBox[
                SubsuperscriptBox["p", \(a  b\), 
                  RowBox[{
                    TagBox[
                      StyleBox["a",
                        ShowContents->False],
                      (StyleForm[ #, ShowContents -> False]&)], 
                    TagBox[
                      StyleBox["b",
                        ShowContents->False],
                      (StyleForm[ #, ShowContents -> False]&)]}]],
                Tensor[ p, {Void, Void}, {a, b}],
                Editable->False], " ", 
              InterpretationBox[
                SubsuperscriptBox["q", 
                  TagBox[
                    StyleBox["a",
                      ShowContents->False],
                    (StyleForm[ #, ShowContents -> False]&)], "a"],
                Tensor[ q, {a}, {Void}],
                Editable->False]}], ")"}], \(\(;\)\(c\)\)],
        Times[ 2, 
          Plus[ 
            Times[ 
              CovariantD[ 
                Tensor[ q, {a}, {Void}], c], 
              Tensor[ p, {Void, Void}, {a, b}]], 
            Times[ 
              CovariantD[ 
                Tensor[ p, {Void, Void}, {a, b}], c], 
              Tensor[ q, {a}, {Void}]]]],
        Editable->False],
      HoldForm]], "Output",
  CellLabel->"Out[4]="],

Cell[BoxData[
    RowBox[{"2", " ", 
      RowBox[{"(", 
        RowBox[{
          RowBox[{
            InterpretationBox[
              SubscriptBox[
                InterpretationBox[
                  SubsuperscriptBox["q", 
                    TagBox[
                      StyleBox["a",
                        ShowContents->False],
                      (StyleForm[ #, ShowContents -> False]&)], "a"],
                  Tensor[ q, {a}, {Void}],
                  Editable->False], \(\(;\)\(c\)\)],
              CovariantD[ 
                Tensor[ q, {a}, {Void}], c],
              Editable->False], " ", 
            InterpretationBox[
              SubsuperscriptBox["p", \(a  b\), 
                RowBox[{
                  TagBox[
                    StyleBox["a",
                      ShowContents->False],
                    (StyleForm[ #, ShowContents -> False]&)], 
                  TagBox[
                    StyleBox["b",
                      ShowContents->False],
                    (StyleForm[ #, ShowContents -> False]&)]}]],
              Tensor[ p, {Void, Void}, {a, b}],
              Editable->False]}], "+", 
          RowBox[{
            InterpretationBox[
              SubscriptBox[
                InterpretationBox[
                  SubsuperscriptBox["p", \(a  b\), 
                    RowBox[{
                      TagBox[
                        StyleBox["a",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)], 
                      TagBox[
                        StyleBox["b",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)]}]],
                  Tensor[ p, {Void, Void}, {a, b}],
                  Editable->False], \(\(;\)\(c\)\)],
              CovariantD[ 
                Tensor[ p, {Void, Void}, {a, b}], c],
              Editable->False], " ", 
            InterpretationBox[
              SubsuperscriptBox["q", 
                TagBox[
                  StyleBox["a",
                    ShowContents->False],
                  (StyleForm[ #, ShowContents -> False]&)], "a"],
              Tensor[ q, {a}, {Void}],
              Editable->False]}]}], ")"}]}]], "Output",
  CellLabel->"Out[5]="]
}, Open  ]],

Cell[TextData[{
  "If we try to use ",
  Cell[BoxData[
      \(SymmetrizeSlots\)]],
  " directly, it works after a fashion. But the whole routine is put in the \
held expression without evaluation and only evaluated after ",
  Cell[BoxData[
      \(ReleaseHold\)]],
  ". Not what we would want."
}], "Text"],

Cell[CellGroupData[{

Cell[BoxData[{
    \(CovariantD[pdd[a, b] qu[a] + pdd[b, a] qu[a], c] // 
      HoldOp[CovariantD]\), "\[IndentingNewLine]", 
    \(% // SymmetrizeSlots[p, 2, Symmetric[1, 2]]\), "\[IndentingNewLine]", 
    \(% // ReleaseHold\)}], "Input",
  CellLabel->"In[6]:="],

Cell[BoxData[
    TagBox[
      InterpretationBox[
        SubscriptBox[
          RowBox[{"(", 
            RowBox[{
              RowBox[{
                InterpretationBox[
                  SubsuperscriptBox["p", \(a  b\), 
                    RowBox[{
                      TagBox[
                        StyleBox["a",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)], 
                      TagBox[
                        StyleBox["b",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)]}]],
                  Tensor[ p, {Void, Void}, {a, b}],
                  Editable->False], " ", 
                InterpretationBox[
                  SubsuperscriptBox["q", 
                    TagBox[
                      StyleBox["a",
                        ShowContents->False],
                      (StyleForm[ #, ShowContents -> False]&)], "a"],
                  Tensor[ q, {a}, {Void}],
                  Editable->False]}], "+", 
              RowBox[{
                InterpretationBox[
                  SubsuperscriptBox["p", \(b  a\), 
                    RowBox[{
                      TagBox[
                        StyleBox["b",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)], 
                      TagBox[
                        StyleBox["a",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)]}]],
                  Tensor[ p, {Void, Void}, {b, a}],
                  Editable->False], " ", 
                InterpretationBox[
                  SubsuperscriptBox["q", 
                    TagBox[
                      StyleBox["a",
                        ShowContents->False],
                      (StyleForm[ #, ShowContents -> False]&)], "a"],
                  Tensor[ q, {a}, {Void}],
                  Editable->False]}]}], ")"}], \(\(;\)\(c\)\)],
        Plus[ 
          Times[ 
            CovariantD[ 
              Tensor[ q, {a}, {Void}], c], 
            Tensor[ p, {Void, Void}, {a, b}]], 
          Times[ 
            CovariantD[ 
              Tensor[ q, {a}, {Void}], c], 
            Tensor[ p, {Void, Void}, {b, a}]], 
          Times[ 
            CovariantD[ 
              Tensor[ p, {Void, Void}, {a, b}], c], 
            Tensor[ q, {a}, {Void}]], 
          Times[ 
            CovariantD[ 
              Tensor[ p, {Void, Void}, {b, a}], c], 
            Tensor[ q, {a}, {Void}]]],
        Editable->False],
      HoldForm]], "Output",
  CellLabel->"Out[6]="],

Cell[BoxData[
    TagBox[
      InterpretationBox[
        SubscriptBox[
          RowBox[{"(", 
            RowBox[{
              RowBox[{
                RowBox[{"Catch", "[", 
                  RowBox[{"Module", "[", 
                    RowBox[{
                      RowBox[{"{", 
                        
                        RowBox[{\(TensorCalculus4`Tensorial`Private`order$ = 
                            Length[{Void, Void}]\), ",", 
                          RowBox[{
                          "TensorCalculus4`Tensorial`Private`dummies$", "=", 
                            RowBox[{"First", "[", 
                              RowBox[{"ParseTermIndices", "[", 
                                InterpretationBox[
                                  SubsuperscriptBox["p", \(a  b\), 
                                    RowBox[{
                                      TagBox[
                                        StyleBox["a",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)], 
                                      TagBox[
                                        StyleBox["b",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)]}]],
                                  Tensor[ p, {Void, Void}, {a, b}],
                                  Editable->False], "]"}], "]"}]}], 
                          ",", \(TensorCalculus4`Tensorial`Private`tsign$ = 
                            1\), ",", 
                          "TensorCalculus4`Tensorial`Private`symmetry$", ",", 
                          "TensorCalculus4`Tensorial`Private`slots$", ",", 
                          "TensorCalculus4`Tensorial`Private`processsymmetry$\
", ",", "TensorCalculus4`Tensorial`Private`duplicatedummies$"}], "}"}], ",", 
                      
                      RowBox[{\(TensorCalculus4`Tensorial`Private`\
duplicatedummies$[TensorCalculus4`Tensorial`Private`sslots$_] := 
                          Module[{TensorCalculus4`Tensorial`Private`work$}, 
                            TensorCalculus4`Tensorial`Private`work$ = 
                              Outer[Module[{TensorCalculus4`Tensorial`Private`\
indices}, TensorCalculus4`Tensorial`Private`indices = 
                                      Cases[#2, {_Symbol, 
                                        TensorCalculus4`Tensorial`Private`\
index_, 1 | \(-1\)} \[Rule] 
                                        TensorCalculus4`Tensorial`Private`\
index, \[Infinity]]; MatchQ[#1, Alternatives @@ 
                                        TensorCalculus4`Tensorial`Private`\
indices]] &, TensorCalculus4`Tensorial`Private`dummies$, 
                                TensorCalculus4`Tensorial`Private`sslots$, 
                                1]; TensorCalculus4`Tensorial`Private`work$ = \
\((Count[#1, True, \[Infinity]] > 1 &)\) /@ 
                                TensorCalculus4`Tensorial`Private`work$; 
                            Or @@ TensorCalculus4`Tensorial`Private`work$]\), 
                        ";", \(TensorCalculus4`Tensorial`Private`\
processsymmetry$[TensorCalculus4`Tensorial`Private`subsymmetry$_] := 
                          Module[{TensorCalculus4`Tensorial`Private`symtype$ \
= Head[TensorCalculus4`Tensorial`Private`subsymmetry$], 
                              TensorCalculus4`Tensorial`Private`symslots$, 
                              TensorCalculus4`Tensorial`Private`subslots$, 
                              TensorCalculus4`Tensorial`Private`neworder$, 
                              TensorCalculus4`Tensorial`Private`sign$, 
                              TensorCalculus4`Tensorial`Private`newsubslots$},\
 If[TensorCalculus4`Tensorial`Private`symtype$ === List, 
                              Return[
                                TensorCalculus4`Tensorial`Private`subsymmetry$\
]]; TensorCalculus4`Tensorial`Private`symslots$ = \
\(\(TensorCalculus4`Tensorial`Private`subsymmetry$ \
/. \[InvisibleSpace]{TensorCalculus4`Tensorial`Private`args : \((_Integer \
.. )\)} \[RuleDelayed] 
                                      Sort[{TensorCalculus4`Tensorial`Private`\
args}]\) /. \[InvisibleSpace]\((Symmetric | AntiSymmetric)\)[
                                      TensorCalculus4`Tensorial`Private`args \
: \((_List .. )\)] \[Rule] {TensorCalculus4`Tensorial`Private`args}\) \
/. \[InvisibleSpace]\((Symmetric | AntiSymmetric)\)[
                                    TensorCalculus4`Tensorial`Private`args : \
\((_Integer .. )\)] \[RuleDelayed] 
                                  Partition[
                                    Sort[{TensorCalculus4`Tensorial`Private`\
args}], 1]; 
                            TensorCalculus4`Tensorial`Private`subslots$ = \
\((TensorCalculus4`Tensorial`Private`slots$\[LeftDoubleBracket]#1\
\[RightDoubleBracket] &)\) /@ TensorCalculus4`Tensorial`Private`symslots$; 
                            TensorCalculus4`Tensorial`Private`neworder$ = 
                              Ordering[
                                TensorCalculus4`Tensorial`Private`subslots$]; 
                            TensorCalculus4`Tensorial`Private`tsign$ = 
                              Which[TensorCalculus4`Tensorial`Private`symtype$\
 === AntiSymmetric && \((TensorCalculus4`Tensorial`Private`duplicatedummies$[
                                        TensorCalculus4`Tensorial`Private`\
subslots$] || Length[Union[TensorCalculus4`Tensorial`Private`subslots$]] < 
                                        Length[
                                        TensorCalculus4`Tensorial`Private`\
subslots$])\), 0, TensorCalculus4`Tensorial`Private`symtype$ === 
                                  AntiSymmetric, 
                                TensorCalculus4`Tensorial`Private`tsign$\ \
Signature[TensorCalculus4`Tensorial`Private`neworder$]\ Signature[
                                    TensorCalculus4`Tensorial`Private`\
symslots$], True, TensorCalculus4`Tensorial`Private`tsign$]; 
                            TensorCalculus4`Tensorial`Private`newsubslots$ = 
                              Flatten[
                                TensorCalculus4`Tensorial`Private`subslots$\
\[LeftDoubleBracket]TensorCalculus4`Tensorial`Private`neworder$\
\[RightDoubleBracket], 1]; 
                            TensorCalculus4`Tensorial`Private`slots$ = 
                              ReplacePart[
                                TensorCalculus4`Tensorial`Private`slots$, 
                                TensorCalculus4`Tensorial`Private`newsubslots$\
, Partition[Flatten[TensorCalculus4`Tensorial`Private`symslots$, 1], 1], 
                                Partition[
                                  Range[
                                    Length[
                                      TensorCalculus4`Tensorial`Private`\
newsubslots$]], 1]]; List @@ 
                              TensorCalculus4`Tensorial`Private`subsymmetry$]\
\), ";", 
                        RowBox[{"If", "[", 
                          RowBox[{
                          "TensorCalculus4`Tensorial`Private`passedsymmetry$\
103", ",", 
                            
                            RowBox[{\(TensorCalculus4`Tensorial`Private`\
symmetry$ = TensorCalculus4`Tensorial`Private`psymmetry$103\), ";", 
                              RowBox[{"If", "[", 
                                
                                RowBox[{\(p =!= 
                                      TensorCalculus4`Tensorial`Private`\
plabel$103 || TensorCalculus4`Tensorial`Private`order$ =!= 
                                      TensorCalculus4`Tensorial`Private`\
porder$103\), ",", 
                                  RowBox[{"Throw", "[", 
                                    InterpretationBox[
                                      SubsuperscriptBox["p", \(a  b\), 
                                        RowBox[{
                                        TagBox[
                                        StyleBox["a",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)], 
                                        TagBox[
                                        StyleBox["b",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)]}]],
                                      Tensor[ p, {Void, Void}, {a, b}],
                                      Editable->False], "]"}]}], "]"}]}], ",",
                             
                            
                            RowBox[{\(TensorCalculus4`Tensorial`Private`\
symmetry$ = TensorSymmetry[p, TensorCalculus4`Tensorial`Private`order$]\), 
                              ";", 
                              RowBox[{"If", "[", 
                                
                                RowBox[{\(Head[
                                      TensorCalculus4`Tensorial`Private`\
symmetry$] === TensorSymmetry\), ",", 
                                  RowBox[{"Throw", "[", 
                                    InterpretationBox[
                                      SubsuperscriptBox["p", \(a  b\), 
                                        RowBox[{
                                        TagBox[
                                        StyleBox["a",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)], 
                                        TagBox[
                                        StyleBox["b",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)]}]],
                                      Tensor[ p, {Void, Void}, {a, b}],
                                      Editable->False], "]"}]}], "]"}]}]}], 
                          "]"}], ";", 
                        RowBox[{
                        "TensorCalculus4`Tensorial`Private`slots$", "=", 
                          RowBox[{"ExtractTensorSlots", "[", 
                            InterpretationBox[
                              SubsuperscriptBox["p", \(a  b\), 
                                RowBox[{
                                  TagBox[
                                    StyleBox["a",
                                      ShowContents->False],
                                    (StyleForm[ #, ShowContents -> False]&)], 
                                  
                                  TagBox[
                                    StyleBox["b",
                                      ShowContents->False],
                                    (
                                    StyleForm[ #, ShowContents -> 
                                      False]&)]}]],
                              Tensor[ p, {Void, Void}, {a, b}],
                              Editable->False], "]"}]}], 
                        ";", \(Map[
                          TensorCalculus4`Tensorial`Private`processsymmetry$, 
                          TensorCalculus4`Tensorial`Private`symmetry$, {0, \
\(-2\)}]\), ";", \(TensorCalculus4`Tensorial`Private`tsign$\ SlotsToTensor[
                            TensorCalculus4`Tensorial`Private`slots$]\)}]}], 
                    "]"}], "]"}], " ", 
                RowBox[{"Catch", "[", 
                  RowBox[{"Module", "[", 
                    RowBox[{
                      RowBox[{"{", 
                        
                        RowBox[{\(TensorCalculus4`Tensorial`Private`order$ = 
                            Length[{a}]\), ",", 
                          RowBox[{
                          "TensorCalculus4`Tensorial`Private`dummies$", "=", 
                            RowBox[{"First", "[", 
                              RowBox[{"ParseTermIndices", "[", 
                                InterpretationBox[
                                  SubsuperscriptBox["q", 
                                    TagBox[
                                      StyleBox["a",
                                        ShowContents->False],
                                      (
                                      StyleForm[ #, ShowContents -> False]&)],
                                     "a"],
                                  Tensor[ q, {a}, {Void}],
                                  Editable->False], "]"}], "]"}]}], 
                          ",", \(TensorCalculus4`Tensorial`Private`tsign$ = 
                            1\), ",", 
                          "TensorCalculus4`Tensorial`Private`symmetry$", ",", 
                          "TensorCalculus4`Tensorial`Private`slots$", ",", 
                          "TensorCalculus4`Tensorial`Private`processsymmetry$\
", ",", "TensorCalculus4`Tensorial`Private`duplicatedummies$"}], "}"}], ",", 
                      
                      RowBox[{\(TensorCalculus4`Tensorial`Private`\
duplicatedummies$[TensorCalculus4`Tensorial`Private`sslots$_] := 
                          Module[{TensorCalculus4`Tensorial`Private`work$}, 
                            TensorCalculus4`Tensorial`Private`work$ = 
                              Outer[Module[{TensorCalculus4`Tensorial`Private`\
indices}, TensorCalculus4`Tensorial`Private`indices = 
                                      Cases[#2, {_Symbol, 
                                        TensorCalculus4`Tensorial`Private`\
index_, 1 | \(-1\)} \[Rule] 
                                        TensorCalculus4`Tensorial`Private`\
index, \[Infinity]]; MatchQ[#1, Alternatives @@ 
                                        TensorCalculus4`Tensorial`Private`\
indices]] &, TensorCalculus4`Tensorial`Private`dummies$, 
                                TensorCalculus4`Tensorial`Private`sslots$, 
                                1]; TensorCalculus4`Tensorial`Private`work$ = \
\((Count[#1, True, \[Infinity]] > 1 &)\) /@ 
                                TensorCalculus4`Tensorial`Private`work$; 
                            Or @@ TensorCalculus4`Tensorial`Private`work$]\), 
                        ";", \(TensorCalculus4`Tensorial`Private`\
processsymmetry$[TensorCalculus4`Tensorial`Private`subsymmetry$_] := 
                          Module[{TensorCalculus4`Tensorial`Private`symtype$ \
= Head[TensorCalculus4`Tensorial`Private`subsymmetry$], 
                              TensorCalculus4`Tensorial`Private`symslots$, 
                              TensorCalculus4`Tensorial`Private`subslots$, 
                              TensorCalculus4`Tensorial`Private`neworder$, 
                              TensorCalculus4`Tensorial`Private`sign$, 
                              TensorCalculus4`Tensorial`Private`newsubslots$},\
 If[TensorCalculus4`Tensorial`Private`symtype$ === List, 
                              Return[
                                TensorCalculus4`Tensorial`Private`subsymmetry$\
]]; TensorCalculus4`Tensorial`Private`symslots$ = \
\(\(TensorCalculus4`Tensorial`Private`subsymmetry$ \
/. \[InvisibleSpace]{TensorCalculus4`Tensorial`Private`args : \((_Integer \
.. )\)} \[RuleDelayed] 
                                      Sort[{TensorCalculus4`Tensorial`Private`\
args}]\) /. \[InvisibleSpace]\((Symmetric | AntiSymmetric)\)[
                                      TensorCalculus4`Tensorial`Private`args \
: \((_List .. )\)] \[Rule] {TensorCalculus4`Tensorial`Private`args}\) \
/. \[InvisibleSpace]\((Symmetric | AntiSymmetric)\)[
                                    TensorCalculus4`Tensorial`Private`args : \
\((_Integer .. )\)] \[RuleDelayed] 
                                  Partition[
                                    Sort[{TensorCalculus4`Tensorial`Private`\
args}], 1]; 
                            TensorCalculus4`Tensorial`Private`subslots$ = \
\((TensorCalculus4`Tensorial`Private`slots$\[LeftDoubleBracket]#1\
\[RightDoubleBracket] &)\) /@ TensorCalculus4`Tensorial`Private`symslots$; 
                            TensorCalculus4`Tensorial`Private`neworder$ = 
                              Ordering[
                                TensorCalculus4`Tensorial`Private`subslots$]; 
                            TensorCalculus4`Tensorial`Private`tsign$ = 
                              Which[TensorCalculus4`Tensorial`Private`symtype$\
 === AntiSymmetric && \((TensorCalculus4`Tensorial`Private`duplicatedummies$[
                                        TensorCalculus4`Tensorial`Private`\
subslots$] || Length[Union[TensorCalculus4`Tensorial`Private`subslots$]] < 
                                        Length[
                                        TensorCalculus4`Tensorial`Private`\
subslots$])\), 0, TensorCalculus4`Tensorial`Private`symtype$ === 
                                  AntiSymmetric, 
                                TensorCalculus4`Tensorial`Private`tsign$\ \
Signature[TensorCalculus4`Tensorial`Private`neworder$]\ Signature[
                                    TensorCalculus4`Tensorial`Private`\
symslots$], True, TensorCalculus4`Tensorial`Private`tsign$]; 
                            TensorCalculus4`Tensorial`Private`newsubslots$ = 
                              Flatten[
                                TensorCalculus4`Tensorial`Private`subslots$\
\[LeftDoubleBracket]TensorCalculus4`Tensorial`Private`neworder$\
\[RightDoubleBracket], 1]; 
                            TensorCalculus4`Tensorial`Private`slots$ = 
                              ReplacePart[
                                TensorCalculus4`Tensorial`Private`slots$, 
                                
                                TensorCalculus4`Tensorial`Private`newsubslots$\
, Partition[Flatten[TensorCalculus4`Tensorial`Private`symslots$, 1], 1], 
                                Partition[
                                  Range[
                                    Length[
                                      TensorCalculus4`Tensorial`Private`\
newsubslots$]], 1]]; List @@ 
                              TensorCalculus4`Tensorial`Private`subsymmetry$]\
\), ";", 
                        RowBox[{"If", "[", 
                          RowBox[{
                          "TensorCalculus4`Tensorial`Private`passedsymmetry$\
103", ",", 
                            
                            RowBox[{\(TensorCalculus4`Tensorial`Private`\
symmetry$ = TensorCalculus4`Tensorial`Private`psymmetry$103\), ";", 
                              RowBox[{"If", "[", 
                                
                                RowBox[{\(q =!= 
                                      TensorCalculus4`Tensorial`Private`\
plabel$103 || TensorCalculus4`Tensorial`Private`order$ =!= 
                                      TensorCalculus4`Tensorial`Private`\
porder$103\), ",", 
                                  RowBox[{"Throw", "[", 
                                    InterpretationBox[
                                      SubsuperscriptBox["q", 
                                        TagBox[
                                        StyleBox["a",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)], "a"],
                                      Tensor[ q, {a}, {Void}],
                                      Editable->False], "]"}]}], "]"}]}], ",",
                             
                            
                            RowBox[{\(TensorCalculus4`Tensorial`Private`\
symmetry$ = TensorSymmetry[q, TensorCalculus4`Tensorial`Private`order$]\), 
                              ";", 
                              RowBox[{"If", "[", 
                                
                                RowBox[{\(Head[
                                      TensorCalculus4`Tensorial`Private`\
symmetry$] === TensorSymmetry\), ",", 
                                  RowBox[{"Throw", "[", 
                                    InterpretationBox[
                                      SubsuperscriptBox["q", 
                                        TagBox[
                                        StyleBox["a",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)], "a"],
                                      Tensor[ q, {a}, {Void}],
                                      Editable->False], "]"}]}], "]"}]}]}], 
                          "]"}], ";", 
                        RowBox[{
                        "TensorCalculus4`Tensorial`Private`slots$", "=", 
                          RowBox[{"ExtractTensorSlots", "[", 
                            InterpretationBox[
                              SubsuperscriptBox["q", 
                                TagBox[
                                  StyleBox["a",
                                    ShowContents->False],
                                  (StyleForm[ #, ShowContents -> False]&)], 
                                "a"],
                              Tensor[ q, {a}, {Void}],
                              Editable->False], "]"}]}], 
                        ";", \(Map[
                          TensorCalculus4`Tensorial`Private`processsymmetry$, 
                          TensorCalculus4`Tensorial`Private`symmetry$, {0, \
\(-2\)}]\), ";", \(TensorCalculus4`Tensorial`Private`tsign$\ SlotsToTensor[
                            TensorCalculus4`Tensorial`Private`slots$]\)}]}], 
                    "]"}], "]"}]}], "+", 
              RowBox[{
                RowBox[{"Catch", "[", 
                  RowBox[{"Module", "[", 
                    RowBox[{
                      RowBox[{"{", 
                        
                        RowBox[{\(TensorCalculus4`Tensorial`Private`order$ = 
                            Length[{Void, Void}]\), ",", 
                          RowBox[{
                          "TensorCalculus4`Tensorial`Private`dummies$", "=", 
                            RowBox[{"First", "[", 
                              RowBox[{"ParseTermIndices", "[", 
                                InterpretationBox[
                                  SubsuperscriptBox["p", \(b  a\), 
                                    RowBox[{
                                      TagBox[
                                        StyleBox["b",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)], 
                                      TagBox[
                                        StyleBox["a",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)]}]],
                                  Tensor[ p, {Void, Void}, {b, a}],
                                  Editable->False], "]"}], "]"}]}], 
                          ",", \(TensorCalculus4`Tensorial`Private`tsign$ = 
                            1\), ",", 
                          "TensorCalculus4`Tensorial`Private`symmetry$", ",", 
                          "TensorCalculus4`Tensorial`Private`slots$", ",", 
                          "TensorCalculus4`Tensorial`Private`processsymmetry$\
", ",", "TensorCalculus4`Tensorial`Private`duplicatedummies$"}], "}"}], ",", 
                      
                      RowBox[{\(TensorCalculus4`Tensorial`Private`\
duplicatedummies$[TensorCalculus4`Tensorial`Private`sslots$_] := 
                          Module[{TensorCalculus4`Tensorial`Private`work$}, 
                            TensorCalculus4`Tensorial`Private`work$ = 
                              Outer[Module[{TensorCalculus4`Tensorial`Private`\
indices}, TensorCalculus4`Tensorial`Private`indices = 
                                      Cases[#2, {_Symbol, 
                                        TensorCalculus4`Tensorial`Private`\
index_, 1 | \(-1\)} \[Rule] 
                                        TensorCalculus4`Tensorial`Private`\
index, \[Infinity]]; MatchQ[#1, Alternatives @@ 
                                        TensorCalculus4`Tensorial`Private`\
indices]] &, TensorCalculus4`Tensorial`Private`dummies$, 
                                TensorCalculus4`Tensorial`Private`sslots$, 
                                1]; TensorCalculus4`Tensorial`Private`work$ = \
\((Count[#1, True, \[Infinity]] > 1 &)\) /@ 
                                TensorCalculus4`Tensorial`Private`work$; 
                            Or @@ TensorCalculus4`Tensorial`Private`work$]\), 
                        ";", \(TensorCalculus4`Tensorial`Private`\
processsymmetry$[TensorCalculus4`Tensorial`Private`subsymmetry$_] := 
                          Module[{TensorCalculus4`Tensorial`Private`symtype$ \
= Head[TensorCalculus4`Tensorial`Private`subsymmetry$], 
                              TensorCalculus4`Tensorial`Private`symslots$, 
                              TensorCalculus4`Tensorial`Private`subslots$, 
                              TensorCalculus4`Tensorial`Private`neworder$, 
                              TensorCalculus4`Tensorial`Private`sign$, 
                              TensorCalculus4`Tensorial`Private`newsubslots$},\
 If[TensorCalculus4`Tensorial`Private`symtype$ === List, 
                              Return[
                                TensorCalculus4`Tensorial`Private`subsymmetry$\
]]; TensorCalculus4`Tensorial`Private`symslots$ = \
\(\(TensorCalculus4`Tensorial`Private`subsymmetry$ \
/. \[InvisibleSpace]{TensorCalculus4`Tensorial`Private`args : \((_Integer \
.. )\)} \[RuleDelayed] 
                                      Sort[{TensorCalculus4`Tensorial`Private`\
args}]\) /. \[InvisibleSpace]\((Symmetric | AntiSymmetric)\)[
                                      TensorCalculus4`Tensorial`Private`args \
: \((_List .. )\)] \[Rule] {TensorCalculus4`Tensorial`Private`args}\) \
/. \[InvisibleSpace]\((Symmetric | AntiSymmetric)\)[
                                    TensorCalculus4`Tensorial`Private`args : \
\((_Integer .. )\)] \[RuleDelayed] 
                                  Partition[
                                    Sort[{TensorCalculus4`Tensorial`Private`\
args}], 1]; 
                            TensorCalculus4`Tensorial`Private`subslots$ = \
\((TensorCalculus4`Tensorial`Private`slots$\[LeftDoubleBracket]#1\
\[RightDoubleBracket] &)\) /@ TensorCalculus4`Tensorial`Private`symslots$; 
                            TensorCalculus4`Tensorial`Private`neworder$ = 
                              Ordering[
                                TensorCalculus4`Tensorial`Private`subslots$]; 
                            TensorCalculus4`Tensorial`Private`tsign$ = 
                              Which[TensorCalculus4`Tensorial`Private`symtype$\
 === AntiSymmetric && \((TensorCalculus4`Tensorial`Private`duplicatedummies$[
                                        TensorCalculus4`Tensorial`Private`\
subslots$] || Length[Union[TensorCalculus4`Tensorial`Private`subslots$]] < 
                                        Length[
                                        TensorCalculus4`Tensorial`Private`\
subslots$])\), 0, TensorCalculus4`Tensorial`Private`symtype$ === 
                                  AntiSymmetric, 
                                TensorCalculus4`Tensorial`Private`tsign$\ \
Signature[TensorCalculus4`Tensorial`Private`neworder$]\ Signature[
                                    TensorCalculus4`Tensorial`Private`\
symslots$], True, TensorCalculus4`Tensorial`Private`tsign$]; 
                            TensorCalculus4`Tensorial`Private`newsubslots$ = 
                              Flatten[
                                TensorCalculus4`Tensorial`Private`subslots$\
\[LeftDoubleBracket]
                                  TensorCalculus4`Tensorial`Private`neworder$\
\[RightDoubleBracket], 1]; 
                            TensorCalculus4`Tensorial`Private`slots$ = 
                              ReplacePart[
                                TensorCalculus4`Tensorial`Private`slots$, 
                                TensorCalculus4`Tensorial`Private`newsubslots$\
, Partition[Flatten[TensorCalculus4`Tensorial`Private`symslots$, 1], 1], 
                                Partition[
                                  Range[
                                    Length[
                                      TensorCalculus4`Tensorial`Private`\
newsubslots$]], 1]]; List @@ 
                              TensorCalculus4`Tensorial`Private`subsymmetry$]\
\), ";", 
                        RowBox[{"If", "[", 
                          RowBox[{
                          "TensorCalculus4`Tensorial`Private`passedsymmetry$\
103", ",", 
                            
                            RowBox[{\(TensorCalculus4`Tensorial`Private`\
symmetry$ = TensorCalculus4`Tensorial`Private`psymmetry$103\), ";", 
                              RowBox[{"If", "[", 
                                
                                RowBox[{\(p =!= 
                                      TensorCalculus4`Tensorial`Private`\
plabel$103 || TensorCalculus4`Tensorial`Private`order$ =!= 
                                      TensorCalculus4`Tensorial`Private`\
porder$103\), ",", 
                                  RowBox[{"Throw", "[", 
                                    InterpretationBox[
                                      SubsuperscriptBox["p", \(b  a\), 
                                        RowBox[{
                                        TagBox[
                                        StyleBox["b",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)], 
                                        TagBox[
                                        StyleBox["a",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)]}]],
                                      Tensor[ p, {Void, Void}, {b, a}],
                                      Editable->False], "]"}]}], "]"}]}], ",",
                             
                            
                            RowBox[{\(TensorCalculus4`Tensorial`Private`\
symmetry$ = TensorSymmetry[p, TensorCalculus4`Tensorial`Private`order$]\), 
                              ";", 
                              RowBox[{"If", "[", 
                                
                                RowBox[{\(Head[
                                      TensorCalculus4`Tensorial`Private`\
symmetry$] === TensorSymmetry\), ",", 
                                  RowBox[{"Throw", "[", 
                                    InterpretationBox[
                                      SubsuperscriptBox["p", \(b  a\), 
                                        RowBox[{
                                        TagBox[
                                        StyleBox["b",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)], 
                                        TagBox[
                                        StyleBox["a",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)]}]],
                                      Tensor[ p, {Void, Void}, {b, a}],
                                      Editable->False], "]"}]}], "]"}]}]}], 
                          "]"}], ";", 
                        RowBox[{
                        "TensorCalculus4`Tensorial`Private`slots$", "=", 
                          RowBox[{"ExtractTensorSlots", "[", 
                            InterpretationBox[
                              SubsuperscriptBox["p", \(b  a\), 
                                RowBox[{
                                  TagBox[
                                    StyleBox["b",
                                      ShowContents->False],
                                    (StyleForm[ #, ShowContents -> False]&)], 
                                  
                                  TagBox[
                                    StyleBox["a",
                                      ShowContents->False],
                                    (
                                    StyleForm[ #, ShowContents -> 
                                      False]&)]}]],
                              Tensor[ p, {Void, Void}, {b, a}],
                              Editable->False], "]"}]}], 
                        ";", \(Map[
                          TensorCalculus4`Tensorial`Private`processsymmetry$, 
                          TensorCalculus4`Tensorial`Private`symmetry$, {0, \
\(-2\)}]\), ";", \(TensorCalculus4`Tensorial`Private`tsign$\ SlotsToTensor[
                            TensorCalculus4`Tensorial`Private`slots$]\)}]}], 
                    "]"}], "]"}], " ", 
                RowBox[{"Catch", "[", 
                  RowBox[{"Module", "[", 
                    RowBox[{
                      RowBox[{"{", 
                        
                        RowBox[{\(TensorCalculus4`Tensorial`Private`order$ = 
                            Length[{a}]\), ",", 
                          RowBox[{
                          "TensorCalculus4`Tensorial`Private`dummies$", "=", 
                            RowBox[{"First", "[", 
                              RowBox[{"ParseTermIndices", "[", 
                                InterpretationBox[
                                  SubsuperscriptBox["q", 
                                    TagBox[
                                      StyleBox["a",
                                        ShowContents->False],
                                      (
                                      StyleForm[ #, ShowContents -> False]&)],
                                     "a"],
                                  Tensor[ q, {a}, {Void}],
                                  Editable->False], "]"}], "]"}]}], 
                          ",", \(TensorCalculus4`Tensorial`Private`tsign$ = 
                            1\), ",", 
                          "TensorCalculus4`Tensorial`Private`symmetry$", ",", 
                          "TensorCalculus4`Tensorial`Private`slots$", ",", 
                          "TensorCalculus4`Tensorial`Private`processsymmetry$\
", ",", "TensorCalculus4`Tensorial`Private`duplicatedummies$"}], "}"}], ",", 
                      
                      RowBox[{\(TensorCalculus4`Tensorial`Private`\
duplicatedummies$[TensorCalculus4`Tensorial`Private`sslots$_] := 
                          Module[{TensorCalculus4`Tensorial`Private`work$}, 
                            TensorCalculus4`Tensorial`Private`work$ = 
                              Outer[Module[{TensorCalculus4`Tensorial`Private`\
indices}, TensorCalculus4`Tensorial`Private`indices = 
                                      Cases[#2, {_Symbol, 
                                        TensorCalculus4`Tensorial`Private`\
index_, 1 | \(-1\)} \[Rule] 
                                        TensorCalculus4`Tensorial`Private`\
index, \[Infinity]]; MatchQ[#1, Alternatives @@ 
                                        TensorCalculus4`Tensorial`Private`\
indices]] &, TensorCalculus4`Tensorial`Private`dummies$, 
                                TensorCalculus4`Tensorial`Private`sslots$, 
                                1]; TensorCalculus4`Tensorial`Private`work$ = \
\((Count[#1, True, \[Infinity]] > 1 &)\) /@ 
                                TensorCalculus4`Tensorial`Private`work$; 
                            Or @@ TensorCalculus4`Tensorial`Private`work$]\), 
                        ";", \(TensorCalculus4`Tensorial`Private`\
processsymmetry$[TensorCalculus4`Tensorial`Private`subsymmetry$_] := 
                          Module[{TensorCalculus4`Tensorial`Private`symtype$ \
= Head[TensorCalculus4`Tensorial`Private`subsymmetry$], 
                              TensorCalculus4`Tensorial`Private`symslots$, 
                              TensorCalculus4`Tensorial`Private`subslots$, 
                              TensorCalculus4`Tensorial`Private`neworder$, 
                              TensorCalculus4`Tensorial`Private`sign$, 
                              TensorCalculus4`Tensorial`Private`newsubslots$},\
 If[TensorCalculus4`Tensorial`Private`symtype$ === List, 
                              Return[
                                TensorCalculus4`Tensorial`Private`subsymmetry$\
]]; TensorCalculus4`Tensorial`Private`symslots$ = \
\(\(TensorCalculus4`Tensorial`Private`subsymmetry$ \
/. \[InvisibleSpace]{TensorCalculus4`Tensorial`Private`args : \((_Integer \
.. )\)} \[RuleDelayed] 
                                      Sort[{TensorCalculus4`Tensorial`Private`\
args}]\) /. \[InvisibleSpace]\((Symmetric | AntiSymmetric)\)[
                                      TensorCalculus4`Tensorial`Private`args \
: \((_List .. )\)] \[Rule] {TensorCalculus4`Tensorial`Private`args}\) \
/. \[InvisibleSpace]\((Symmetric | AntiSymmetric)\)[
                                    TensorCalculus4`Tensorial`Private`args : \
\((_Integer .. )\)] \[RuleDelayed] 
                                  Partition[
                                    Sort[{TensorCalculus4`Tensorial`Private`\
args}], 1]; 
                            TensorCalculus4`Tensorial`Private`subslots$ = \
\((TensorCalculus4`Tensorial`Private`slots$\[LeftDoubleBracket]#1\
\[RightDoubleBracket] &)\) /@ TensorCalculus4`Tensorial`Private`symslots$; 
                            TensorCalculus4`Tensorial`Private`neworder$ = 
                              Ordering[
                                TensorCalculus4`Tensorial`Private`subslots$]; 
                            TensorCalculus4`Tensorial`Private`tsign$ = 
                              Which[TensorCalculus4`Tensorial`Private`symtype$\
 === AntiSymmetric && \((TensorCalculus4`Tensorial`Private`duplicatedummies$[
                                        TensorCalculus4`Tensorial`Private`\
subslots$] || Length[Union[TensorCalculus4`Tensorial`Private`subslots$]] < 
                                        Length[
                                        TensorCalculus4`Tensorial`Private`\
subslots$])\), 0, TensorCalculus4`Tensorial`Private`symtype$ === 
                                  AntiSymmetric, 
                                TensorCalculus4`Tensorial`Private`tsign$\ \
Signature[TensorCalculus4`Tensorial`Private`neworder$]\ Signature[
                                    TensorCalculus4`Tensorial`Private`\
symslots$], True, TensorCalculus4`Tensorial`Private`tsign$]; 
                            TensorCalculus4`Tensorial`Private`newsubslots$ = 
                              Flatten[
                                TensorCalculus4`Tensorial`Private`subslots$\
\[LeftDoubleBracket]TensorCalculus4`Tensorial`Private`neworder$\
\[RightDoubleBracket], 1]; 
                            TensorCalculus4`Tensorial`Private`slots$ = 
                              ReplacePart[
                                TensorCalculus4`Tensorial`Private`slots$, 
                                TensorCalculus4`Tensorial`Private`newsubslots$\
, Partition[Flatten[TensorCalculus4`Tensorial`Private`symslots$, 1], 1], 
                                Partition[
                                  Range[
                                    Length[
                                      TensorCalculus4`Tensorial`Private`\
newsubslots$]], 1]]; List @@ 
                              TensorCalculus4`Tensorial`Private`subsymmetry$]\
\), ";", 
                        RowBox[{"If", "[", 
                          RowBox[{
                          "TensorCalculus4`Tensorial`Private`passedsymmetry$\
103", ",", 
                            
                            RowBox[{\(TensorCalculus4`Tensorial`Private`\
symmetry$ = TensorCalculus4`Tensorial`Private`psymmetry$103\), ";", 
                              RowBox[{"If", "[", 
                                
                                RowBox[{\(q =!= 
                                      TensorCalculus4`Tensorial`Private`\
plabel$103 || TensorCalculus4`Tensorial`Private`order$ =!= 
                                      TensorCalculus4`Tensorial`Private`\
porder$103\), ",", 
                                  RowBox[{"Throw", "[", 
                                    InterpretationBox[
                                      SubsuperscriptBox["q", 
                                        TagBox[
                                        StyleBox["a",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)], "a"],
                                      Tensor[ q, {a}, {Void}],
                                      Editable->False], "]"}]}], "]"}]}], ",",
                             
                            
                            RowBox[{\(TensorCalculus4`Tensorial`Private`\
symmetry$ = TensorSymmetry[q, TensorCalculus4`Tensorial`Private`order$]\), 
                              ";", 
                              RowBox[{"If", "[", 
                                
                                RowBox[{\(Head[
                                      TensorCalculus4`Tensorial`Private`\
symmetry$] === TensorSymmetry\), ",", 
                                  RowBox[{"Throw", "[", 
                                    InterpretationBox[
                                      SubsuperscriptBox["q", 
                                        TagBox[
                                        StyleBox["a",
                                        ShowContents->False],
                                        (
                                        StyleForm[ #, ShowContents -> 
                                        False]&)], "a"],
                                      Tensor[ q, {a}, {Void}],
                                      Editable->False], "]"}]}], "]"}]}]}], 
                          "]"}], ";", 
                        RowBox[{
                        "TensorCalculus4`Tensorial`Private`slots$", "=", 
                          RowBox[{"ExtractTensorSlots", "[", 
                            InterpretationBox[
                              SubsuperscriptBox["q", 
                                TagBox[
                                  StyleBox["a",
                                    ShowContents->False],
                                  (StyleForm[ #, ShowContents -> False]&)], 
                                "a"],
                              Tensor[ q, {a}, {Void}],
                              Editable->False], "]"}]}], 
                        ";", \(Map[
                          TensorCalculus4`Tensorial`Private`processsymmetry$, 
                          TensorCalculus4`Tensorial`Private`symmetry$, {0, \
\(-2\)}]\), ";", \(TensorCalculus4`Tensorial`Private`tsign$\ SlotsToTensor[
                            TensorCalculus4`Tensorial`Private`slots$]\)}]}], 
                    "]"}], "]"}]}]}], ")"}], \(\(;\)\(c\)\)],
        Times[ 2, 
          Plus[ 
            Times[ 
              CovariantD[ 
                Tensor[ q, {a}, {Void}], c], 
              Tensor[ p, {Void, Void}, {a, b}]], 
            Times[ 
              CovariantD[ 
                Tensor[ p, {Void, Void}, {a, b}], c], 
              Tensor[ q, {a}, {Void}]]]],
        Editable->False],
      HoldForm]], "Output",
  CellLabel->"Out[7]="],

Cell[BoxData[
    RowBox[{"2", " ", 
      RowBox[{"(", 
        RowBox[{
          RowBox[{
            InterpretationBox[
              SubscriptBox[
                InterpretationBox[
                  SubsuperscriptBox["q", 
                    TagBox[
                      StyleBox["a",
                        ShowContents->False],
                      (StyleForm[ #, ShowContents -> False]&)], "a"],
                  Tensor[ q, {a}, {Void}],
                  Editable->False], \(\(;\)\(c\)\)],
              CovariantD[ 
                Tensor[ q, {a}, {Void}], c],
              Editable->False], " ", 
            InterpretationBox[
              SubsuperscriptBox["p", \(a  b\), 
                RowBox[{
                  TagBox[
                    StyleBox["a",
                      ShowContents->False],
                    (StyleForm[ #, ShowContents -> False]&)], 
                  TagBox[
                    StyleBox["b",
                      ShowContents->False],
                    (StyleForm[ #, ShowContents -> False]&)]}]],
              Tensor[ p, {Void, Void}, {a, b}],
              Editable->False]}], "+", 
          RowBox[{
            InterpretationBox[
              SubscriptBox[
                InterpretationBox[
                  SubsuperscriptBox["p", \(a  b\), 
                    RowBox[{
                      TagBox[
                        StyleBox["a",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)], 
                      TagBox[
                        StyleBox["b",
                          ShowContents->False],
                        (StyleForm[ #, ShowContents -> False]&)]}]],
                  Tensor[ p, {Void, Void}, {a, b}],
                  Editable->False], \(\(;\)\(c\)\)],
              CovariantD[ 
                Tensor[ p, {Void, Void}, {a, b}], c],
              Editable->False], " ", 
            InterpretationBox[
              SubsuperscriptBox["q", 
                TagBox[
                  StyleBox["a",
                    ShowContents->False],
                  (StyleForm[ #, ShowContents -> False]&)], "a"],
              Tensor[ q, {a}, {Void}],
              Editable->False]}]}], ")"}]}]], "Output",
  CellLabel->"Out[8]="]
}, Open  ]],

Cell[TextData[{
  "The following uses ",
  Cell[BoxData[
      \(EvaluateAtPattern\)]],
  " to perform a trigonometric substitution in a held integral and then make \
a simplification."
}], "Text"],

Cell[CellGroupData[{

Cell[BoxData[{
    \(Integrate[1/\@\(4 + x\^2\), x] // 
      HoldOp[Integrate]\), "\[IndentingNewLine]", 
    \(Print["\<Substitute \>", 
      x \[Rule] 2\ Tan[\[Theta]]]\), "\[IndentingNewLine]", 
    \(\(%% // 
        EvaluateAtPattern[
          a : Power[_, _], \[Infinity], \((\(# /. 
                  a : Power[_, \(-1\)/2] \[Rule] 
                    a\ D[2\ Tan[\[Theta]], \[Theta]]\) /. 
                x \[Rule] 
                  2\ Tan[\[Theta]])\) &];\)\), "\[IndentingNewLine]", 
    \(% /. x \[Rule] \[Theta]\), "\[IndentingNewLine]", 
    \(% // EvaluateAtPattern[HoldPattern[Times[_, __]], \[Infinity], 
        Simplify[#, \(-\[Pi]\)/2 < \[Theta] < \[Pi]/
                2] &]\), "\[IndentingNewLine]", 
    \(\(step1 = % + C // ReleaseHold;\)\), "\[IndentingNewLine]", 
    \(\(% /. Log[a_] - Log[b_] \[Rule] Log[a/b];\)\), "\[IndentingNewLine]", 
    \(\(\(% // TrigToExp\) // Simplify;\)\), "\[IndentingNewLine]", 
    \(\(% /. \[Theta] \[Rule] ArcTan[x/2];\)\), "\[IndentingNewLine]", 
    \(\(ComplexExpand[%, 
        TargetFunctions \[Rule] {Re, Im}];\)\), "\[IndentingNewLine]", 
    \(Simplify[%, x \[Element] Reals]\)}], "Input",
  CellLabel->"In[9]:="],

Cell[BoxData[
    TagBox[\(\[Integral]\(1\/\@\(4 + x\^2\)\) \[DifferentialD]x\),
      HoldForm]], "Output",
  CellLabel->"Out[9]="],

Cell[BoxData[
    InterpretationBox[\("Substitute "\[InvisibleSpace]\(x \[Rule] 
          2\ Tan[\[Theta]]\)\),
      SequenceForm[ "Substitute ", x -> Times[ 2, 
          Tan[ \[Theta]]]],
      Editable->False]], "Print",
  CellLabel->"From In[9]:="],

Cell[BoxData[
    TagBox[\(\[Integral]\(\(2\ Sec[\[Theta]]\^2\)\/\@\(4 + 4\ \
Tan[\[Theta]]\^2\)\) \[DifferentialD]\[Theta]\),
      HoldForm]], "Output",
  CellLabel->"Out[12]="],

Cell[BoxData[
    TagBox[\(\[Integral]Sec[\[Theta]] \[DifferentialD]\[Theta]\),
      HoldForm]], "Output",
  CellLabel->"Out[13]="],

Cell[BoxData[
    \(C - 
      1\/2\ Log[\(4 + x\^2 - x\ \@\(4 + x\^2\)\)\/\(4 + x\^2 + x\ \@\(4 + \
x\^2\)\)]\)], "Output",
  CellLabel->"Out[19]="]
}, Open  ]],

Cell["Restore state", "Text"],

Cell[BoxData[
    \(ClearTensorShortcuts[{{q}, 1}, {{p}, 2}]\)], "Input",
  CellLabel->"In[20]:="]
}, Open  ]]
}, Open  ]]
},
FrontEndVersion->"5.2 for Microsoft Windows",
ScreenRectangle->{{0, 1680}, {0, 965}},
ScreenStyleEnvironment->"Working",
WindowToolbars->{},
WindowSize->{745, 456},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
ShowSelection->True,
CommonDefaultFormatTypes->{"Output"->StandardForm},
Magnification->1,
StyleDefinitions -> "HelpBrowser.nb"
]

(*******************************************************************
Cached data follows.  If you edit this Notebook file directly, not
using Mathematica, you must remove the line containing CacheID at
the top of  the file.  The cache data will then be recreated when
you save this file from within Mathematica.
*******************************************************************)

(*CellTagsOutline
CellTagsIndex->{
  "Function?"->{
    Cell[1776, 53, 64, 1, 41, "ObjectName",
      CellTags->"Function?"],
    Cell[1843, 56, 574, 20, 50, "Usage",
      CellTags->"Function?"]}
  }
*)

(*CellTagsIndex
CellTagsIndex->{
  {"Function?", 63261, 1313}
  }
*)

(*NotebookFileOutline
Notebook[{

Cell[CellGroupData[{
Cell[1776, 53, 64, 1, 41, "ObjectName",
  CellTags->"Function?"],
Cell[1843, 56, 574, 20, 50, "Usage",
  CellTags->"Function?"],
Cell[2420, 78, 116, 3, 41, "MathCaption"],
Cell[2539, 83, 139, 6, 41, "MathCaption"],

Cell[CellGroupData[{
Cell[2703, 93, 34, 0, 39, "ExampleSection"],
Cell[2740, 95, 96, 2, 29, "Input"],
Cell[2839, 99, 98, 2, 29, "Input"],
Cell[2940, 103, 278, 6, 42, "Text"],

Cell[CellGroupData[{
Cell[3243, 113, 330, 6, 89, "Input"],
Cell[3576, 121, 2660, 69, 30, "Output"],
Cell[6239, 192, 1426, 39, 30, "Output"],
Cell[7668, 233, 2280, 58, 29, "Output"]
}, Open  ]],
Cell[9963, 294, 307, 9, 42, "Text"],

Cell[CellGroupData[{
Cell[10295, 307, 263, 5, 69, "Input"],
Cell[10561, 314, 2660, 69, 30, "Output"],
Cell[13224, 385, 44518, 770, 6093, "Output"],
Cell[57745, 1157, 2280, 58, 29, "Output"]
}, Open  ]],
Cell[60040, 1218, 197, 6, 25, "Text"],

Cell[CellGroupData[{
Cell[60262, 1228, 1188, 23, 256, "Input"],
Cell[61453, 1253, 132, 3, 44, "Output"],
Cell[61588, 1258, 254, 6, 23, "Print"],
Cell[61845, 1266, 179, 4, 48, "Output"],
Cell[62027, 1272, 132, 3, 39, "Output"],
Cell[62162, 1277, 149, 4, 49, "Output"]
}, Open  ]],
Cell[62326, 1284, 29, 0, 25, "Text"],
Cell[62358, 1286, 98, 2, 29, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)



(*******************************************************************
End of Mathematica Notebook file.
*******************************************************************)

