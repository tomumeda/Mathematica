(* Content-type: application/mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 7.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       145,          7]
NotebookDataLength[   1917457,      45957]
NotebookOptionsPosition[   1911368,      45859]
NotebookOutlinePosition[   1911810,      45878]
CellTagsIndexPosition[   1911767,      45875]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[TextData[{
 "This notebook contains Module[]s and definitions that have been useful in \
applying ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " to physics problems.  The contents of this file is always in development \
as new needs are addressed or bugs found."
}], "Text",
 CellChangeTimes->{{3.746303284500805*^9, 
  3.746303450291175*^9}},ExpressionUUID->"8490fecd-4fd3-426c-855f-\
640bdb564157"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"BeginPackage", "[", "\"\<tuQFTToolKit2`\>\"", "]"}], ";"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.666498643222073*^9, 3.6664986519795227`*^9}, 
   3.666499689970216*^9, {3.666534649208027*^9, 3.6665346920959063`*^9}, 
   3.666541680472727*^9},ExpressionUUID->"e9b3371a-a3e5-4d39-b046-\
0e708a41bc22"],

Cell[TextData[{
 "Revised definitions.  (The goal is streamline and generalize the \
definitions for most QFT problems.  Unfortunately, the metric tensor is \
defined differently between Srednicki\n(negative time) and Peskin-Schroeder \
(positive time).  We will use P-S convention here. )  We will use the \
Tensorial package for the primary notational basis.   The developmental Dot \
and IntegralOp functions are also incorporated.  The Dot[] function is used \
to maintain non-communicative relationship between products.  Most \
relationships will be maintained as Rule[] since ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " changes the position of terms in Equal[[] relationships."
}], "Text",
 CellChangeTimes->{{3.475327771927926*^9, 3.475327795604416*^9}, {
  3.4753278343184958`*^9, 3.475328036401976*^9}, {3.475328152556926*^9, 
  3.4753282968651867`*^9}, {3.4753284939034557`*^9, 3.475328512244706*^9}, {
  3.4753298929719687`*^9, 3.475329962196875*^9}, {3.475329997312049*^9, 
  3.475330030626697*^9}, {3.4753333336267138`*^9, 3.4753333941058693`*^9}, {
  3.475333638454989*^9, 3.4753337240466433`*^9}, {3.666498631493349*^9, 
  3.66649863705226*^9}, {3.7411840097833157`*^9, 
  3.741184020972124*^9}},ExpressionUUID->"e96418e5-ebbc-4725-a249-\
b488bf3a3d83"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"External", " ", "packages"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Needs", "[", "\"\<TensorForms1V6`TensorialForms`\>\"", "]"}], 
    ";", "\[IndentingNewLine]", "TensorialHelp", ";"}], "\[IndentingNewLine]",
    "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"WARNING", ":", " ", 
    RowBox[{
     RowBox[{"Needs", "[", "\"\<TensorCalculus5`Tensorial`\>\"", "]"}], "  ", 
     "called", " ", "in", " ", "TensorialForms"}]}], "  ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Needs", "[", "\"\<VariationalMethods`\>\"", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"**", "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], 
    "********)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"The", " ", "display", " ", "definitions", " ", "of", " ", 
     RowBox[{"Tensor", "[", "]"}], " ", "from", " ", 
     RowBox[{"TensorialForms", "."}]}], "   ", "*)"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"Tensor", "[", "A_", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], "@@", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MakeBoxes", "[", 
         RowBox[{"A", ",", "form"}], "]"}], ",", 
        RowBox[{"Tensor", "[", "A", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"Tensor", "[", 
        RowBox[{"A_", ",", "up_List", ",", "down_List"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"newdown", "=", "down"}], ",", 
         RowBox[{"newup", "=", "up"}], ",", "makespace"}], "}"}], ",", 
       RowBox[{
        RowBox[{"makespace", "=", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#1", "===", "Void"}], ",", 
            RowBox[{"Style", "[", 
             RowBox[{"#2", ",", 
              RowBox[{"ShowContents", "\[Rule]", "False"}]}], "]"}], ",", 
            "#1"}], "]"}], "&"}]}], ";", 
        RowBox[{"newup", "=", 
         RowBox[{"Inner", "[", 
          RowBox[{"makespace", ",", "newup", ",", "newdown", ",", "List"}], 
          "]"}]}], ";", 
        RowBox[{"newdown", "=", 
         RowBox[{"Inner", "[", 
          RowBox[{"makespace", ",", "newdown", ",", "newup", ",", "List"}], 
          "]"}]}], ";", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"InterpretationBox", "[", 
            RowBox[{"#1", ",", "#2", ",", 
             RowBox[{"Editable", "\[Rule]", "False"}], ",", 
             RowBox[{"BaseStyle", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"AutoMultiplicationSymbol", "\[Rule]", "False"}], 
               "}"}]}]}], 
            StyleBox["\n",
             
             FontColor->RGBColor[
              0.9764705882352941, 0.9764705882352941, 0.9764705882352941]], 
            "]"}], "&"}], ")"}], "@@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"SubsuperscriptBox", "[", 
            RowBox[{
             RowBox[{"MakeBoxes", "[", 
              RowBox[{"A", ",", "form"}], "]"}], ",", 
             StyleBox["\n",
              
              FontColor->RGBColor[
               0.9764705882352941, 0.9764705882352941, 0.9764705882352941]], 
             RowBox[{"RowBox", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"MakeBoxes", "[", 
                  RowBox[{"#1", ",", "form"}], "]"}], "&"}], ")"}], "/@", 
               "newdown"}], "]"}], ",", 
             RowBox[{"RowBox", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"MakeBoxes", "[", 
                  RowBox[{"#1", ",", "form"}], "]"}], "&"}], ")"}], "/@", 
               "newup"}], "]"}]}], "]"}], ",", 
           RowBox[{"Tensor", "[", 
            RowBox[{"A", ",", "up", ",", "down"}], "]"}]}], "}"}]}]}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"**", 
     RowBox[{"*", "Simple", " ", "ways", " ", "of", " ", "defining", " ", 
      RowBox[{"Tensor", "[", "]"}]}]}], " ", "****)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"T", "::", "usage"}], "=", 
     "\"\<T[A_,up_List,down_List] produces any Tensor[A_,up_List,down_list]. \
Checks for proper indices. \[IndentingNewLine]A_ can be functional labels. \
Uses Null List item to hold slot in index list, e.g., \
T[A,{,i},{j,}\[Rule]\!\(\*SuperscriptBox[SubscriptBox[\(T\), \(j\)], \
\(i\)]\).\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"T", "[", 
      RowBox[{"A_", ",", "up_List", ",", "down_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"u", "=", 
          RowBox[{"up", "/.", 
           RowBox[{"Null", "->", "Void"}]}]}], ",", 
         RowBox[{"d", "=", 
          RowBox[{"down", "/.", 
           RowBox[{"Null", "->", "Void"}]}]}], ",", "return"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"up", "==", 
            RowBox[{"{", "}"}]}], "&&", 
           RowBox[{"down", "==", 
            RowBox[{"{", "}"}]}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Tensor", "[", 
            RowBox[{"A", ",", "up", ",", "down"}], "]"}], "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "Scalar", " ", "Tensor", " ", "with", " ", "no", " ", "indices"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{"{", "}"}], " ", "index", " ", "case"}], " ", "->", " ", 
          RowBox[{"entirely", " ", "other", " ", "index"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"up", "==", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"u", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"Void", ",", 
             RowBox[{"{", 
              RowBox[{"Length", "[", "d", "]"}], "}"}]}], "]"}]}]}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"down", "==", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"d", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"Void", ",", 
             RowBox[{"{", 
              RowBox[{"Length", "[", "u", "]"}], "}"}]}], "]"}]}]}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "d", "]"}], "==", 
            RowBox[{"Length", "[", "u", "]"}]}], "&&", "\[IndentingNewLine]", 
           
           RowBox[{"(", 
            RowBox[{"!", 
             RowBox[{"Inner", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"#1", "=!=", "Void"}], "&&", 
                  RowBox[{"#2", "=!=", "Void"}]}], "||", 
                 RowBox[{
                  RowBox[{"#1", "===", "Void"}], "&&", 
                  RowBox[{"#2", "===", "Void"}]}]}], "&"}], ",", "u", ",", 
               "d", ",", "Or"}], "]"}]}], ")"}]}], ",", 
          RowBox[{"(*", 
           RowBox[{"index", " ", "check"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Tensor", "[", 
           RowBox[{"A", ",", "u", ",", "d"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Style", "[", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"A", ",", "up", ",", "down"}], "]"}], ",", 
            RowBox[{"FontColor", "->", "Red"}]}], "]"}]}], 
         RowBox[{"(*", 
          RowBox[{"Error", " ", "condition"}], "*)"}], "\[IndentingNewLine]", 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"T", "::", "usage"}], "=", 
     "\"\<T[A_,uds_String,index_List] produces any Tensor where uds_String \
specifies up/down position of index_, e.g., \
T[Symbol\\\"udd\\\",{i,j,k}]->((\!\(\*SuperscriptBox[\(Symbol\), \(i\)]\)\!\(\
\*SubscriptBox[\()\), \(jk\)]\))\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"T", "[", 
      RowBox[{"A_", ",", "uds_String", ",", "index_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"ud", "=", 
          RowBox[{"Characters", "[", "uds", "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{"ud", ",", 
             RowBox[{"Except", "[", 
              RowBox[{"\"\<u\>\"", "|", "\"\<d\>\""}], "]"}]}], "]"}], "===", 
           
           RowBox[{"{", "}"}]}], "&&", 
          RowBox[{"(*", 
           RowBox[{"only", " ", "u", " ", "and", " ", "d", " ", "allowed"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"tmp", "=", 
             RowBox[{"Which", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Head", "[", "index", "]"}], "===", "List"}], "&&", 
                RowBox[{
                 RowBox[{"Length", "[", "ud", "]"}], "==", 
                 RowBox[{"Length", "[", "index", "]"}]}]}], ",", 
               RowBox[{"(*", 
                RowBox[{
                "check", " ", "list", " ", "parameter", " ", 
                 "compatibility"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"Tensor", "[", 
                RowBox[{"A", ",", 
                 RowBox[{"MapThread", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#1", "===", "\"\<u\>\""}], ",", "#2", ",", 
                    "Void"}], "]"}], ")"}], "&"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"ud", ",", "index"}], "}"}]}], "]"}], ",", 
                 RowBox[{"MapThread", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#1", "===", "\"\<d\>\""}], ",", "#2", ",", 
                    "Void"}], "]"}], ")"}], "&"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"ud", ",", "index"}], "}"}]}], "]"}]}], "]"}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"ud", "===", 
                RowBox[{"{", "\"\<u\>\"", "}"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"Tensor", "[", 
                RowBox[{"A", ",", 
                 RowBox[{"{", "index", "}"}], ",", 
                 RowBox[{"{", "Void", "}"}]}], "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"ud", "===", 
                RowBox[{"{", "\"\<d\>\"", "}"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"Tensor", "[", 
                RowBox[{"A", ",", 
                 RowBox[{"{", "Void", "}"}], ",", 
                 RowBox[{"{", "index", "}"}]}], "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"no", " ", "list", " ", "index"}], "*)"}], 
               "\[IndentingNewLine]", "True", ",", 
               RowBox[{"(*", "error", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"-", "1"}]}], "]"}]}], ")"}], "=!=", 
           RowBox[{"-", "1"}]}]}], ",", "tmp", ",", "\[IndentingNewLine]", 
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"A", ",", "uds", ",", "index"}], "]"}], ",", 
           RowBox[{"FontColor", "->", "Red"}]}], "]"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OnlyudQ", "[", "string_", "]"}], ":=", 
     RowBox[{
      RowBox[{"StringCases", "[", 
       RowBox[{"string", ",", 
        RowBox[{"Except", "[", 
         RowBox[{"{", 
          RowBox[{"\"\<d\>\"", ",", "\"\<u\>\""}], "}"}], "]"}]}], " ", "]"}],
       "\[Equal]", 
      RowBox[{"{", "}"}]}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Alternate", " ", "format", " ", "for", " ", "T"}], ":=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"T", "[", 
        RowBox[{"symbol", ",", "\"\<UpDownString\>\""}], "]"}], "[", 
       "indices", "]"}], " ", "7", "Apr2012"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"T", "::", "usage"}], "=", 
     "\"\<T[A_,uds_String][index0__] produces any Tensor where uds_String \
specifies up/down position of index_, e.g.,T[Symbol,\\\"udd\\\"][i,j,k]->((\!\
\(\*SuperscriptBox[\(Symbol\), \(i\)]\)\!\(\*SubscriptBox[\()\), \(jk\)]\))\>\
\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"T", "[", 
       RowBox[{"A_", ",", "uds_String"}], "]"}], "[", "index0__", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"ud", "=", 
          RowBox[{"Characters", "[", "uds", "]"}]}], ",", 
         RowBox[{"index", "=", 
          RowBox[{"{", "index0", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{"ud", ",", 
             RowBox[{"Except", "[", 
              RowBox[{"\"\<u\>\"", "|", "\"\<d\>\""}], "]"}]}], "]"}], "===", 
           
           RowBox[{"{", "}"}]}], "&&", 
          RowBox[{"(*", 
           RowBox[{"only", " ", "u", " ", "and", " ", "d", " ", "allowed"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"tmp", "=", 
             RowBox[{"Which", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Head", "[", "index", "]"}], "===", "List"}], "&&", 
                RowBox[{
                 RowBox[{"Length", "[", "ud", "]"}], "==", 
                 RowBox[{"Length", "[", "index", "]"}]}]}], ",", 
               RowBox[{"(*", 
                RowBox[{
                "check", " ", "list", " ", "parameter", " ", 
                 "compatibility"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"Tensor", "[", 
                RowBox[{"A", ",", 
                 RowBox[{"MapThread", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#1", "===", "\"\<u\>\""}], ",", "#2", ",", 
                    "Void"}], "]"}], ")"}], "&"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"ud", ",", "index"}], "}"}]}], "]"}], ",", 
                 RowBox[{"MapThread", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#1", "===", "\"\<d\>\""}], ",", "#2", ",", 
                    "Void"}], "]"}], ")"}], "&"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"ud", ",", "index"}], "}"}]}], "]"}]}], "]"}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"ud", "===", 
                RowBox[{"{", "\"\<u\>\"", "}"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"Tensor", "[", 
                RowBox[{"A", ",", 
                 RowBox[{"{", "index", "}"}], ",", 
                 RowBox[{"{", "Void", "}"}]}], "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"ud", "===", 
                RowBox[{"{", "\"\<d\>\"", "}"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"Tensor", "[", 
                RowBox[{"A", ",", 
                 RowBox[{"{", "Void", "}"}], ",", 
                 RowBox[{"{", "index", "}"}]}], "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"no", " ", "list", " ", "index"}], "*)"}], 
               "\[IndentingNewLine]", "True", ",", 
               RowBox[{"(*", "error", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"-", "1"}]}], "]"}]}], ")"}], "=!=", 
           RowBox[{"-", "1"}]}]}], ",", "tmp", ",", "\[IndentingNewLine]", 
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"A", ",", "uds", ",", "index"}], "]"}], ",", 
           RowBox[{"FontColor", "->", "Red"}]}], "]"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"**", "**", "**", "**", "**", "**", "**"}], "********)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "This", " ", "a", " ", "a", " ", "replacement", " ", "routine", " ", 
      "that", " ", "includes", " ", "DerivOps"}], ",", " ", 
     RowBox[{
      RowBox[{"etc", ".", "  ", "The", " ", ".", "m"}], " ", "version", " ", 
      "does", " ", "not", " ", "work", " ", "for", " ", "some", " ", 
      RowBox[{"reason", ".", "  ", "Uses"}], " ", "Tensorial", " ", 
      RowBox[{"routines", "."}], " ", "*", "5", "Sep2015"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"DELETE", " ", 
        RowBox[{
         RowBox[{"xArrayExpansion", "[", 
          RowBox[{"indices_List", ",", 
           RowBox[{"baseindices_", " ", ":", "Automatic"}]}], "]"}], "[", 
         "expr_", "]"}]}], "/;", 
       RowBox[{"MatchQ", "[", 
        RowBox[{"baseindices", ",", 
         RowBox[{"Automatic", "|", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"_Integer", "|", "_Symbol"}], ")"}], ".."}], "}"}], "|", 
          
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"_Integer", "|", "_Symbol"}], ")"}], ".."}], "}"}], 
            ".."}], "}"}]}]}], "]"}]}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "idx", ",", "inindex", ",", "wbaseindices", ",", "indexstructure", 
          ",", "wstructure", ",", "replace", ",", "uq", ",", "q", ",", 
          "uqreplace"}], "}"}], ",", 
        RowBox[{
         RowBox[{"wbaseindices", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"VectorQ", "[", "baseindices", "]"}], ",", 
            RowBox[{"{", "baseindices", "}"}], ",", "baseindices"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"indexstructure", "=", 
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"index", ",", "bases", ",", "subbases"}], "}"}], ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"index", "=", 
                RowBox[{"Part", "[", 
                 RowBox[{"indices", ",", "idx"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"bases", "=", 
                RowBox[{"GetBaseIndices", "[", "index", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"subbases", "=", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", "wbaseindices", "]"}], 
                   "\[GreaterEqual]", "idx"}], ",", 
                  RowBox[{"Part", "[", 
                   RowBox[{"wbaseindices", ",", "idx"}], "]"}], ",", 
                  "bases"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"\[Not]", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Intersection", "[", 
                    RowBox[{"subbases", ",", "bases"}], "]"}], "===", 
                    RowBox[{"Sort", "[", "subbases", "]"}]}], ")"}]}], ",", 
                 RowBox[{
                  RowBox[{"Message", "[", 
                   RowBox[{
                    RowBox[{"SumArrayExpansion", "::", "subset"}], ",", 
                    "subbases", ",", "bases"}], "]"}], ";", 
                  RowBox[{"Abort", "[", "]"}]}], ",", 
                 RowBox[{"bases", "=", "subbases"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"index", ",", "bases"}], "}"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"idx", ",", "1", ",", 
                RowBox[{"Length", "[", "indices", "]"}]}], "}"}]}], "]"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"inindex", "[", "i_", "]"}], ":=", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Count", "[", 
              RowBox[{
               RowBox[{"{", "expr", "}"}], ",", 
               RowBox[{
                RowBox[{"Tensor", "[", 
                 RowBox[{"_", ",", 
                  RowBox[{"up_", "/;", 
                   RowBox[{"\[Not]", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"up", ",", "i", ",", "1"}], "]"}]}]}], ",", 
                  "down_"}], "]"}], "|", 
                RowBox[{"Tensor", "[", 
                 RowBox[{"_", ",", "up_", ",", 
                  RowBox[{"down_", "/;", 
                   RowBox[{"\[Not]", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"down", ",", "i", ",", "1"}], "]"}]}]}]}], "]"}], 
                "|", "\[IndentingNewLine]", 
                RowBox[{"Map", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"HoldPattern", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"_", ",", "i"}], "]"}], "]"}], "&"}], ",", 
                  "DerivOps"}], "]"}]}], ",", "\[Infinity]", ",", 
               RowBox[{"Heads", "\[Rule]", "True"}]}], "]"}], ">", "0"}], 
            "\[And]", 
            RowBox[{"\[Not]", 
             RowBox[{"BaseIndexQ", "[", "i", "]"}]}]}], ")"}]}], ";", "\n", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"replace", "[", 
           RowBox[{"i_", ",", "newindex_"}], "]"}], ":=", 
          RowBox[{"Switch", "[", 
           RowBox[{
            RowBox[{"Head", "[", "i", "]"}], ",", 
            RowBox[{"_", "?", "IndexFlavorQ"}], ",", 
            RowBox[{
             RowBox[{"Head", "[", "i", "]"}], "[", "newindex", "]"}], ",", 
            "_", ",", "newindex"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"uqreplace", "[", "i_", "]"}], ":=", 
          RowBox[{"Switch", "[", 
           RowBox[{
            RowBox[{"Head", "[", "i", "]"}], ",", 
            RowBox[{"_", "?", "IndexFlavorQ"}], ",", 
            RowBox[{
             RowBox[{"Head", "[", "i", "]"}], "[", "q", "]"}], ",", "_", ",", 
            "q"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"wstructure", "=", 
          RowBox[{"Select", "[", 
           RowBox[{"indexstructure", ",", 
            RowBox[{
             RowBox[{"inindex", "[", 
              RowBox[{"First", "[", "#", "]"}], "]"}], "&"}]}], "]"}]}], ";", 
         "\n", "\[IndentingNewLine]", 
         RowBox[{"Fold", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"List", "@@", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#1", "//", 
                  RowBox[{"tuIndexChange", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "[", "#2", "]"}], ",", 
                    RowBox[{"uq", "=", 
                    RowBox[{"uqreplace", "[", 
                    RowBox[{"First", "[", "#2", "]"}], "]"}]}]}], "}"}], 
                   "]"}]}], ")"}], "/.", 
                RowBox[{"uq", "\[Rule]", 
                 RowBox[{"replace", "[", 
                  RowBox[{
                   RowBox[{"First", "[", "#2", "]"}], ",", 
                   RowBox[{"Part", "[", 
                    RowBox[{
                    RowBox[{"Last", "[", "#2", "]"}], ",", "idx"}], "]"}]}], 
                  "]"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"idx", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{"Last", "[", "#2", "]"}], "]"}]}], "}"}]}], "]"}]}],
             "&"}], ",", "expr", ",", 
           RowBox[{"Reverse", "[", "wstructure", "]"}]}], "]"}]}]}], "\n", 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tuArraySum", "::", "usage"}], "=", 
      "\"\<tuArraySum[index_List][exp_] sums xArrayExpansion results.\>\""}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"tuArraySum", "[", "index_List", "]"}], "[", "exp_", "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"Fold", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Apply", "[", 
              RowBox[{"Plus", ",", 
               RowBox[{
                RowBox[{"xArrayExpansion", "[", 
                 RowBox[{"{", "#2", "}"}], "]"}], "[", "#1", "]"}]}], "]"}], 
             "&"}], ",", "exp", ",", "index"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"xArraySum", "[", "index_List", "]"}], "[", "exp_", "]"}], ":=", 
      RowBox[{
       RowBox[{"tuArraySum", "[", "index", "]"}], "[", "exp", "]"}]}], ";"}], 
    
    RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuEinsteinSum", "::", "usage"}], "=", 
     "\"\<tuEinsteinSum[baseindices_:Automatic][exp_] uses EinsteinSum[] but \
includes functions defined in DerivOps. baseindices_ can be Automatic[ly] \
defined by DeclareBaseIndices[] or explicitly, e.g. {1,2,3} or {i1,i2,i3}. \
*3Aug2012*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuEinsteinSum", "[", 
       RowBox[{"baseindices_:", "Automatic"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"ExpandAll", "[", "exp", "]"}]}], ",", "xtmp", ",", "sub", 
         ",", 
         RowBox[{"OPS", "=", "DerivOps"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"EinsteinSum", "[", "baseindices", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"a__", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"OP", ":", "DerivOps"}], ")"}], "[", 
             RowBox[{"d_", ",", "$e_"}], "]"}]}], ":>", 
           RowBox[{
            RowBox[{
             RowBox[{"xArraySum", "[", 
              RowBox[{"{", "$e", "}"}], "]"}], "[", 
             RowBox[{"a", " ", 
              RowBox[{"OP", "[", 
               RowBox[{"d", ",", "$e"}], "]"}]}], "]"}], "/;", " ", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"ExtractDummyIndices", "[", 
               RowBox[{"a", " ", 
                RowBox[{"OP", "[", 
                 RowBox[{"d", ",", "$e"}], "]"}]}], "]"}], ",", "$e"}], 
             "]"}]}]}]}]}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"xEinsteinSum", "[", 
       RowBox[{"baseindices_:", "Automatic"}], "]"}], "[", "exo_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuEinsteinSum", "[", "baseindices", "]"}], "[", "exp", "]"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"SumTermsWithTU", "[", "index_List", "]"}], "[", "exp_", "]"}], 
     " ", "applies", " ", "Sum", " ", "to", " ", "Times", " ", "terms", " ", 
     "in", " ", "exp_", "  ", "where", " ", "index_List", " ", "is", " ", 
     "form", " ", "of", " ", "the", " ", 
     RowBox[{"Sum", "[", 
      RowBox[{"_", ",", "arg"}], "]"}], " ", 
     RowBox[{"arg", ".", "   ", "Intended"}], " ", "to", " ", "extend", " ", 
     RowBox[{"EinsteinSum", ".", " ", "Does"}], " ", "not", " ", "observe", 
     " ", "UpDown", " ", 
     RowBox[{"convention", ".", "  ", "Returns"}], " ", "xSum", " ", "to", 
     " ", "allow", " ", "checking", " ", "of", " ", 
     RowBox[{"expression", "."}], " ", "*", "5", "Mar2014"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"SumTermsWithTU", "[", "index_List", "]"}], "[", "exp_", "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "iterm", ",", "noiterm", ",", "$i",
          ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "associative", " ", "operators", " ", "that", " ", "this", " ", 
           "can", " ", "be", " ", "applied", " ", "on"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"ops", "=", 
          RowBox[{"Times", "|", "Dot", "|", "xDot"}]}]}], 
        "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", "Expand"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"op", ":", "ops"}], "->", 
              RowBox[{"OP", "[", "op", "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"$i", ",", 
             RowBox[{"index", "[", 
              RowBox[{"[", "$i", "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", "tmp", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"OP", "[", 
                RowBox[{"op", ":", "_"}], "]"}], "[", "a__", "]"}], ":>", 
              RowBox[{
               RowBox[{"iterm", "[", 
                RowBox[{"Apply", "[", 
                 RowBox[{"op", ",", 
                  RowBox[{"Select", "[", 
                   RowBox[{
                    RowBox[{"{", "a", "}"}], ",", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{"$i", ",", "1"}], "]"}], "]"}]}], "]"}]}], 
                    "&"}]}], "  ", "]"}]}], "]"}], "]"}], 
               RowBox[{"noiterm", "[", 
                RowBox[{"Apply", "[", 
                 RowBox[{"op", ",", 
                  RowBox[{"Select", "[", 
                   RowBox[{
                    RowBox[{"{", "a", "}"}], ",", 
                    RowBox[{
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{"$i", ",", "1"}], "]"}], "]"}]}], " ", "]"}], 
                    "&"}]}], "]"}]}], "]"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"iterm", "[", "a_", "]"}], ":>", 
              RowBox[{
               RowBox[{"iterm", "[", 
                RowBox[{"xSum", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"index", "[", 
                   RowBox[{"[", "$i", "]"}], "]"}]}], "]"}], "]"}], "/;", 
               RowBox[{"!", 
                RowBox[{"FreeQ", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"index", "[", 
                   RowBox[{"[", 
                    RowBox[{"$i", ",", "1"}], "]"}], "]"}]}], "]"}]}]}]}]}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"tmp", "/.", 
               RowBox[{
                RowBox[{"iterm", "[", "a_", "]"}], "->", "a"}]}], "/.", 
              RowBox[{
               RowBox[{"noiterm", "[", "a_", "]"}], "->", "a"}]}], "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"OP", "[", "op_", "]"}], "[", "a__", "]"}], ":>", 
              RowBox[{"op", "[", "a", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", "tmp", "]"}]}], ",", "\[IndentingNewLine]", 
          
          RowBox[{"{", 
           RowBox[{"$i", ",", 
            RowBox[{"Length", "[", "index", "]"}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*****)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Past", " ", "definitions"}], "*)"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"DeclareZeroTensor", "[", "zero", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"TensorLabelFormat", "[", 
      RowBox[{"zero", ",", "0"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"<<", "Local`LocalFunctions`"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"<<", "Local`CommonPR2`"}], "\[IndentingNewLine]", 
   RowBox[{"<<", "Local`Utilities2`"}], "\[IndentingNewLine]", 
   RowBox[{"tuSaveFile", ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "DotFunctions", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"IntegralFunctions", " ", "already", " ", "included"}], "*)"}], 
   RowBox[{"(*", "\n", "IntegrateSumFunctions", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Some", " ", "mathematical", " ", "relationships", " ", "are", " ", 
       "different", " ", "in", " ", "Peskin"}], "-", "Schroeder"}], ",", " ", 
     
     RowBox[{"e", ".", "g", "."}], ",", " ", 
     RowBox[{
      RowBox[{"Civita", " ", "Tensor", " ", "index", " ", 
       RowBox[{"sums", ".", "  ", "Setting"}], " ", "this", " ", "to", " ", 
       "1", " ", "use", " ", "the", " ", "Peskin"}], "-", 
      RowBox[{"Schroeder", " ", 
       RowBox[{"relationship", "."}]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PeskinSchroederMode", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Area", " ", "for", " ", "specific", " ", "assignments", " ", "of", " ", 
     "variables", " ", "for", " ", "all", " ", 
     RowBox[{"problems", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Indices4D", "=", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "2", ",", "3"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"DeclareIndexFlavor", "[", 
      RowBox[{"{", 
       RowBox[{"field", ",", "Green"}], "}"}], "]"}], "\[IndentingNewLine]", 
     RowBox[{"DeclareIndexFlavor", "[", 
      RowBox[{"{", 
       RowBox[{"space", ",", "Red"}], "}"}], "]"}], "\[IndentingNewLine]", 
     RowBox[{"DeclareIndexFlavor", "[", 
      RowBox[{"{", 
       RowBox[{"timespace", ",", "Magenta"}], "}"}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"DeclareIndexFlavor", "[", 
      RowBox[{"{", 
       RowBox[{"feyn", ",", "Orange"}], "}"}], "]"}], "\[IndentingNewLine]", 
     RowBox[{"DeclareIndexFlavor", "[", 
      RowBox[{"{", 
       RowBox[{"groupR", ",", "Blue"}], "}"}], "]"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"timespace", ",", 
      RowBox[{"{", 
       RowBox[{"Flat", ",", "OneIdentity", ",", "Listable"}], "}"}]}], "]"}], 
    ";"}], 
   RowBox[{"(*", 
    RowBox[{"eliminates", " ", "double", " ", "calls"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DeclareBaseIndices", "[", 
     RowBox[{"Indices4D", ",", 
      RowBox[{"{", 
       RowBox[{"field", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"feyn", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4", ",", "5"}], "}"}]}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"space", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"timespace", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"groupR", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "CompleteBaseIndices", "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "QCDBaseIndices", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"QCDBaseIndices", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DeclareIndexFlavor", "[", 
         RowBox[{"{", 
          RowBox[{"color", ",", "Brown"}], "}"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"DeclareIndexFlavor", "[", 
         RowBox[{"{", 
          RowBox[{"flavor", ",", "Orange"}], "}"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"DeclareIndexFlavor", "[", 
         RowBox[{"{", 
          RowBox[{"family", ",", 
           RowBox[{"Darker", "[", "Green", "]"}]}], "}"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AddBaseIndex", "[", 
         RowBox[{"{", 
          RowBox[{"gaugeG", ",", 
           RowBox[{"{", 
            RowBox[{
            "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", 
             ",", "8"}], "}"}]}], "}"}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"SU", "[", "3", "]"}], " ", "gauge", " ", "group", " ", 
          "index"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"AddBaseIndex", "[", 
         RowBox[{"{", 
          RowBox[{"color", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"SU", "[", "3", "]"}], " ", "singlet", " ", "index"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"AddBaseIndex", "[", 
         RowBox[{"{", 
          RowBox[{"flavor", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6"}], 
            "}"}]}], "}"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"correspondence", ":", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"u", ",", "c", ",", "t", ",", " ", 
              RowBox[{
               RowBox[{"with", " ", "Q"}], "=", 
               RowBox[{"2", "/", "3"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"d", ",", "s", ",", "b", ",", " ", 
              RowBox[{
               RowBox[{"with", " ", "Q"}], "=", 
               RowBox[{
                RowBox[{"-", "1"}], "/", "3"}]}]}], "}"}]}], "}"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"AddBaseIndex", "[", 
         RowBox[{"{", 
          RowBox[{"family", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}], "]"}], ";", 
        "\[IndentingNewLine]", "CompleteBaseIndices"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Add", " ", "index", " ", "pattern", " ", "for", " ", 
     RowBox[{"xPartialD", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"indexspecs1", "=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"{", "2", "}"}], ",", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"_", ",", 
           RowBox[{"index_", "/;", 
            RowBox[{
             RowBox[{"Head", "[", "index", "]"}], "=!=", "List"}]}]}], 
          "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"2", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "_"}], "}"}], ",", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"_", ",", "index_List"}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"{", "2", "}"}], ",", 
         RowBox[{"xCovariantD", "[", 
          RowBox[{"_", ",", 
           RowBox[{"index_", "/;", 
            RowBox[{
             RowBox[{"Head", "[", "index", "]"}], "=!=", "List"}]}]}], 
          "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"2", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "_"}], "}"}], ",", 
         RowBox[{"xCovariantD", "[", 
          RowBox[{"_", ",", "index_List"}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"{", "2", "}"}], ",", 
         RowBox[{
          RowBox[{"xD", "[", "_", "]"}], "[", 
          RowBox[{"_", ",", 
           RowBox[{"index_", "/;", 
            RowBox[{
             RowBox[{"Head", "[", "index", "]"}], "=!=", "List"}]}]}], 
          "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"2", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "_"}], "}"}], ",", 
         RowBox[{
          RowBox[{"xD", "[", "_", "]"}], "[", 
          RowBox[{"_", ",", "index_List"}], "]"}]}], "}"}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"indexspecs2", "=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"{", "2", "}"}], ",", 
         RowBox[{"xPartialDu", "[", 
          RowBox[{"_", ",", 
           RowBox[{"index_", "/;", 
            RowBox[{
             RowBox[{"Head", "[", "index", "]"}], "=!=", "List"}]}]}], 
          "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"2", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "_"}], "}"}], ",", 
         RowBox[{"xPartialDu", "[", 
          RowBox[{"_", ",", "index_List"}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"{", "2", "}"}], ",", 
         RowBox[{"xCovariantDu", "[", 
          RowBox[{"_", ",", 
           RowBox[{"index_", "/;", 
            RowBox[{
             RowBox[{"Head", "[", "index", "]"}], "=!=", "List"}]}]}], 
          "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"2", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "_"}], "}"}], ",", 
         RowBox[{"xCovariantDu", "[", 
          RowBox[{"_", ",", "index_List"}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"{", "2", "}"}], ",", 
         RowBox[{
          RowBox[{"xDu", "[", "_", "]"}], "[", 
          RowBox[{"_", ",", 
           RowBox[{"index_", "/;", 
            RowBox[{
             RowBox[{"Head", "[", "index", "]"}], "=!=", "List"}]}]}], 
          "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"2", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "_"}], "}"}], ",", 
         RowBox[{
          RowBox[{"xDu", "[", "_", "]"}], "[", 
          RowBox[{"_", ",", "index_List"}], "]"}]}], "}"}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NewIndexChangePatterns", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"indexspecs1", ",", "indexspecs2"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"NewIndexChangePatterns", ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"IndexParsingRules", ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        OverscriptBox["$$ten_Tensor", "_"], "->", "$$ten"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DerivOpsU", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"$$c_:", "1"}], ")"}], " ", 
           RowBox[{"DerivOpsD", "[", 
            RowBox[{"$$a_", ",", "$$m_"}], "]"}]}], ",", "$$n_"}], "]"}], 
        "\[Rule]", 
        RowBox[{"$$c", " ", "$$a", " ", 
         RowBox[{"Tensor", "[", 
          RowBox[{"$$XXX", ",", 
           RowBox[{"{", "$$n", "}"}], ",", 
           RowBox[{"{", "$$m", "}"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DerivOpsD", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"$$c_:", "1"}], " ", ")"}], " ", 
           RowBox[{"DerivOpsU", "[", 
            RowBox[{"$$a_", ",", "$$m_"}], "]"}]}], ",", "$$n_"}], "]"}], 
        "\[Rule]", 
        RowBox[{"$$c", " ", "$$a", " ", 
         RowBox[{"Tensor", "[", 
          RowBox[{"$$XXX", ",", 
           RowBox[{"{", "$$m", "}"}], ",", 
           RowBox[{"{", "$$n", "}"}]}], "]"}]}]}], ",", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DerivOpsD", "[", 
         RowBox[{"$$a_", ",", "$$m_"}], "]"}], "\[Rule]", 
        RowBox[{"$$a", " ", 
         RowBox[{"Tensor", "[", 
          RowBox[{"$$XXX", ",", 
           RowBox[{"{", "Void", "}"}], ",", 
           RowBox[{"{", "$$m", "}"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DerivOpsU", "[", 
         RowBox[{"$$a_", ",", "$$m_"}], "]"}], "\[Rule]", 
        RowBox[{"$$a", " ", 
         RowBox[{"Tensor", "[", 
          RowBox[{"$$XXX", ",", 
           RowBox[{"{", "$$m", "}"}], ",", 
           RowBox[{"{", "Void", "}"}]}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"HoldPattern", "[", "Derivative", "]"}], "[", "a__", "]"}], 
         "[", 
         RowBox[{"Tensor", "[", 
          RowBox[{"$$b_", ",", "$$c_", ",", "$$d_"}], "]"}], "]"}], ":>", 
        RowBox[{"Tensor", "[", 
         RowBox[{"$$b", ",", "$$c", ",", "$$d"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ExteriorD", "[", "$$a_", "]"}], "->", "$$a"}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Functional", " ", "patterns", " ", "that", " ", "may", " ", "use", " ", 
     "indices"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"IndexVarPatterns", "=", 
     RowBox[{
      RowBox[{"Tensor", "[", 
       RowBox[{"a_", ",", "u_List", ",", "d_List"}], "]"}], "|", 
      RowBox[{"xPartialD", "[", 
       RowBox[{"a_", ",", "d_"}], "]"}], "|", 
      RowBox[{"xPartialDu", "[", 
       RowBox[{"a_", ",", "u_"}], "]"}], "|", 
      RowBox[{"xCovariantD", "[", 
       RowBox[{"a_", ",", "d_"}], "]"}], "|", 
      RowBox[{"xCovariantDu", "[", 
       RowBox[{"a_", ",", "u_"}], "]"}], "|", 
      RowBox[{
       RowBox[{"xD", "[", "b_", "]"}], "[", 
       RowBox[{"a_", ",", "d_"}], "]"}], "|", 
      RowBox[{
       RowBox[{"xDu", "[", "b_", "]"}], "[", 
       RowBox[{"a_", ",", "u_"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Notation", " ", "in", " ", "QFT", " ", "has", " ", "too", " ", "many", 
     " ", "requirements", " ", "and", " ", "often", " ", "needs", " ", "to", 
     " ", "be", " ", "problem", " ", 
     RowBox[{"specific", "."}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Keep", " ", "the", " ", "Length", " ", "of", " ", "the", " ", "_D", " ", 
     "_U", " ", "variables", " ", "the", " ", 
     RowBox[{"same", "!"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuDerivOpsD", ":=", 
     RowBox[{"tuDPartial", "|", "tuDCovariant", "|", 
      RowBox[{"tuDs", "[", "_", "]"}], "|", 
      RowBox[{"tuDDown", "[", "_", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuDerivOpsU", ":=", 
     RowBox[{"tuDPartialu", "|", "tuDCovariantu", "|", 
      RowBox[{"tuDsu", "[", "_", "]"}], "|", 
      RowBox[{"tuDUp", "[", "_", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuDerivOps", ":=", 
     RowBox[{
      RowBox[{"tuDerivOpsD", "|", "tuDerivOpsU", "|", "tuDLie"}], "//", 
      "Flatten"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DerivOpsD", ":=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"xPartialD", "|", "xCovariantD", "|", 
        RowBox[{"xD", "[", "_", "]"}]}], ",", "tuDerivOpsD"}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DerivOpsU", ":=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"xPartialDu", "|", "xCovariantDu", "|", 
        RowBox[{"xDu", "[", "_", "]"}]}], ",", "tuDerivOpsU"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DerivOps", ":=", 
     RowBox[{
      RowBox[{"DerivOpsD", "|", "DerivOpsU", "|", "tuDerivOps"}], "//", 
      "Flatten"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"Slashes", " ", "symbol_"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"slash", "[", "symbol_", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ToBoxes", "[", "\"\</\>\"", "]"}], ",", 
           RowBox[{"AdjustmentBox", "[", 
            RowBox[{
             RowBox[{"ToBoxes", "[", "symbol", "]"}], ",", 
             RowBox[{"BoxMargins", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", ".6"}], ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{".0", ",", "0"}], "}"}]}], "}"}]}]}], "]"}]}], "}"}],
          "]"}], ",", 
        RowBox[{"slash", "[", "symbol", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Slash", ":=", "slash"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"PartialDSlash", "[", "symbol_", "]"}], " ", 
     RowBox[{"notation", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"tuPartialDSlash", "[", "symbol_", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ToBoxes", "[", "\"\</\>\"", "]"}], ",", 
           RowBox[{"AdjustmentBox", "[", 
            RowBox[{"\"\<\[PartialD]\>\"", ",", 
             RowBox[{"BoxMargins", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "0.8"}], ",", "0.0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0.", ",", "0."}], "}"}]}], "}"}]}]}], "]"}], ",", 
           RowBox[{"ToBoxes", "[", "symbol", "]"}]}], "}"}], "]"}], ",", " ", 
        
        RowBox[{"tuPartialDSlash", "[", "symbol", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"PartialDSlash", ":=", "tuPartialDSlash"}], "\[IndentingNewLine]", 
   
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"CovariantDSlash", "[", "symbol_", "]"}], " ", 
     RowBox[{"notation", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"tuCovariantDSlash", "[", "symbol_", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ToBoxes", "[", "\"\<\[ScriptCapitalD]\>\"", "]"}], ",", 
           RowBox[{"AdjustmentBox", "[", 
            RowBox[{"\"\</\>\"", ",", 
             RowBox[{"BoxMargins", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "0.6666666666666666"}], ",", 
                  RowBox[{"-", "0.6666"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0.", ",", "0."}], "}"}]}], "}"}]}]}], "]"}], ",", 
           "\"\<[\>\"", ",", 
           RowBox[{"ToBoxes", "[", "symbol", "]"}], ",", "\"\<]\>\""}], "}"}],
          "]"}], ",", " ", 
        RowBox[{"tuCovariantDSlash", "[", "symbol", "]"}]}], "}"}]}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{"CovariantDSlash", ":=", "tuCovariantDSlash"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"GammaSlash", " ", "display", " ", 
      RowBox[{"definition", ".", "  ", "May"}], " ", "want", " ", "to", " ", 
      "redefine", " ", "it", " ", "as", " ", 
      RowBox[{"g", "[", "a_", "]"}]}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"GammaSlash", "[", "a", "]"}], ".", "  ", "Perhaps"}], " ", 
      "the", " ", "Bold", " ", "is", " ", 
      RowBox[{"enough", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"GammaSlash", "[", "a_", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      "\n", "    ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{"Overscript", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{"a", ",", "Bold"}], "]"}], ",", "\"\</\>\""}], "]"}], 
         "]"}], ",", " ", 
        RowBox[{"GammaSlash", "[", "a", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"xIntegral", " ", "and", " ", 
     RowBox[{"xCIntegral", ":", " ", "\[IndentingNewLine]", 
      RowBox[{
      "Intermediate", " ", "form", " ", "of", " ", "tuIntegral", " ", "and", 
       " ", "tuCIntegral", " ", "to", " ", "have", " ", "arguements", " ", 
       "consistent", " ", "with", " ", "standard", " ", "Mathematica", " ", 
       "arguement", " ", 
       RowBox[{"lists", "."}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"xIntegral", ":=", 
    RowBox[{"Inactive", "[", "Integrate", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"xCIntegral", "[", 
        RowBox[{"a_", ",", "v__"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{"\"\<\[ContourIntegral]\>\"", ",", 
            RowBox[{"Column", "[", 
             RowBox[{"{", "v", "}"}], "]"}]}], "]"}], "[", "a", "]"}], "]"}], 
        ",", " ", 
        RowBox[{"xCIntegral", "[", 
         RowBox[{"a", ",", "v"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"tuIntegral", " ", "display", " ", 
     RowBox[{"definition", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegral", "::", "usage"}], "=", 
     "\"\<tuIntegral[vars_List,integrand_] Integral operator with list of \
variables vars_ \[Rule] {{v1},{v2}} and integrand_. \>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"tuIntegral", "[", 
        RowBox[{"v_", ",", "a_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{"\"\<\[Integral]\>\"", ",", 
            RowBox[{"Column", "[", "v", "]"}]}], "]"}], "[", "a", "]"}], 
         "]"}], ",", " ", 
        RowBox[{"tuIntegral", "[", 
         RowBox[{"v", ",", "a"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"IntegralOp", ":=", "tuIntegral"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"tuCIntegral", " ", "display", " ", 
     RowBox[{"definition", ".", "  ", "Syntax"}], " ", 
     RowBox[{"tuCIntegral", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"v1", ",", "a1", ",", "b1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"v2", ",", "a2", ",", "b3"}], "}"}]}], "}"}], ",", 
       "integrand"}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"tuCIntegral", "[", 
        RowBox[{"v_", ",", "a_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{"\"\<\[ContourIntegral]\>\"", ",", 
            RowBox[{"Column", "[", "v", "]"}]}], "]"}], "[", "a", "]"}], 
         "]"}], ",", " ", 
        RowBox[{"tuCIntegral", "[", 
         RowBox[{"v", ",", "a"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CIntegralOp", "[", 
      RowBox[{"v_", ",", "a_"}], "]"}], ":=", 
     RowBox[{"tuCIntegral", "[", 
      RowBox[{"v", ",", "a"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"Transpose", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"Transpose", "[", "a_", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{"Superscript", "[", 
          RowBox[{"a", ",", "T"}], "]"}], "]"}], ",", " ", 
        RowBox[{"Transpose", "[", "a", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"ConjugateTranspose", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{"SuperDagger", "[", "a", "]"}], "]"}], ",", " ", 
        RowBox[{"ConjugateTranspose", "[", "a", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"Conjugate", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"Conjugate", "[", "a_", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{"SuperStar", "[", "a", "]"}], "]"}], ",", " ", 
        RowBox[{"Conjugate", "[", "a", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"xPartialD", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuPartialD", "::", "usage"}], "=", 
     "\"\<tuPartialD[field_,var_] displays the PartialD[field,var] \[Rule] \!\
\(\*SubscriptBox[\(\[PartialD]\), \(var\)]\)field. \>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"tuPartialD", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{
            UnderscriptBox["\"\<\[PartialD]\>\"", "_"], ",", "b"}], "]"}], 
          "[", "a", "]"}], "]"}], ",", " ", 
        RowBox[{"tuPartialD", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xPartialD", "[", 
      RowBox[{"field_", ",", "var_"}], "]"}], ":=", 
     RowBox[{"tuPartialD", "[", 
      RowBox[{"field", ",", "var"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuPartialD", ":=", "tuDPartial"}], ";"}], " ", 
   RowBox[{"(*", "Transitional", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuPartialDu", ":=", "tuDPartialu"}], ";"}], " ", 
   RowBox[{"(*", "Transitional", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"xPartialDu", " ", 
     RowBox[{"(", 
      RowBox[{"contravariant", " ", "derivative"}], ")"}], " ", "display", 
     " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuPartialDu", "::", "usage"}], "=", 
     "\"\<tuPartialDu[field_,var_] displays the PartialDu[field,var] \[Rule] \
\!\(\*SuperscriptBox[\(\[PartialD]\), \(var\)]\)field. \>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"tuPartialDu", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Superscript", "[", 
           RowBox[{
            UnderscriptBox["\"\<\[PartialD]\>\"", "_"], ",", "b"}], "]"}], 
          "[", "a", "]"}], "]"}], ",", " ", 
        RowBox[{"tuPartialDu", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xPartialDu", "[", 
      RowBox[{"field_", ",", "var_"}], "]"}], ":=", 
     RowBox[{"tuPartialDu", "[", 
      RowBox[{"field", ",", "var"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"xCovariantD", " ", 
     RowBox[{"(", 
      RowBox[{"contravariant", " ", "covariant", " ", "derivative"}], ")"}], 
     " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"xCovariantD", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{
            UnderscriptBox["\"\<\[GothicCapitalD]\>\"", "_"], ",", "b"}], 
           "]"}], "[", "a", "]"}], "]"}], ",", " ", 
        RowBox[{"xCovariantD", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"xCovariantDu", " ", 
     RowBox[{"(", 
      RowBox[{"contravariant", " ", "covariant", " ", "derivative"}], ")"}], 
     " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MakeBoxes", "[", 
     RowBox[{
      RowBox[{"xCovariantDu", "[", 
       RowBox[{"a_", ",", "b_"}], "]"}], ",", 
      RowBox[{"form", ":", 
       RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"InterpretationBox", "[", 
       RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
        RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ToBoxes", "[", 
        RowBox[{
         RowBox[{"Superscript", "[", 
          RowBox[{
           UnderscriptBox["\"\<\[GothicCapitalD]\>\"", "_"], ",", "b"}], 
          "]"}], "[", "a", "]"}], "]"}], ",", " ", 
       RowBox[{"xCovariantDu", "[", 
        RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"xLieD", " ", 
     RowBox[{"(", 
      RowBox[{"Lie", " ", "derivative"}], ")"}], " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"xLieD", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{
            UnderscriptBox["\"\<\[ScriptCapitalL]\>\"", "_"], ",", "b"}], 
           "]"}], "[", "a", "]"}], "]"}], ",", " ", 
        RowBox[{"xLieD", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"deltaD", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"deltaD", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{
            UnderscriptBox["\"\<\[Delta]\>\"", "_"], ",", "b"}], "]"}], "[", 
          "a", "]"}], "]"}], ",", " ", 
        RowBox[{"deltaD", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"xDeltaD", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"xDeltaD", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{
            UnderscriptBox["\"\<\[Del]\>\"", "_"], ",", "b"}], "]"}], "[", 
          "a", "]"}], "]"}], ",", " ", 
        RowBox[{"xDeltaD", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "xDeltaD", " ", "display", " ", "definition", " ", "for", " ", 
     "specified", " ", "symbol", " ", "s_."}], "*)"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"xDeltaD", "[", 
        RowBox[{"s_", ",", "a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{
            UnderscriptBox["s", "_"], ",", "b"}], "]"}], "[", "a", "]"}], 
         "]"}], ",", " ", 
        RowBox[{"xDeltaD", "[", 
         RowBox[{"s", ",", "a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "xD", " ", "display", " ", "definition", " ", "specified", " ", "symbol", 
     " ", "s_."}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"xD", "[", "s_", "]"}], "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{
            UnderscriptBox["s", "_"], ",", "b"}], "]"}], "[", "a", "]"}], 
         "]"}], ",", " ", 
        RowBox[{
         RowBox[{"xD", "[", "s", "]"}], "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "xDu", " ", "display", " ", "definition", " ", "specified", " ", "symbol",
      " ", "s_."}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"xDu", "[", "s_", "]"}], "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Superscript", "[", 
           RowBox[{
            UnderscriptBox["s", "_"], ",", "b"}], "]"}], "[", "a", "]"}], 
         "]"}], ",", " ", 
        RowBox[{
         RowBox[{"xDu", "[", "s", "]"}], "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"xDDeltaD", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"xDDeltaD", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{
            UnderscriptBox["\"\<D\>\"", "_"], ",", "b"}], "]"}], "[", "a", 
          "]"}], "]"}], ",", " ", 
        RowBox[{"xDDeltaD", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"xDiscreteDelta", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MakeBoxes", "[", 
     RowBox[{
      RowBox[{"xDiscreteDelta", "[", 
       RowBox[{"a_", ",", "b_"}], "]"}], ",", 
      RowBox[{"form", ":", 
       RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"InterpretationBox", "[", 
       RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
        RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ToBoxes", "[", 
        RowBox[{
         UnderscriptBox["\"\<\[Delta]\>\"", "_"], "[", 
         RowBox[{"a", ",", "b"}], "]"}], "]"}], ",", " ", 
       RowBox[{"xDiscreteDelta", "[", 
        RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"xSum", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"xSum", "[", 
        RowBox[{"a_", ",", "b__"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Underscript", "[", 
           RowBox[{
            UnderscriptBox[
             RowBox[{" ", "\"\<\[Sum]\>\""}], "_"], ",", 
            RowBox[{"Column", "[", 
             RowBox[{"{", "b", "}"}], "]"}]}], "]"}], "[", "a", "]"}], "]"}], 
        ",", " ", 
        RowBox[{"xSum", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"xProduct", ",", " ", "xUnion", ",", " ", 
     RowBox[{"xIntersection", " ", "display", " ", 
      RowBox[{"definition", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"xProduct", "[", 
        RowBox[{"a_", ",", "b__"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Underscript", "[", 
           RowBox[{
            UnderscriptBox[
             RowBox[{" ", "\"\<\[Product]\>\""}], "_"], ",", 
            RowBox[{"Column", "[", 
             RowBox[{"{", "b", "}"}], "]"}]}], "]"}], "[", "a", "]"}], "]"}], 
        ",", " ", 
        RowBox[{"xProduct", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MakeBoxes", "[", 
     RowBox[{
      RowBox[{"xUnion", "[", 
       RowBox[{"a_", ",", "b__"}], "]"}], ",", 
      RowBox[{"form", ":", 
       RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"InterpretationBox", "[", 
       RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
        RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ToBoxes", "[", 
        RowBox[{
         RowBox[{"Underscript", "[", 
          RowBox[{
           UnderscriptBox[
            RowBox[{" ", "\"\<\[Union]\>\""}], "_"], ",", 
           RowBox[{"Column", "[", 
            RowBox[{"{", "b", "}"}], "]"}]}], "]"}], "[", "a", "]"}], "]"}], 
       ",", " ", 
       RowBox[{"xUnion", "[", 
        RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MakeBoxes", "[", 
     RowBox[{
      RowBox[{"xIntersection", "[", 
       RowBox[{"a_", ",", "b__"}], "]"}], ",", 
      RowBox[{"form", ":", 
       RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"InterpretationBox", "[", 
       RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
        RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ToBoxes", "[", 
        RowBox[{
         RowBox[{"Underscript", "[", 
          RowBox[{
           UnderscriptBox[
            RowBox[{" ", "\"\<\[Intersection]\>\""}], "_"], ",", 
           RowBox[{"Column", "[", 
            RowBox[{"{", "b", "}"}], "]"}]}], "]"}], "[", "a", "]"}], "]"}], 
       ",", " ", 
       RowBox[{"xIntersection", "[", 
        RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"Bra", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"Bra", "[", "b__", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[LeftAngleBracket]\>\"", ",", "Bold"}], "]"}], ",", 
           
           RowBox[{"ToBoxes", "[", "b", "]"}], ",", 
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[RightBracketingBar]\>\"", ",", "Bold"}], "]"}]}], 
          "}"}], "]"}], ",", " ", 
        RowBox[{"Bra", "[", "b", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Bra", " ", "display", " ", "definition", " ", "without", " ", "List", 
     " ", "arguement", " ", "*", "13", "Jul2018"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"Bra", "[", "b__", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[LeftAngleBracket]\>\"", ",", "Bold"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"MakeBoxes", "[", 
               RowBox[{"{", "b", "}"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"2", ";;", 
                RowBox[{"-", "2"}]}], ",", "1"}], "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[RightBracketingBar]\>\"", ",", "Bold"}], "]"}]}], 
          "}"}], "]"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{"Bra", "[", "b", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"Ket", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"MakeBoxes", "[", 
       RowBox[{
        RowBox[{"Ket", "[", "b__", "]"}], ",", 
        RowBox[{"form", ":", 
         RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"InterpretationBox", "[", 
         RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
          RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"RowBox", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"StyleBox", "[", 
             RowBox[{"\"\<\[LeftBracketingBar]\>\"", ",", "Bold"}], "]"}], 
            ",", 
            RowBox[{"ToBoxes", "[", "b", "]"}], ",", 
            RowBox[{"StyleBox", "[", 
             RowBox[{"\"\<\[RightAngleBracket]\>\"", ",", "Bold"}], "]"}]}], 
           "}"}], "]"}], ",", " ", 
         RowBox[{"Ket", "[", "b", "]"}]}], "}"}]}]}], ";"}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Ket", " ", "display", " ", "definition", " ", "without", " ", "List", 
     " ", "arguement", " ", "*", "13", "Jul2018"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"Ket", "[", "b__", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[LeftBracketingBar]\>\"", ",", "Bold"}], "]"}], ",",
            "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"MakeBoxes", "[", 
               RowBox[{"{", "b", "}"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"2", ";;", 
                RowBox[{"-", "2"}]}], ",", "1"}], "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[RightAngleBracket]\>\"", ",", "Bold"}], "]"}]}], 
          "}"}], "]"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{"Ket", "[", "b", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"BraKet", "[", "b", "]"}], " ", "display", " ", "definition"}], 
     ",", " ", 
     RowBox[{"<", "b", ">"}]}], "  ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"BraKet", "[", "b__", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[LeftAngleBracket]\>\"", ",", "Bold"}], "]"}], ",", 
           
           RowBox[{"ToBoxes", "[", "b", "]"}], ",", 
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[RightAngleBracket]\>\"", ",", "Bold"}], "]"}]}], 
          "}"}], "]"}], ",", " ", 
        RowBox[{"BraKet", "[", "b", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"BraKet", "[", 
       RowBox[{"b", ",", "c"}], "]"}], " ", "display", " ", "definition"}], 
     ",", " ", 
     RowBox[{
      RowBox[{"<", "b"}], "|", 
      RowBox[{"c", ">"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"BraKet", "[", 
        RowBox[{"b__", ",", "c__"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[LeftAngleBracket]\>\"", ",", "Bold"}], "]"}], ",", 
           
           RowBox[{"ToBoxes", "[", "b", "]"}], ",", 
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<|\>\"", ",", "Bold"}], "]"}], ",", 
           RowBox[{"ToBoxes", "[", "c", "]"}], ",", 
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[RightAngleBracket]\>\"", ",", "Bold"}], "]"}]}], 
          "}"}], "]"}], ",", " ", 
        RowBox[{"BraKet", "[", 
         RowBox[{"b", ",", "c"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"BraKet", "[", 
       RowBox[{"a", ",", "b", ",", "c"}], "]"}], " ", "display", " ", 
      "definition"}], ",", " ", 
     RowBox[{
      RowBox[{"<", "a"}], "|", "b", "|", 
      RowBox[{"c", ">"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"BraKet", "[", 
        RowBox[{"a__", ",", "b__", ",", "c__"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[LeftAngleBracket]\>\"", ",", "Bold"}], "]"}], ",", 
           
           RowBox[{"ToBoxes", "[", "a", "]"}], ",", 
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<|\>\"", ",", "Bold"}], "]"}], ",", 
           RowBox[{"ToBoxes", "[", "b", "]"}], ",", 
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<|\>\"", ",", "Bold"}], "]"}], ",", 
           RowBox[{"ToBoxes", "[", "c", "]"}], ",", 
           RowBox[{"StyleBox", "[", 
            RowBox[{"\"\<\[RightAngleBracket]\>\"", ",", "Bold"}], "]"}]}], 
          "}"}], "]"}], ",", " ", 
        RowBox[{"BraKet", "[", 
         RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"CommutatorM", " ", "display", " ", 
     RowBox[{"definition", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"CommutatorM", "[", 
        RowBox[{"a_", ",", "b__"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"SubscriptBox", "[", 
         RowBox[{
          RowBox[{"RowBox", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<[\>\"", ",", 
             RowBox[{"ToBoxes", "[", "a", "]"}], ",", "\"\<,\>\"", ",", 
             RowBox[{"ToBoxes", "[", "b", "]"}], ",", "\"\<]\>\""}], "}"}], 
           "]"}], ",", "\"\<-\>\""}], "]"}], ",", " ", 
        RowBox[{"CommutatorM", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"CommutatorP", " ", "display", " ", 
     RowBox[{"definition", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"CommutatorP", "[", 
        RowBox[{"a_", ",", "b__"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"SubscriptBox", "[", 
         RowBox[{
          RowBox[{"RowBox", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<[\>\"", ",", 
             RowBox[{"ToBoxes", "[", "a", "]"}], ",", "\"\<,\>\"", ",", 
             RowBox[{"ToBoxes", "[", "b", "]"}], ",", "\"\<]\>\""}], "}"}], 
           "]"}], ",", "\"\<+\>\""}], "]"}], ",", " ", 
        RowBox[{"CommutatorP", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"HodgeStar", " ", "display", " ", "definition"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"HodgeStar", "[", "a_", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          UnderscriptBox["\"\<*\>\"", "_"], "[", "a", "]"}], "]"}], ",", " ", 
        
        RowBox[{"HodgeStar", "[", "a", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "difForm", " ", "display", " ", "definition", " ", "11", "July2012"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{"difForm", "[", "a_", "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          UnderscriptBox["d", "_"], "[", "a", "]"}], "]"}], ",", " ", 
        RowBox[{"difForm", "[", "a", "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"DifForm", ":=", "difForm"}], " ", 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
       "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
       "**", "\[IndentingNewLine]", "Indexed"}], " ", "derivative", " ", 
     "Box", " ", "definitions", " ", "*", "migration", " ", "TARGET", " ", 
     "*", "6", "Feb2015"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"tuDDown", "[", "s_", "]"}], "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{
            UnderscriptBox["s", "_"], ",", "b"}], "]"}], "[", "a", "]"}], 
         "]"}], ",", " ", 
        RowBox[{
         RowBox[{"tuDDown", "[", "s", "]"}], "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";", 
    RowBox[{
     RowBox[{"MakeBoxes", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"tuDUp", "[", "s_", "]"}], "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ",", 
       RowBox[{"form", ":", 
        RowBox[{"StandardForm", "|", "TraditionalForm"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"InterpretationBox", "[", 
        RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", 
         RowBox[{"SyntaxForm", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Editable", "\[Rule]", "False"}]}], "]"}], "&"}], " ", "@@", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ToBoxes", "[", 
         RowBox[{
          RowBox[{"Superscript", "[", 
           RowBox[{
            UnderscriptBox["s", "_"], ",", "b"}], "]"}], "[", "a", "]"}], 
         "]"}], ",", " ", 
        RowBox[{
         RowBox[{"tuDUp", "[", "s", "]"}], "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
      "**", "**", "**", "**", "**", "**", "**", "**", "**", "**"}], 
    "*******)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDPartial", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuDDown", "[", "\"\<\[PartialD]\>\"", "]"}], "[", 
      RowBox[{"a", ",", "b"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDPartialu", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuDUp", "[", "\"\<\[PartialD]\>\"", "]"}], "[", 
      RowBox[{"a", ",", "b"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDCovariant", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuDDown", "[", "\"\<\[Del]\>\"", "]"}], "[", 
      RowBox[{"a", ",", "b"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDCovariantu", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuDUp", "[", "\"\<\[Del]\>\"", "]"}], "[", 
      RowBox[{"a", ",", "b"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDs", "[", "s_", "]"}], "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuDDown", "[", "s", "]"}], "[", 
      RowBox[{"a", ",", "b"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDsu", "[", "s_", "]"}], "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuDUp", "[", "s", "]"}], "[", 
      RowBox[{"a", ",", "b"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDLie", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuDDown", "[", "\"\<\[ScriptCapitalL]\>\"", "]"}], "[", 
      RowBox[{"a", ",", "b"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuDOps", ":=", 
     RowBox[{
      RowBox[{"tuDUp", "[", "_", "]"}], "|", 
      RowBox[{"tuDDown", "[", "_", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDExpand", "::", "usage"}], "=", 
     "\"\<tuDExpand[ops_:tuDOps,constants_List:{},fnc_:(BraKet|Times|dotOps|\
Wedge|CircleTimes)] Rules to Expand by name two argument differential \
operator ops_, e.g., tuDUp[_]|tuDDown[_], tuDPartial, tuDPartialu, \
tuDCovariant, tuDCovariantu. Terms that match any of list of constants are \
treated as constant. Leibnitz rule is applied over functions fnc_.  NOTE: \
seems like only tuDUp[_] and tuDDown [_] work as ops_.  \
*2Mar2015*27Sep2017*12Feb2019*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDExpand", "[", 
      RowBox[{
       RowBox[{"ops_:", "tuDOps"}], ",", 
       RowBox[{"constants_List:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"fnc_:", 
        RowBox[{"(", 
         RowBox[{
         "BraKet", "|", "Times", "|", "dotOps", "|", "Wedge", "|", 
          "CircleTimes"}], ")"}]}]}], "]"}], ":=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"(*", 
           RowBox[{"Liebnitz", " ", "rule"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"oo", ":", 
             RowBox[{"Flatten", "[", "fnc", "]"}]}], ")"}], "[", 
           RowBox[{"a_", "  ", ",", "b__"}], "]"}], ",", "c__"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{
          RowBox[{"oo", "[", 
           RowBox[{
            RowBox[{"name", "[", 
             RowBox[{"a", ",", "c"}], "]"}], ",", "b"}], "]"}], "+", 
          RowBox[{"oo", "[", 
           RowBox[{"a", " ", ",", 
            RowBox[{"name", "[", 
             RowBox[{
              RowBox[{"oo", "[", "b", "]"}], ",", "c"}], "]"}]}], "]"}]}], "/;", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"{", "b", "}"}], "]"}], ">", "1"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"oo", ":", 
             RowBox[{"Flatten", "[", "fnc", "]"}]}], ")"}], "[", 
           RowBox[{"a_", "  ", ",", "b__"}], "]"}], ",", "c__"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{
          RowBox[{"oo", "[", 
           RowBox[{
            RowBox[{"name", "[", 
             RowBox[{"a", ",", "c"}], "]"}], ",", "b"}], "]"}], "+", 
          RowBox[{"oo", "[", 
           RowBox[{"a", " ", ",", 
            RowBox[{"name", "[", 
             RowBox[{"b", ",", "c"}], "]"}]}], "]"}]}], "/;", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"{", "b", "}"}], "]"}], "==", "1"}]}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{
          RowBox[{"a_", "+", " ", "c_"}], ",", "b_"}], "]"}], "->", 
        RowBox[{
         RowBox[{"name", "[", 
          RowBox[{"a", ",", "b"}], "]"}], "+", " ", 
         RowBox[{"name", "[", " ", 
          RowBox[{"c", ",", "b"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{"a_", ",", 
          RowBox[{"b_", " ", 
           RowBox[{"c_", "?", "NumericQ"}]}]}], "]"}], ":>", " ", 
        RowBox[{
         RowBox[{"name", "[", 
          RowBox[{"a", ",", "b"}], "]"}], "/", "c"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{"a_", ",", 
          RowBox[{"b_", "  ", 
           RowBox[{"c_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"tuHasAnyQ", "[", 
               RowBox[{"#", ",", 
                RowBox[{"{", "constants", "}"}]}], "]"}], "&"}], ")"}]}]}]}], 
         "]"}], ":>", " ", 
        RowBox[{
         RowBox[{"name", "[", 
          RowBox[{"a", ",", "b"}], "]"}], "/", "c"}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{
          RowBox[{"Exp", "[", "a_", "]"}], ",", "b_"}], "]"}], "->", 
        RowBox[{
         RowBox[{"Exp", "[", "a", "]"}], " ", 
         RowBox[{"name", "[", 
          RowBox[{"a", ",", "b"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{
          RowBox[{"Log", "[", "a_", "]"}], ",", "b_"}], "]"}], "->", " ", 
        RowBox[{
         RowBox[{"name", "[", 
          RowBox[{"a", ",", "b"}], "]"}], "/", "a"}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "tuDOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{"a_", ",", "n_"}], "]"}], ",", "b_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         SuperscriptBox["a", "n"], " ", 
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Log", "[", "a", "]"}], 
            RowBox[{"name", "[", 
             RowBox[{"n", ",", "b"}], "]"}]}], "+", 
           RowBox[{"n", " ", 
            RowBox[{
             RowBox[{"name", "[", 
              RowBox[{"a", ",", "b"}], "]"}], "/", "a"}]}]}], ")"}]}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{"a_", ",", 
          RowBox[{"b_", "+", "c_"}]}], "]"}], "->", 
        RowBox[{
         RowBox[{"name", "[", 
          RowBox[{"a", ",", "b"}], "]"}], "+", " ", 
         RowBox[{"name", "[", " ", 
          RowBox[{"a", ",", "c"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{"NumericQ", "[", "a", "]"}]}]}], " ", ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{"ListMemberQ", "[", 
          RowBox[{"a", ",", "constants"}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"ff", ":", 
             RowBox[{"(", 
              RowBox[{
              "BraKet", "|", "Times", "|", "dotOps", "|", "Wedge", "|", 
               "CircleTimes"}], ")"}]}], ")"}], "[", 
           RowBox[{"b__", ",", "  ", 
            RowBox[{"ConjugateTranspose", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "DerivOps"}], ")"}], "[", 
              RowBox[{"a_", ",", "a_"}], "]"}], "]"}]}], "]"}], ":>", 
          RowBox[{"ConjugateTranspose", "[", 
           RowBox[{"ff", "[", "b", "]"}], "]"}]}], ","}], 
        "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{"a_", ",", "a_"}], "]"}], ":>", "1"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
          "The", " ", "following", " ", "3", " ", "Rules", " ", "conflict", 
           " ", "with", " ", "the", " ", "above", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"name", ":", "ops"}], ")"}], "[", 
            RowBox[{"a_", ",", "a_"}], "]"}]}], ":>", 
          RowBox[{
          "1", " ", "and", " ", "the", " ", "Liebnitz", " ", "rule"}]}], ",", 
         " ", 
         RowBox[{
         "in", " ", "that", " ", "when", " ", "it", " ", "is", " ", 
          "satisfied", " ", "the", " ", "coefficient", " ", "terms", " ", 
          "are", " ", "not", " ", "dealt", " ", "with", " ", 
          RowBox[{"properly", "."}]}]}], "   ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a_", "]"}], ",", "b_"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"name", "[", 
           RowBox[{"a", ",", "b"}], "]"}], "]"}], "/;", 
         RowBox[{"!", 
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"{", "\"\<\[Del]\>\"", "}"}], ",", "name"}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{
          RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ",", "b_"}], "]"}], 
        ":>", 
        RowBox[{
         RowBox[{"ConjugateTranspose", "[", 
          RowBox[{"name", "[", 
           RowBox[{"a", ",", "b"}], "]"}], "]"}], "/;", 
         RowBox[{"!", 
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"{", "\"\<\[Del]\>\"", "}"}], ",", "name"}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{
          RowBox[{"Transpose", "[", "a_", "]"}], ",", "b_"}], "]"}], ":>", 
        RowBox[{"Transpose", "[", 
         RowBox[{"name", "[", 
          RowBox[{"a", ",", "b"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{"a__", ",", "\[Mu]_"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"name", "[", 
           RowBox[{"a", ",", "\[Mu]"}], "]"}], "]"}], "/;", 
         RowBox[{
          RowBox[{"Head", "[", "a", "]"}], "==", "List"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{"a_", ",", "\[Mu]_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Rule", ",", 
           RowBox[{"Thread", "[", 
            RowBox[{"name", "[", 
             RowBox[{
              RowBox[{"Apply", "[", 
               RowBox[{"List", ",", "a"}], "]"}], ",", "\[Mu]"}], "]"}], 
            "]"}]}], "]"}], "/;", 
         RowBox[{
          RowBox[{"Head", "[", "a", "]"}], "===", "Rule"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"name", ":", "ops"}], ")"}], "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"ss", ":", 
             RowBox[{"xSum", "|", "Sum"}]}], ")"}], "[", 
           RowBox[{"a_", ",", "b__"}], "]"}], ",", "\[Mu]_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{"ss", "[", 
         RowBox[{
          RowBox[{"name", "[", 
           RowBox[{"a", ",", "\[Mu]"}], "]"}], ",", "b"}], "]"}]}]}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Intended", " ", "to", " ", 
         RowBox[{"do", ":", " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", 
            RowBox[{"2", "x"}]], "A"}]}]}], "\[Rule]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            SubscriptBox["\[PartialD]", "x"], "A"}], ")"}], "/", "2"}], " ", 
         "but", " ", "CREATES", " ", 
         RowBox[{"Rule", "[", "]"}], " ", "PROBLEMS", " ", "with", " ", 
         "some", " ", 
         RowBox[{"expressions", ".", " ", "Avoid"}], " ", "cases", " ", 
         "where", " ", "b", " ", "is", " ", "an", " ", "integer", " ", 
         RowBox[{"index", "."}]}]}], "*)"}], "\[IndentingNewLine]", "}"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"TEST", "\[IndentingNewLine]", 
          RowBox[{"difForm", "[", 
           RowBox[{"a", "+", "b", "+", "d"}], "]"}], "\[IndentingNewLine]", 
          "%"}], "//.", 
         RowBox[{
          RowBox[{"tuDExpand", "[", "difForm", "]"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tuDDown", "[", "Dn", "]"}], "[", 
           RowBox[{
            RowBox[{"a", "+", "b"}], ",", "c"}], "]"}], "\[IndentingNewLine]",
           "%"}]}], "//.", 
        RowBox[{
         RowBox[{"tuDExpand", "[", "DerivOps", "]"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tuDDown", "[", "Dn", "]"}], "[", 
          RowBox[{
           RowBox[{"Log", "[", 
            RowBox[{"a", " ", "b"}], "]"}], ",", "c"}], "]"}], 
         "\[IndentingNewLine]", "%"}]}], "//.", 
       RowBox[{
        RowBox[{"tuDExpand", "[", "DerivOps", "]"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tuDDown", "[", "Dn", "]"}], "[", 
         RowBox[{
          RowBox[{"Wedge", "[", 
           RowBox[{"a", ",", " ", "b", ",", "d"}], "]"}], ",", "c"}], "]"}], 
        "\[IndentingNewLine]", "%"}]}], "//.", 
      RowBox[{
       RowBox[{"tuDExpand", "[", "DerivOps", "]"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDDown", "[", "Dn", "]"}], "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ConjugateTranspose", "[", 
           RowBox[{"a", " ", "b"}], "  ", "]"}], "e", " ", "d"}], ",", "b"}], 
        "]"}], "\[IndentingNewLine]", "%"}]}], "//.", 
     RowBox[{"tuDExpand", "[", "DerivOps", "]"}]}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDExpandF", "::", "usage"}], "=", 
     "\"\<tuDExpandF[ops_,constants_List:{},fnc_:(BraKet|Times|dotOps|Wedge|\
CircleTimes)][exp_]Expands terms with two argument differential operator \
ops_, e.g., tuDUp[_]|tuDDown[_], tuDPartial, tuDPartialu, tuDCovariant, \
tuDCovariantu. Terms that match any of list of constants are treated as \
constant. Leibnitz rule is applied over functions fnc_. Applies Mathematica \
function Dt[]. NOTE: Works with single argumennt differential operator, but \
does not as Liebnitz rule. WARNING: Does not work with nested ops_. \
*2Mar2015**27Sep2017*8May2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDExpandF", "[", 
       RowBox[{
        RowBox[{"ops_:", "DerivOps"}], ",", 
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"fnc_:", 
         RowBox[{"(", 
          RowBox[{
          "BraKet", "|", "Times", "|", "dotOps", "|", "Wedge", "|", 
           "CircleTimes"}], ")"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sub", ",", 
         RowBox[{"tmp", "=", "exp"}], ",", "tmp0"}], "\[IndentingNewLine]", 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", "tmp", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", "Expand"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<0::\>\"", ",", "tmp"}], "]"}], ";", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tmp", "=", 
              RowBox[{"tmp", "//.", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"name", ":", "ops"}], ")"}], "[", 
                 RowBox[{"a_", " ", "+", "  ", "b_"}], "]"}], "\[Rule]", 
                RowBox[{
                 RowBox[{"name", "[", "a", "]"}], "+", " ", 
                 RowBox[{"name", "[", "b", "]"}]}]}]}]}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"name", ":", "ops"}], ")"}], "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"oo", ":", "productOps"}], ")"}], "[", 
                RowBox[{"a_", "  ", ",", "b__"}], "]"}], "]"}], ":>", 
              RowBox[{
               RowBox[{"oo", "[", 
                RowBox[{
                 RowBox[{"name", "[", "a", "]"}], ",", "b"}], "]"}], "+", 
               RowBox[{"oo", "[", 
                RowBox[{"a", " ", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "b", "}"}], "]"}], ">", "1"}], ",", 
                   RowBox[{"name", "[", 
                    RowBox[{"oo", "[", "b", "]"}], "]"}], ",", 
                   RowBox[{"name", "[", "b", "]"}]}], "]"}]}], "]"}]}]}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<1::\>\"", ",", "tmp"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"tuDExpand", "[", 
              RowBox[{"ops", ",", "constants", ",", "fnc"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"work", " ", "around", " ", "for", " ", 
             RowBox[{"Dt", "[", 
              RowBox[{"a", "[", "2", "]"}], "]"}], " ", "like", " ", 
             "terms"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"dd", ":", 
               RowBox[{"ops", "[", "a_", "]"}]}], "\[RuleDelayed]", 
              RowBox[{"hideDtIntArg", "[", "dd", "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Use", " ", "Mathematica", " ", "Dt", " ", 
             RowBox[{"function", "\[DoubleLongRightArrow]", "some"}], " ", 
             "Rules", " ", "above", " ", "are", " ", 
             RowBox[{"obsolete", "."}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"name", ":", "ops"}], ")"}], "[", 
               RowBox[{"a_", ",", "___"}], "]"}], ":>", 
              RowBox[{"0", "/;", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "constants"}], "]"}]}]}]}]}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"TEST", "\[IndentingNewLine]", 
             RowBox[{"difForm", "[", 
              RowBox[{"a", "+", "b", "+", "d"}], "]"}], "\[IndentingNewLine]",
              "%"}], "//", 
            RowBox[{
             RowBox[{"tuDExpandF", "[", "difForm", "]"}], 
             "\[IndentingNewLine]", 
             RowBox[{"d", "[", 
              RowBox[{
               RowBox[{"a", "[", 
                RowBox[{"x", ",", "y"}], "]"}], "+", "b", "+", "d"}], "]"}], 
             "\[IndentingNewLine]", "%"}]}], "//", 
           RowBox[{
            RowBox[{"tuDExpandF", "[", "d", "]"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tuDDown", "[", "Dn", "]"}], "[", 
             RowBox[{
              RowBox[{
               RowBox[{"a", "[", 
                RowBox[{"x", ",", "y"}], "]"}], "+", "b"}], ",", "d"}], "]"}],
             "\[IndentingNewLine]", "%"}]}], "//", 
          RowBox[{
           RowBox[{"tuDExpandF", "[", "DerivOps", "]"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"tuDDown", "[", "Dn", "]"}], "[", 
            RowBox[{
             RowBox[{"Log", "[", 
              RowBox[{"a", " ", "b"}], "]"}], ",", "c"}], "]"}], 
           "\[IndentingNewLine]", "%"}]}], "//", 
         RowBox[{
          RowBox[{"tuDExpandF", "[", "DerivOps", "]"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tuDDown", "[", "Dn", "]"}], "[", 
           RowBox[{
            RowBox[{"Wedge", "[", 
             RowBox[{
              RowBox[{"a", "[", "x", "]"}], ",", " ", "b", ",", "d"}], "]"}], 
            ",", "c"}], "]"}], "\[IndentingNewLine]", "%"}]}], "//", 
        RowBox[{
         RowBox[{"tuDExpandF", "[", "DerivOps", "]"}], "\[IndentingNewLine]", 
         
         RowBox[{"d", "[", 
          RowBox[{
           RowBox[{"a", "[", 
            RowBox[{"x", ",", "y"}], "]"}], "+", "b", "+", 
           RowBox[{"d", "[", 
            RowBox[{"f", "[", "x", "]"}], "]"}]}], "]"}], 
         "\[IndentingNewLine]", "%"}]}], "//", 
       RowBox[{
        RowBox[{"tuDExpandF", "[", "d", "]"}], "\[IndentingNewLine]", 
        RowBox[{"d", "[", 
         RowBox[{"Wedge", "[", 
          RowBox[{
           RowBox[{"a", "[", 
            RowBox[{"x", ",", "y"}], "]"}], ",", 
           RowBox[{"b", "+", "d"}]}], "]"}], "]"}], "\[IndentingNewLine]", 
        "%"}]}], "//", 
      RowBox[{
       RowBox[{"tuDExpandF", "[", "d", "]"}], 
       RowBox[{"(*", 
        RowBox[{"no", " ", "Liebnitz", " ", "rule"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDDown", "[", "Dn", "]"}], "[", 
        RowBox[{
         RowBox[{"ct", "[", 
          RowBox[{"a", " ", "b"}], "]"}], ",", "a"}], "]"}], 
       "\[IndentingNewLine]", "%"}]}], "//", 
     RowBox[{"tuDExpandF", "[", 
      RowBox[{"tuDDown", "[", "Dn", "]"}], "]"}]}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Module", " ", "to", " ", "apply", " ", "Dt", " ", "where", " ", "the", 
     " ", "variables", " ", "may", " ", "be", " ", "a", " ", "single", " ", 
     "integer", " ", "coming", " ", "from", " ", "independentVars", " ", 
     "dummies"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"hideDtIntArg", "[", "dtexp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "dtexp"}], ",", "op", ",", "nn", ",", "hideXX", 
         ",", "$s", ",", "$s1"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"op", "=", 
         RowBox[{"Head", "[", "$", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", " ", 
          RowBox[{
           RowBox[{"a_", "[", "n_", "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"hideXX", "[", 
             RowBox[{"a", ",", "n"}], "]"}], "/;", 
            RowBox[{"IntegerQ", "[", "n", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"$", "/.", 
           RowBox[{"op", "\[Rule]", "Dt"}]}], "/.", 
          RowBox[{"Dt", "\[Rule]", "op"}]}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"$", "//", "FullForm"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{"$", "//", 
           RowBox[{"tuExtractPattern", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Derivative", "[", 
               RowBox[{"1", ",", "0"}], "]"}], "[", "hideXX", "]"}], "[", 
             RowBox[{"_", ",", "_"}], "]"}], "]"}]}], "//", "First"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$s1", "=", 
         RowBox[{
          RowBox[{"op", "[", 
           RowBox[{"$s", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Rule]", 
          RowBox[{"op", "[", 
           RowBox[{
            RowBox[{"$s", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"$s", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"$", "/.", 
           RowBox[{"$s", "\[Rule]", "1"}]}], " ", "/.", "$s1"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", 
          RowBox[{
           RowBox[{"hideXX", "[", 
            RowBox[{"a_", ",", "n_"}], "]"}], "\[Rule]", 
           RowBox[{"a", "[", "n", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", 
              RowBox[{"_", ",", "0"}], "]"}], "[", "hideXX", "]"}], "[", 
            RowBox[{"_", ",", "_"}], "]"}], "\[Rule]", "0"}]}]}]}]}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"set", " ", "higher", " ", "Dt"}], "\[Rule]", "0"}], "*)"}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDExpandFvI", "::", "usage"}], "=", 
     "\"\<tuDExpandFvI[ops_,constants_List:{},fnc_:(BraKet|Times|dotOps|Wedge|\
CircleTimes)] wrapper for tuDExpandF[]. Calls  \
tuOpIndependentVar[tuDExpandF,op$[ops,constants,fnc][exp]] *14Jan2018*\>\""}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDExpandFvI", "[", 
       RowBox[{"ops_", ",", 
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"fnc_:", 
         RowBox[{"(", 
          RowBox[{
          "BraKet", "|", "Times", "|", "dotOps", "|", "Wedge", "|", 
           "CircleTimes"}], ")"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"tuOpIndependentVar", "[", 
        RowBox[{"tuDExpandF", ",", 
         RowBox[{
          RowBox[{"op$", "[", 
           RowBox[{"ops", ",", "constants", ",", "fnc"}], "]"}], "[", "exp", 
          "]"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"\[Delta]Expand", "[", 
       RowBox[{"\[Delta]1_", ",", 
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuDExpandF", "[", 
       RowBox[{"\[Delta]1", ",", "constants"}], "]"}], "[", "exp", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DifExpand", "[", 
      RowBox[{"ops_", ",", "constants_List"}], "]"}], ":=", 
     RowBox[{"tuDExpand", "[", 
      RowBox[{"ops", ",", "constants"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDExpandMultiVar", "::", "usage"}], "=", 
     "\"\<tuDExpandMultiVar is Rule[] for separating multiple differential \
symbol into a nest of single differtials: \
tuDOps[a,{b,c}]->tuDOps[tuDOps[a,b],c] *15Aug2015*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuDExpandMultiVar", ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"head", ":", "DerivOps"}], ")"}], "[", 
        RowBox[{"a_", ",", "b_List"}], "]"}], ":>", 
       RowBox[{"head", "[", 
        RowBox[{
         RowBox[{"head", "[", 
          RowBox[{"a", ",", 
           RowBox[{"First", "[", "b", "]"}]}], "]"}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"Rest", "[", "b", "]"}], "]"}], ">", "1"}], ",", 
           RowBox[{"Rest", "[", "b", "]"}], ",", 
           RowBox[{
            RowBox[{"Rest", "[", "b", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDerivativeExpand", "::", "usage"}], "=", 
     "\"\<tuDerivativeExpand[constants_List:{},fnc_:(BraKet|Times|dotOps|\
Wedge|CircleTimes)][exp_] expands DerivOps in exp_ by applying \
tuDExpandMultiVar and tuDExpand. Expands over functions specified by fnc_. \
Defaults:BraKet|Times|dotOps|Wedge|CircleTimes.  \
*15Aug2015**27Sep2017*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDerivativeExpand", "[", 
       RowBox[{
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"fnc_:", 
         RowBox[{"(", 
          RowBox[{
          "BraKet", "|", "Times", "|", "dotOps", "|", "Wedge", "|", 
           "CircleTimes"}], ")"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", 
         RowBox[{"ops", "=", "DerivOps"}], ",", 
         RowBox[{"test", "=", "NULL"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", "tuDExpandMultiVar"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"Expansion", " ", "for", " ", "multiple", " ", "tuOOps"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"test", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"test", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"Expand", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", 
             RowBox[{"tuDExpandF", "[", 
              RowBox[{"ops", ",", "constants", ",", 
               RowBox[{"(", 
                RowBox[{"fnc", "|", "Times"}], ")"}]}], "]"}]}]}], ";", 
           RowBox[{"(*", 
            RowBox[{"changed", " ", "7", "Dec2017"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"Continue", "[", "]"}]}]}], 
         RowBox[{"(*", 
          RowBox[{"May", " ", "not", " ", "need", " ", "to", " ", 
           RowBox[{"iterate", "."}]}], "*)"}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuDExpandD2", "]"}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"tuDExpandD2", "::", "usage"}], "=", 
     "\"\<tuDExpandD2[ops_:tuDerivOps,constants_List:{},fnc_:(BraKet|Times|\
dotOps|Wedge|CircleTimes)][EXP_] expands tuDerivOps expression in EXP_ \
including its second arguement, *13Dec2017*2May2018*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDExpandD2", "[", 
       RowBox[{
        RowBox[{"ops_:", "tuDerivOps"}], ",", 
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"fnc_:", 
         RowBox[{"(", 
          RowBox[{
          "BraKet", "|", "Times", "|", "dotOps", "|", "Wedge", "|", 
           "CircleTimes"}], ")"}]}]}], "]"}], "[", "EXP_", "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "EXP"}], ",", "xdx", ",", "$s"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"name", ":", "ops"}], ")"}], "[", 
            RowBox[{"a_", ",", "b___"}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"name", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"xdx", "[", "b", "]"}]}], "]"}], "//", 
                RowBox[{
                 RowBox[{"Inactive", "[", "tuDExpandF", "]"}], "[", 
                 RowBox[{"xdx", ",", "constants", ",", "fnc"}], "]"}]}], "//", 
               RowBox[{"tuOpIndependentVarActivate", "[", "]"}]}], "//", 
              RowBox[{"tuDerivativeExpand", "[", "constants", "]"}]}], ")"}], 
            "/;", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "b", "]"}], ">", "1"}], "&&", 
             RowBox[{"tuHasNoneQ", "[", 
              RowBox[{"b", ",", 
               RowBox[{"{", "xdx", "}"}]}], "]"}]}]}]}]}]}], ";", 
        RowBox[{"xPrint", "[", "tmp", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Clean", " ", "up", " ", 
          RowBox[{"xdx", "[", "]"}], "s"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"name", ":", "ops"}], ")"}], "[", 
            RowBox[{"a_", ",", "b___"}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"name", "[", 
               RowBox[{"a", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"$s", "=", 
                   RowBox[{"First", "[", 
                    RowBox[{
                    RowBox[{"tuExtractPattern", "[", 
                    RowBox[{"xdx", "[", "_", "]"}], "]"}], "[", "b", "]"}], 
                    "]"}]}], ")"}], "/.", 
                 RowBox[{
                  RowBox[{"xdx", "[", "c_", "]"}], "\[Rule]", "c"}]}]}], 
               "]"}], " ", "/", 
              RowBox[{"(", 
               RowBox[{"b", "/.", 
                RowBox[{"(", 
                 RowBox[{"$s", "\[Rule]", "1"}], ")"}]}], ")"}]}], ")"}], "/;", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "b", "]"}], ">", "1"}], "&&", 
             RowBox[{"tuHasAnyQ", "[", 
              RowBox[{"b", ",", 
               RowBox[{"{", "xdx", "}"}]}], "]"}]}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", "$s", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "//", 
         RowBox[{"tuDerivativeExpand", "[", "constants", "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"EX", ":", " ", "$"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"tuDPartial", "[", 
        RowBox[{"a", ",", 
         RowBox[{
          SuperscriptBox["b", "2"], "/", "c"}]}], "]"}], 
       "\[IndentingNewLine]", "$"}], "//", 
      RowBox[{"tuDExpandD2", "[", "]"}]}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuDlHopital", "]"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"EG", ":", "\[IndentingNewLine]", "$"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"tuDPartialu", "[", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Theta]", ",", "\"\<d\>\"", ",", 
           RowBox[{"{", "1", "}"}]}], "]"}], ",", "\[Tau]"}], "]"}], 
       "\[IndentingNewLine]", "$"}], "=", 
      RowBox[{
       RowBox[{"$", "/.", 
        RowBox[{
         RowBox[{"tuDChain", "[", 
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Omega]", ",", "\"\<d\>\"", ",", 
             RowBox[{"{", "1", "}"}]}], "]"}], ",", "tuDPartialu"}], "]"}], 
         "\[IndentingNewLine]", "$"}]}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"$", "/.", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"\[Omega]", ",", "\"\<d\>\"", ",", 
              RowBox[{"{", "1", "}"}]}], "]"}], "\[Rule]", 
            RowBox[{
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"x", ",", "\"\<u\>\"", ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "/", "r"}], 
             "\[IndentingNewLine]", "%"}]}]}], "//", 
          RowBox[{"tuDerivativeExpand", "[", 
           RowBox[{"{", "r", "}"}], "]"}]}], "//", 
         RowBox[{"tuDExpandD2", "[", "]"}]}], "//", 
        RowBox[{"Simplify", "\[IndentingNewLine]", 
         RowBox[{"tuDlHopital", "[", 
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Omega]", ",", "\"\<d\>\"", ",", 
             RowBox[{"{", "1", "}"}]}], "]"}], ",", "tuDPartialu"}], 
          "]"}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDChain", "::", "usage"}], "=", 
     "\"\<tuDChain[c_,dif_:tuDPartial] Rule for applying the chain rule to \
dif_[] with c_ as the chain variable: dif_[a_,b_]\[Rule]dif[a,c]dif[c,b]. \
vars_ may be a List of intermediate variables. *21Feb2019*20Apr20*\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuDChain", "[", 
     RowBox[{"vars_", ",", 
      RowBox[{"dif_:", "tuDPartial"}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{"dif", "[", 
      RowBox[{"a_", ",", "b__"}], "]"}], "\[RuleDelayed]", 
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"dif", "[", 
         RowBox[{"a", ",", "cc"}], "]"}], 
        RowBox[{"dif", "[", 
         RowBox[{"cc", ",", "b"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"cc", ",", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "vars", "}"}], "]"}]}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuJacobian", "::", "usage"}], "=", 
     "\"\<tuJacobian[transformations_,var1_List,var2_List] computes the \
Jacobians from transformation_ of the form {var1[1]\[Rule]var1[1][var2[1],\
\[Ellipsis],var2[n]],var1[2]\[Rule]var1[2][var2[1],\[Ellipsis],var2[n]],\
\[Ellipsis]}.\nThe routine returns: {Jacobian[var1/var2], \
Rules[\[PartialD][var1,var2]], Jacobian[var2/var1], \
Rules[\[PartialD][var2,var1]]. *20Apr20*\>\""}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuJacobian", "[", 
      RowBox[{"transformation_", ",", "var1_List", ",", "var2_List"}], "]"}], 
     ":=", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "$", ",", "$0", ",", "$1", ",", "$2", ",", "$dterms", ",", "$s", ",", 
         "d", ",", "$j", ",", "$j2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"d", "[", "#", "]"}], "&"}], "/@", "#"}], "&"}], "/@", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "transformation", "}"}], "]"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$0", "=", 
         RowBox[{"$", "=", 
          RowBox[{"$", "//", 
           RowBox[{"tudExpandvI", "[", "d", "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"$dterms", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"d", "[", "i", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "var1"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"tuRuleSolve", "[", 
            RowBox[{"$0", ",", "$dterms"}], "]"}], "//", "Simplify"}], "//", 
          "Expand"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$dterms", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"d", "[", "i", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "var2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$j", "=", 
         RowBox[{"$", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "$dterms"}], "]"}], "&"}],
            "/@", "$"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"tuDPartial", "[", 
            RowBox[{"j", ",", "i"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "var2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "var1"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$1", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"$s", "\[Rule]", "$"}], ")"}], "//.", 
           RowBox[{
            RowBox[{"rr", ":", 
             RowBox[{"Rule", "[", 
              RowBox[{"a_", ",", "b_"}], "]"}]}], ":>", 
            RowBox[{"Thread", "[", "rr", "]"}]}]}], "//", "Flatten"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"$dterms", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"d", "[", "i", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "var2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"tuRuleSolve", "[", 
            RowBox[{"$0", ",", "$dterms"}], "]"}], "//", "Simplify"}], "//", 
          "Expand"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$dterms", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"d", "[", "i", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "var1"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$j2", "=", 
         RowBox[{"$", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "$dterms"}], "]"}], "&"}],
            "/@", "$"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"tuDPartial", "[", 
            RowBox[{"j", ",", "i"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "var1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "var2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"$2", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"$s", "\[Rule]", "$"}], ")"}], "//.", 
           RowBox[{
            RowBox[{"rr", ":", 
             RowBox[{"Rule", "[", 
              RowBox[{"a_", ",", "b_"}], "]"}]}], ":>", 
            RowBox[{"Thread", "[", "rr", "]"}]}]}], "//", "Flatten"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"$j", "[", 
           RowBox[{"CG", "[", "\"\<Jacobian[var1/var2]\>\"", "]"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"$1", "[", 
           RowBox[{"CG", "[", "\"\<Rules[\[PartialD][var1,var2]]\>\"", "]"}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"$j2", "[", 
           RowBox[{"CG", "[", "\"\<Jacobian[var2/var1]\>\"", "]"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"$2", "[", 
           RowBox[{"CG", "[", "\"\<Rules[\[PartialD][var1,var2]]\>\"", "]"}], 
           "]"}]}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
      "**", "**", "**", "**"}], "********)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuScalarSelect", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuScalarSelect", "::", "usage"}], "=", 
     "\"\<tuScalarSelect[scalars_List:{}][exp_] returns a List of NumericQ[] \
and scalars_ in exp_. *12Nov2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuScalarSelect", "[", 
       RowBox[{"scalars_List:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$pos"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$pos", "=", 
         RowBox[{"$", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"_", "?", "NumericQ"}], ",", "scalars"}], "}"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "&"}], ",", "$pos"}], 
          "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuScalarDelete", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuScalarDelete", "::", "usage"}], "=", 
     "\"\<tuScalarDelete[scalars_List:{}][exp_] returns exp_ with NumericQ[] \
and scalars_ in removed. *12Nov2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuScalarDelete", "[", 
       RowBox[{"scalars_List:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$pos"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$pos", "=", 
         RowBox[{"$", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"_", "?", "NumericQ"}], ",", "scalars"}], "}"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$pos", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", "$pos"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"$", ",", "$pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Commutation", " ", "and", " ", "Anti"}], "-", 
     RowBox[{"commutation", " ", 
      RowBox[{"definitions", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCommutator", "::", "usage"}], " ", "=", " ", 
     "\"\<tuCommutator[op_:Dot,sign_:-1][A_,B_] expands the commutator of \
matrices A and B using op_ as multiplicative operator. *17Feb2016*\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCommutator", "[", 
      RowBox[{
       RowBox[{"op_:", "Dot"}], ",", 
       RowBox[{"sign_:", "-", "1"}]}], "]"}], "[", 
     RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"op", "[", 
      RowBox[{"A", ",", "B"}], "]"}], "+", 
     RowBox[{"sign", " ", 
      RowBox[{"op", "[", 
       RowBox[{"B", ",", "A"}], "]"}]}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MCommutator", "[", 
      RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuCommutator", "[", "Dot", "]"}], "[", 
      RowBox[{"A", ",", "B"}], "]"}]}], ";"}], " ", 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ACommutator", "[", 
      RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuCommutator", "[", 
       RowBox[{"Dot", ",", "1"}], "]"}], "[", 
      RowBox[{"A", ",", "B"}], "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]"}]}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.474902202988223*^9, 3.474902218781245*^9}, {
   3.474902249452106*^9, 3.474902252358342*^9}, 3.4749022885666847`*^9, {
   3.474904002467537*^9, 3.474904015966226*^9}, {3.474904313637267*^9, 
   3.474904314548793*^9}, {3.4749048751484833`*^9, 3.474904921574607*^9}, {
   3.474904979979472*^9, 3.4749049974963837`*^9}, {3.474905066647118*^9, 
   3.4749050811369257`*^9}, {3.47490523544936*^9, 3.474905236168868*^9}, {
   3.474944627432186*^9, 3.474944639810153*^9}, {3.4749447417941303`*^9, 
   3.474944745533605*^9}, {3.47494480052849*^9, 3.474944888358387*^9}, {
   3.4749449236275597`*^9, 3.4749449266154633`*^9}, {3.4749449876399603`*^9, 
   3.4749450212062597`*^9}, {3.474945424838657*^9, 3.4749454345521097`*^9}, {
   3.474945466141786*^9, 3.474945538456306*^9}, {3.474945628035927*^9, 
   3.4749456296334476`*^9}, {3.474945732962715*^9, 3.474945737890752*^9}, {
   3.4749482603608637`*^9, 3.474948281093103*^9}, {3.4749483840846977`*^9, 
   3.4749483992388697`*^9}, {3.47494875051725*^9, 3.474948803611261*^9}, {
   3.474948884947719*^9, 3.474948931840364*^9}, {3.4749492406201077`*^9, 
   3.47494925331595*^9}, 3.4749494733800087`*^9, {3.4749495113089247`*^9, 
   3.474949513753845*^9}, 3.474949573354327*^9, 3.4749499896837673`*^9, 
   3.474950029369328*^9, {3.474950131732786*^9, 3.474950132368799*^9}, {
   3.474981806402833*^9, 3.474981899327038*^9}, {3.474981930863414*^9, 
   3.4749819526597548`*^9}, {3.474982139741414*^9, 3.474982219964347*^9}, 
   3.4749823960052423`*^9, {3.474982459470777*^9, 3.4749824720743837`*^9}, {
   3.474984800287813*^9, 3.4749848254758472`*^9}, {3.474985004182403*^9, 
   3.4749850117712927`*^9}, {3.474985086786294*^9, 3.474985134182914*^9}, {
   3.474985177061207*^9, 3.4749851963052073`*^9}, {3.4749852770738363`*^9, 
   3.474985279382162*^9}, {3.474985317981666*^9, 3.474985318796495*^9}, {
   3.474985397408358*^9, 3.4749854396534157`*^9}, {3.475036704893425*^9, 
   3.475036731196498*^9}, {3.4750389758328333`*^9, 3.475039012093803*^9}, {
   3.475039049487483*^9, 3.4750390689880657`*^9}, {3.475039105243697*^9, 
   3.475039159964554*^9}, {3.4750392870967073`*^9, 3.475039385368299*^9}, {
   3.475039458528109*^9, 3.475039503603745*^9}, {3.475063508482891*^9, 
   3.475063663796075*^9}, {3.475063695597624*^9, 3.475063763677724*^9}, 
   3.475063796432467*^9, {3.475063970321206*^9, 3.475064036031556*^9}, 
   3.475064099865511*^9, {3.4750641864351683`*^9, 3.475064298812497*^9}, {
   3.475064353035616*^9, 3.4750644186614227`*^9}, {3.475064520693749*^9, 
   3.475064524811913*^9}, {3.475064601896146*^9, 3.475064610046653*^9}, {
   3.475064688899332*^9, 3.4750647411643953`*^9}, {3.47506479413098*^9, 
   3.475064868797393*^9}, {3.475327441006032*^9, 3.475327452271845*^9}, {
   3.475327660591365*^9, 3.475327669398367*^9}, {3.475333293468802*^9, 
   3.47533329498803*^9}, {3.475333430884448*^9, 3.475333507277213*^9}, {
   3.475509439666131*^9, 3.475509440215962*^9}, {3.475808837281938*^9, 
   3.475808862101738*^9}, {3.475808893363825*^9, 3.4758090991040487`*^9}, {
   3.475809285434099*^9, 3.475809308024102*^9}, {3.475809566820257*^9, 
   3.4758095722907352`*^9}, {3.475898672757971*^9, 3.475898765258114*^9}, {
   3.475899848905645*^9, 3.4758998957129507`*^9}, {3.4763897180650787`*^9, 
   3.476389718908877*^9}, {3.476394465322373*^9, 3.476394470317672*^9}, {
   3.476394524776701*^9, 3.476394532918673*^9}, {3.476475121496636*^9, 
   3.476475148939528*^9}, {3.476475180297505*^9, 3.4764752046779013`*^9}, {
   3.476475244590598*^9, 3.4764754125132837`*^9}, {3.476824581316856*^9, 
   3.47682466249527*^9}, {3.476824721532248*^9, 3.476824789474885*^9}, {
   3.47682488084687*^9, 3.476824889776174*^9}, {3.476825118436091*^9, 
   3.476825133069786*^9}, {3.4768251972628813`*^9, 3.476825201005974*^9}, {
   3.476891015110813*^9, 3.4768911658439093`*^9}, {3.47689128459365*^9, 
   3.476891327240355*^9}, {3.4781225088749332`*^9, 3.478122510170926*^9}, {
   3.478281524916589*^9, 3.478281541989093*^9}, {3.4783504236141663`*^9, 
   3.478350443455793*^9}, {3.478540691886973*^9, 3.478540756549728*^9}, {
   3.478704614167588*^9, 3.4787046954582*^9}, {3.4787284987021103`*^9, 
   3.478728572584029*^9}, 3.4787286358032503`*^9, {3.4787287078152237`*^9, 
   3.478728751465004*^9}, {3.479094639012525*^9, 3.479094640981619*^9}, {
   3.479823095470861*^9, 3.479823097868977*^9}, {3.480704788150837*^9, 
   3.480704788738905*^9}, {3.481082722497822*^9, 3.481082722779748*^9}, {
   3.481083321369286*^9, 3.481083328317712*^9}, 3.481725675991349*^9, 
   3.482148715235587*^9, {3.482185298093439*^9, 3.482185298895957*^9}, {
   3.4821854152750893`*^9, 3.4821854165183496`*^9}, {3.482236737238839*^9, 
   3.482236747909891*^9}, {3.4824294407189703`*^9, 3.4824294456308737`*^9}, {
   3.48251241688312*^9, 3.4825124177552223`*^9}, {3.482546884730997*^9, 
   3.4825468880538588`*^9}, {3.482547761319466*^9, 3.482547766588665*^9}, {
   3.482604340389491*^9, 3.4826043550210876`*^9}, 3.48260442831594*^9, {
   3.4826335414095488`*^9, 3.482633547869377*^9}, {3.482633609701015*^9, 
   3.482633613077763*^9}, {3.482637096849654*^9, 3.482637097680759*^9}, {
   3.4826703830360117`*^9, 3.4826703838774548`*^9}, {3.482673603256509*^9, 
   3.482673662540257*^9}, {3.482673697366275*^9, 3.4826737257435102`*^9}, {
   3.482673839152343*^9, 3.4826738395414658`*^9}, {3.482678360478923*^9, 
   3.4826783610311947`*^9}, {3.482721043643178*^9, 3.4827210763884277`*^9}, {
   3.482721333608243*^9, 3.482721333741722*^9}, {3.482868680893037*^9, 
   3.482868742739963*^9}, {3.4830648741403427`*^9, 3.483064875569902*^9}, {
   3.48500705514178*^9, 3.485007077555449*^9}, {3.485007230414259*^9, 
   3.485007238393736*^9}, {3.485007322134348*^9, 3.4850073419800262`*^9}, {
   3.4853497458091307`*^9, 3.48534978019737*^9}, {3.4853498601902227`*^9, 
   3.485349860546287*^9}, {3.4864683683970737`*^9, 3.486468376508766*^9}, {
   3.48673067878537*^9, 3.486730731968979*^9}, {3.489846032895563*^9, 
   3.489846033748596*^9}, {3.489847242765437*^9, 3.489847243495686*^9}, {
   3.490193824777232*^9, 3.4901938703675623`*^9}, {3.4901941313958597`*^9, 
   3.4901942388797503`*^9}, {3.491961182980302*^9, 3.491961260689644*^9}, {
   3.491961926167563*^9, 3.491961975600124*^9}, {3.492093048589561*^9, 
   3.4920931082587643`*^9}, {3.492477146003482*^9, 3.492477150452724*^9}, 
   3.492530040864007*^9, 3.492530939388747*^9, {3.495330323944461*^9, 
   3.495330412607485*^9}, {3.496418489105599*^9, 3.496418499479809*^9}, {
   3.4971882659247723`*^9, 3.497188335314774*^9}, {3.4971884918118896`*^9, 
   3.497188493840942*^9}, {3.497188532432785*^9, 3.4971885401626062`*^9}, {
   3.497188689002428*^9, 3.497188756616213*^9}, {3.497188808049087*^9, 
   3.497188813463811*^9}, {3.497188856915152*^9, 3.497188933815338*^9}, {
   3.497189191779944*^9, 3.4971892835387583`*^9}, {3.497194928995056*^9, 
   3.497194932926819*^9}, {3.50117772160289*^9, 3.5011777269658003`*^9}, {
   3.501177763481373*^9, 3.501177764929788*^9}, {3.501178081472568*^9, 
   3.501178082590404*^9}, {3.501178321091796*^9, 3.501178336586912*^9}, {
   3.501178367142498*^9, 3.501178375469048*^9}, {3.501179047593821*^9, 
   3.501179083220793*^9}, {3.5011794098632803`*^9, 3.501179416107768*^9}, {
   3.501206212115271*^9, 3.5012062409825697`*^9}, {3.501206481469286*^9, 
   3.50120648221948*^9}, {3.5012066273002253`*^9, 3.5012066477607613`*^9}, {
   3.5012067411793737`*^9, 3.501206746371129*^9}, {3.5012067828548326`*^9, 
   3.501206870171858*^9}, {3.505743666057332*^9, 3.505743694561953*^9}, {
   3.507040187520445*^9, 3.5070402484347363`*^9}, {3.507040292073475*^9, 
   3.507040387231353*^9}, {3.507040421568221*^9, 3.5070404293419*^9}, {
   3.5070405905557547`*^9, 3.507040754180627*^9}, {3.507403711463745*^9, 
   3.5074037506595783`*^9}, {3.507404921843438*^9, 3.507404934591123*^9}, {
   3.509886752215684*^9, 3.509886752982313*^9}, {3.510318906220117*^9, 
   3.510318908804021*^9}, {3.512909449063163*^9, 3.512909511210724*^9}, {
   3.51455942285139*^9, 3.514559521571856*^9}, {3.514563004726968*^9, 
   3.514563010477454*^9}, {3.514563074893447*^9, 3.514563126181097*^9}, {
   3.514563551529117*^9, 3.514563558036141*^9}, 3.517141849222274*^9, {
   3.5173985801442842`*^9, 3.517398637240151*^9}, {3.517398706275816*^9, 
   3.517398713241227*^9}, {3.5173987566518497`*^9, 3.517398787391902*^9}, {
   3.517398906090645*^9, 3.517398918882574*^9}, {3.51739895353936*^9, 
   3.5173989537357683`*^9}, {3.517399107149704*^9, 3.517399112559073*^9}, {
   3.517399172795806*^9, 3.51739917612143*^9}, {3.5173993135494423`*^9, 
   3.517399313886087*^9}, {3.517399354825639*^9, 3.517399355021492*^9}, {
   3.517399615727089*^9, 3.517399615943577*^9}, {3.517922461363771*^9, 
   3.517922519111821*^9}, 3.520604439885626*^9, {3.520604485580719*^9, 
   3.5206045633393183`*^9}, {3.5206046709555683`*^9, 3.52060472848389*^9}, {
   3.5206047604679737`*^9, 3.520604761689803*^9}, {3.5206048261342907`*^9, 
   3.520604892395482*^9}, {3.5206049307069798`*^9, 3.520604933949596*^9}, {
   3.520604966978264*^9, 3.5206049998445683`*^9}, {3.520605061308443*^9, 
   3.520605069611031*^9}, {3.520605111585581*^9, 3.520605118147347*^9}, {
   3.520605660245088*^9, 3.520605789491481*^9}, {3.5245875402485437`*^9, 
   3.524587545392435*^9}, {3.524587677365147*^9, 3.524587692716282*^9}, {
   3.524587928238309*^9, 3.5245879328401814`*^9}, {3.5245879887756653`*^9, 
   3.5245879916961737`*^9}, {3.5245897982588043`*^9, 
   3.5245898451716127`*^9}, {3.5245899039439087`*^9, 3.524589915047142*^9}, {
   3.524589957001099*^9, 3.524589993244589*^9}, {3.525792365238401*^9, 
   3.525792430328878*^9}, {3.5360796120405397`*^9, 3.536079661317154*^9}, {
   3.5360813788158817`*^9, 3.5360814159663982`*^9}, {3.536082463100623*^9, 
   3.536082463469048*^9}, {3.53609258082764*^9, 3.536092589107584*^9}, {
   3.5417796080821323`*^9, 3.5417796139624662`*^9}, {3.543325811800481*^9, 
   3.543325856810061*^9}, {3.547466955841556*^9, 3.5474669602275343`*^9}, {
   3.547467036670439*^9, 3.547467060881939*^9}, 3.547521472789277*^9, {
   3.54752153591936*^9, 3.5475215382851477`*^9}, {3.547569792960968*^9, 
   3.5475698144053288`*^9}, {3.547569907007142*^9, 3.547569912452526*^9}, {
   3.54756994458948*^9, 3.547569950365323*^9}, {3.547573068242045*^9, 
   3.547573196930344*^9}, {3.547606057479868*^9, 3.547606066567369*^9}, {
   3.547776334300455*^9, 3.547776343902893*^9}, {3.547820344308168*^9, 
   3.547820346054772*^9}, {3.547820494822114*^9, 3.547820504577984*^9}, {
   3.547821255017911*^9, 3.547821360971533*^9}, {3.547821478017498*^9, 
   3.547821478589033*^9}, {3.547821623438278*^9, 3.547821631282832*^9}, {
   3.5478290591858892`*^9, 3.5478290671293163`*^9}, {3.547913827318898*^9, 
   3.5479138486403637`*^9}, 3.5479146111360083`*^9, 3.547914890397006*^9, {
   3.547952343777731*^9, 3.547952350961772*^9}, {3.547984612762704*^9, 
   3.547984624069708*^9}, {3.547988313947021*^9, 3.547988314140554*^9}, {
   3.5479883770279083`*^9, 3.547988392020302*^9}, {3.547989473059956*^9, 
   3.5479894772742157`*^9}, 3.548296827630518*^9, {3.548672135665238*^9, 
   3.548672179829811*^9}, {3.5486722300911913`*^9, 3.548672299206053*^9}, {
   3.548676008494523*^9, 3.5486761531538687`*^9}, 3.5486762120604057`*^9, 
   3.54867672077451*^9, 3.548760910203574*^9, {3.5490367717020493`*^9, 
   3.549036825475224*^9}, {3.5492009260709953`*^9, 3.5492009490136003`*^9}, {
   3.549202845824753*^9, 3.5492028670436783`*^9}, {3.5492028981234303`*^9, 
   3.549203096393979*^9}, {3.549461773653892*^9, 3.5494617997942142`*^9}, {
   3.5494658071402893`*^9, 3.549465826515318*^9}, {3.549465864346469*^9, 
   3.549465865711234*^9}, {3.549467711803896*^9, 3.549467738918034*^9}, {
   3.549636724565477*^9, 3.549636767877368*^9}, {3.549636809899124*^9, 
   3.549636826650112*^9}, {3.549637124194193*^9, 3.5496371316916943`*^9}, {
   3.5496387523977547`*^9, 3.5496387583329983`*^9}, {3.551009054328559*^9, 
   3.55100919140309*^9}, {3.551454412364565*^9, 3.5514544419346867`*^9}, {
   3.551454788521068*^9, 3.551454800674261*^9}, {3.5517232192304583`*^9, 
   3.551723236143983*^9}, {3.5517233143384323`*^9, 3.551723333690413*^9}, {
   3.5517233802644176`*^9, 3.5517233812544613`*^9}, {3.552224985900489*^9, 
   3.5522249915164547`*^9}, {3.5522251563919773`*^9, 3.552225180790694*^9}, {
   3.5522253772081003`*^9, 3.552225381112842*^9}, {3.5522255000389*^9, 
   3.552225507864771*^9}, 3.5522257060989428`*^9, {3.552225769415806*^9, 
   3.552225775782591*^9}, {3.552306782893716*^9, 3.552306808813896*^9}, {
   3.552997105263105*^9, 3.5529974450170717`*^9}, 3.552997491810095*^9, {
   3.5529975262200108`*^9, 3.552997702777557*^9}, {3.552997734999671*^9, 
   3.552997745009034*^9}, {3.5529977760225697`*^9, 3.5529977790942497`*^9}, {
   3.5531847221053247`*^9, 3.5531848079614573`*^9}, {3.553184857218029*^9, 
   3.553184957853076*^9}, {3.5531850043341846`*^9, 3.553185042119327*^9}, {
   3.553185530111565*^9, 3.55318559123486*^9}, {3.554084812059407*^9, 
   3.554084881553115*^9}, {3.554084911987204*^9, 3.5540849415531063`*^9}, {
   3.554084997475234*^9, 3.554085042307598*^9}, 3.554085094384509*^9, {
   3.554085231165718*^9, 3.554085232560597*^9}, {3.555429843617339*^9, 
   3.555429881516202*^9}, {3.556118849857534*^9, 3.5561189474520473`*^9}, {
   3.5575382143336363`*^9, 3.557538250108223*^9}, {3.557538308987898*^9, 
   3.557538312372142*^9}, {3.5575383540843353`*^9, 3.557538354324029*^9}, {
   3.561244021947459*^9, 3.561244068900326*^9}, {3.561246143834937*^9, 
   3.5612462565432053`*^9}, {3.570814270173438*^9, 3.570814272834488*^9}, {
   3.579482328331637*^9, 3.57948233966433*^9}, 3.5795235827018623`*^9, {
   3.579615532654642*^9, 3.579615565221303*^9}, {3.5825517651336527`*^9, 
   3.582551768597513*^9}, 3.582572840635682*^9, 3.582573256991846*^9, {
   3.582660123215681*^9, 3.5826601369788017`*^9}, {3.582661509052243*^9, 
   3.582661537323606*^9}, {3.5829852743793173`*^9, 3.582985279662901*^9}, {
   3.5851443733687277`*^9, 3.585144410754301*^9}, {3.585144448280352*^9, 
   3.585144481730774*^9}, 3.5901512324506063`*^9, {3.590151288269692*^9, 
   3.590151311355528*^9}, {3.59590400643709*^9, 3.595904033643372*^9}, 
   3.603132183085704*^9, {3.603134675259358*^9, 3.603134908674239*^9}, {
   3.603161514314807*^9, 3.603161586567883*^9}, {3.603374999152697*^9, 
   3.603375000450149*^9}, {3.604237956036614*^9, 3.604237973940854*^9}, {
   3.606139558691266*^9, 3.606139585679583*^9}, {3.606139620552191*^9, 
   3.606139677004023*^9}, {3.6061397338516417`*^9, 3.606139799798225*^9}, {
   3.606180500136984*^9, 3.6061805248637533`*^9}, {3.61390776781805*^9, 
   3.613907778086227*^9}, {3.620398892636718*^9, 3.620398893344049*^9}, {
   3.626572185028987*^9, 3.626572200355054*^9}, {3.626572244853149*^9, 
   3.626572245290723*^9}, {3.6301670114535646`*^9, 3.630167016588004*^9}, {
   3.630167065920331*^9, 3.630167203355472*^9}, {3.6322399180429773`*^9, 
   3.6322399545703897`*^9}, 3.632240142809801*^9, {3.632244553981351*^9, 
   3.632244588637862*^9}, {3.632244674139402*^9, 3.632244674840087*^9}, {
   3.6322447575417433`*^9, 3.632244783008519*^9}, {3.6322450477784777`*^9, 
   3.632245097280139*^9}, {3.6322827144807663`*^9, 3.632282782667157*^9}, {
   3.632282831263461*^9, 3.6322828485634604`*^9}, {3.632282902476047*^9, 
   3.6322829060683603`*^9}, {3.632336529591711*^9, 3.632336539021999*^9}, {
   3.632338268129551*^9, 3.6323382996941357`*^9}, {3.632342233953264*^9, 
   3.632342290728303*^9}, {3.632409495713695*^9, 3.6324095704493847`*^9}, {
   3.632968218403388*^9, 3.6329682949841948`*^9}, {3.632968364129599*^9, 
   3.6329683644380293`*^9}, {3.632968612410953*^9, 3.6329686302898903`*^9}, {
   3.633355585391631*^9, 3.633355602866496*^9}, {3.6333556543701344`*^9, 
   3.633355665696307*^9}, {3.6336270490227118`*^9, 3.6336270850315323`*^9}, {
   3.63430354452103*^9, 3.634303571870769*^9}, {3.6343036019332027`*^9, 
   3.634303619303318*^9}, {3.634303676157058*^9, 3.634303717251642*^9}, {
   3.63430374928133*^9, 3.634303751129406*^9}, {3.634303795446948*^9, 
   3.634303847527969*^9}, {3.634303878704342*^9, 3.634303911361217*^9}, 
   3.6343039642464933`*^9, {3.634310610866789*^9, 3.634310617830597*^9}, {
   3.634480627133318*^9, 3.634480634923929*^9}, {3.635262535742736*^9, 
   3.635262546526554*^9}, {3.635859215332065*^9, 3.635859306553586*^9}, {
   3.641902202671479*^9, 3.641902208424436*^9}, {3.642517257877203*^9, 
   3.64251728302556*^9}, {3.642517811751189*^9, 3.642517867391622*^9}, 
   3.647968153093069*^9, {3.648053834794793*^9, 3.648053843252666*^9}, 
   3.6480540303987513`*^9, {3.648054482263104*^9, 3.6480544856756697`*^9}, {
   3.648054885494812*^9, 3.648054902842156*^9}, {3.648647952356991*^9, 
   3.648648170712833*^9}, {3.648648299060418*^9, 3.648648304388734*^9}, {
   3.6486532261033373`*^9, 3.648653362149927*^9}, {3.6503850232387257`*^9, 
   3.650385028430337*^9}, {3.650420139072345*^9, 3.650420209159109*^9}, {
   3.650459160162188*^9, 3.650459227692157*^9}, {3.650459267031205*^9, 
   3.650459273084811*^9}, 3.651252104534273*^9, {3.65176306617669*^9, 
   3.6517631146949873`*^9}, {3.6518583312287807`*^9, 3.651858334756316*^9}, 
   3.651858462529237*^9, 3.651858787873815*^9, {3.651860046565812*^9, 
   3.651860110911244*^9}, {3.651862508616939*^9, 3.651862541948559*^9}, {
   3.651877105495965*^9, 3.6518771080636787`*^9}, {3.651930004311692*^9, 
   3.651930091205946*^9}, 3.651930150801971*^9, {3.6519302328479757`*^9, 
   3.6519302782899017`*^9}, {3.65193057125574*^9, 3.651930573642048*^9}, {
   3.651930608156439*^9, 3.651930623470849*^9}, {3.6519313686100817`*^9, 
   3.651931383446331*^9}, {3.6546136257904663`*^9, 3.6546136585335093`*^9}, {
   3.654613709212088*^9, 3.654613716868129*^9}, {3.6550570377848587`*^9, 
   3.655057223802351*^9}, {3.655083420131201*^9, 3.655083422320631*^9}, {
   3.6559917788954477`*^9, 3.655991786616446*^9}, {3.655991889122361*^9, 
   3.6559918905439177`*^9}, 3.6559954073422613`*^9, {3.6559954926100197`*^9, 
   3.655995493653132*^9}, {3.656192339497262*^9, 3.656192351133314*^9}, 
   3.656343177949699*^9, {3.6563536729659233`*^9, 3.656353695894915*^9}, {
   3.656353738266508*^9, 3.656353739572315*^9}, 3.656353901739676*^9, {
   3.6563560582695627`*^9, 3.656356059426629*^9}, 3.6563580252934027`*^9, {
   3.6563818783015833`*^9, 3.656381888449151*^9}, {3.6563825072501583`*^9, 
   3.656382536344324*^9}, 3.656382625829821*^9, {3.656382736492379*^9, 
   3.656382752637125*^9}, {3.6563828701683493`*^9, 3.65638292350183*^9}, {
   3.656383002923203*^9, 3.656383034406505*^9}, {3.656383516965989*^9, 
   3.656383547491228*^9}, {3.656386983611854*^9, 3.656386985020563*^9}, {
   3.656518258647299*^9, 3.656518261119485*^9}, {3.656608093117013*^9, 
   3.6566081392287683`*^9}, 3.6580682806461563`*^9, {3.658068359928054*^9, 
   3.658068402888883*^9}, {3.658068536520453*^9, 3.6580686207530117`*^9}, 
   3.6614422953300123`*^9, {3.661703643920867*^9, 3.661703734209997*^9}, {
   3.6617038041234837`*^9, 3.6617038397149763`*^9}, 3.66301536533948*^9, {
   3.6633470801307173`*^9, 3.663347121124921*^9}, {3.66342519570679*^9, 
   3.6634251958612137`*^9}, {3.663425226098872*^9, 3.663425257844859*^9}, {
   3.664673871130727*^9, 3.664673877019802*^9}, {3.664674285313066*^9, 
   3.664674351115965*^9}, {3.664718757619442*^9, 3.664718902008336*^9}, {
   3.6647189443203983`*^9, 3.664718971063574*^9}, {3.66471900674513*^9, 
   3.664719041477016*^9}, {3.664719113501501*^9, 3.664719181980377*^9}, 
   3.6647243054035482`*^9, 3.664724350989072*^9, 3.66472438769591*^9, {
   3.664761918661418*^9, 3.66476191886895*^9}, {3.666054510667283*^9, 
   3.6660545110849743`*^9}, {3.6665322820125093`*^9, 3.666532284705451*^9}, 
   3.666535512485806*^9, {3.666535732053694*^9, 3.666535746905856*^9}, {
   3.666542181117128*^9, 3.666542181294492*^9}, {3.666542229303391*^9, 
   3.666542238888685*^9}, {3.666542462506027*^9, 3.666542514097335*^9}, {
   3.667484823509465*^9, 3.6674848583631983`*^9}, 3.669640238244953*^9, 
   3.669640451527762*^9, {3.684671623810527*^9, 3.684671636789295*^9}, 
   3.696039905655365*^9, {3.6984575322988653`*^9, 3.698457545584296*^9}, {
   3.69921905359743*^9, 3.699219118036455*^9}, 3.70085272011712*^9, {
   3.700852752605055*^9, 3.700852754479116*^9}, 3.705425295298192*^9, 
   3.715353424518551*^9, {3.715355228289563*^9, 3.715355251610196*^9}, {
   3.71551859911445*^9, 3.715518693646047*^9}, {3.715518741576043*^9, 
   3.715518880854244*^9}, 3.715519470907192*^9, {3.71863054591855*^9, 
   3.718630560842331*^9}, {3.718630593328651*^9, 3.718630609111992*^9}, {
   3.719884224087564*^9, 3.719884395128935*^9}, {3.719885108420034*^9, 
   3.719885112331997*^9}, 3.719936273363143*^9, 3.7200256760054502`*^9, {
   3.720031115516616*^9, 3.7200311589568357`*^9}, 3.7200363647243032`*^9, {
   3.721572141116715*^9, 3.721572141331973*^9}, {3.72157224812575*^9, 
   3.721572273033217*^9}, 3.7215723116625223`*^9, {3.721573101935635*^9, 
   3.721573125811124*^9}, {3.7222725856842327`*^9, 3.722272592148238*^9}, {
   3.722272630140163*^9, 3.722272630410589*^9}, {3.7222777139211283`*^9, 
   3.722277717648478*^9}, {3.7222777540609407`*^9, 3.722277764530471*^9}, {
   3.722277807027483*^9, 3.722277823677991*^9}, {3.724598142068655*^9, 
   3.724598177252694*^9}, 3.724598559110568*^9, {3.72459881411948*^9, 
   3.724598840457182*^9}, {3.724938805306134*^9, 3.724938826367186*^9}, 
   3.7249409460559893`*^9, {3.725237263887587*^9, 3.725237430036418*^9}, 
   3.7284433178271217`*^9, {3.7289306527031593`*^9, 3.7289306562109947`*^9}, 
   3.730032302069594*^9, {3.733745159924086*^9, 3.733745161264634*^9}, {
   3.73420760969687*^9, 3.734207631668275*^9}, 3.7342077221948223`*^9, {
   3.734207791246051*^9, 3.734207805391631*^9}, {3.734294650019022*^9, 
   3.734294650871552*^9}, {3.7342984464481897`*^9, 3.7342985831809263`*^9}, 
   3.734811223049776*^9, {3.734827131217099*^9, 3.734827134691774*^9}, 
   3.734828274897483*^9, {3.7348283056328373`*^9, 3.734828306046193*^9}, {
   3.734829130035247*^9, 3.7348291354769983`*^9}, {3.734829686564053*^9, 
   3.734829784540326*^9}, {3.7348298192826777`*^9, 3.734829845318838*^9}, {
   3.734829877461061*^9, 3.734829900239401*^9}, {3.734830020236506*^9, 
   3.7348300232514553`*^9}, {3.73508949087645*^9, 3.735089495245596*^9}, {
   3.7367743189164457`*^9, 3.736774624231256*^9}, {3.736774971158208*^9, 
   3.736775005555626*^9}, {3.73677548311661*^9, 3.736775499064307*^9}, {
   3.736775581634591*^9, 3.736775610167419*^9}, 3.736775811004257*^9, {
   3.736777119335939*^9, 3.736777220149267*^9}, {3.7367773564428873`*^9, 
   3.73677736630464*^9}, 3.736777451306786*^9, 3.736777517666383*^9, {
   3.7404847633484373`*^9, 3.740484764439864*^9}, {3.7404849463694477`*^9, 
   3.74048502224798*^9}, {3.7404850604639874`*^9, 3.740485078041994*^9}, {
   3.740485367566526*^9, 3.7404854908824253`*^9}, {3.750433336848987*^9, 
   3.7504333529074783`*^9}, 3.7504348938066587`*^9, {3.750435209143507*^9, 
   3.750435210666519*^9}, {3.7584007859629393`*^9, 3.758400857189207*^9}, {
   3.759071909828596*^9, 3.759071916540208*^9}, {3.759071976295788*^9, 
   3.759072029698648*^9}, {3.7590746053022823`*^9, 3.759074623115233*^9}, {
   3.759110034522871*^9, 3.7591100505358686`*^9}, {3.759842743970127*^9, 
   3.7598429992090473`*^9}, {3.759843092766433*^9, 3.7598430973726187`*^9}, {
   3.7609299263321943`*^9, 3.760929972075721*^9}, {3.762599290273859*^9, 
   3.7625992914844112`*^9}, {3.762826253783053*^9, 3.762826259045985*^9}, 
   3.762871101759263*^9, 3.792936346810896*^9, {3.796411180608741*^9, 
   3.796411274577875*^9}, {3.796415219798744*^9, 3.796415222529022*^9}, 
   3.796415341963957*^9, 
   3.797084417561535*^9},ExpressionUUID->"7fe73395-1254-4288-b8f3-\
24670935a812"],

Cell[BoxData["DotFunctions"], "Output",
 CellChangeTimes->{
  3.552665666784577*^9, {3.552997791332822*^9, 3.5529977925118513`*^9}, 
   3.553186057844952*^9, 3.554084575943719*^9, 3.554085050647551*^9, 
   3.554085238378446*^9, {3.555429884052548*^9, 3.555429885965501*^9}, 
   3.55577801801059*^9, 3.556368719029397*^9, 3.556375761069633*^9, {
   3.556376972947465*^9, 3.5563769934874477`*^9}, 3.556904690815742*^9, 
   3.556974061264797*^9, 3.5569748092731743`*^9, 3.55697487720932*^9, 
   3.556974912216609*^9, 3.557076030989336*^9, 3.558963616452752*^9, 
   3.558988280658901*^9, 3.559212051320636*^9, 3.559395857368808*^9, {
   3.5648823608585863`*^9, 3.564882362932171*^9}, {3.566226549489211*^9, 
   3.566226579567203*^9}, 3.5662692792287893`*^9, {3.566271126500415*^9, 
   3.566271148484943*^9}, 3.5671743572153053`*^9, 3.5673468305153112`*^9, 
   3.568471650561784*^9, 3.568820173091609*^9, 3.570206028579933*^9, 
   3.5708423527614937`*^9, 3.573225227352779*^9, 3.577065893180237*^9, 
   3.5799727136307077`*^9, {3.5802127657844257`*^9, 3.580212781887764*^9}, {
   3.58021282063768*^9, 3.58021282249397*^9}, {3.5802128584408197`*^9, 
   3.580212882527535*^9}, 3.580213012093449*^9, 3.580573984509042*^9, 
   3.580574526420362*^9, 3.5825723025245323`*^9, 3.582884271475889*^9, 
   3.582985282038698*^9, {3.5831537933409767`*^9, 3.583153795196087*^9}, 
   3.583853041889923*^9, {3.585144487169178*^9, 3.5851444893898077`*^9}, 
   3.588421080473011*^9, 3.590540981212843*^9, 3.593918764341484*^9, 
   3.596205464852831*^9, 3.5975338625870647`*^9, 3.597635723890345*^9, 
   3.597635979080573*^9, 3.600109613729927*^9, 3.602946177486844*^9, 
   3.603374915400469*^9, 3.6033750026088867`*^9, 3.604077749225848*^9, 
   3.606480751427948*^9, 3.607447650270329*^9, 3.6082191755726433`*^9, 
   3.608994964776641*^9, 3.609704685896785*^9, 3.6114087685714397`*^9, 
   3.615478587536117*^9, 3.620144186553331*^9, 3.6203973784854107`*^9, {
   3.6203981175371943`*^9, 3.620398123110386*^9}, {3.6203989207534657`*^9, 
   3.620398929497123*^9}, 3.620398977339456*^9, 3.620500591686352*^9, 
   3.6205686638630238`*^9, 3.620999761240095*^9, 3.621342767606632*^9, 
   3.6216024745150023`*^9, 3.626275953553906*^9, 3.6269710250775547`*^9, 
   3.6270631567334347`*^9, 3.628866555837755*^9, 3.631035491014024*^9, {
   3.631375862200739*^9, 3.631375878914476*^9}, 3.6314538557404947`*^9, {
   3.631800803819447*^9, 3.631800806559661*^9}, 3.631800840727607*^9, 
   3.632244619398506*^9, 3.6322447883374357`*^9, 3.632245074279151*^9, 
   3.632245106017213*^9, 3.63233831136257*^9, {3.633462764954226*^9, 
   3.6334627677934513`*^9}, 3.6334628207513742`*^9, 3.633627096150796*^9, 
   3.634309612128146*^9, 3.634310213744403*^9, {3.635262549953981*^9, 
   3.635262552212591*^9}, {3.635859318176495*^9, 3.6358593221598673`*^9}, 
   3.638886122238785*^9, 3.641908568462097*^9, 3.64367009918878*^9, 
   3.64368338769563*^9, 3.644023125981762*^9, {3.65505647743815*^9, 
   3.655056480817955*^9}, 3.655993932082576*^9, 3.656123972025215*^9, {
   3.656382543029499*^9, 3.656382547555777*^9}, 3.656382758942429*^9, 
   3.656382929228393*^9, 3.65651842898319*^9, 3.656596060371455*^9, 
   3.656597840057987*^9, 3.661018128476542*^9, {3.663425310009902*^9, 
   3.663425312292375*^9}, 3.6646412447361917`*^9, 3.664719054953404*^9, 
   3.666499659836491*^9, 3.6664997104231052`*^9, 3.666499793447399*^9, 
   3.6675737496999397`*^9, 3.669493490415452*^9, 3.6695533716490173`*^9, 
   3.669749154265767*^9, 3.6700801533123817`*^9, {3.6724462727544537`*^9, 
   3.672446275323547*^9}, {3.6724463056590137`*^9, 3.672446307609062*^9}, {
   3.695141636508999*^9, 3.695141661783188*^9}, 3.696874041764681*^9, 
   3.699730559079404*^9, 3.6997960461455584`*^9, 3.7000597874337053`*^9, 
   3.700145203085329*^9, 3.7005320513953743`*^9, 3.7054249407623167`*^9, 
   3.70671534077971*^9, 3.707052299742326*^9, 3.714143104375287*^9, 
   3.731069822516193*^9, 3.7321068997221746`*^9, 3.732191454833714*^9, 
   3.733240404762702*^9, {3.73508949978496*^9, 3.735089503023548*^9}, {
   3.735089941101675*^9, 3.735089943627606*^9}, 3.73564692430579*^9, 
   3.739794280625359*^9, 3.741353169724786*^9, {3.744973063196477*^9, 
   3.74497306746826*^9}, 3.745263603854718*^9, 3.7452673096092997`*^9, 
   3.745492870178808*^9, {3.747413746197236*^9, 3.747413750555229*^9}, 
   3.750954478349061*^9, 3.752936813311689*^9, 3.756049301984211*^9, {
   3.75907205190718*^9, 3.759072055933329*^9}, 3.7590746424849033`*^9, 
   3.796393437566689*^9, {3.7995892261404467`*^9, 3.799589232919189*^9}, {
   3.799589265373281*^9, 3.79958927210389*^9}, {3.799589486330512*^9, 
   3.7995894934318333`*^9}, 3.7995897109107037`*^9, 3.799589794281932*^9, 
   3.799589829516561*^9, 
   3.799589893871572*^9},ExpressionUUID->"7715a8bd-f761-45f7-aca0-\
165de23d7920"],

Cell[BoxData["CompleteBaseIndices"], "Output",
 CellChangeTimes->{
  3.552665666784577*^9, {3.552997791332822*^9, 3.5529977925118513`*^9}, 
   3.553186057844952*^9, 3.554084575943719*^9, 3.554085050647551*^9, 
   3.554085238378446*^9, {3.555429884052548*^9, 3.555429885965501*^9}, 
   3.55577801801059*^9, 3.556368719029397*^9, 3.556375761069633*^9, {
   3.556376972947465*^9, 3.5563769934874477`*^9}, 3.556904690815742*^9, 
   3.556974061264797*^9, 3.5569748092731743`*^9, 3.55697487720932*^9, 
   3.556974912216609*^9, 3.557076030989336*^9, 3.558963616452752*^9, 
   3.558988280658901*^9, 3.559212051320636*^9, 3.559395857368808*^9, {
   3.5648823608585863`*^9, 3.564882362932171*^9}, {3.566226549489211*^9, 
   3.566226579567203*^9}, 3.5662692792287893`*^9, {3.566271126500415*^9, 
   3.566271148484943*^9}, 3.5671743572153053`*^9, 3.5673468305153112`*^9, 
   3.568471650561784*^9, 3.568820173091609*^9, 3.570206028579933*^9, 
   3.5708423527614937`*^9, 3.573225227352779*^9, 3.577065893180237*^9, 
   3.5799727136307077`*^9, {3.5802127657844257`*^9, 3.580212781887764*^9}, {
   3.58021282063768*^9, 3.58021282249397*^9}, {3.5802128584408197`*^9, 
   3.580212882527535*^9}, 3.580213012093449*^9, 3.580573984509042*^9, 
   3.580574526420362*^9, 3.5825723025245323`*^9, 3.582884271475889*^9, 
   3.582985282038698*^9, {3.5831537933409767`*^9, 3.583153795196087*^9}, 
   3.583853041889923*^9, {3.585144487169178*^9, 3.5851444893898077`*^9}, 
   3.588421080473011*^9, 3.590540981212843*^9, 3.593918764341484*^9, 
   3.596205464852831*^9, 3.5975338625870647`*^9, 3.597635723890345*^9, 
   3.597635979080573*^9, 3.600109613729927*^9, 3.602946177486844*^9, 
   3.603374915400469*^9, 3.6033750026088867`*^9, 3.604077749225848*^9, 
   3.606480751427948*^9, 3.607447650270329*^9, 3.6082191755726433`*^9, 
   3.608994964776641*^9, 3.609704685896785*^9, 3.6114087685714397`*^9, 
   3.615478587536117*^9, 3.620144186553331*^9, 3.6203973784854107`*^9, {
   3.6203981175371943`*^9, 3.620398123110386*^9}, {3.6203989207534657`*^9, 
   3.620398929497123*^9}, 3.620398977339456*^9, 3.620500591686352*^9, 
   3.6205686638630238`*^9, 3.620999761240095*^9, 3.621342767606632*^9, 
   3.6216024745150023`*^9, 3.626275953553906*^9, 3.6269710250775547`*^9, 
   3.6270631567334347`*^9, 3.628866555837755*^9, 3.631035491014024*^9, {
   3.631375862200739*^9, 3.631375878914476*^9}, 3.6314538557404947`*^9, {
   3.631800803819447*^9, 3.631800806559661*^9}, 3.631800840727607*^9, 
   3.632244619398506*^9, 3.6322447883374357`*^9, 3.632245074279151*^9, 
   3.632245106017213*^9, 3.63233831136257*^9, {3.633462764954226*^9, 
   3.6334627677934513`*^9}, 3.6334628207513742`*^9, 3.633627096150796*^9, 
   3.634309612128146*^9, 3.634310213744403*^9, {3.635262549953981*^9, 
   3.635262552212591*^9}, {3.635859318176495*^9, 3.6358593221598673`*^9}, 
   3.638886122238785*^9, 3.641908568462097*^9, 3.64367009918878*^9, 
   3.64368338769563*^9, 3.644023125981762*^9, {3.65505647743815*^9, 
   3.655056480817955*^9}, 3.655993932082576*^9, 3.656123972025215*^9, {
   3.656382543029499*^9, 3.656382547555777*^9}, 3.656382758942429*^9, 
   3.656382929228393*^9, 3.65651842898319*^9, 3.656596060371455*^9, 
   3.656597840057987*^9, 3.661018128476542*^9, {3.663425310009902*^9, 
   3.663425312292375*^9}, 3.6646412447361917`*^9, 3.664719054953404*^9, 
   3.666499659836491*^9, 3.6664997104231052`*^9, 3.666499793447399*^9, 
   3.6675737496999397`*^9, 3.669493490415452*^9, 3.6695533716490173`*^9, 
   3.669749154265767*^9, 3.6700801533123817`*^9, {3.6724462727544537`*^9, 
   3.672446275323547*^9}, {3.6724463056590137`*^9, 3.672446307609062*^9}, {
   3.695141636508999*^9, 3.695141661783188*^9}, 3.696874041764681*^9, 
   3.699730559079404*^9, 3.6997960461455584`*^9, 3.7000597874337053`*^9, 
   3.700145203085329*^9, 3.7005320513953743`*^9, 3.7054249407623167`*^9, 
   3.70671534077971*^9, 3.707052299742326*^9, 3.714143104375287*^9, 
   3.731069822516193*^9, 3.7321068997221746`*^9, 3.732191454833714*^9, 
   3.733240404762702*^9, {3.73508949978496*^9, 3.735089503023548*^9}, {
   3.735089941101675*^9, 3.735089943627606*^9}, 3.73564692430579*^9, 
   3.739794280625359*^9, 3.741353169724786*^9, {3.744973063196477*^9, 
   3.74497306746826*^9}, 3.745263603854718*^9, 3.7452673096092997`*^9, 
   3.745492870178808*^9, {3.747413746197236*^9, 3.747413750555229*^9}, 
   3.750954478349061*^9, 3.752936813311689*^9, 3.756049301984211*^9, {
   3.75907205190718*^9, 3.759072055933329*^9}, 3.7590746424849033`*^9, 
   3.796393437566689*^9, {3.7995892261404467`*^9, 3.799589232919189*^9}, {
   3.799589265373281*^9, 3.79958927210389*^9}, {3.799589486330512*^9, 
   3.7995894934318333`*^9}, 3.7995897109107037`*^9, 3.799589794281932*^9, 
   3.799589829516561*^9, 
   3.799589893891296*^9},ExpressionUUID->"3523df20-645e-404c-b9d3-\
8f0188bfbb47"]
}, Open  ]],

Cell["Miscellaneous Functions ", "Text",
 CellChangeTimes->{{3.491742726218636*^9, 3.4917427373277283`*^9}, {
   3.491742868186756*^9, 3.491742883123385*^9}, {3.532197713706972*^9, 
   3.5321977316368427`*^9}, 3.566226593870934*^9, 
   3.5802128970468903`*^9},ExpressionUUID->"2f7f58f1-24a3-4ba3-a5f7-\
f16176f77457"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Extract", " ", 
    RowBox[{"Sum", "'"}], "s", " ", "from", " ", "Dot", " ", "expressions", 
    " ", "and", " ", "simplifies", " ", "Sum", " ", 
    RowBox[{"LowerIndexTUexpression", "."}]}], "*)"}], 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"DotSum2SumDot", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mname", "=", "\"\<DotSum2SumDot\>\""}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{"Sum", "->", "xSum"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<{tmp1}\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{"a___", ",", 
             RowBox[{"xSum", "[", 
              RowBox[{"b_", ",", "nb__"}], "]"}], ",", "c___"}], "]"}], "->", 
           
           RowBox[{"xSum", "[", 
            RowBox[{
             RowBox[{"Dot", "[", 
              RowBox[{"a", ",", "b", ",", "c"}], "]"}], ",", "nb"}], 
            "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<{tmp2}\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", "subGatherSum"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", "tmp"}]}]}], 
      RowBox[{"(*", 
       RowBox[{"//.", 
        RowBox[{"xSum", "->", "Sum"}]}], "*)"}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Rules", " ", "to", " ", "simplify", " ", "Scalars", " ", "in", " ", 
      RowBox[{"Transpose", "[", "]"}], " ", "and", " ", 
      RowBox[{"ConjugateTranspose", "[", "]"}], " ", 
      RowBox[{"expressions", ".", "\[IndentingNewLine]", 
       RowBox[{"Usage", ":", " ", "expression"}]}]}], "//.", 
     RowBox[{"simpleTranspose", "[", "scalar_List", "]"}]}], "  ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTransposeSimplify", "::", "usage"}], "=", 
     "\"\<tuTransposeSimplify[scalar_List:{}] Rule[]s for simplifying \
Transpose expressions.  Accounts for scalars in scalar_List. \
*16Apr2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTransposeSimplify", "[", 
      RowBox[{"scalar_List:", 
       RowBox[{"{", "}"}]}], "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"a_", " ", "b_"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"a", " ", 
          RowBox[{"Transpose", "[", "b", "]"}]}], "/;", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"tuMemberQ", "[", 
            RowBox[{"a", ",", "scalar"}], "]"}], "||", 
           RowBox[{"NumericQ", "[", "a", "]"}]}], ")"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{"a_", ",", "n_"}], "]"}], " ", "b_"}], "]"}], ":>", 
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{"a", ",", "n"}], "]"}], " ", 
          RowBox[{"Transpose", "[", "b", "]"}]}], "/;", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"tuMemberQ", "[", 
            RowBox[{"a", ",", "scalar"}], "]"}], "||", 
           RowBox[{"NumericQ", "[", "a", "]"}]}], ")"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Transpose", "[", "a_", " ", "]"}], ":>", 
        RowBox[{"a", " ", "/;", 
         RowBox[{
          RowBox[{"tuMemberQ", "[", 
           RowBox[{"a", ",", "scalar"}], "]"}], "||", 
          RowBox[{"NumericQ", "[", "a", "]"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"Power", "[", 
          RowBox[{"c_", ",", "x_"}], "]"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"Power", "[", 
          RowBox[{"c", ",", "x"}], "]"}], "/;", 
         RowBox[{"tuMemberQ", "[", 
          RowBox[{"c", ",", "scalar"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ConjugateTranspose", "[", 
         RowBox[{"Power", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], " ", "]"}], ":>", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"Power", "[", 
           RowBox[{"a", ",", "b"}], "]"}], "]"}], " ", "/;", 
         RowBox[{"tuMemberQ", "[", 
          RowBox[{"a", ",", "scalar"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ConjugateTranspose", "[", "a_", " ", "]"}], ":>", 
        RowBox[{
         RowBox[{"Conjugate", "[", "a", "]"}], " ", "/;", 
         RowBox[{"tuMemberQ", "[", 
          RowBox[{"a", ",", "scalar"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"dd", ":", "tuDerivOps"}], ")"}], "[", 
          RowBox[{"c_", ",", "x_"}], "]"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"dd", "[", 
          RowBox[{"c", ",", "x"}], "]"}], "/;", 
         RowBox[{"tuMemberQ", "[", 
          RowBox[{"c", ",", "scalar"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ConjugateTranspose", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"dd", ":", "tuDerivOps"}], ")"}], "[", 
          RowBox[{"c_", ",", "x_"}], "]"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"dd", "[", 
           RowBox[{"c", ",", "x"}], "]"}], "]"}], "/;", 
         RowBox[{"tuMemberQ", "[", 
          RowBox[{"c", ",", "scalar"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simpleTranspose", "[", "scalar_List", "]"}], ":=", 
     RowBox[{"tuTransposeSimplify", "[", "scalar", "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "TransposeMatrix", " ", "applies", " ", "Transpose", " ", "to", " ", 
     "elements", " ", "of", " ", "matrix_", " ", 
     RowBox[{"(", 
      RowBox[{"level", " ", "2"}], ")"}], " ", "where", " ", "elements", " ", 
     "may", " ", "be", " ", "symbolic", " ", 
     RowBox[{"elements", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"NOT", " ", 
       RowBox[{
        RowBox[{"USED", "?", "\[IndentingNewLine]", "TransposeMatrix"}], "[", 
        "matrix_List", "]"}]}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"tmp", "=", "matrix"}], ",", 
          RowBox[{"pos", "=", 
           RowBox[{"Position", "[", 
            RowBox[{"matrix", ",", "_", ",", "2"}], "]"}]}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pos", "=", 
          RowBox[{"Select", "[", 
           RowBox[{"pos", ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "#", "]"}], "==", "2"}], "&&", 
              RowBox[{"!", 
               RowBox[{"MemberQ", "[", 
                RowBox[{"#", ",", "0"}], "]"}]}]}], "&"}]}], " ", "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"MapAt", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Transpose", "[", "#", "]"}], "&"}], ",", "matrix", ",", 
           "pos"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"dotOps", " ", "Attributes"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"xDot", ",", 
      RowBox[{"{", "Flat", "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Attributes", "[", "CenterDot", "]"}], "=", 
     RowBox[{"{", 
      RowBox[{"Flat", ",", "OneIdentity"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Attributes", "[", "xDot", "]"}], "=", 
     RowBox[{"{", 
      RowBox[{"Flat", ",", "OneIdentity"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Rule", " ", "for", " ", "expanding", " ", "Dot", " ", "of", " ", 
     "Sums"}], "*)"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"DotExpand", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{"a___", ",", 
           RowBox[{"b_", "+", "c_"}], ",", "d___"}], "]"}], "->", 
         RowBox[{
          RowBox[{"Dot", "[", 
           RowBox[{"a", ",", "b", ",", "d"}], "]"}], "+", 
          RowBox[{"Dot", "[", 
           RowBox[{"a", ",", "c", ",", "d"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"xDot", "[", 
          RowBox[{"a___", ",", 
           RowBox[{"b_", "+", "c_"}], ",", "d___"}], "]"}], "->", 
         RowBox[{
          RowBox[{"xDot", "[", 
           RowBox[{"a", ",", "b", ",", "d"}], "]"}], "+", 
          RowBox[{"xDot", "[", 
           RowBox[{"a", ",", "c", ",", "d"}], "]"}]}]}]}], "}"}]}], ";"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DotExpandAll", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", "DotExpand"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DotExpandAll2", "[", "scalar_List", "]"}], "[", "exp_", "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp1"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp1"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", "DotExpand"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"simpleDot2", "[", "scalar", "]"}]}]}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Rules", " ", "to", " ", "simplify", " ", "Dot"}], "|", 
     RowBox[{"xDot", " ", 
      RowBox[{"expressions", "."}], " ", "*", "10", "Sep2012"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Possible", " ", "Dot", " ", "operators"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dotOps", ":=", 
     RowBox[{"Dot", "|", "xDot", "|", "CenterDot", "|", 
      RowBox[{"Inactive", "[", "Dot", "]"}]}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Often", " ", "used", " ", "xDot", " ", 
     RowBox[{"Rule", "[", "]"}], "s"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"toxDot", ":=", 
     RowBox[{"dotOps", "\[Rule]", "xDot"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"toDot", ":=", 
     RowBox[{"dotOps", "\[Rule]", "Dot"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"toTimes", ":=", 
     RowBox[{"dotOps", "\[Rule]", "Times"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"toCenterDot", ":=", 
    RowBox[{
     RowBox[{"dotOps", "|", "Times"}], "\[Rule]", "CenterDot"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"dotTimesTerms", "[", "with_List", "]"}], "[", "exp_", "]"}], 
     " ", "replaces", " ", "terms", " ", "in", " ", "Times", " ", 
     "expression", " ", "in", " ", "exp_", " ", "with", " ", "with_", " ", 
     "symbols", " ", "in", " ", 
     RowBox[{"Dot", "'"}], "ed", " ", "expression", " ", "*", "2", 
     "Oct2014"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"dotTimesTerms", "[", "with_List", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "$with", ",", "$without"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "/.", 
          RowBox[{"Times", "\[Rule]", "xTimes"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"xTimes", "[", "a__", "]"}], "\[RuleDelayed]", 
           RowBox[{"xTimes", "[", 
            RowBox[{
             RowBox[{"$with", "[", 
              RowBox[{"Select", "[", 
               RowBox[{
                RowBox[{"{", "a", "}"}], ",", 
                RowBox[{
                 RowBox[{"!", 
                  RowBox[{"ListFreeQ", "[", 
                   RowBox[{"#", ",", "with"}], "]"}]}], "&"}]}], "]"}], "]"}], 
             RowBox[{"$without", "[", 
              RowBox[{"Select", "[", 
               RowBox[{
                RowBox[{"{", "a", "}"}], ",", 
                RowBox[{
                 RowBox[{"ListFreeQ", "[", 
                  RowBox[{"#", ",", "with"}], "]"}], "&"}]}], "]"}], "]"}]}], 
            "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$with", "[", 
              RowBox[{"{", "}"}], "]"}], "\[Rule]", "1"}], ",", 
            RowBox[{
             RowBox[{"$without", "[", 
              RowBox[{"{", "}"}], "]"}], "\[Rule]", "1"}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"$with", "[", 
               RowBox[{"{", "a__", "}"}], "]"}], "\[Rule]", 
              RowBox[{
               RowBox[{"Inactive", "[", "Dot", "]"}], "[", "a", "]"}]}]}], "/.", 
            RowBox[{
             RowBox[{"$without", "[", 
              RowBox[{"{", "a__", "}"}], "]"}], "\[Rule]", 
             RowBox[{"Times", "[", "a", "]"}]}]}], "/.", 
           RowBox[{"xTimes", "\[Rule]", "Times"}]}], "//", "Activate"}]}]}]}],
       "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"productOps", " ", "definition"}], "*)"}], "\[IndentingNewLine]", 
   
   RowBox[{"productOps", ":=", 
    RowBox[{
     RowBox[{"dotOps", "|", "Times", "|", "CircleTimes"}], "//", 
     "Flatten"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpSwitch", "::", "usage"}], "=", 
     "\"\<tuOpSwitch[op1_,op2_][exp_] Switches order of op1_ and op2 in exp_ \
through Repeated Rule. Primarily for operators: Sum, Integrate, i.e., \
operators with operand as first arguement. *10Feb2017*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuOpSwitch", "[", 
       RowBox[{"op1_", ",", "op2_"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "op1a", ",", "op2a"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"delayed", " ", "Symbol", " ", "assignment"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"op1a", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"tuMemberQ", "[", 
            RowBox[{"op1", ",", "tuDerivOps"}], "]"}], ",", 
           RowBox[{
            RowBox[{"op1", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "//", "Head"}], ",", "op1"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"op2a", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"tuMemberQ", "[", 
            RowBox[{"op2", ",", "tuDerivOps"}], "]"}], ",", 
           RowBox[{
            RowBox[{"op2", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "//", "Head"}], ",", "op2"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"op1a", " ", "===", "op2a"}], ",", "\[IndentingNewLine]", 
          RowBox[{"$", "=", 
           RowBox[{"$", "/.", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"ooA", ":", "op1a"}], ")"}], "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"ooB", ":", "op2a"}], ")"}], "[", 
                RowBox[{"a_", ",", "b___"}], "]"}], ",", "c___"}], "]"}], 
             "\[Rule]", 
             RowBox[{"ooB", "[", 
              RowBox[{
               RowBox[{"ooA", "[", 
                RowBox[{"a", ",", "c"}], "]"}], ",", "b"}], "]"}]}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"$", "=", 
           RowBox[{"$", "//.", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"ooA", ":", "op1a"}], ")"}], "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"ooB", ":", "op2a"}], ")"}], "[", 
                RowBox[{"a_", ",", "b___"}], "]"}], ",", "c___"}], "]"}], 
             "\[Rule]", 
             RowBox[{"ooB", "[", 
              RowBox[{
               RowBox[{"ooA", "[", 
                RowBox[{"a", ",", "c"}], "]"}], ",", "b"}], "]"}]}]}]}]}], 
         "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpNestGather", "::", "usage"}], "=", 
     "\"\<tuOpNestGather[op_,product_:Times][exp_] gathers nested operators \
op_ into an expression with one op_. Product operator product_ may be \
specified.,  e.g., \
xSum[aa[i]\[CenterDot]xSum[bb[k],{k,3},{m,4}],{i,2},{j,3}]//tuOpNestGather[\
xSum,CenterDot] \[LongRightArrow] \
xSum[aa[i]\[CenterDot]bb[k],{k,3},{m,4},{i,2},{j,3}]. WARNING: Does not work \
with Sum, Switch to Inactive[Sum]. *19Oct2015*\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuOpNestGather", "[", 
       RowBox[{"op_", ",", 
        RowBox[{"product_:", "Times"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$0", ",", 
         RowBox[{"iproduct", "=", 
          RowBox[{"Inactive", "[", "product", "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{"product", "\[Rule]", "iproduct"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"$0", "=!=", "$"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$0", "=", "$"}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"{", 
             RowBox[{"$0", ",", "iproduct"}], "}"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "/.", 
             RowBox[{
              RowBox[{"op", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"pp", ":", "iproduct"}], ")"}], "[", 
                RowBox[{"a___", ",", " ", 
                 RowBox[{"op", "[", 
                  RowBox[{"b__", ",", "c___"}], "]"}], ",", "d___"}], "]"}], 
               "]"}], "\[RuleDelayed]", 
              RowBox[{"op", "[", 
               RowBox[{"pp", "[", 
                RowBox[{"a", ",", " ", "b", ",", "c", ",", "d"}], "]"}], 
               "]"}]}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "//.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pp", ":", "iproduct"}], ")"}], "[", 
               RowBox[{"a___", ",", 
                RowBox[{"op", "[", 
                 RowBox[{"b_", ",", "c___"}], "]"}], ",", "d___"}], "]"}], 
              "\[Rule]", 
              RowBox[{"op", "[", 
               RowBox[{
                RowBox[{"pp", "[", 
                 RowBox[{"a", ",", "b", ",", "d"}], "]"}], ",", "c"}], 
               "]"}]}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "//.", 
             RowBox[{
              RowBox[{
               RowBox[{"op", "[", 
                RowBox[{"a_", ",", "b___"}], "]"}], "+", 
               RowBox[{"op", "[", 
                RowBox[{"c_", ",", "b___"}], "]"}]}], "\[Rule]", 
              RowBox[{"op", "[", 
               RowBox[{
                RowBox[{"a", "+", "c"}], ",", "b"}], "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "//.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pp", ":", "iproduct"}], ")"}], "[", 
               RowBox[{
                RowBox[{"op", "[", 
                 RowBox[{"a_", ",", "d___"}], "]"}], "  ", ",", 
                RowBox[{"op", "[", 
                 RowBox[{"b_", ",", "c___"}], "]"}]}], "]"}], "\[Rule]", 
              RowBox[{"op", "[", 
               RowBox[{
                RowBox[{"pp", "[", 
                 RowBox[{"a", ",", " ", "b"}], "]"}], ",", "c", ",", "d"}], 
               "]"}]}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Activate", "[", 
         RowBox[{"$", ",", "product"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpDistribute", "::", "usage"}], "=", 
     "\"\<tuOpDistribute[op_,over_:Plus] Rule for distributing op_ over \
over_. EG.\na.(b-c).d/.tuOpDistribute[dotOps]->a.b.d+a.(-c).d. Works with \
op_s of form  CommutatorM[arg__\!\(\*SubscriptBox[\(]\), \(\[Rho]\)]\) as \
well.  *21May2015*23Jun2017*15Jun2020*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpDistribute", "[", 
      RowBox[{"op_", ",", 
       RowBox[{"over_:", "Plus"}]}], "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"oo", ":", 
         RowBox[{
          RowBox[{"(", "op", ")"}], "[", 
          RowBox[{"a1___", ",", 
           RowBox[{"over", "[", 
            RowBox[{"a_", ",", "ap__"}], "]"}], ",", "a2___"}], "]"}]}], 
        "\[RuleDelayed]", 
        RowBox[{"Distribute", "[", 
         RowBox[{
          RowBox[{"ExpandAll", "[", "oo", "]"}], ",", "over"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"oo", ":", 
         RowBox[{
          RowBox[{"(", "op", ")"}], "[", 
          RowBox[{
           RowBox[{"over", "[", 
            RowBox[{"a_", ",", "ap__"}], "]"}], ",", "a2___"}], "]"}]}], 
        "\[RuleDelayed]", 
        RowBox[{"Distribute", "[", 
         RowBox[{
          RowBox[{"ExpandAll", "[", "oo", "]"}], ",", "over"}], "]"}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", "$"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"a", ".", 
         RowBox[{"(", 
          RowBox[{"b", "+", 
           RowBox[{"c", ".", 
            RowBox[{"(", 
             RowBox[{"d", "+", "e"}], ")"}]}]}], ")"}]}], 
        "\[IndentingNewLine]", "$"}], "//.", 
       RowBox[{
        RowBox[{"tuOpDistribute", "[", "Dot", "]"}], "\[IndentingNewLine]", 
        "$"}]}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fn", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"fn", "[", 
             RowBox[{"c", ",", 
              RowBox[{"n", "+", "m"}]}], "]"}], "+", 
            RowBox[{"fn", "[", 
             RowBox[{
              RowBox[{"a", "+", "b"}], ",", "1"}], "]"}]}], ",", "2"}], "]"}],
          "\[IndentingNewLine]", "$"}], "//.", 
        RowBox[{
         RowBox[{"tuOpDistribute", "[", "fn", "]"}], "\[IndentingNewLine]", 
         "$"}]}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"CommutatorM", "[", 
           RowBox[{"a", ",", 
            RowBox[{"CommutatorM", "[", 
             RowBox[{
              RowBox[{"a", "+", "c"}], ",", "b"}], "]"}]}], "]"}], 
          "\[IndentingNewLine]", "$"}], "//.", 
         RowBox[{
          RowBox[{"tuOpDistribute", "[", "CommutatorM", "]"}], 
          "\[IndentingNewLine]", "$"}]}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"tuDPartial", "[", 
           RowBox[{
            RowBox[{"a", " ", 
             RowBox[{"{", 
              RowBox[{"aaa", ",", "aa"}], "}"}]}], ",", "b"}], "]"}], 
          "\[IndentingNewLine]", "$"}], "//.", 
         RowBox[{"tuOpDistribute", "[", 
          RowBox[{"tuDPartial", ",", "List"}], "]"}]}]}]}]}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DotExpand", ":=", 
     RowBox[{"tuOpDistribute", "[", "dotOps", "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpDistributeF", "::", "usage"}], "=", 
     "\"\<tuOpDistributeF[op_,over_:Plus][exp_] applies Rule[] tuOpDistribute \
over ExpandAll[exp_].  op_ may be somewhat complex in that operators like \
CommutatorM[arg__\!\(\*SubscriptBox[\(]\), \(\[Rho]\)]\) may be specified.  \
arg__ is needed to specify position of the arguement. EG.\n\
a.(b-c).d//tuOpDistributeF[dotOps]->a.b.d+a.(-c).d. \
*10Feb2016*8July2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuOpDistributeF", "[", 
       RowBox[{"operator_", ",", 
        RowBox[{"over_:", "Plus"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"ExpandAll", "[", "exp", "]"}], "//.", 
         RowBox[{"tuOpDistribute", "[", 
          RowBox[{"operator", ",", "over"}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"TEST", "\[IndentingNewLine]", 
       RowBox[{"a", ".", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"b", "+", "c"}], ")"}], "/", "2"}], ")"}], ".", "d"}]}], "/.",
       " ", 
      RowBox[{
       RowBox[{"tuOpDistribute", "[", "Dot", "]"}], "\[IndentingNewLine]", 
       "%"}]}], "//", 
     RowBox[{"tuOpDistributeF", "[", "Dot", "]"}]}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "***)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpSimplify", "::", "usage"}], "=", 
     "\"\<tuOpSimplify[operator_,scalars_List:{},oneIdentity_:{}] Rule for \
simplifying operator[] expressions by removing NumericQ and scalars_ from its \
arguements. \noneIdentity_:{} identifies operators that behave like \
OneIdentity Attribute[]. NOTE: Some of these Rule[]s do not seem active for \
some expressions. BUG: Does not Match some scalars_. \
*26Sep2015**21Mar2018**12Mar2019*25Mar2020*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpSimplify", "[", 
      RowBox[{"operator_", ",", 
       RowBox[{"scalars_List:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"oneIdentity_:", 
        RowBox[{"{", "}"}]}]}], "]"}], ":=", 
     RowBox[{"tuRule", "[", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "operator"}], ")"}], "[", "a_", "]"}], ":>", 
         RowBox[{"a", "/;", 
          RowBox[{"MatchQ", "[", 
           RowBox[{"op", ",", "dotOps"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "operator"}], ")"}], "[", "a_", "]"}], ":>", 
         RowBox[{"a", "/;", 
          RowBox[{"tuMemberQ", "[", 
           RowBox[{"op", ",", "oneIdentity"}], "]"}]}]}], ",", 
        RowBox[{"(*", 
         RowBox[{"OneIdentity", " ", "1", "Apr2017"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "operator"}], ")"}], "[", "]"}], "\[Rule]", 
         "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "operator"}], ")"}], "[", 
          RowBox[{
           RowBox[{"Longest", "[", "a___", "]"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"cc", ":", 
              SuperscriptBox["c_", 
               RowBox[{"n_:", "1"}]]}], ")"}], " ", "d_"}], ",", 
           RowBox[{"Longest", "[", "e___", "]"}]}], "]"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"cc", " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "d", ",", "e"}], "]"}]}], "/;", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"NumericQ", "[", "c", "]"}], ")"}], "||", 
             RowBox[{"tuMemberQ", "[", 
              RowBox[{"c", ",", "scalars"}], "]"}]}], ")"}], "&&", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"NumericQ", "[", "n", "]"}], ")"}], "||", 
             RowBox[{"tuMemberQ", "[", 
              RowBox[{"n", ",", "scalars"}], "]"}]}], ")"}]}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "operator"}], ")"}], "[", 
          RowBox[{
           RowBox[{"Longest", "[", "a___", "]"}], ",", 
           RowBox[{"(", 
            RowBox[{"cc", ":", 
             SuperscriptBox["c_", 
              RowBox[{"n_:", "1"}]]}], ")"}], "  ", ",", 
           RowBox[{"Longest", "[", "d___", "]"}]}], "]"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"cc", " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "d"}], "]"}]}], "/;", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"NumericQ", "[", "c", "]"}], ")"}], "||", 
              RowBox[{"tuMemberQ", "[", 
               RowBox[{"c", ",", "scalars"}], "]"}]}], ")"}], "&&", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"NumericQ", "[", "n", "]"}], ")"}], "||", 
              RowBox[{"tuMemberQ", "[", 
               RowBox[{"n", ",", "scalars"}], "]"}]}], ")"}]}], ")"}]}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"op", ":", "operator"}], ")"}], "[", "a__", "]"}], "]"}], 
         ":>", 
         RowBox[{"Apply", "[", 
          RowBox[{"op", ",", 
           RowBox[{"Thread", "[", 
            RowBox[{"Conjugate", "[", 
             RowBox[{"{", "a", "}"}], "]"}], "]"}]}], "]"}]}]}], "  ", 
       RowBox[{"(*", 
        RowBox[{"Does", " ", "not", " ", "belong", " ", 
         RowBox[{"here", "."}]}], "*)"}], "\[IndentingNewLine]", "}"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpSimplifyF", "::", "usage"}], "=", 
     "\"\<tuOpSimplifyF[operator_,scalars_List:{}] [exp_] simplifies \
operator[] expressions by removing NumericQ and scalars_ from its arguements. \
operator_ may be somewhat complex in that operators like \
CommutatorM[arg__\!\(\*SubscriptBox[\(]\), \(\[Rho]\)]\) may be specified.  \
arg__ is needed to specify position of the arguement. NOTE: Applies \
tuOpSimplify Rule[]s above. *10Feb2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuOpSimplifyF", "[", 
       RowBox[{"operator_", ",", 
        RowBox[{"scalars_List:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"func", ",", "tmp", ",", "oper", ",", "$ss", ",", "arg"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "operator", "]"}], "\[Equal]", "Symbol"}], "||", 
           RowBox[{
            RowBox[{"Head", "[", "operator", "]"}], "==", "Alternatives"}]}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"exp", "//.", 
            RowBox[{"tuOpSimplify", "[", 
             RowBox[{"operator", ",", "scalars"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "attempt", " ", "to", " ", "handle", " ", "generalize", " ", 
            "functions", " ", 
            RowBox[{"e", ".", "g", ".", " ", 
             SubscriptBox[
              RowBox[{"[", 
               RowBox[{"a", ",", "b"}], "]"}], "R"]}]}], "  ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$ss", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"func", "[", "arg", "]"}], "\[Rule]", 
              RowBox[{"tuPatternRemove", "[", "operator", "]"}]}], "//", 
             RowBox[{"tuAddPatternVariable", "[", 
              RowBox[{"arg", ",", "BlankSequence"}], "]"}]}]}], ";", 
           RowBox[{"xPrint", "[", "$s", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"exp", "/.", 
             RowBox[{"operator", "\[Rule]", 
              RowBox[{"func", "[", "arg", "]"}]}]}]}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"{", 
             RowBox[{"4", ",", "operator", ",", "tmp"}], "}"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"tuOpSimplify", "[", 
              RowBox[{"func", ",", "scalars"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", "$ss"}]}]}]}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuOpSimplifyFirst", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpSimplifyFirst", "::", "usage"}], "=", 
     "\"\<tuOpSimplifyFirst[operator_,scalars_List:{}][exp_] applies \
tuOpSimplify[] to the First arguement of operator_s in exp_ accounting for \
scalars_ which are moved out of the arguement list. Only Times[] terms as \
first arguements are assumed. *23Oct2015*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuOpSimplifyFirst", "[", 
       RowBox[{"operator_", ",", 
        RowBox[{"scalars_List:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "xTimes", ",", "xUNIT"}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"op", ":", "operator"}], ")"}], "[", 
            RowBox[{"a_", " ", ",", "b___"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"op", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"AppendTo", "[", 
                RowBox[{
                 RowBox[{"xTimes", "@@", 
                  RowBox[{"{", "a", "}"}]}], ",", "xUNIT"}], "]"}], "//.", 
               RowBox[{"tuOpSimplify", "[", 
                RowBox[{"xTimes", ",", "scalars"}], "]"}]}], ")"}], ",", 
             "b"}], "]"}]}]}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<X: \>\"", ",", "$"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"$", "/.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "operator"}], ")"}], "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"aa_:", "1"}], ")"}], "   ", 
               RowBox[{"xTimes", "[", "c1___", "]"}]}], ",", "b___"}], "]"}], 
            "->", 
            RowBox[{"aa", " ", 
             RowBox[{"op", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Hold", "[", "Times", "]"}], "[", "c1", "]"}], ")"}],
                ",", "b"}], "]"}]}]}]}], "//", "ReleaseHold"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{"xUNIT", "\[Rule]", "1"}]}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuBlankOpGroupLevels", "::", "usage"}], "=", 
     "\"\<tuBlankOpGroupLevels[exp_] groups nested Replacement Rules from \
tuExtractPositionPattern[dotOps[__]]. Use by tuBlankOpNest. \
*15Mar2020*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuBlankOpGroupLevels", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$i", ",", "$s", ",", "$len", ",", 
         RowBox[{"$ig", "=", "1"}], ",", 
         RowBox[{"$g", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"$groups", "=", 
          RowBox[{"{", "}"}]}], ",", "$seq"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$len", "=", 
         RowBox[{"Length", "[", "$", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"$i", "=", "1"}], ",", 
          RowBox[{"$i", "<", "$len"}], ",", 
          RowBox[{"$i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$seq", "=", 
            RowBox[{"SequencePosition", "[", 
             RowBox[{
              RowBox[{"$", "[", 
               RowBox[{"[", 
                RowBox[{"$i", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"$", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"$i", "+", "1"}], ",", "1"}], "]"}], "]"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"$i", "\[Equal]", "1"}], ",", 
             RowBox[{"$g", "=", 
              RowBox[{"{", "$i", "}"}]}]}], "]"}], ";", 
           RowBox[{"(*", 
            RowBox[{"Initialize", " ", "$g"}], "*)"}], "\[IndentingNewLine]", 
           
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"$seq", "=!=", 
               RowBox[{"{", "}"}]}], "&&", 
              RowBox[{
               RowBox[{"$seq", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[Equal]", "1"}]}], 
             ",", 
             RowBox[{"(*", 
              RowBox[{"Multiple", " ", "items"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$g", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"$g", ",", 
                  RowBox[{"{", 
                   RowBox[{"$i", ",", 
                    RowBox[{"$i", "+", "1"}]}], "}"}]}], "}"}], "//", 
                "Flatten"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"$i", "+", "1"}], "==", "$len"}], ",", 
                RowBox[{"$groups", "=", 
                 RowBox[{"{", 
                  RowBox[{"$groups", ",", 
                   RowBox[{"XX", "[", 
                    RowBox[{"$g", "//", "DeleteDuplicates"}], "]"}]}], 
                  "}"}]}]}], "]"}]}], "\[IndentingNewLine]", ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$groups", "=", 
               RowBox[{"{", 
                RowBox[{"$groups", ",", 
                 RowBox[{"XX", "[", 
                  RowBox[{
                   RowBox[{"Flatten", "[", "$g", "]"}], "//", 
                   "DeleteDuplicates"}], "]"}]}], "}"}]}], ";", 
              RowBox[{"$g", "=", 
               RowBox[{"{", 
                RowBox[{"$i", "+", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"$i", "+", "1"}], "==", "$len"}], ",", 
                RowBox[{"$groups", "=", 
                 RowBox[{"{", 
                  RowBox[{"$groups", ",", 
                   RowBox[{"XX", "[", 
                    RowBox[{"{", 
                    RowBox[{"$i", "+", "1"}], "}"}], "]"}]}], "}"}]}]}], 
               "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$r", "=", 
         RowBox[{"$groups", "//", "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$r", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "/.", 
             RowBox[{
              RowBox[{"XX", "[", "a_", "]"}], "\[Rule]", "a"}]}], "&"}], ",", 
           "$r"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Part", "[", 
           RowBox[{"$", ",", "#"}], "]"}], "&"}], "/@", "$r"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuBlankOpNest", "::", "usage"}], "=", 
     "\"\<tuBlankOpNest[operators_:{}][exp_] returns exp_ where all Times\
\[Rule]Dot and dotOps terms containing Blank[]s are returned with its Blank[] \
arguement filled with its terms on the right. operators_ designate are \
multipliers operators without Blank[] arguements. , e.g. op1[_].op2[_].arg\
\[Rule]op1[op2[arg]].  All Times operators are replaced with Dots. Look at \
tuOpBlankFill[] for op[_][arg]\[Rule]op[arg] function. NEEDs op1[_][var]\
\[Rule]op1[var]. *8Mar2020*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuBlankOpNest", "[", 
       RowBox[{"operators_:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$0", ",", "$s", ",", "$t", ",", 
         "$p", ",", "$s1", ",", "xBlank", ",", "XX"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "\[Rule]", 
            RowBox[{"#", "[", "_", "]"}]}], "&"}], "/@", "operators"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"$", "/.", "$s"}], "/.", 
          RowBox[{"Times", "\[Rule]", "Dot"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"$", " ", "=!=", " ", "$0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$0", "=", "$"}], ";", "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "//", 
             RowBox[{"expandDot", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Times", "\[Rule]", "Dot"}], ",", 
                 RowBox[{"Blank", "\[Rule]", "xBlank"}]}], "}"}], ",", 
               RowBox[{"{", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$s", "=", 
            RowBox[{"$", "//", 
             RowBox[{"tuExtractPositionPattern", "[", 
              RowBox[{"dotOps", "[", "__", "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$s", "=", 
            RowBox[{"$s", "//", "tuBlankOpGroupLevels"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<<<1>> \>\"", ",", "$s"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"$s", "=", 
            RowBox[{"Map", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"$group", "=", 
                RowBox[{
                 RowBox[{"Map", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"$t", "=", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ";", 
                    RowBox[{"$p", "=", 
                    RowBox[{"SelectFirst", "[", 
                    RowBox[{"$t", ",", 
                    RowBox[{
                    RowBox[{"tuHasAnyQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"xBlank", "[", "]"}]}], "]"}], "&"}]}], "]"}]}], 
                    ";", 
                    RowBox[{"$p", "=", 
                    RowBox[{"Position", "[", 
                    RowBox[{"$t", ",", "$p"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"$t", "=", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"$p", " ", "=!=", 
                    RowBox[{"{", "}"}]}], "&&", 
                    RowBox[{
                    RowBox[{"Length", "[", "$t", "]"}], ">", 
                    RowBox[{"$p", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"$t", ",", 
                    RowBox[{"1", ";;", 
                    RowBox[{"$p", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], "]"}], "/.", 
                    RowBox[{
                    RowBox[{"xBlank", "[", "]"}], "\[RuleDelayed]", 
                    RowBox[{"XX", "[", 
                    RowBox[{"Part", "[", 
                    RowBox[{"$t", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"$p", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", "1"}], ";;", 
                    RowBox[{"-", "1"}]}]}], "]"}], "]"}]}]}], ")"}], ",", 
                    "\[IndentingNewLine]", "$t"}], "\[IndentingNewLine]", 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<<<1.1>>\>\"", ",", 
                    RowBox[{"{", 
                    RowBox[{"$t", ",", "$p", ",", 
                    RowBox[{"Length", "[", "$t", "]"}]}], "}"}]}], "]"}], 
                    ";"}], "*)"}], "\[IndentingNewLine]", "$t"}], 
                    "\[IndentingNewLine]", ")"}]}], "&"}], ",", 
                   "\[IndentingNewLine]", "#"}], "]"}], "&"}]}], 
               "\[IndentingNewLine]", ")"}], "\[IndentingNewLine]", ",", 
              "\[IndentingNewLine]", "$s"}], "\[IndentingNewLine]", "]"}]}], 
           ";", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<<< 2 >>\>\"", ",", "$s"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"$s", "=", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"tuHasAnyQ", "[", 
                  RowBox[{"#", ",", "XX"}], "]"}], ",", 
                 RowBox[{"SelectFirst", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{
                    RowBox[{"tuHasAnyQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"XX", "[", "_", "]"}], "}"}]}], "]"}], "&"}]}], 
                  "]"}], ",", 
                 RowBox[{"#", "//", "First"}]}], "]"}], "&"}], ",", "$s"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<<< 3 >>\>\"", ",", "$s"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{
             RowBox[{"tuReplacePart", "[", 
              RowBox[{"$", ",", "$s"}], "]"}], "//.", 
             RowBox[{
              RowBox[{"XX", "[", "a_", "]"}], "\[Rule]", "a"}]}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"$", ",", "$s"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "a_", "]"}], "\[Rule]", 
            RowBox[{"#", ".", "a"}]}], "&"}], "/@", "operators"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"$", "/.", 
          RowBox[{"xBlank", "\[Rule]", "Blank"}]}], "//.", "$s"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "TEST", "*)"}], 
   RowBox[{"(*", "\n", "\t", 
    RowBox[{"$", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"A", "+", 
            RowBox[{"a", " ", 
             RowBox[{
              RowBox[{"ff", "[", "_", "]"}], ".", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"c", " ", 
                  RowBox[{"f", "[", "_", "]"}]}], "+", "g"}], ")"}], "2"]}]}],
             "+", 
            RowBox[{"b", "[", "_", "]"}]}], ")"}], "+", "g"}], ")"}], ".", 
        "S"}], "\[IndentingNewLine]", "$"}], "//", 
      RowBox[{"tuBlankOpNest", "[", 
       RowBox[{"{", 
        RowBox[{"A", ",", "g"}], "}"}], "]"}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"$", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"A", "+", 
           RowBox[{"a", " ", 
            RowBox[{
             RowBox[{"ff", "[", "_", "]"}], ".", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"c", " ", 
                 RowBox[{"f", "[", "_", "]"}]}], "+", "g"}], ")"}], "2"]}]}], 
           "+", 
           RowBox[{"b", "[", "_", "]"}]}], ")"}], "+", "g"}], ")"}], 
       "\[IndentingNewLine]", "%"}], "//", 
      RowBox[{"tuBlankOpNest", "[", 
       RowBox[{"{", 
        RowBox[{"A", ",", "g"}], "}"}], "]"}]}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpBlankFill", "::", "usage"}], "=", 
     "\"\<tuOpBlankFill[exp_] returns an expression with Blank[]s in the \
operator filled with its arguement, e.g. op[_][arg]\[Rule]op[arg].  Only \
works for simple expressions. Use carefully. *15May2016*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpBlankFill", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "head", ",", "arg"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"head", "=", 
         RowBox[{
          RowBox[{"Head", "[", "$", "]"}], "/.", 
          RowBox[{"Blank", "\[Rule]", "xBlank"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"arg", "=", 
         RowBox[{"$", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"head", "=", 
         RowBox[{"head", "/.", 
          RowBox[{
           RowBox[{"xBlank", "[", "]"}], "\[Rule]", "arg"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpCoefficientInclude", "::", "usage"}], "=", 
     "\"\<tuOpCoefficientInclude[op_] Rule for including coefficient of op_ \
into its first arguement. *9Mar2019*\>\""}], ";", 
    RowBox[{
     RowBox[{"tuOpCoefficientInclude", "[", "op_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"dd", ":", 
         RowBox[{"Times", "|", "dotOps"}]}], ")"}], "[", 
       RowBox[{"a__", ",", " ", 
        RowBox[{"op", "[", 
         RowBox[{"b_", ",", "c___"}], "]"}]}], "]"}], "->", 
      RowBox[{"op", "[", 
       RowBox[{
        RowBox[{"dd", "[", 
         RowBox[{"a", ",", "b"}], "]"}], ",", "c"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"expandDot", "::", "usage"}], "=", 
     "\"\<expandDot[sub_:{},scalar_:{},func_:{},iterate_:20] functional \
definition equivalent to \
tuRepeat[{sub,tuOpDistribute[dotOps],tuOpSimplify[dotOps,scalar]},{func},\
iterate]. This definition serves as an example of how to collect several \
repeated operations into one statement.  *22Mar2019*\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"expandDot", "[", 
       RowBox[{
        RowBox[{"sub_:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"scalar_:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"func_:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"iterate_:", "20"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuRepeat", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"sub", ",", 
          RowBox[{"tuOpDistribute", "[", "dotOps", "]"}], ",", 
          RowBox[{"tuOpSimplify", "[", 
           RowBox[{"dotOps", ",", "scalar"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", "func", "}"}], ",", "iterate"}], "]"}], "[", "exp", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"expandDC", "[", 
      RowBox[{
       RowBox[{"sub_:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"scalar_:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"func_:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"iterate_:", "20"}]}], "]"}], ":=", 
     RowBox[{"expandDot", "[", 
      RowBox[{"sub", ",", "scalar", ",", "func", ",", "iterate"}], "]"}]}], 
    ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"compatibility", ":", " ", 
     RowBox[{
     "expandDC", " ", "label", " ", "used", " ", "in", " ", "many", " ", 
      "old", " ", "situations"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"**", "**"}], "*******)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Rules", " ", "for", " ", "simplifying", " ", "dotOps", " ", "with", " ", 
     "NumericQ", " ", "and", " ", "Conjugates", " ", "*", "10", "Sep2012"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"simpleDot", ":=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
         RowBox[{"a___", ",", 
          RowBox[{"n_", " ", "d_"}], ",", "c___"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"n", " ", 
          RowBox[{"op", "[", 
           RowBox[{"a", ",", "d", ",", "c"}], "]"}]}], "/;", 
         RowBox[{"NumericQ", "[", "n", "]"}]}]}], ",", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
         RowBox[{"a___", ",", "b_", ",", "c___"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"b", " ", 
          RowBox[{"op", "[", 
           RowBox[{"a", ",", "c"}], "]"}]}], "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "b", "]"}], "&&", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"{", 
             RowBox[{"a", ",", "c"}], "}"}], "]"}], ">", "0"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
         RowBox[{"a___", ",", "b_", ",", "c___"}], "]"}], ":>", 
        RowBox[{"b", " ", "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "b", "]"}], "&&", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"{", 
             RowBox[{"a", ",", "c"}], "}"}], "]"}], "===", "0"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
         RowBox[{"a___", ",", 
          RowBox[{"-", "b_"}], ",", "c___"}], "]"}], "\[Rule]", 
        RowBox[{"-", " ", 
         RowBox[{"op", "[", 
          RowBox[{"a", ",", "b", ",", "c"}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Conjugate", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "dotOps"}], ")"}], "[", "a__", "]"}], "]"}], ":>", 
        RowBox[{"Apply", "[", 
         RowBox[{"op", ",", 
          RowBox[{"Thread", "[", 
           RowBox[{"Conjugate", "[", 
            RowBox[{"{", "a", "}"}], "]"}], "]"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"simpleDot1a", "[", "scalars_List", "]"}], "[", "exp_", "]"}], 
      " ", "applies", " ", "Rules", " ", "for", " ", "simplifying", " ", 
      "Dot"}], "|", 
     RowBox[{
     "xDot", " ", "expressions", " ", "in", " ", "exp_", " ", "accounting", 
      " ", "for", " ", 
      RowBox[{"scalars_List", ".", "  ", "Conjugate"}], " ", "and", " ", 
      "Transpose", " ", "of", " ", "scalars_List", " ", "are", " ", 
      "considered", " ", 
      RowBox[{"scalars", ".", "  ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Replaces", " ", "simpleDot1"}], ",", " ", 
         RowBox[{
         "but", " ", "has", " ", "name", " ", "conflict", " ", "with", " ", 
          RowBox[{"it", "."}]}]}], ")"}]}], "*", "10", "Sep2012"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"simpleDot1a", "[", "scalars_List", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "sub", ",", 
         RowBox[{"scal", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Conjugate", "[", "scalars", "]"}], ",", "scalars"}], 
           "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sub", "=", 
         RowBox[{
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
           "DotExpand", ",", "\[IndentingNewLine]", "simpleDot", ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
              RowBox[{"a___", ",", 
               RowBox[{"d___", " ", "c_"}], ",", "b___"}], "]"}], ":>", 
             RowBox[{
              RowBox[{"c", "  ", 
               RowBox[{"op", "[", 
                RowBox[{"a", ",", "d", ",", "b"}], "]"}]}], "/;", 
              RowBox[{"ListMemberQ", "[", 
               RowBox[{"c", ",", "scal"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
              RowBox[{"a___", ",", "c_", ",", "b___"}], "]"}], ":>", 
             RowBox[{
              RowBox[{"c", " ", 
               RowBox[{"op", "[", 
                RowBox[{"a", ",", "b"}], "]"}]}], "/;", 
              RowBox[{"ListMemberQ", "[", 
               RowBox[{"c", ",", "scal"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
              RowBox[{"a___", ",", 
               RowBox[{"d___", " ", 
                SuperscriptBox["c_", "n_"]}], ",", "b___"}], "]"}], ":>", 
             RowBox[{
              RowBox[{
               SuperscriptBox["c", "n"], " ", 
               RowBox[{"op", "[", 
                RowBox[{"a", ",", "d", ",", "b"}], "]"}]}], "/;", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ListMemberQ", "[", 
                 RowBox[{"c", ",", "scalars"}], "]"}], "||", 
                RowBox[{"ListMemberQ", "[", 
                 RowBox[{"c", ",", "scal"}], "]"}]}], ")"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
              RowBox[{"a___", ",", 
               SuperscriptBox["c_", "n_"], ",", "b___"}], "]"}], ":>", 
             RowBox[{
              RowBox[{
               SuperscriptBox["c", "n"], " ", 
               RowBox[{"op", "[", 
                RowBox[{"a", ",", "b"}], "]"}]}], "/;", 
              RowBox[{"ListMemberQ", "[", 
               RowBox[{"c", ",", "scal"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"simpleTranspose", "[", "scalars", "]"}]}], 
           "\[IndentingNewLine]", "}"}], "//", "Flatten"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "//.", "sub"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "Rules", " ", "to", " ", "simplify", " ", "Dot", " ", "expressions", " ",
       "with", " ", "extention", " ", "to", " ", "simpleDot", " ", "to", " ", 
      "account", " ", "for", " ", "scalars_.", "  ", 
      RowBox[{"Usage", ":", " ", "expression"}]}], "//.", 
     RowBox[{"simpleDot1", "[", "scalars_List", "]"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simpleDot1", "[", "scalars_List", "]"}], ":=", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
          RowBox[{"a___", ",", 
           RowBox[{"d___", " ", "c_"}], ",", "b___"}], "]"}], ":>", 
         RowBox[{
          RowBox[{"c", " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "d", ",", "b"}], "]"}]}], "/;", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"c", ",", "scalars"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
          RowBox[{"a___", ",", 
           RowBox[{"d___", " ", 
            SuperscriptBox["c_", "n_"]}], ",", "b___"}], "]"}], ":>", 
         RowBox[{
          RowBox[{
           SuperscriptBox["c", "n"], " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "d", ",", "b"}], "]"}]}], "/;", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"c", ",", "scalars"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
          RowBox[{"a___", ",", "c_", ",", "b___"}], "]"}], ":>", 
         RowBox[{
          RowBox[{"c", " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "b"}], "]"}]}], "/;", 
          RowBox[{
           RowBox[{"ListMemberQ", "[", 
            RowBox[{"c", ",", "scalars"}], "]"}], "&&", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "a", "}"}], "]"}], ">", "0"}], "||", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "b", "}"}], "]"}], ">", "0"}]}], ")"}]}]}]}], ",",
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
          RowBox[{"a___", ",", 
           SuperscriptBox["c_", "n_"], ",", "b___"}], "]"}], ":>", 
         RowBox[{
          RowBox[{
           SuperscriptBox["c", "n"], " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "b"}], "]"}]}], "/;", 
          RowBox[{
           RowBox[{"ListMemberQ", "[", 
            RowBox[{"c", ",", "scalars"}], "]"}], "&&", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "a", "}"}], "]"}], ">", "0"}], "||", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "b", "}"}], "]"}], ">", "0"}]}], ")"}]}]}]}], ",",
         "\[IndentingNewLine]", 
        RowBox[{"simpleTranspose", "[", "scalars", "]"}], ",", 
        "\[IndentingNewLine]", "simpleDot"}], "}"}], "//", "Flatten"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Rules", " ", "to", " ", "simplify", " ", "Dot", " ", "expressions", " ",
       "with", " ", "extention", " ", "to", " ", "simpleDot", " ", "to", " ", 
      "account", " ", "for", " ", "scalars_.", "  ", "Include", " ", 
      RowBox[{"DotExpand", ".", "\[IndentingNewLine]", 
       RowBox[{"Usage", ":", " ", "expression"}]}]}], "//.", 
     RowBox[{
      RowBox[{"simpleDot2", "[", "scalars_List", "]"}], ".", "  ", 
      RowBox[{"NOTE", ":", " ", 
       RowBox[{
       "DotExpand", " ", "works", " ", "for", " ", "only", " ", "simple", " ", 
        RowBox[{"sums", "."}]}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simpleDot2", "[", "scalars_List", "]"}], ":=", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{"DotExpand", ",", "\[IndentingNewLine]", 
        RowBox[{"simpleDot1", "[", "scalars", "]"}]}], "\[IndentingNewLine]", 
       "}"}], "//", "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDotSimplify", "::", "usage"}], "=", 
     "\"\<tuDotSimplify[scalars_List][exp_] expands and simplifies Dot|xDot \
expressions in exp_ accounting for scalar_List. *20Feb2015*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDotSimplify", "[", 
       RowBox[{"scalars_List:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp1"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp1"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", "DotExpandAll"}]}], ";", 
           RowBox[{"(*", 
            RowBox[{"CAREFUL", " ", "of", " ", "nested", " ", 
             RowBox[{"Dot", "[", "]"}], "s"}], "*)"}], "\[IndentingNewLine]", 
           
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"simpleDot2", "[", "scalars", "]"}]}]}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"simpleDot3", "[", 
       RowBox[{"scalars_List:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuDotSimplify", "[", "scalars", "]"}], "[", "exp", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"ruleSimpleDot", "[", 
       RowBox[{"rule_List", ",", "scalar_List", ",", "constant_List"}], "]"}],
       "[", "exp_", "]"}], " ", "recurrent", " ", "combinations", " ", "of", 
     " ", 
     RowBox[{"Functions", "."}], " ", "*", "27", "Oct2014"}], "*)"}], 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ruleSimpleDot", "[", 
       RowBox[{"rule_List", ",", "scalar_List", ",", 
        RowBox[{"repeat_Integer:", "2"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", 
         RowBox[{"xrule", "=", 
          RowBox[{"Flatten", "[", "rule", "]"}]}], ",", 
         RowBox[{"n", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"tmp", "=!=", "tmp1"}], "&&", 
           RowBox[{"n", "<", "repeat"}]}], ",", 
          RowBox[{
           RowBox[{"tmp1", "=", "tmp"}], ";", 
           RowBox[{"n", "++"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tmp", "/.", "xrule"}], "//", 
             RowBox[{"simpleDot3", "[", "scalar", "]"}]}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ruleSimpleDot", "[", 
      RowBox[{"rule_List", ",", "scalar_List", ",", "constant_List", ",", 
       RowBox[{"repeat_Integer:", "2"}]}], "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", 
        RowBox[{"xrule", "=", 
         RowBox[{"Flatten", "[", "rule", "]"}]}], ",", 
        RowBox[{"n", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp1"}], "&&", 
          RowBox[{"n", "<", "repeat"}]}], ",", 
         RowBox[{
          RowBox[{"tmp1", "=", "tmp"}], ";", 
          RowBox[{"n", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"tmp", "/.", "xrule"}], "//", 
             RowBox[{"tuDerivativeExpand", "[", "constant", "]"}]}], "//", 
            RowBox[{"simpleDot3", "[", "scalar", "]"}]}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"orderDot", "[", 
      RowBox[{"exp_", 
       RowBox[{"(", 
        RowBox[{"Dot", "|", "xDot"}], ")"}]}], "]"}], " ", "Orders", " ", 
     "terms", " ", "in", " ", "exp_", 
     RowBox[{"(", 
      RowBox[{"Dot", "|", "xDot"}], ")"}], " ", "*", "10", "Oct2012"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"orderDot", "[", 
     RowBox[{"exp_Dot", "|", "exp_xDot"}], "]"}], ":=", 
    RowBox[{"Apply", "[", 
     RowBox[{
      RowBox[{"Head", "[", "exp", "]"}], ",", 
      RowBox[{"Sort", "[", 
       RowBox[{"Apply", "[", 
        RowBox[{"List", ",", "exp"}], "]"}], "]"}]}], "]"}]}], 
   RowBox[{"(*", 
    RowBox[{"Simple", " ", "Sort", " ", "will", " ", 
     RowBox[{"do", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"orderArg", "[", "term_", "]"}], " ", "orders", " ", 
       "arguements", " ", "of", " ", "any", " ", "term_.", "  ", "Supercede", 
       " ", 
       RowBox[{"orderDot", ".", " ", "E", ".", "G", "."}]}], ":", " ", 
      "exp"}], "/.", 
     RowBox[{
      RowBox[{"dot", ":", 
       RowBox[{"Dot", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}]}], ":>", 
      RowBox[{
       RowBox[{"orderArg", "[", "dot", "]"}], "   ", "*", "23", 
       "Oct2012"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"orderArg", "[", "term_", "]"}], ":=", 
    RowBox[{"Apply", "[", 
     RowBox[{
      RowBox[{"Head", "[", "term", "]"}], ",", 
      RowBox[{"Sort", "[", 
       RowBox[{"Apply", "[", 
        RowBox[{"List", ",", "term"}], "]"}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"SeparateInto2After", "[", "term_", "]"}], "[", "exp_", "]"}], 
      " ", "separates", " ", "exp_", " ", "into", " ", "2", " ", "pieces", 
      " ", "with", " ", "the", " ", "same", " ", 
      RowBox[{"Head", ".", " ", "The"}], " ", "separation", " ", "point", " ",
       "right", " ", "after", " ", "term_", " ", "which", " ", "may", " ", 
      "be", " ", "a", " ", 
      RowBox[{"pattern", ".", "  ", "Usage"}], " ", 
      RowBox[{"example", ":", "\[IndentingNewLine]", "exp"}]}], " ", "/.", 
     RowBox[{
      RowBox[{"dot", ":", 
       RowBox[{"HoldPattern", "[", 
        RowBox[{"Dot", "[", 
         RowBox[{"a_", ",", "b__"}], "]"}], "]"}]}], "\[RuleDelayed]", 
      RowBox[{
       RowBox[{
        RowBox[{"SeparateInto2After", "[", 
         RowBox[{
          SubscriptBox["u", "e"], "[", "_", "]"}], "]"}], "[", "dot", "]"}], 
       "   ", "*", "10", "Nov2012"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"SeparateInto2After", "[", "term_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"head", ",", 
         RowBox[{"tmp", "=", "exp"}], ",", "pos", ",", "front", ",", "back"}],
         "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"head", "=", 
         RowBox[{"Head", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"xDot", ",", "tmp"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"tmp", ",", "term", ",", "1", ",", "1"}], "]"}], "//", 
          "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"front", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"head", ",", 
           RowBox[{"Take", "[", 
            RowBox[{"tmp", ",", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Append", "[", 
               RowBox[{
                RowBox[{"{", "1", "}"}], ",", "pos"}], "]"}], "]"}]}], 
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"back", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"head", ",", 
           RowBox[{"Take", "[", 
            RowBox[{"tmp", ",", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Append", "[", 
               RowBox[{
                RowBox[{"pos", "+", "1"}], ",", 
                RowBox[{"{", 
                 RowBox[{"-", "1"}], "}"}]}], "]"}], "]"}]}], "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"front", " ", "back"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"CollectDotRight", "[", "var_", "]"}], "[", "exp_", "]"}], " ", 
     "collects", " ", "var_", " ", "terms", " ", "in", " ", "exp_", " ", "if",
      " ", "var_", " ", "is", " ", "on", " ", "the", " ", "right", " ", "of", 
     " ", 
     RowBox[{"Dot", "[", 
      RowBox[{"...", ",", "var_"}], "]"}], " ", "or", " ", "in", " ", "a", 
     " ", "Times", " ", 
     RowBox[{"term", "."}], "  ", "*", "10", "Oct2013"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"CollectDotRight", "[", "var_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "test", ",", "tmp1", ",", "pos"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"Dot", "\[Rule]", "xDot"}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"var", "  ", 
              RowBox[{"ii", ":", "___"}]}], "\[Rule]", 
             RowBox[{
              RowBox[{"xDot", "[", "ii", "]"}], ".", 
              RowBox[{"test", "[", "var", "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"b___", " ", 
              RowBox[{"var", "^", "n_"}]}], "\[Rule]", 
             RowBox[{
              RowBox[{"xDot", "[", 
               RowBox[{"b", " ", 
                RowBox[{"var", "^", 
                 RowBox[{"(", 
                  RowBox[{"n", "-", "1"}], ")"}]}]}], "]"}], ".", " ", 
              RowBox[{"test", "[", "var", "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"xDot", "[", 
              RowBox[{"b__", ",", "var"}], "]"}], "\[Rule]", 
             RowBox[{
              RowBox[{"xDot", "[", "b", "]"}], " ", ".", " ", 
              RowBox[{"test", "[", "var", "]"}]}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"Position", "[", 
          RowBox[{"tmp", ",", 
           RowBox[{"Dot", "[", 
            RowBox[{"a__", ",", 
             RowBox[{"test", "[", "_", "]"}]}], "]"}], ",", "2"}], "]"}]}], 
        ";", 
        RowBox[{"(*", 
         RowBox[{"??", 
          RowBox[{"?", 
           RowBox[{"ERR", "\[LeftArrow]", 
            RowBox[{"no", " ", "Dot"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Extract", "[", 
            RowBox[{"tmp", ",", "pos"}], "]"}], "/.", 
           RowBox[{
            RowBox[{"test", "[", "_", "]"}], "\[Rule]", "1"}]}], "//", 
          RowBox[{
           RowBox[{"Apply", "[", 
            RowBox[{"Plus", ",", "#"}], "]"}], "&"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", 
         RowBox[{
          RowBox[{"tmp1", "//.", 
           RowBox[{"simpleDot2", "[", 
            RowBox[{"{", "}"}], "]"}]}], "/.", 
          RowBox[{"fxDot", "\[Rule]", "Dot"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", 
         RowBox[{"Dot", "[", 
          RowBox[{"tmp1", ",", "var"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"tmp", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmp", "+", "tmp1"}], "/.", 
         RowBox[{"xDot", "\[Rule]", "Dot"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"CollectDotLeft", "[", "var_", "]"}], "[", "exp_", "]"}], " ", 
     "collects", " ", "var_", " ", "terms", " ", "in", " ", "exp_", " ", "if",
      " ", "var_", " ", "is", " ", "on", " ", "the", " ", "left", " ", "of", 
     " ", 
     RowBox[{"Dot", "[", 
      RowBox[{"var_", ",", "...", ","}], "]"}], " ", "or", " ", "in", " ", 
     "a", " ", "Times", " ", 
     RowBox[{"term", "."}], "  ", "*", "10", "Oct2013"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"CollectDotLeft", "[", "var_", "]"}], "[", "exp_", "]"}], ":=", 
     
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "test", ",", "tmp1", ",", "pos"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"Dot", "\[Rule]", "xDot"}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"var", "  ", 
              RowBox[{"ii", ":", "___"}]}], "\[Rule]", 
             RowBox[{
              RowBox[{"test", "[", "var", "]"}], ".", 
              RowBox[{"xDot", "[", "ii", "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"b___", " ", 
              RowBox[{"var", "^", "n_"}]}], "\[Rule]", 
             RowBox[{
              RowBox[{"test", "[", "var", "]"}], ".", 
              RowBox[{"xDot", "[", 
               RowBox[{"b", " ", 
                RowBox[{"var", "^", 
                 RowBox[{"(", 
                  RowBox[{"n", "-", "1"}], ")"}]}]}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"xDot", "[", 
              RowBox[{"var", ",", " ", "b__"}], "]"}], "\[Rule]", " ", 
             RowBox[{
              RowBox[{"test", "[", "var", "]"}], ".", 
              RowBox[{"xDot", "[", "b", "]"}]}]}]}], "}"}]}]}], ";", 
        RowBox[{"xPrint", "[", "tmp", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"Position", "[", 
          RowBox[{"tmp", ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"test", "[", "_", "]"}], ",", "a__"}], "]"}], ",", "2"}],
           "]"}]}], ";", 
        RowBox[{"xPrint", "[", "pos", "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"??", 
          RowBox[{"?", 
           RowBox[{"ERR", "\[LeftArrow]", 
            RowBox[{"no", " ", "Dot"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Extract", "[", 
            RowBox[{"tmp", ",", "pos"}], "]"}], "/.", 
           RowBox[{
            RowBox[{"test", "[", "_", "]"}], "\[Rule]", "1"}]}], "//", 
          RowBox[{
           RowBox[{"Apply", "[", 
            RowBox[{"Plus", ",", "#"}], "]"}], "&"}]}]}], ";", 
        RowBox[{"xPrint", "[", "tmp1", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", 
         RowBox[{
          RowBox[{"tmp1", "//.", 
           RowBox[{"simpleDot2", "[", 
            RowBox[{"{", "}"}], "]"}]}], "/.", 
          RowBox[{"xDot", "\[Rule]", "Dot"}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"tmp1", "=", 
         RowBox[{"Dot", "[", 
          RowBox[{"var", ",", "tmp1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"tmp", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmp", "+", "tmp1"}], "/.", 
         RowBox[{"xDot", "\[Rule]", "Dot"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuVarsInExp", "::", "usage"}], "=", 
     "\"\<tuVarsInExp[exp_] produces a List of variables in exp_ accounting \
for tuRuleIndependentVarPattern. *21Feb2019*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuVarsInExp", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "$", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"tuOpIndependentVar", "[", 
          RowBox[{"Level", ",", 
           RowBox[{"op$", "[", 
            RowBox[{"exp", ",", "20"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"$", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"!", 
              RowBox[{"NumericQ", "[", "#", "]"}]}], "&&", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"AtomQ", "[", "#", "]"}], "||", 
               RowBox[{"!", 
                RowBox[{"MemberQ", "[", 
                 RowBox[{
                  RowBox[{"Attributes", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"Head", "[", "#", "]"}], "]"}], "]"}], ",", 
                  "Protected"}], "]"}]}]}], ")"}]}], "\[IndentingNewLine]", 
            "&"}]}], "]"}], "//", "DeleteDuplicates"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", "$"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"a", ".", "b"}], " ", 
       RowBox[{
        RowBox[{"c", "[", "x", "]"}], "[", "y", "]"}], " ", "d", " ", "f", 
       " ", 
       RowBox[{
        RowBox[{"T", "[", 
         RowBox[{"tt", ",", "\"\<u\>\"", ",", 
          RowBox[{"{", "i", "}"}]}], "]"}], ".", 
        SubscriptBox["s", "j"]}], "\[IndentingNewLine]", "$"}], "//", 
      "tuVarsInExp"}]}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuVarCount", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuVarCount", "::", "usage"}], "=", 
     "\"\<tuVarCount[var_][exp_] return the Count of var_ in exp_.  exp_ is \
wrapped in tuOpIndependentVar before evaluation. *22Feb2019*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuVarCount", "[", "var_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "$", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"tuOpIndependentVar", "[", 
          RowBox[{"Level", ",", 
           RowBox[{"op$", "[", 
            RowBox[{"exp", ",", "20"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"$", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"!", 
              RowBox[{"NumericQ", "[", "#", "]"}]}], "&&", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"AtomQ", "[", "#", "]"}], "||", 
               RowBox[{"!", 
                RowBox[{"MemberQ", "[", 
                 RowBox[{
                  RowBox[{"Attributes", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"Head", "[", "#", "]"}], "]"}], "]"}], ",", 
                  "Protected"}], "]"}]}]}], ")"}]}], "\[IndentingNewLine]", 
            "&"}]}], "]"}], "//", 
         RowBox[{"Count", "[", "var", "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", "$"}], "=", 
     RowBox[{
      RowBox[{"-", "2"}], " ", "\[ImaginaryI]", " ", 
      RowBox[{"\[CurlyEpsilon]", ".", "\[Chi]"}], " ", 
      RowBox[{"\[CurlyEpsilon]", ".", 
       InterpretationBox[
        RowBox[{
         SubscriptBox[
          UnderscriptBox["\"\<\[PartialD]\>\"", "_"], "\[Tau]"], "[", 
         "\[CurlyEpsilon]", "]"}],
        $CellContext`tuDDown[
        "\[PartialD]"][$CellContext`\[CurlyEpsilon], $CellContext`\[Tau]],
        Editable->False,
        SyntaxForm->Automatic], ".", "\[Chi]", ".", 
       InterpretationBox[
        SubsuperscriptBox["\[Psi]", 
         StyleBox["\[Mu]",
          StripOnInput->False,
          ShowContents->False], "\[Mu]"],
        $CellContext`Tensor[$CellContext`\[Psi], {$CellContext`\[Mu]}, \
{$CellContext`Void}],
        BaseStyle->{AutoMultiplicationSymbol -> False},
        Editable->False]}], " ", 
      InterpretationBox[
       RowBox[{
        SubscriptBox[
         UnderscriptBox["\"\<\[PartialD]\>\"", "_"], "\[Tau]"], "[", 
        InterpretationBox[
         SubsuperscriptBox["X", "\[Mu]", 
          StyleBox["\[Mu]",
           StripOnInput->False,
           ShowContents->False]],
         $CellContext`Tensor[$CellContext`X, {$CellContext`Void}, \
{$CellContext`\[Mu]}],
         BaseStyle->{AutoMultiplicationSymbol -> False},
         Editable->False], "]"}],
       $CellContext`tuDDown["\[PartialD]"][
        $CellContext`Tensor[$CellContext`X, {$CellContext`Void}, \
{$CellContext`\[Mu]}], $CellContext`\[Tau]],
       Editable->False,
       SyntaxForm->Automatic], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tuVarCount", "[", "\[CurlyEpsilon]", "]"}], "[", "$", 
       "]"}]}]}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuVarCollect", "::", "usage"}], "=", 
     "\"\<tuVarCollect[side_String:'LR'][exp_] collects left/right end \
variables of dotOps|CircleTimes terms in Plus[] expression to the left/right. \
 The side_String 'L','R','LR' determines the side to collect. \
*26May2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuVarCollect", "[", 
      RowBox[{"side_String:", "\"\<LR\>\""}], "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "SCL", ",", 
        RowBox[{"ops", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"dotOps", "|", "CircleTimes"}], "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"xPrint", "[", "ops", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"StringFreeQ", " ", "[", 
           RowBox[{"side", ",", "\"\<R\>\""}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"dd", ":", "ops"}], ")"}], "[", "a__", "]"}], 
               RowBox[{"(", 
                RowBox[{"acc___", ":", "1"}], ")"}]}], "\[RuleDelayed]", 
              RowBox[{"dd", "[", 
               RowBox[{
                RowBox[{"SCL", "[", "acc", "]"}], ",", "a"}], "]"}]}]}], "/.", 
            RowBox[{
             RowBox[{"dd", "[", 
              RowBox[{
               RowBox[{"SCL", "[", "1", "]"}], ",", "a__"}], "]"}], "\[Rule]", 
             RowBox[{"dd", "[", "a", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
          
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "//.", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dd", ":", "ops"}], ")"}], "[", 
               RowBox[{"a__", ",", 
                RowBox[{"Longest", "[", "c__", "]"}]}], "]"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dd", ":", "ops"}], ")"}], "[", 
               RowBox[{"b__", ",", 
                RowBox[{"Longest", "[", "c__", "]"}]}], "]"}]}], "\[Rule]", 
             RowBox[{"dd", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"dd", "[", "a", "]"}], "+", 
                 RowBox[{"dd", "[", "b", "]"}]}], ")"}], ",", "c"}], 
              "]"}]}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dd", ":", "ops"}], ")"}], "[", 
               RowBox[{
                RowBox[{"SCL", "[", "a__", "]"}], ",", "b__"}], "]"}], 
              "\[Rule]", 
              RowBox[{
               RowBox[{"SCL", "[", "a", "]"}], 
               RowBox[{"dd", "[", "b", "]"}]}]}]}], "/.", 
            RowBox[{
             RowBox[{"SCL", "[", "a__", "]"}], ":>", 
             RowBox[{"Times", "[", "a", "]"}]}]}]}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"StringFreeQ", " ", "[", 
           RowBox[{"side", ",", "\"\<L\>\""}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"dd", ":", "ops"}], ")"}], "[", "a__", "]"}], 
               RowBox[{"(", 
                RowBox[{"acc___", ":", "1"}], ")"}]}], "\[RuleDelayed]", 
              RowBox[{"dd", "[", 
               RowBox[{"a", ",", 
                RowBox[{"SCL", "[", "acc", "]"}]}], "]"}]}]}], "/.", 
            RowBox[{
             RowBox[{"dd", "[", 
              RowBox[{"a__", ",", 
               RowBox[{"SCL", "[", "1", "]"}]}], "]"}], "\[Rule]", 
             RowBox[{"dd", "[", "a", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
          
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "//.", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dd", ":", "ops"}], ")"}], "[", 
               RowBox[{
                RowBox[{"Longest", "[", "c__", "]"}], ",", "a__"}], "]"}], 
              "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dd", ":", "ops"}], ")"}], "[", 
               RowBox[{
                RowBox[{"Longest", "[", "c__", "]"}], ",", "b__"}], "]"}]}], 
             "\[Rule]", 
             RowBox[{"dd", "[", 
              RowBox[{"c", ",", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"dd", "[", "a", "]"}], "+", 
                 RowBox[{"dd", "[", "b", "]"}]}], ")"}]}], "]"}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dd", ":", "ops"}], ")"}], "[", 
               RowBox[{"b__", ",", 
                RowBox[{"SCL", "[", "a__", "]"}]}], "]"}], "\[Rule]", 
              RowBox[{
               RowBox[{"SCL", "[", "a", "]"}], 
               RowBox[{"dd", "[", "b", "]"}]}]}]}], "/.", 
            RowBox[{
             RowBox[{"SCL", "[", "a__", "]"}], ":>", 
             RowBox[{"Times", "[", "a", "]"}]}]}]}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "/.", 
        RowBox[{
         RowBox[{"ops", "[", "a_", "]"}], "\[RuleDelayed]", 
         RowBox[{"a", "/;", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"{", "a", "}"}], "]"}], "\[Equal]", "1"}]}]}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "TEST", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"scal", 
         RowBox[{"(", 
          RowBox[{"a", "\[CircleTimes]", 
           SubscriptBox["1", "n"], "\[CircleTimes]", "d"}], ")"}]}], "-", 
        RowBox[{"a", "\[CircleTimes]", "0"}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"-", "b"}], ")"}], "\[CircleTimes]", 
         RowBox[{"(", 
          RowBox[{"-", 
           SubscriptBox["1", "n"]}], ")"}], "\[CircleTimes]", 
         RowBox[{"(", "d", ")"}]}]}], "//.", 
       RowBox[{
        RowBox[{"tuOpSimplify", "[", "CircleTimes", "]"}], 
        "\[IndentingNewLine]", "%"}]}], "//", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"tuVarCollect", "[", "\"\<R\>\"", "]"}], 
         "\[IndentingNewLine]", "scal", 
         RowBox[{"(", 
          RowBox[{"a", "\[CenterDot]", 
           SubscriptBox["1", "n"], "\[CenterDot]", "d"}], ")"}]}], "-", 
        RowBox[{"a", "\[CenterDot]", "0"}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"-", "b"}], ")"}], "\[CenterDot]", 
         RowBox[{"(", 
          RowBox[{"-", 
           SubscriptBox["1", "n"]}], ")"}], "\[CenterDot]", 
         RowBox[{"(", 
          RowBox[{"-", "d"}], ")"}]}]}], "//.", 
       RowBox[{
        RowBox[{"tuOpSimplify", "[", "CenterDot", "]"}], 
        "\[IndentingNewLine]", "%"}]}]}], "//", 
     RowBox[{"tuVarCollect", "[", "\"\<R\>\"", "]"}]}], "\[IndentingNewLine]",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuDotVarCollect", ":=", "tuVarCollect"}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDotVarCollect", "::", "usage"}], "=", 
     "\"\<tuDotVarCollect[side_String:'LR'][exp_] collects left/right end \
variables of dotOps terms in Plus[] expression to the left/right.  The \
side_String 'L','R','LR' determines the side to collect. Replaced by \
tuVarCollect. *17Feb2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"collectDotTermsLeftRight", "[", "exp_Plus", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuVarCollect", "[", "\"\<LR\>\"", "]"}], "[", "exp", "]"}]}], 
    ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"collectDotRight", "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuVarCollect", "[", "\"\<R\>\"", "]"}], "[", "exp", "]"}]}], 
    ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"collectDotLeft", "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuVarCollect", "[", "\"\<L\>\"", "]"}], "[", "exp", "]"}]}], 
    ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Rules", " ", "to", " ", "simplify", " ", "NonCommuting", " ", 
      RowBox[{"expressions", ".", "  ", 
       RowBox[{"Usage", ":", " ", 
        RowBox[{"a", "\[CircleTimes]", 
         RowBox[{"(", 
          RowBox[{"4", " ", "b"}], ")"}], "\[CircleTimes]", "c"}]}]}]}], "//.", 
     RowBox[{
      RowBox[{"simpleNC", "[", "op", "]"}], ".", " ", 
      RowBox[{"NOTE", ":", " ", 
       RowBox[{"Does", " ", "not", " ", "work", " ", "for", " ", 
        RowBox[{"Dot", ".", " ", "25"}], " ", "June", " ", "2012"}]}]}]}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "simpleNC", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simpleNC", "[", 
      RowBox[{"op_", ",", "scalars_List"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{"a___", ",", 
           RowBox[{"d___", " ", "c_"}], ",", "b___"}], "]"}], ":>", 
         RowBox[{
          RowBox[{"c", " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "d", ",", "b"}], "]"}]}], "/;", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"c", ",", "scalars"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{"a___", ",", 
           RowBox[{"d___", " ", 
            SuperscriptBox["c_", "n_"]}], ",", "b___"}], "]"}], ":>", 
         RowBox[{
          RowBox[{
           SuperscriptBox["c", "n"], " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "d", ",", "b"}], "]"}]}], "/;", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"c", ",", "scalars"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{"a___", ",", "c_", ",", "b___"}], "]"}], ":>", 
         RowBox[{
          RowBox[{"c", " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "b"}], "]"}]}], "/;", 
          RowBox[{
           RowBox[{"ListMemberQ", "[", 
            RowBox[{"c", ",", "scalars"}], "]"}], "&&", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "a", "}"}], "]"}], ">", "0"}], "||", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "b", "}"}], "]"}], ">", "0"}]}], ")"}]}]}]}], ",",
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{"a___", ",", 
           SuperscriptBox["c_", "n_"], ",", "b___"}], "]"}], ":>", 
         RowBox[{
          RowBox[{
           SuperscriptBox["c", "n"], " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "b"}], "]"}]}], "/;", 
          RowBox[{
           RowBox[{"ListMemberQ", "[", 
            RowBox[{"c", ",", "scalars"}], "]"}], "&&", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "a", "]"}], ">", "0"}], "||", 
             RowBox[{
              RowBox[{"Length", "[", "b", "]"}], ">", "0"}]}], ")"}]}]}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"simpleTranspose", "[", "scalars", "]"}], ",", 
        RowBox[{"(*", 
         RowBox[{"CHECK", " ", "if", " ", 
          RowBox[{"appropriate", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{"a___", ",", 
           RowBox[{"n_", " ", "d_"}], ",", "c___"}], "]"}], "\[RuleDelayed]", 
         
         RowBox[{
          RowBox[{"n", " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "d", ",", "c"}], "]"}]}], "/;", 
          RowBox[{"NumericQ", "[", "n", "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{"a___", ",", "b_", ",", "c___"}], "]"}], ":>", 
         RowBox[{
          RowBox[{"b", " ", 
           RowBox[{"op", "[", 
            RowBox[{"a", ",", "c"}], "]"}]}], "/;", 
          RowBox[{"NumericQ", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{"a___", ",", 
           RowBox[{"-", "b_"}], ",", "c___"}], "]"}], "\[Rule]", 
         RowBox[{"-", 
          RowBox[{"op", "[", 
           RowBox[{"a", ",", "b", ",", "c"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"op", "[", "a__", "]"}], "]"}], ":>", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Conjugate", "[", "#", "]"}], "&"}], ",", 
            RowBox[{"op", "[", "a", "]"}]}], "]"}], "/;", 
          RowBox[{"op", "=!=", "Dot"}]}]}]}], "\[IndentingNewLine]", "}"}], "//",
       "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpIfMultiArg", "::", "usage"}], "=", 
     "\"\<tuOpIfMultiArg[op_,arg_List] forms op_[arg_] if Length of arg_List \
> 1 *4Mar2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpIfMultiArg", "[", 
      RowBox[{"op_", ",", "arg_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "$", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "arg", "]"}], ">", "1"}], ",", 
         RowBox[{"op", "[", 
          RowBox[{"Apply", "[", 
           RowBox[{"Sequence", ",", "arg"}], "]"}], "]"}], ",", 
         RowBox[{"arg", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], " ", "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuOpCollectR", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpCollectR", "::", "usage"}], "=", 
     "\"\<tuOpCollectR[op_:dotOps,dist_:Plus] is Rule[]s for collecting terms \
with common symbol on the left or right of a dist_ expressions.\n ie. \
c1(a.b)+d1(c.b)\[Rule](c1 a+d1 c).b. NOTE: has problems with complex \
expressions. *1Mar2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpCollectR", "[", 
      RowBox[{
       RowBox[{"op_:", "dotOps"}], ",", 
       RowBox[{"dist_:", "Plus"}]}], "]"}], ":=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"(*", "RHS", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"dist", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"c1_:", "1"}], ")"}], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"oo", ":", "op"}], ")"}], "[", 
            RowBox[{"a1__", " ", ",", 
             RowBox[{"Longest", "[", " ", "b__", "]"}]}], "]"}]}], " ", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"c2_:", "1"}], ")"}], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"oo", ":", "op"}], ")"}], "[", 
            RowBox[{"a2__", ",", "  ", 
             RowBox[{"Longest", "[", " ", "b__", "]"}]}], "]"}]}]}], "]"}], ":>", 
        RowBox[{"oo", "[", 
         RowBox[{
          RowBox[{"dist", "[", 
           RowBox[{
            RowBox[{"c1", "  ", 
             RowBox[{"tuOpIfMultiArg", "[", 
              RowBox[{"oo", ",", 
               RowBox[{"{", "a1", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
            ",", 
            RowBox[{"c2", " ", 
             RowBox[{"tuOpIfMultiArg", "[", 
              RowBox[{"oo", ",", 
               RowBox[{"{", "a2", "}"}]}], "]"}]}]}], "]"}], " ", ",", " ", 
          RowBox[{"tuOpIfMultiArg", "[", 
           RowBox[{"oo", ",", 
            RowBox[{"{", "b", "}"}]}], "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", "LHS", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dist", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"c1_:", "1"}], ")"}], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"oo", ":", "op"}], ")"}], "[", 
            RowBox[{
             RowBox[{"Longest", "[", " ", "b__", "]"}], ",", "a1__"}], " ", 
            "]"}]}], " ", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"c2_:", "1"}], ")"}], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"oo", ":", "op"}], ")"}], "[", 
            RowBox[{
             StyleBox[
              RowBox[{"Longest", "[", " ", "b__", "]"}],
              FontWeight->"Bold"], ",", "a2__"}], " ", "]"}]}]}], "]"}], ":>", 
        RowBox[{"oo", "[", 
         RowBox[{
          RowBox[{"tuOpIfMultiArg", "[", 
           RowBox[{"oo", ",", 
            RowBox[{"{", "b", "}"}]}], "]"}], ",", " ", 
          RowBox[{"dist", "[", 
           RowBox[{
            RowBox[{"c1", "  ", 
             RowBox[{"tuOpIfMultiArg", "[", 
              RowBox[{"oo", ",", 
               RowBox[{"{", "a1", "}"}]}], "]"}]}], ",", 
            RowBox[{"c2", " ", 
             RowBox[{"tuOpIfMultiArg", "[", 
              RowBox[{"oo", ",", 
               RowBox[{"{", "a2", "}"}]}], "]"}]}]}], "]"}]}], " ", "]"}]}]}],
       "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuOpCollect", "]"}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"tuOpCollect", "::", "usage"}], "=", 
     "\"\<tuOpCollect[op_:dotOps,dist_:Plus,distribute_:True][EXP_] collects \
common symbols on the left and right of op_ terms in a dist_[op_] expression \
in EXP_.  If distribute_ is False tuOpDistribute[op,dist] in not applied.  \
EG: \[IndentingNewLine] cc1 a1.b1.c1 + cc2 a1.b2.c1 \[Rule] a1.(b1 cc1+b2 \
cc2).c1 *5Mar2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuOpCollect", "[", 
       RowBox[{
        RowBox[{"op_:", "dotOps"}], ",", 
        RowBox[{"dist_:", "Plus"}], ",", 
        RowBox[{"distribute_:", "True"}]}], "]"}], "[", "EXP_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "EXP"}], ",", "Id", ",", "xPlus"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Attributes", "[", "xPlus", "]"}], "=", 
         RowBox[{"{", "Flat", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Add", " ", "dummy", " ", "identity", " ", "so", " ", "tuOpCollect", 
          " ", "works"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//", "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"If", "[", 
          RowBox[{"distribute", ",", 
           RowBox[{"$", "//.", 
            RowBox[{"tuOpDistribute", "[", 
             RowBox[{"op", ",", "dist"}], "]"}]}], ",", "$"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", 
          RowBox[{"tuOpSimplify", "[", "op", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", 
          RowBox[{"dist", "\[Rule]", "xPlus"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "Need", " ", "xPlus", " ", "replacement", " ", "for", " ", "dist_", 
          " ", "so", " ", "that", " ", "following", " ", 
          RowBox[{"Rule", "[", "]"}], " ", 
          RowBox[{"works", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"Add", " ", 
           RowBox[{"Id", ":", " ", "var"}]}], "\[Rule]", 
          RowBox[{"Id", ".", "var", ".", "Id"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"xPlus", "[", "a__", "]"}], "\[RuleDelayed]", 
           RowBox[{"Apply", "[", 
            RowBox[{"xPlus", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "/.", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"dd", ":", "op"}], ")"}], "[", "aa__", "]"}], 
                 "\[RuleDelayed]", 
                 RowBox[{"dd", "[", 
                  RowBox[{"Id", ",", "aa", ",", "Id"}], "]"}]}]}], "&"}], "/@", 
              RowBox[{"{", "a", "}"}]}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Collect", " ", "op_", " ", "and", " ", "Simplify"}], ",", 
          " ", 
          RowBox[{"remove", " ", 
           RowBox[{"Id", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"$", "//.", 
            RowBox[{"tuOpCollectR", "[", 
             RowBox[{"op", ",", "xPlus"}], "]"}]}], "//.", 
           RowBox[{"tuOpSimplify", "[", 
            RowBox[{"op", ",", 
             RowBox[{"{", "Id", "}"}]}], "]"}]}], "/.", 
          RowBox[{"Id", "\[Rule]", "1"}]}], "/.", 
         RowBox[{"xPlus", "\[Rule]", "dist"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"TEST", "\[IndentingNewLine]", " ", "cc1", " ", 
       RowBox[{"a1", ".", "b1", ".", " ", "c1"}]}], " ", "+", " ", 
      RowBox[{"cc2", " ", 
       RowBox[{"a1", ".", "b2", ".", "c1"}]}]}], " ", "//", 
     RowBox[{"tuOpCollect", "[", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuCircleTimesMatrix", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesMatrix", "::", "usage"}], "=", 
     "\"\<tuCircleTimesMatrix[exp_] expands all instances of a\[CircleTimes]b \
where a|b are Metrices|Arrays and turns it into Matrices of \[CircleTimes] \
over its elements, e.g., {{a,b}}\[CircleTimes]{{c,d}}->{{a\[CircleTimes]c,b\
\[CircleTimes]d}}. Works with \[CircleTimes] expression with multiple \
arguments. 2Apr2017*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesMatrix", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$p"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$p", "=", 
         RowBox[{"$", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"CircleTimes", "[", "__", "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$p", "=", 
         RowBox[{
          RowBox[{"$p", "//.", 
           RowBox[{
            RowBox[{"cc", ":", 
             RowBox[{"CircleTimes", "[", "__", "]"}]}], ":>", 
            RowBox[{"tuCircleTimesMatrix1", "[", "cc", "]"}]}]}], "//.", 
          RowBox[{"tuOpSimplify", "[", "CircleTimes", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$p", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "->", 
             RowBox[{"ArrayFlatten", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "2"}], "]"}]}], "&"}], 
           ",", "$p"}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", "$p", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"tuReplacePart", "[", 
           RowBox[{"$", ",", "$p"}], "]"}], "//.", 
          RowBox[{"tuOpSimplify", "[", "CircleTimes", "]"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesMatrix1", "[", "exp_CircleTimes", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$0", "=", "exp"}], ",", "$", ",", "$1", ",", "$1a", ",", 
         "X"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$1", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"X", "[", "#", "]"}], "&"}], "/@", "$0"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$1", "=", 
         RowBox[{
          RowBox[{"$1", "//", 
           RowBox[{"tuExtractPositionPattern", "[", 
            RowBox[{"X", "[", 
             RowBox[{"List", "[", "__", "]"}], "]"}], "]"}]}], "//", 
          "First"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"$1", ",", "$0"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"FreeQ", "[", 
           RowBox[{"$1", ",", 
            RowBox[{"X", "[", 
             RowBox[{"List", "[", "__", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"Return", "[", "$0", "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"No", " ", "Lists", " ", 
          RowBox[{"in", " ", "\[CircleTimes]", " ", "exp_"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$1", "=", 
         RowBox[{"$1", "/.", 
          RowBox[{
           RowBox[{"X", "[", "a_", "]"}], "\[Rule]", "a"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$1a", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"$1", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "/.", 
           RowBox[{"List", "\[Rule]", "xList"}]}], "\[IndentingNewLine]", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"FreeQ", "[", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", "xList"}], "]"}], "&"}],
              ")"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$1a", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"$1a", ",", 
           RowBox[{
            RowBox[{"FreeQ", "[", 
             RowBox[{"#", ",", "xList"}], "]"}], "&"}]}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", "$1a", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "->", 
             RowBox[{"tuReplacePart", "[", 
              RowBox[{"$0", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"$1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], "&"}], "/@",
            "$1a"}], "//", "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{
           RowBox[{"$1", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "$"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{
          RowBox[{"ArrayDepth", "[", "$", "]"}], ",", 
          RowBox[{"Dimensions", "[", "$", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuCircleTimesOp", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesOp", "::", "usage"}], "=", 
     "\"\<tuCircleTimesOp[OP_:Null][exp_] PROTOTYPE routine to expand \
\[CircleTimes] expression.  (a\[CircleTimes]b)[c\[CircleTimes]d] \[Rule] a[c]\
\[CircleTimes]b[d], (a\[CircleTimes]b\[CircleTimes]c).(a1\[CircleTimes]b1\
\[CircleTimes]c1) \[Rule] a.a1\[CircleTimes]b.b1\[CircleTimes]c.c1.  OP_ does \
nothing. *2Jul2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuCircleTimesOp", "[", 
       RowBox[{"OP_:", "Null"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$0", "=", "exp"}], ",", "$", ",", 
         RowBox[{"ops", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Times", "|", "dotOps"}], "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", "$0"}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\< \>\"", ",", "$"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Nested", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"a", "\[CircleTimes]", "b"}], ")"}], "[", 
            RowBox[{"c", "\[CircleTimes]", "d"}], "]"}]}], " ", "\[Rule]", 
          " ", 
          RowBox[{
           RowBox[{"a", "[", "c", "]"}], "\[CircleTimes]", 
           RowBox[{"b", "[", "d", "]"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"CircleTimes", "[", "f__", "]"}], "[", " ", 
            RowBox[{"CircleTimes", "[", "d__", "]"}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Inner", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#1", "[", "#2", "]"}], "&"}], ",", 
              RowBox[{"{", "f", "}"}], ",", 
              RowBox[{"{", "d", "}"}], ",", "CircleTimes"}], "]"}], "/;", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "f", "}"}], "]"}], ">", "1"}], "&&", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "f", "}"}], "]"}], "==", 
              RowBox[{"Length", "[", 
               RowBox[{"{", "d", "}"}], "]"}]}]}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Distribute", " ", "arguements", " ", "over", " ", "each", " ", 
          "element", " ", 
          RowBox[{"of", " ", "\[CircleTimes]", "."}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"CircleTimes", "[", "f__", "]"}], "[", "d__", "]"}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Apply", "[", 
             RowBox[{"CircleTimes", ",", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", "d", "]"}], "&"}], ",", 
                RowBox[{"{", "f", "}"}]}], "]"}]}], "]"}], "/;", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"{", "f", "}"}], "]"}], ">", "1"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Distribute", " ", "op_", " ", 
          RowBox[{"over", " ", "\[CircleTimes]"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"ops", "|", "OP"}], "]"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"oo", ":", 
            RowBox[{"op_", "[", 
             RowBox[{
              RowBox[{"CircleTimes", "[", "a__", "]"}], " ", ",", " ", 
              RowBox[{"CircleTimes", "[", "b__", "]"}], ",", "c___"}], 
             "]"}]}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"oo", ",", "CircleTimes"}], "]"}], "/;", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"ops", "|", "OP"}], "]"}], ",", "op"}], "]"}]}]}]}]}], 
        ";", "\[IndentingNewLine]", "$"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesExpand", "::", "usage"}], "=", 
     "\"\<tuCircleTimesExpand[exp_] distributes CircleTimes Head over \
arguements. e.g. (a\[CircleTimes]b)[ c\[CircleTimes]d ]\[Rule]a[ c ]\
\[CircleTimes]b[ d ] and (a\[CircleTimes]b)[ c ]\[Rule]a[ c ] \[CircleTimes] \
b[ c ] and dotOps[a\[CircleTimes]b,c\[CircleTimes]d]->dotOps[a,c] \
\[CircleTimes] dotOps[b,d] .  *1Oct2015*\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesExpand", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", ",", 
         RowBox[{"ops", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Times", "|", "dotOps"}], "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", "exp"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"CircleTimes", "[", "f__", "]"}], "[", "  ", 
            RowBox[{"CircleTimes", "[", "d__", "]"}], "  ", "]"}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Inner", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#1", "[", "#2", "]"}], "&"}], ",", 
              RowBox[{"{", "f", "}"}], ",", 
              RowBox[{"{", "d", "}"}], ",", "CircleTimes"}], "]"}], "/;", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "f", "}"}], "]"}], ">", "1"}], "&&", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "f", "}"}], "]"}], "==", 
              RowBox[{"Length", "[", 
               RowBox[{"{", "d", "}"}], "]"}]}]}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"CircleTimes", "[", "f__", "]"}], "[", "d__", "]"}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Apply", "[", 
             RowBox[{"CircleTimes", ",", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", "d", "]"}], "&"}], ",", 
                RowBox[{"{", "f", "}"}]}], "]"}]}], "]"}], "/;", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"{", "f", "}"}], "]"}], ">", "1"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", 
          RowBox[{
           RowBox[{"oo", ":", 
            RowBox[{"op_", "[", 
             RowBox[{
              RowBox[{"c1", ":", 
               RowBox[{"CircleTimes", "[", "a__", "]"}]}], " ", ",", " ", 
              RowBox[{"c2", ":", 
               RowBox[{"CircleTimes", "[", "b__", "]"}]}], ",", "c___"}], 
             "]"}]}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"op", "[", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{
                RowBox[{"op", "[", 
                 RowBox[{"c1", ",", "c2"}], "]"}], ",", "CircleTimes"}], 
               "]"}], ",", "c"}], "]"}], "/;", 
            RowBox[{"MemberQ", "[", 
             RowBox[{"ops", ",", "op"}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuCircleTimesGather", "]"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesGather", "::", "usage"}], "=", 
     "\"\<tuCircleTimesGather[altOP_:Null][exp_] gathers \[CircleTimes] \
expressions, e.g., (aa(a\[CircleTimes]b)).(cc(c\[CircleTimes]d))->((aa a).(cc \
c))\[CircleTimes](b.d). If altOP_ specified this operator is used instead of \
dotOps. Any \!\(\*SubscriptBox[\(1\), \(n\)]\) are taken as placeholders and \
only one is output, e.g., (\!\(\*SubscriptBox[\(1\), \
\(3\)]\)\[CircleTimes]d)-cc (\!\(\*SubscriptBox[\(1\), \
\(3\)]\)\[CircleTimes]f)\[Rule]\!\(\*SubscriptBox[\(1\), \(3\)]\)\
\[CircleTimes](d-cc f).  NOTE: Coefficients are placed in the first \
space.*16Apr2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuCircleTimesGather", "[", 
       RowBox[{
        RowBox[{"scal_:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"altOP_:", "Null"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "xOP", ",", "narg", ",", 
         RowBox[{"ops", "=", 
          RowBox[{"Flatten", "[", "dotOps", "]"}]}], ",", "$s"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"altOP", "=!=", "Null"}], ",", 
          RowBox[{"ops", "=", "altOP"}]}], "]"}], ";", 
        RowBox[{"xPrint", "[", "ops", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", 
          RowBox[{"tuOpSimplify", "[", 
           RowBox[{"CircleTimes", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", "scal", "}"}], "]"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Simplified", " ", "21", "May2016"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"Combine", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"cc", 
              RowBox[{"(", 
               RowBox[{"a", "\[CircleTimes]", "b"}], ")"}]}], ")"}], ".", 
            RowBox[{"(", 
             RowBox[{"dd", 
              RowBox[{"(", 
               RowBox[{"c", "\[CircleTimes]", "d"}], ")"}]}], ")"}]}]}], 
          "\[Rule]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"cc", " ", "a"}], ")"}], ".", 
             RowBox[{"(", 
              RowBox[{"dd", " ", "c"}], ")"}]}], ")"}], "\[CircleTimes]", 
           RowBox[{"(", 
            RowBox[{"b", ".", "d"}], ")"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"$", "//.", 
           RowBox[{
            RowBox[{"a_", 
             RowBox[{"(", 
              RowBox[{"b_", "\[CircleTimes]", "c_"}], ")"}]}], "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"a", " ", "b"}], ")"}], " ", "\[CircleTimes]", 
             "c"}]}]}], "/.", 
          RowBox[{
           RowBox[{"oo", ":", "ops"}], "\[RuleDelayed]", 
           RowBox[{"xOP", "[", "oo", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", " ", 
          RowBox[{
           RowBox[{"oo", ":", 
            RowBox[{
             RowBox[{"xOP", "[", "_", "]"}], "[", "arg__", "]"}]}], ":>", 
           RowBox[{"Thread", "[", 
            RowBox[{"oo", ",", "CircleTimes"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"xOP", "[", "a_", "]"}], "\[Rule]", "a"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Gathering", " ", "over", " ", "PlusRule"}], " ", "*)"}], 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{"REMOVED", " ", "use", " ", 
            RowBox[{
             RowBox[{"tuVarCollect", "[", "]"}], ".", "\[IndentingNewLine]", 
             "$s"}]}], "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"ca_:", "1"}], ")"}], " ", 
                RowBox[{"a_", " ", "\[CircleTimes]", "ss_"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"cb_:", "1"}], ")"}], 
                RowBox[{"b_", " ", "\[CircleTimes]", "ss_"}]}]}], "\[Rule]", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ca", " ", "a"}], "+", 
                 RowBox[{"cb", " ", "b"}]}], ")"}], "\[CircleTimes]", 
               "ss"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"ca_:", "1"}], ")"}], 
                RowBox[{"ss_", "\[CircleTimes]", " ", "a_"}]}], " ", "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"cb_:", "1"}], ")"}], 
                RowBox[{"ss_", "\[CircleTimes]", "b_"}]}]}], " ", "\[Rule]", 
              RowBox[{"ss", "\[CircleTimes]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ca", " ", "a"}], "+", 
                 RowBox[{"cb", " ", "b"}]}], ")"}]}]}]}], 
            "\[IndentingNewLine]", "}"}]}], ";"}], "*)"}], 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"$tmp", "=", "$"}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//", 
          RowBox[{"tuRepeat", "[", 
           RowBox[{
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{
               SuperscriptBox[
                SubscriptBox["1", "n_"], 
                RowBox[{"m_:", "1"}]], "->", 
               SubscriptBox["1", "n"]}], ",", 
              RowBox[{
               RowBox[{"ops", "[", 
                RowBox[{
                 SubscriptBox["1", "n_"], ".."}], "]"}], "\[Rule]", 
               SubscriptBox["1", "n"]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"tuOpCollect", "[", "CircleTimes", "]"}], ",", 
              RowBox[{"tuOpSimplifyF", "[", 
               RowBox[{"ops", ",", 
                RowBox[{"{", "}"}]}], "]"}], ",", 
              RowBox[{"tuOpSimplifyF", "[", 
               RowBox[{"CircleTimes", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", "scal", "}"}], "]"}]}], "]"}]}], "}"}], ",", 
            "\[IndentingNewLine]", "10"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "$", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "TEST", "*)"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"scal", 
          RowBox[{"(", 
           RowBox[{"a", "\[CircleTimes]", "b", "\[CircleTimes]", "d"}], 
           ")"}]}], "-", 
         RowBox[{"a", "\[CircleTimes]", "0"}], "+", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "b"}], ")"}], "\[CircleTimes]", 
           RowBox[{"(", 
            RowBox[{"-", "c"}], ")"}], "\[CircleTimes]", 
           RowBox[{"(", "d", ")"}]}], "\[IndentingNewLine]", "%"}]}], "//", 
        RowBox[{
         RowBox[{
          RowBox[{"tuCircleTimesGather", "[", "]"}], "\[IndentingNewLine]", 
          "scal", 
          RowBox[{"(", 
           RowBox[{"a", "\[CircleTimes]", "d"}], ")"}]}], "-", 
         RowBox[{"a", "\[CircleTimes]", "0"}], "+", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "b"}], ")"}], "\[CircleTimes]", 
           RowBox[{"(", "d", ")"}]}], "\[IndentingNewLine]", "%"}]}]}], "//", 
       
       RowBox[{
        RowBox[{
         RowBox[{"tuCircleTimesGather", "[", "scal", "]"}], 
         "\[IndentingNewLine]", "scal", 
         RowBox[{"(", 
          RowBox[{"a", "\[CircleTimes]", 
           SubscriptBox["1", "n"], "\[CircleTimes]", "d"}], ")"}]}], "-", 
        RowBox[{"a", "\[CircleTimes]", "0"}], "+", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"-", "b"}], ")"}], "\[CircleTimes]", 
          RowBox[{"(", 
           RowBox[{"-", 
            SubscriptBox["1", "n"]}], ")"}], "\[CircleTimes]", 
          RowBox[{"(", "d", ")"}]}], "\[IndentingNewLine]", "%"}]}]}], "//", 
      RowBox[{
       RowBox[{
        RowBox[{"tuCircleTimesGather", "[", "scal", "]"}], 
        "\[IndentingNewLine]", "scal", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"a", "\[CircleTimes]", "d"}], ")"}], ".", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "b"}], ")"}], "\[CircleTimes]", 
           RowBox[{"(", 
            SubscriptBox["1", "n"], ")"}]}], ")"}]}]}], "+", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "e"}], ")"}], "\[CircleTimes]", 
           RowBox[{"(", 
            SubscriptBox["1", "n"], ")"}]}], ")"}], ".", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"-", "f"}], ")"}], "\[CircleTimes]", 
           RowBox[{"(", 
            SubscriptBox["1", "n"], ")"}]}], ")"}]}], "\[IndentingNewLine]", 
        "%"}]}]}], "//", 
     RowBox[{"tuCircleTimesGather", "[", "scal", "]"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuCircleTimesInnerTerm", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesInnerTerm", "::", "usage"}], "=", 
     "\"\<tuCircleTimesInnerTerm[difOp_][exp_] computes the inner terms \
produced when merging CircleTimes operator expressions, exp_, e.g., (a\
\[CircleTimes]b).(c\[CircleTimes]d)\[Rule](a.c)\[CircleTimes](b.d)+(a.\
tuCircleTimesInnerTerm[c[b],\[Del]])\[CircleTimes](d).  Assumes dotOps \
variable separators.  *2Mar2016*\>\""}], "  ", ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuCircleTimesInnerTerm", "[", "difOp_", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$h", ",", "$h1", ",", "$dif", ",", 
         RowBox[{"$", "=", "exp"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$h", "=", 
         RowBox[{"Head", "[", "exp", "]"}]}], ";", 
        RowBox[{"xPrint", "[", "$h", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"FreeQ", "[", 
           RowBox[{"$h", ",", "difOp"}], "]"}], ",", 
          RowBox[{
           RowBox[{"$", "=", "0"}], ";"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"FreeQ", "[", 
               RowBox[{"$h", ",", "dotOps"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"xPrint", "[", 
               RowBox[{"\"\<$XX \>\"", ",", "$h"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"$dif", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"tuExtractPattern", "[", "difOp", "]"}], "[", "$h", 
                 "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";", 
              RowBox[{"xPrint", "[", "exp", "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"$", "=", 
               RowBox[{"$dif", "[", 
                RowBox[{"exp", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
              RowBox[{"xPrint", "[", 
               RowBox[{"$h", ",", 
                RowBox[{"Length", "[", "$h", "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"$h1", "=", 
               RowBox[{"Head", "[", "$h", "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"tuMemberQ", "[", 
                 RowBox[{"$h1", ",", "dotOps"}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"$h", "=", 
                  RowBox[{"Apply", "[", 
                   RowBox[{"$h1", ",", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{
                    RowBox[{"Apply", "[", 
                    RowBox[{"List", ",", "$h"}], "]"}], ",", "difOp"}], 
                    "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"$", "=", 
                  RowBox[{"Apply", "[", 
                   RowBox[{"$h1", ",", 
                    RowBox[{"{", 
                    RowBox[{"$h", ",", "$"}], "}"}]}], "]"}]}]}]}], 
               "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuCircleTimesSimplify", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesSimplify", "::", "usage"}], "=", 
     "\"\<tuCircleTimesSimplify[exp_] zeros CircleTimes terms that contain 0, \
Moves signs of components to overall expression. NOTE: \
tuOpSimplify[CircleTimes] may be all that is needed. *14Apr2016*\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesSimplify", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"$", "//.", 
        RowBox[{"tuOpSimplify", "[", "CircleTimes", "]"}]}]}], 
      RowBox[{"(*", 
       RowBox[{"replaced", " ", "17", "May2016"}], "*)"}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuCircleTimesSeparate", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesSeparate", "::", "usage"}], "=", 
     "\"\<tuCircleTimesSeparate[{spaceVar_List:{},derivatives:DerivOps}][exp_]\
 separates product spaces (e.g. a\[CircleTimes]b) in exp_  into Dot product \
of product spaces involving only one of the spaces (a\[CircleTimes]b\[Rule](a\
\[CircleTimes]\!\(\*SubscriptBox[\(1\), \(b\)]\)).(\!\(\*SubscriptBox[\(1\), \
\(a\)]\)\[CircleTimes]b)). spaceVar_List:{} specifies Lists of Patterns that \
group variables of each space ({\!\(\*SubscriptBox[\(1\), \(a\)]\),A,B},{\!\(\
\*SubscriptBox[\(1\), \(b\)]\),a,b,Tensor[a|b,_,_]}). The first element of \
each space pattern List is its identity element(\!\(\*SubscriptBox[\(1\), \
\(n_\)]\)). *21May2016*\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuCircleTimesSeparate", "[", 
       RowBox[{
        RowBox[{"spaceVars_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"derivatives_:", "DerivOps"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", ",", 
         RowBox[{"$0", "=", "exp"}], ",", "$1", ",", "$1a", ",", "$2", ",", 
         RowBox[{"ops", "=", "dotOps"}], ",", 
         RowBox[{"nspace", "=", 
          RowBox[{"Length", "[", "spaceVars", "]"}]}], ",", "$i", ",", "$j", 
         ",", "pattern", ",", "$list"}], "\[IndentingNewLine]", "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"template", " ", "for", " ", "finding", " ", "products"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pattern", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"CircleTimes", ",", 
           RowBox[{"Table", "[", 
            RowBox[{"_", ",", "nspace"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$list", "=", 
         RowBox[{"$0", "//", 
          RowBox[{"tuExtractPositionPattern", "[", "pattern", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"identity", " ", "array"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$1a", "=", 
         RowBox[{"$1", "=", 
          RowBox[{"Apply", "[", 
           RowBox[{"CircleTimes", ",", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", "spaceVars"}], 
             "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"$i", "=", "1"}], ",", 
          RowBox[{"$i", "\[LessEqual]", 
           RowBox[{"Length", "[", "$list", "]"}]}], ",", 
          RowBox[{"$i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$2", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", " ", 
           RowBox[{"$", "=", 
            RowBox[{"$list", "[", 
             RowBox[{"[", 
              RowBox[{"$i", ",", "2"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"$j", "=", "1"}], ",", 
             RowBox[{"$j", "\[LessEqual]", "nspace"}], ",", 
             RowBox[{"$j", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$1", "=", "$1a"}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"$1", "[", 
                RowBox[{"[", "$j", "]"}], "]"}], "=", 
               RowBox[{"$", "[", 
                RowBox[{"[", "$j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"$1", "=!=", "$1a"}], ",", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"$2", ",", "$1"}], "]"}]}], "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$list", "[", 
             RowBox[{"[", 
              RowBox[{"$i", ",", "2"}], "]"}], "]"}], "=", 
            RowBox[{"Apply", "[", 
             RowBox[{"Dot", ",", "$2"}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"$0", ",", "$list"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\n", "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuDotCircleTimesOrder", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDotCircleTimesOrder", "::", "usage"}], "=", 
     "\"\<tuDotCircleTimesOrder[{spaceVar_List:{},derivatives:DerivOps}][exp_]\
 Cononically orders Dot product of product spaces (e.g. (c\[CircleTimes]b).(a\
\[CircleTimes]b)->(a\[CircleTimes]b).(c\[CircleTimes]b) ) in exp_.  \
spaceVar_List:{} specifies Lists of Patterns that match variables of each \
space ({\!\(\*SubscriptBox[\(1\), \(a\)]\),A,B},{\!\(\*SubscriptBox[\(1\), \
\(b\)]\),a,b,Tensor[a|b,_,_]}). The first element of each space pattern List \
is its identity element(\!\(\*SubscriptBox[\(1\), \(n_\)]\)). The result is \
put in canonical order except for separated spaces that contain derivatives.  \
*21May2016*\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDotCircleTimesOrder", "[", 
       RowBox[{
        RowBox[{"spaceVars_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"derivatives_:", "DerivOps"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", ",", 
         RowBox[{"$0", "=", "exp"}], ",", "$1", ",", "$1a", ",", "$2", ",", 
         RowBox[{"ops", "=", "dotOps"}], ",", 
         RowBox[{"nspace", "=", 
          RowBox[{"Length", "[", "spaceVars", "]"}]}], ",", "$i", ",", "$j", 
         ",", "pattern", ",", "$list"}], "\[IndentingNewLine]", "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"template", " ", "for", " ", "finding", " ", "products"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pattern", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"CircleTimes", ",", 
           RowBox[{"Table", "[", 
            RowBox[{"_", ",", "nspace"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$0", "=", 
         RowBox[{"$0", "/.", "toxDot"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$0", "=", 
         RowBox[{"$0", "/.", 
          RowBox[{
           RowBox[{"xDot", "[", "a__", "]"}], ":>", 
           RowBox[{"Apply", "[", 
            RowBox[{"xDot", ",", 
             RowBox[{
              RowBox[{"{", "a", "}"}], "/.", "toDot"}]}], "]"}]}]}]}], ";", 
        " ", 
        RowBox[{"xPrint", "[", "$0", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$list", "=", 
         RowBox[{"$0", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"xDot", "[", 
            RowBox[{"pattern", ".."}], "]"}], "]"}]}]}], ";", 
        RowBox[{"xPrint", "[", "$list", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$list", "=", 
         RowBox[{"$list", "/.", 
          RowBox[{
           RowBox[{"dd", ":", 
            RowBox[{"xDot", "[", "__", "]"}]}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Sort", "[", "dd", "]"}], "/;", 
            RowBox[{"FreeQ", "[", 
             RowBox[{"dd", ",", "derivatives"}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$list", "=", 
         RowBox[{"$list", "/.", "toDot"}]}], ";", 
        RowBox[{"xPrint", "[", "$list", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"$0", ",", "$list"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuCircleTimesSeparateGroups", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCircleTimesSeparateGroups", "::", "usage"}], "=", 
     "\"\<tuCircleTimesSeparateGroups[{spaceVar_List:{},derivatives:DerivOps}]\
[exp_] separates product spaces (e.g. (a1.a2)\[CircleTimes]b) in exp_  into \
Dot product of product spaces divided by groups defined in spaceVars_List.  \
The grouping is defined by patterns of variables for each space involving \
only one of the spaces (a1.a[2].a3)\[CircleTimes]b\[Rule](a1.a[2])\
\[CircleTimes]b).(a3\[CircleTimes]b). spaceVar_List:{} specifies Lists of \
Patterns that match variable groups of each space ({\!\(\*SubscriptBox[\(1\), \
\(a\)]\),A,B},{\!\(\*SubscriptBox[\(1\), \(b\)]\),a.b,Tensor[a|b,_,_]}). \
Consecutive Dotted variables are grouped. Scalars are grouped an are put in \
first position of the separated n-space.  The first element of each \
spaceVar_List is its identity element(\!\(\*SubscriptBox[\(1\), \(n_\)]\)) \
and used when no vector element is available to hold the space position.  \
*21May2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuCircleTimesSeparateGroups", "[", 
       RowBox[{
        RowBox[{"spaceVars_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"derivatives_:", 
         RowBox[{"{", "DerivOps", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", ",", 
         RowBox[{"$0", "=", "exp"}], ",", "$1", ",", "$1a", ",", "$2", ",", 
         "$2a", ",", "$2b", ",", 
         RowBox[{"ops", "=", "dotOps"}], ",", 
         RowBox[{"nspace", "=", 
          RowBox[{"Length", "[", "spaceVars", "]"}]}], ",", "$i", ",", "$j", 
         ",", "$k", ",", "pattern", ",", "$list", ",", "$s", ",", "X", ",", 
         "$test"}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
       
       RowBox[{"(*", 
        RowBox[{"template", " ", "for", " ", "finding", " ", "products"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pattern", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"CircleTimes", ",", 
           RowBox[{"Table", "[", 
            RowBox[{"_", ",", "nspace"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$0", "=", 
         RowBox[{
          RowBox[{"tuCircleTimesSeparate", "[", 
           RowBox[{"spaceVars", ",", "derivatives"}], "]"}], "[", "$0", 
          "]"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<$0: \>\"", ",", "$0"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$list", "=", 
         RowBox[{"$0", "//", 
          RowBox[{"tuExtractPositionPattern", "[", "pattern", "]"}]}]}], ";", 
        
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<$list: \>\"", ",", "$list"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"identity", " ", "array"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$1s", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"CircleTimes", ",", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", "spaceVars"}], 
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"$i", "=", "1"}], ",", 
          RowBox[{"$i", "\[LessEqual]", 
           RowBox[{"Length", "[", "$list", "]"}]}], ",", 
          RowBox[{"$i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$2", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Locate", " ", "and", " ", "mark", " ", "groups"}], 
            "*)"}], "\[IndentingNewLine]", " ", 
           RowBox[{"$", "=", 
            RowBox[{"$list", "[", 
             RowBox[{"[", 
              RowBox[{"$i", ",", "2"}], "]"}], "]"}]}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<$: \>\"", ",", "$"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "**", "**", "**", "**", "**", "**", "**", "**", "**", "**"}], 
            "******)"}], "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"$j", "=", "1"}], ",", 
             RowBox[{"$j", "\[LessEqual]", "nspace"}], ",", 
             RowBox[{"$j", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$s", "=", 
               RowBox[{"spaceVars", "[", 
                RowBox[{"[", "$j", "]"}], "]"}]}], ";", 
              RowBox[{"xPrint", "[", 
               RowBox[{"\"\<$s: \>\"", ",", "$s"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"$1", "=", 
               RowBox[{"$", "[", 
                RowBox[{"[", "$j", "]"}], "]"}]}], ";", 
              RowBox[{"xPrint", "[", 
               RowBox[{"\"\<$1a: \>\"", ",", "$1"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"$1", "===", 
                 RowBox[{"$s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"identify", " ", "multiplicative", " ", "scalar"}], 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"$1", "=", 
               RowBox[{"Apply", "[", 
                RowBox[{"Dot", ",", 
                 RowBox[{"Map", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"tuMemberQ", "[", 
                    RowBox[{
                    RowBox[{"Head", "[", "#", "]"}], ",", "dotOps"}], "]"}]}],
                     ",", 
                    RowBox[{"scal", "[", "#", "]"}], ",", "#"}], "]"}], "&"}],
                    ",", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"$1", "/.", 
                    RowBox[{"Times", "\[Rule]", "List"}]}], "}"}], "]"}]}], 
                  "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"xPrint", "[", 
               RowBox[{"\"\<$1: \>\"", ",", "$1", ",", "\"\<:\>\"", ",", 
                RowBox[{"Length", "[", "$s", "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Dot", " ", "separate", " ", "groups"}], " ", "*)"}], 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"xPrint", "[", 
               RowBox[{"\"\<$1.1: \>\"", ",", "$1", ",", "\"\<:\>\"", ",", 
                RowBox[{"Length", "[", "$s", "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "mark", " ", "with", " ", "X", " ", "specified", " ", 
                "groups"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"For", "[", 
               RowBox[{
                RowBox[{"$k", "=", "2"}], ",", 
                RowBox[{"$k", "\[LessEqual]", 
                 RowBox[{"Length", "[", "$s", "]"}]}], ",", 
                RowBox[{"$k", "++"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"$1", "=", 
                  RowBox[{"$1", "/.", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"ss", ":", " ", 
                    RowBox[{"$s", "[", 
                    RowBox[{"[", "$k", "]"}], "]"}]}], ")"}], 
                    "\[RuleDelayed]", 
                    RowBox[{"X", "[", "ss", "]"}]}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"xPrint", "[", 
                  RowBox[{"\"\<{$1.2}: \>\"", ",", 
                   RowBox[{"{", "$1", "}"}]}], "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"xPrint", "[", 
               RowBox[{"\"\<$1.3:\>\"", ",", "$j", ",", "\"\<: \>\"", ",", 
                RowBox[{"$1", "=", "$1"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"expand", " ", "groups"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"$2", "=", 
               RowBox[{
                RowBox[{"expand2CT", "[", 
                 RowBox[{"$j", ",", "$1s"}], "]"}], "[", "$1", "]"}]}], ";", 
              RowBox[{"xPrint", "[", 
               RowBox[{"\"\<$2: \>\"", ",", "$2"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"$list", "[", 
                RowBox[{"[", 
                 RowBox[{"$i", ",", "2"}], "]"}], "]"}], "=", "$2"}], ";", 
              RowBox[{"xPrint", "[", 
               RowBox[{
               "\"\<$list: \>\"", ",", "$i", ",", "\"\<:\>\"", ",", "$list"}],
                "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "**", "**", "**", "**", "**", "**", "**", "**", "**", "**"}], 
          "******)"}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"$0", ",", "$list"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCirclePlus2Matrix", "::", "usage"}], "=", 
     "\"\<tuCirclePlus2Matrix[exp_] converts CirclePlus expression exp_ into \
matrix expression where terms of the CirclePlus expresion are placed on the \
diagonals *24Jun2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCirclePlus2Matrix", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "xCirclePlus"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"$", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"CirclePlus", "[", "__", "]"}], "]"}]}]}], ";", 
        RowBox[{"xPrint", "[", "$", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"CirclePlus", "[", "a__", "]"}], "\[RuleDelayed]", 
           RowBox[{"xCirclePlus", "[", 
            RowBox[{"Append", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"ArrayPad", "[", 
                  RowBox[{
                   RowBox[{"matrixLevel2", "[", 
                    RowBox[{"{", 
                    RowBox[{"{", "#", "}"}], "}"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}]}], "]"}], "&"}], ",", 
                RowBox[{"Most", "[", 
                 RowBox[{"{", "a", "}"}], "]"}]}], "]"}], ",", 
              RowBox[{"matrixLevel2", "[", 
               RowBox[{"{", 
                RowBox[{"{", 
                 RowBox[{"Last", "[", 
                  RowBox[{"{", "a", "}"}], "]"}], "}"}], "}"}], "]"}]}], 
             "]"}], "]"}]}]}]}], ";", 
        RowBox[{"xPrint", "[", "$", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"xCirclePlus", "[", "a__", "]"}], "\[RuleDelayed]", 
           RowBox[{"Fold", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ArrayFlatten", "[", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"#1", ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", 
                    RowBox[{"-", "1"}]}], "}"}], "->", "#2"}]}], "]"}], "]"}],
               "&"}], ",", 
             RowBox[{"First", "[", "a", "]"}], ",", 
             RowBox[{"Rest", "[", "a", "]"}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"exp", ",", "$"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"matrixLevel2", "[", "exp_List", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"MatrixQ", "[", "$", "]"}]}], ",", 
          RowBox[{"$", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{"$", ",", "1"}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"expand2CT", "[", 
       RowBox[{"ispace_Integer", ",", "ones_"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$scal", ",", 
         RowBox[{"$", "=", "exp"}], ",", "$1", ",", 
         RowBox[{"$2", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"$4", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"$1s", "=", "ones"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "$", "]"}], "<", "2"}], ",", 
           RowBox[{"xDot", "[", "$", "]"}], ",", "$"}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<exp: \>\"", ",", "$"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$scal", "=", 
         RowBox[{"$", "//", 
          RowBox[{"tuExtractPattern", "[", 
           RowBox[{"scal", "[", "_", "]"}], "]"}]}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<$scal: \>\"", ",", "$scal"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$scal", "=", 
         RowBox[{
          RowBox[{"Apply", "[", 
           RowBox[{"Times", ",", "$scal"}], "]"}], "/.", 
          RowBox[{
           RowBox[{"scal", "[", "a_", "]"}], "\[Rule]", "a"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"$scal", "=!=", "1"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"$2", ",", "$scal"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"Apply", "[", 
            RowBox[{"List", ",", "$"}], "]"}], ",", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"MatchQ", "[", 
              RowBox[{"#", ",", 
               RowBox[{"scal", "[", "_", "]"}]}], "]"}]}], "&"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "$", "]"}], ">", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"$1", ",", "$"}], "}"}], "=", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"$", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"tuMemberQ", "[", 
              RowBox[{"$1", ",", 
               RowBox[{"{", 
                RowBox[{"X", "[", "_", "]"}], "}"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "$4", "]"}], ">", "0"}], ",", 
                RowBox[{
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"$2", ",", 
                   RowBox[{"Apply", "[", 
                    RowBox[{"xDot", ",", "$4"}], "]"}]}], "]"}], ";", 
                 RowBox[{"$4", "=", 
                  RowBox[{"{", "}"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"$2", ",", "$1"}], "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"$4", ",", "$1"}], "]"}]}], "\[IndentingNewLine]", 
            "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "$4", "]"}], ">", "0"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"$2", ",", 
            RowBox[{"Apply", "[", 
             RowBox[{"xDot", ",", "$4"}], "]"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ReplacePart", "[", 
               RowBox[{"$1s", ",", 
                RowBox[{"ispace", "->", "#"}]}], "]"}], "&"}], ",", "$2"}], 
            "]"}], "/.", 
           RowBox[{
            RowBox[{"X", "[", "a__", "]"}], "\[Rule]", "a"}]}], "/.", 
          "toDot"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Apply", "[", 
         RowBox[{"Dot", ",", "$"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"**", "**", "**"}], "*", "\[IndentingNewLine]", "Trace", " ", 
     RowBox[{"(", "Tr", ")"}], " ", "expansion", " ", "Rules"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuTrExpand", "=", 
     RowBox[{
      RowBox[{"tt", ":", 
       RowBox[{"Tr", "[", "_", "]"}]}], "\[RuleDelayed]", 
      RowBox[{
       RowBox[{"tuDistributeOp", "[", 
        RowBox[{"Tr", "[", "_", "]"}], "]"}], "[", "tt", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TrExpand", ":=", "tuTrExpand"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuTrSimplify", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTrSimplify", "::", "usage"}], "=", 
     "\"\<tuTrSimplify[scalars_List:{},product_:Times][exp_] simplifies Tr[] \
terms under product_ operation in exp_. Rules are applied to the terms \
Tr[product_[...]] accounting for Tr[] scalars_List. *16Jan2016*\>\""}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuTrSimplify", "[", 
       RowBox[{
        RowBox[{"scalars_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"product_:", "Times"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$s", ",", "scal", ",", 
         RowBox[{"iproduct", "=", 
          RowBox[{"Inactive", "[", "product", "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"scal", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"scalars", ",", 
            RowBox[{"Conjugate", "/@", "scalars"}]}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{"product", "\[Rule]", "iproduct"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Tr", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pp", ":", "iproduct"}], ")"}], "[", 
               RowBox[{"aa___", ",", 
                RowBox[{"Tr", "[", "a_", "]"}], ",", "b___"}], "]"}], "]"}], "->", 
             RowBox[{"Tr", "[", 
              RowBox[{"pp", "[", 
               RowBox[{"aa", ",", "a", ",", "b"}], "]"}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Tr", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pp", ":", "iproduct"}], ")"}], "[", 
               RowBox[{"a___", ",", " ", 
                SuperscriptBox["c_", 
                 RowBox[{"n_:", "1"}]], ",", "b___"}], "]"}], "]"}], 
             "\[RuleDelayed]", 
             RowBox[{
              RowBox[{"pp", "[", 
               RowBox[{
                SuperscriptBox["c", "n"], " ", ",", 
                RowBox[{"Tr", "[", 
                 RowBox[{"pp", "[", 
                  RowBox[{"a", ",", "b"}], "]"}], "]"}]}], "]"}], "/;", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"tuMemberQ", "[", 
                 RowBox[{"c", ",", "scal"}], "]"}], "||", 
                RowBox[{"NumericQ", "[", "c", "]"}], "||", 
                RowBox[{
                 RowBox[{"Head", "[", "c", "]"}], "===", "Tr"}]}], ")"}]}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Tr", "[", 
              RowBox[{"Tr", "[", "a_", "]"}], "]"}], "\[Rule]", 
             RowBox[{"Tr", "[", "a", "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Tr", "[", "0", "]"}], "\[Rule]", "0"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Tr", "[", "]"}], "\[Rule]", "1"}], ",", 
            "\[IndentingNewLine]", "tuTrExpand"}], 
           RowBox[{"(*", " ", 
            RowBox[{"BUG", ":", " ", 
             RowBox[{"placement", " ", "of", " ", "this", " ", "Rule", " ", 
              RowBox[{"matters", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
           "}"}], "//", "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Activate", "[", 
         RowBox[{
          RowBox[{"$", "//.", "$s"}], ",", "product"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTrEvaluate", "::", "usage"}], "=", 
     "\"\<tuTrEvaluate[matrixRule_List:{}][exp_] evalates Tr[] expressions in \
exp_ assuming that all elements of exp_ could be matrices as well.  An \
optional matrixRule_List is provided for substituting into exp_ before \
evaluation.  The action is to sum the Diagonal of the exp_ leaving each \
element of the diagonal as a possible Tr[] term as indicated by xTr[] \
*16Apr2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuTrEvaluate", "[", 
       RowBox[{"matrixRule_List:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"$", "/.", 
           RowBox[{"Tr", "\[Rule]", "xTr"}]}], "/.", "matrixRule"}]}], ";", 
        RowBox[{"xPrint", "[", "$", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"xTr", "[", "a_", "]"}], "\[RuleDelayed]", 
           RowBox[{"Thread", "[", 
            RowBox[{"xTr", "[", 
             RowBox[{"Diagonal", "[", "a", "]"}], "]"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"xTr", "[", "a_", "]"}], "\[RuleDelayed]", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"xTr", "[", "a", "]"}], ",", "Plus"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"Plus", ",", "$"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTrCanonicalOrder", "::", "usage"}], "=", 
     "\"\<tuTrCanonicalOrder[exp_Tr] Canonically orders Dot expression in \
exp_Tr[Dot[]]. EG: exp/.tt:Tr[a_]:>tuTrCanonicalOrder[tt] . \
*17Jun2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTrCanonicalOrder", "[", "exp_Tr", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", ",", "$low", ",", "$range"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$low", "=", 
         RowBox[{"$", "=", 
          RowBox[{
           RowBox[{"exp", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "/.", 
           RowBox[{"Dot", "\[Rule]", "List"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$range", "=", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "$", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"$", "=", 
            RowBox[{"Permute", "[", 
             RowBox[{"$", ",", 
              RowBox[{"Cycles", "[", 
               RowBox[{"{", "$range", "}"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"$range", ",", "$", ",", "$low", ",", 
             RowBox[{"OrderedQ", "[", 
              RowBox[{"{", 
               RowBox[{"$", ",", "$low"}], "}"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"OrderedQ", "[", 
              RowBox[{"{", 
               RowBox[{"$", ",", "$low"}], "}"}], "]"}], ",", 
             RowBox[{"$low", "=", "$"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"Length", "[", "$", "]"}], "}"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Tr", "[", 
         RowBox[{"Apply", "[", 
          RowBox[{"Dot", ",", "$low"}], "]"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Rules", " ", "for", " ", "simplifying", " ", "expressions", " ", "with", 
     " ", "metric", " ", 
     RowBox[{"tensor", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simpleMetric", "[", "g_", "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Tensor", "[", 
         RowBox[{"g", ",", 
          RowBox[{"{", 
           RowBox[{"Void", ",", "$a_"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"$b_", ",", "Void"}], "}"}]}], "]"}], "->", 
        RowBox[{"Tensor", "[", 
         RowBox[{"g", ",", 
          RowBox[{"{", 
           RowBox[{"$b", ",", "Void"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Void", ",", "$a"}], "}"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Tensor", "[", 
          RowBox[{"g", ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void"}], "}"}]}], "]"}], "|", 
         RowBox[{"Tensor", "[", 
          RowBox[{"g", ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], "->", "1"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Tensor", "[", 
          RowBox[{"g", ",", 
           RowBox[{"{", 
            RowBox[{"a_", ",", "a_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void"}], "}"}]}], "]"}], "|", 
         RowBox[{"Tensor", "[", 
          RowBox[{"g", ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"a_", ",", "a_"}], "}"}]}], "]"}]}], ":>", 
        RowBox[{
         RowBox[{"-", "1"}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", "a"}], "]"}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Tensor", "[", 
          RowBox[{"g", ",", 
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void"}], "}"}]}], "]"}], "|", 
         RowBox[{"Tensor", "[", 
          RowBox[{"g", ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"a_", ",", "b_"}], "}"}]}], "]"}]}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{
          RowBox[{"IntegerQ", "[", "a", "]"}], "&&", 
          RowBox[{"IntegerQ", "[", "b", "]"}], "&&", 
          RowBox[{"a", "=!=", "b"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Tensor", "[", 
          RowBox[{"g", ",", 
           RowBox[{"{", 
            RowBox[{"a_", ",", "Void"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "a_"}], "}"}]}], "]"}], "|", 
         RowBox[{"Tensor", "[", 
          RowBox[{"g", ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "a_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"a_", ",", "Void"}], "}"}]}], "]"}]}], ":>", 
        RowBox[{
         RowBox[{"-", "2"}], "/;", 
         RowBox[{"!", 
          RowBox[{"IntegerQ", "[", "a", "]"}]}]}]}]}], "\[IndentingNewLine]", 
      "}"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"**", "**", "**", "LeviCivita"}], " ", "routines"}], "******)"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuLeviCivitaProduct", "::", "usage"}], ":=", 
     "\"\<tuLeviCivitaProduct[dim_Integer,up_:ii,dn_:jj] produces a List of \
LeviCivita products summed over increasing number of indices from 0-to-dim_ \
indices in terms of Kronecker delta functions.  The index labels can be \
specified by up_ and dn_.  Ref: Wiki. *31Aug2018*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuLeviCivitaProduct", "[", 
      RowBox[{"dim_Integer", ",", 
       RowBox[{"up_:", "ii"}], ",", 
       RowBox[{"dn_:", "jj"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "$", ",", "$1", ",", "$list", ",", "$i", ",", "$ii", ",", "n", ",", 
         "$s\[Delta]", ",", "i$", ",", "j$", ",", "$s1"}], "}"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$s\[Delta]", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"\[Delta]", ",", "\"\<ud\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"i_Integer", ",", "i_Integer"}], "}"}]}], "]"}], 
            "\[Rule]", "1"}], ",", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"\[Delta]", ",", "\"\<ud\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"i_Integer", ",", "j_Integer"}], "}"}]}], "]"}], 
            "\[RuleDelayed]", 
            RowBox[{"0", "/;", 
             RowBox[{"i", "=!=", "j"}]}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$s1", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"a_", " ", 
              RowBox[{"T", "[", 
               RowBox[{"\[Delta]", ",", "\"\<ud\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "jd"}], "}"}]}], "]"}], 
              RowBox[{"T", "[", 
               RowBox[{"\[Delta]", ",", "\"\<ud\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"ju", ",", "i"}], "}"}]}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1"}], "}"}]}], "]"}], "\[Rule]", 
           RowBox[{
            RowBox[{"a", " ", 
             RowBox[{"T", "[", 
              RowBox[{"\[Delta]", ",", "\"\<ud\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"ju", ",", "jd"}], "}"}]}], "]"}]}], "-", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"a", " ", 
               RowBox[{"T", "[", 
                RowBox[{"\[Delta]", ",", "\"\<ud\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "jd"}], "}"}]}], "]"}], 
               RowBox[{"T", "[", 
                RowBox[{"\[Delta]", ",", "\"\<ud\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"ju", ",", "i"}], "}"}]}], "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "2", ",", "dim"}], "}"}]}], "]"}]}]}], "//", 
          
          RowBox[{"tuAddPatternVariable", "[", 
           RowBox[{"{", 
            RowBox[{"ju", ",", "jd"}], "}"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Delta]", ",", "\"\<ud\>\"", ",", 
             RowBox[{"{", 
              RowBox[{
               SubscriptBox["i$", "i"], ",", 
               SubscriptBox["j$", "j"]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "dim"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "dim"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"Det", "[", "$", "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"$list", "[", "0", "]"}], "=", 
         RowBox[{"$", "=", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Epsilon]", ",", 
               RowBox[{"Table", "[", 
                RowBox[{
                 SubscriptBox["i$", "i"], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "dim"}], "}"}]}], "]"}], ",", 
               RowBox[{"Table", "[", 
                RowBox[{"Null", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "dim"}], "}"}]}], "]"}]}], "]"}], 
             "\[IndentingNewLine]", 
             RowBox[{"T", "[", 
              RowBox[{"\[Epsilon]", ",", 
               RowBox[{"Table", "[", 
                RowBox[{"Null", ",", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", "dim"}], "}"}]}], "]"}], ",", 
               RowBox[{"Table", "[", 
                RowBox[{
                 SubscriptBox["j$", "j"], ",", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", "dim"}], "}"}]}], "]"}]}], "]"}]}], ")"}],
            "\[Rule]", "$"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"n", "=", "1"}], ",", 
          RowBox[{"n", "\[LessEqual]", "dim"}], ",", 
          RowBox[{"n", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$", "=", 
            RowBox[{
             RowBox[{"$", "/.", 
              RowBox[{
               SubscriptBox["j$", "n"], "\[Rule]", 
               SubscriptBox["i$", "n"]}]}], "/.", 
             RowBox[{
              SubscriptBox["i$", "n"], "\[Rule]", "$ii"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"$", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"$ii", ",", "dim"}], "}"}]}], "]"}], "/.", 
             "$s\[Delta]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "/.", 
             RowBox[{"$ii", "\[Rule]", 
              SubscriptBox["i$", "n"]}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "/.", "$s1"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$list", "[", "n", "]"}], "=", "$"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"$list", "[", "i", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "dim"}], "}"}]}], "]"}], "/.", 
          RowBox[{"i$", "\[Rule]", "up"}]}], "/.", 
         RowBox[{"j$", "\[Rule]", "dn"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "**)"}], "\[IndentingNewLine]", 
   RowBox[{"tuLeviCivitaExpand1", "//", "Clear"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuLeviCivitaExpand1", "::", "usage"}], "=", 
     "\"\<tuLeviCivitaExpand1[symbol_List:{},index_List:{0,1,2,3}][exp_] \
expands exp_ LeviCivita terms by summing over symbol_List (if provided) or \
all indices in the LeviCivita tensor using the index values provided by \
index_List. Metric factor is not yet accounted; assumes all positive values. \
*16Apr2019*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuLeviCivitaExpand1", "[", 
       RowBox[{
        RowBox[{"symbol_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"index_List:", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "2", ",", "3"}], "}"}]}]}], "]"}], "[", 
      "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "terms", ",", "indices", ",", "$index"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"Expand", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"terms", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"a_", " ", 
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Epsilon]", ",", "_", ",", "_"}], "]"}]}], "]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"iterm", "=", "1"}], ",", 
          RowBox[{"iterm", "\[LessEqual]", 
           RowBox[{"Length", "[", "terms", "]"}]}], ",", 
          RowBox[{"iterm", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$index", "=", 
            RowBox[{
             RowBox[{"tuExtractPattern", "[", 
              RowBox[{"Tensor", "[", 
               RowBox[{"\[Epsilon]", ",", "_", ",", "_"}], "]"}], "]"}], "[", 
             
             RowBox[{"terms", "[", 
              RowBox[{"[", 
               RowBox[{"iterm", ",", "2"}], "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"indices", "=", 
            RowBox[{"$index", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "symbol", "]"}], "\[Equal]", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"indices", "=", 
              RowBox[{"Select", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"!", 
                  RowBox[{"NumberQ", "[", "#", "]"}]}], "&"}]}], "]"}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"indices", "=", "symbol"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"indices", "=", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", "index"}], "}"}], "&"}], ",", "indices"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"terms", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"xSum", "[", 
              RowBox[{
               RowBox[{"terms", "[", 
                RowBox[{"[", 
                 RowBox[{"iterm", ",", "2"}], "]"}], "]"}], ",", 
               RowBox[{"Apply", "[", 
                RowBox[{"Sequence", ",", "indices"}], "]"}]}], "]"}], "/.", 
             RowBox[{"xSum", "\[Rule]", "Sum"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"terms", "[", 
             RowBox[{"[", 
              RowBox[{"iterm", ",", "2"}], "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"terms", "[", 
              RowBox[{"[", 
               RowBox[{"iterm", ",", "2"}], "]"}], "]"}], "/.", 
             RowBox[{
              RowBox[{"tt", ":", 
               RowBox[{"Tensor", "[", 
                RowBox[{"\[Epsilon]", ",", "_", ",", "_"}], "]"}]}], ":>", 
              RowBox[{
               RowBox[{"tuLeviCivitaNumeric", "[", "index", "]"}], "[", "tt", 
               "]"}]}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"tmp", ",", "terms"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuLeviCivitaExpand", "::", "usage"}], "=", 
     "\"\<tuLeviCivitaExpand[index_List,dimension_List:{1,2,3,4}][exp_] \
Sum[]s LeviCivita terms in exp_ over index_List for dimension_List. \
*14Jun2017*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuLeviCivitaExpand", "[", 
       RowBox[{"index_List", ",", 
        RowBox[{"dimension_List:", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}]}]}], "]"}], "[", 
      "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "rangelist", ",", "$test"}], "}"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuIndexSum", "[", 
           RowBox[{"index", ",", "dimension"}], "]"}]}]}], ";", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"rangelist", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", ",", "dimension"}], "}"}], "&"}], "/@", 
            "index"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"Fold", "[", 
            RowBox[{"Sum", ",", "tmp", ",", "rangelist"}], "]"}]}], ";", " ", 
          
          RowBox[{
          "Does", " ", "not", " ", "discriminate", " ", "between", " ", 
           "variables", " ", "and", " ", 
           RowBox[{"indices", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"0", " ", "for", " ", "duplicate", " ", "indices", 
          RowBox[{"(", 
           RowBox[{
           "Not", " ", "needed", " ", "due", " ", "to", " ", "Symmetry", " ", 
            
            RowBox[{"condition", "."}]}], ")"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"term", ":", 
            RowBox[{"(", 
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Epsilon]", ",", "up_List", ",", "dn_List"}], "]"}], 
             ")"}]}], "\[RuleDelayed]", 
           RowBox[{"0", "/;", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"$test", "=", 
                RowBox[{"DeleteCases", "[", " ", 
                 RowBox[{
                  RowBox[{"Join", "[", 
                   RowBox[{"up", ",", "dn"}], "]"}], ",", "Void"}], "]"}]}], 
               ")"}], "=!=", 
              RowBox[{"DeleteDuplicates", "[", "$test", "]"}]}], 
             ")"}]}]}]}]}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuLeviCivitaOrder", "::", "usage"}], "=", 
     "\"\<tuLeviCivitaOrder[tensor_Tensor] canonically orders indices of \
tensor_Tensor with up-indices before the down-indices, (\!\(\*SuperscriptBox[\
\(\[Epsilon]\), \(abc\)]\)\!\(\*SubscriptBox[\()\), \(def\)]\). Returns 0 if \
two indices are identical.  *14Jun2017*\>\""}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"tuLeviCivitaOrder", "[", "tensor_Tensor", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "tmps", ",", "u1", ",", "d1", ",", "u", ",", "d", ",", 
         "xx", ",", "yy", ",", "tmpx", ",", "tmpy", ",", "$sign"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"u1", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"d1", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"xx", "[", "#1", "]"}], ",", 
                RowBox[{"yy", "[", "#2", "]"}]}], "}"}], ",", 
              RowBox[{"_", "[", "Void", "]"}]}], "]"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"u1", ",", "d1"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmps", "=", 
         RowBox[{"Sort", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$sign", "=", 
         RowBox[{"-", 
          RowBox[{"Signature", "[", "tmp", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmpy", "=", 
         RowBox[{
          RowBox[{"tmps", "/.", 
           RowBox[{
            RowBox[{"xx", "[", "_", "]"}], "\[Rule]", "Void"}]}], "/.", 
          RowBox[{
           RowBox[{"yy", "[", "a_", "]"}], "\[Rule]", "a"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmpx", "=", 
         RowBox[{
          RowBox[{"tmps", "/.", 
           RowBox[{
            RowBox[{"yy", "[", "_", "]"}], "\[Rule]", "Void"}]}], "/.", 
          RowBox[{
           RowBox[{"xx", "[", "a_", "]"}], "\[Rule]", "a"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$sign", " ", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"tensor", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "tmpx", ",", "tmpy"}], 
          "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"TEST", "\[IndentingNewLine]", "$"}], "=", 
      RowBox[{"{", 
       RowBox[{"d", ",", "a", ",", "b", ",", "c"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"T", "[", 
       RowBox[{"\[Epsilon]", ",", "\"\<uddu\>\"", ",", "$"}], "]"}], "//", 
      "tuLeviCivitaOrder"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Order\[Epsilon]", "[", "tensor_Tensor", "]"}], ":=", 
     RowBox[{"tuLeviCivitaOrder", "[", "tensor", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"OrderAll\[Epsilon]", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"tt", ":", 
        RowBox[{"Tensor", "[", 
         RowBox[{"\[Epsilon]", ",", "a_", ",", "b_"}], "]"}]}], ":>", 
       RowBox[{"tuLeviCivitaOrder", "[", "tt", "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", "*)"}], 
   RowBox[{
    RowBox[{
     RowBox[{"tuLeviCivitaReduce2", "::", "usage"}], "=", 
     "\"\<tuLeviCivitaReduce2[exp_] contracts pairs of LeviCivita \[Epsilon] \
Tensors in exp_.\nLimitations: \[IndentingNewLine]Converts Tensor pairs into \
\[Delta]-form,\[IndentingNewLine]Only handles 2 \[Epsilon]'s at a time and \
the matching is not controlable,\n\tthe \[Epsilon]-Tensor must be of equal \
dimension,\[IndentingNewLine]there is uncertainty over sign convention. \nThe \
\[Epsilon]-Tensor indices will be ordered.\n*10Jan2019*16Apr2020*\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuLeviCivitaReduce2", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "pos", ",", "up", ",", "dn", ",", 
         "bad", ",", "i", ",", "pair", ",", "tmp1", ",", "tmp2", ",", "tmpd", 
         ",", "u1", ",", "u2", ",", "d1", ",", "d2", ",", "$u1", ",", "$u2", 
         ",", "$d1", ",", "$d2", ",", "ups", ",", "dns", ",", "E\[Epsilon]E", 
         ",", "E\[Epsilon]Epat", ",", "EEterm", ",", "dummies", ",", 
         "tindices", ",", "indices", ",", "n", ",", "m", ",", "\[Mu]", ",", 
         "\[Nu]"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E\[Epsilon]Epat", "=", 
         RowBox[{"(", 
          RowBox[{"EEterm", ":", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Epsilon]", ",", "$u1_List", ",", "$d1_List"}], "]"}], 
            
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Epsilon]", ",", "$u2_List", ",", "$d2_List"}], 
             "]"}]}]}], ")"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"E\[Epsilon]Epat", "\[RuleDelayed]", 
           RowBox[{"E\[Epsilon]E", "[", "EEterm", "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"E\[Epsilon]E", "[", "_", "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", "pos", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", 
           RowBox[{"Length", "[", "pos", "]"}]}], ",", 
          RowBox[{"i", "++"}], ",", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Go", " ", "through", " ", "all", " ", "\[Epsilon]"}], 
            "-", 
            RowBox[{"pair", " ", "index", " ", 
             RowBox[{"contractions", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pair", "=", 
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2", ",", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"dummies", ",", 
              RowBox[{"{", 
               RowBox[{"up", ",", "dn"}], "}"}], ",", "bad"}], "}"}], "=", 
            RowBox[{"tuIndexParser", "[", "pair", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"indices", "=", 
            RowBox[{"pair", "/.", 
             RowBox[{"E\[Epsilon]Epat", "->", 
              RowBox[{"{", 
               RowBox[{"$u1", ",", "$d1", ",", "$u2", ",", "$d2"}], 
               "}"}]}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"u1", ",", "d1", ",", "u2", ",", "d2"}], "}"}], "=", 
            "indices"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"indices", ",", "\"\< dummies \>\"", ",", "dummies"}], 
            "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"n", "=", 
                RowBox[{"Length", "[", "d1", "]"}]}], ")"}], "==", 
              RowBox[{"Length", "[", "d2", "]"}]}], ",", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{"\[Epsilon]", "'"}], "s", " ", "must", " ", "be", " ", 
               "of", " ", "equal", " ", 
               RowBox[{"dimension", "."}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"Build", " ", "pair", " ", "\[Delta]"}], "-", 
               RowBox[{"template", " ", "Wiki", " ", "Levi"}], "-", 
               RowBox[{"Civita", " ", "symbol", " ", 
                RowBox[{"e", "[", "7", "]"}]}]}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"m", "=", 
               RowBox[{
                RowBox[{"Length", "[", "dummies", "]"}], ">", "0"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tmp1", "=", " ", 
               RowBox[{"Product", "[", 
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"\[Delta]", ",", "\"\<du\>\"", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\[Mu]", "[", "i", "]"}], ",", 
                    RowBox[{"\[Nu]", "[", "i", "]"}]}], "}"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tmp1", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"n", "!"}], " ", "tmp1"}], "//", 
                RowBox[{"tuSymmetrizeSymbol", "[", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"\[Mu]", "[", "i", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "]"}]}]}], ";",
               "\[IndentingNewLine]", 
              RowBox[{"(*", "**)"}], "\[IndentingNewLine]", 
              RowBox[{"xPrint", "[", "tmp1", "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"PeskinSchroederMode", "===", "1"}], ",", 
                RowBox[{"tmp1", "=", 
                 RowBox[{"-", "tmp1"}]}]}], "]"}], ";", 
              RowBox[{"(*", 
               RowBox[{
               "PeskinSchroeder", " ", "sign", " ", "differs", " ", "from", 
                " ", 
                RowBox[{"Wiki", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"tmpd", "=", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", "indices", "]"}], ",", "Void"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"tmpd", "=", 
               RowBox[{"Thread", "[", 
                RowBox[{"Rule", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"\[Mu]", "[", "i", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "n"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"\[Nu]", "[", "i", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "}"}], "]"}], 
                  ",", "tmpd"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"xPrint", "[", "tmpd", "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tmp1", "=", 
               RowBox[{"tmp1", "/.", "tmpd"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"xPrint", "[", 
               RowBox[{"tmp1", ",", "\"\< :: \>\"", ",", "tmpd"}], "]"}], ";",
               "\[IndentingNewLine]", 
              RowBox[{"tmp1", "=", 
               RowBox[{
                RowBox[{"tmp1", "//", "Expand"}], "//", 
                RowBox[{"tuKroneckerDeltaEliminate", "[", 
                 RowBox[{"\[Delta]", ",", 
                  RowBox[{"{", 
                   RowBox[{"a", ",", "b"}], "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"xPrint", "[", "tmp1", "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"ups", "=", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{
                 RowBox[{"Join", "[", 
                  RowBox[{"u1", ",", "u2"}], "]"}], ",", "Void"}], "]"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"dns", "=", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{
                 RowBox[{"Join", "[", 
                  RowBox[{"d1", ",", "d2"}], "]"}], ",", "Void"}], "]"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"tmp1", "=", 
               RowBox[{
                RowBox[{"tmp1", "//", 
                 RowBox[{"tuIndicesRaise", "[", 
                  RowBox[{"ups", ",", "ups"}], "]"}]}], "//", 
                RowBox[{"tuIndicesLower", "[", 
                 RowBox[{"dns", ",", "dns"}], "]"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2"}], "]"}], "]"}], "=", "tmp1"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"tmp", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"E\[Epsilon]E", "[", "a_", "]"}], "\[Rule]", "a"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "/.", 
         RowBox[{
          RowBox[{"tt", ":", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Epsilon]", ",", "up_List", ",", "dn_List"}], "]"}]}], ":>", 
          RowBox[{"tuLeviCivitaOrder", "[", "tt", "]"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"simple2\[Epsilon]", "[", "exp_", "]"}], " ", "default", " ", 
      "for", " ", "4"}], "-", 
     RowBox[{"dim", " ", "space"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"simple2\[Epsilon]", "[", 
     RowBox[{"exp_", ",", "4"}], "]"}], ":=", 
    RowBox[{"tuLeviCivitaReduce2", "[", "exp", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"simple2\[Epsilon]", "[", "exp_", "]"}], ":=", 
    RowBox[{"tuLeviCivitaReduce2", "[", "exp", "]"}]}], "\[IndentingNewLine]",
    " ", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"Relabels", " ", "\[Epsilon]"}], "-", 
      RowBox[{
      "matrix", " ", "indices", " ", "contained", " ", "in", " ", "product", 
       " ", "terms", " ", "to", " ", "indices", " ", 
       RowBox[{"\[Epsilon]", "[", "1", "]"}]}]}], ",", 
     RowBox[{"\[Epsilon]", "[", "2", "]"}], ",", "..."}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Relabel\[Epsilon]", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "pos", ",", "ipos", ",", "tmpp", 
         ",", "pos\[Delta]", ",", "ipos\[Delta]", ",", "indices", ",", 
         "post"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"Expand", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Times", "[", 
            RowBox[{"a___", ",", 
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Epsilon]", ",", "_", ",", "_"}], "]"}], ",", 
             "b___"}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"ipos", "=", "1"}], ",", 
          RowBox[{"ipos", "\[LessEqual]", 
           RowBox[{"Length", "[", "pos", "]"}]}], ",", 
          RowBox[{"ipos", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmpp", "=", 
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"ipos", ",", "2"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"pos\[Delta]", "=", 
            RowBox[{"tmpp", "//", 
             RowBox[{"tuExtractPositionPattern", "[", 
              RowBox[{"Tensor", "[", 
               RowBox[{"\[Epsilon]", ",", "_", ",", "_"}], "]"}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"post", "=", 
            RowBox[{"tmpp", "//", 
             RowBox[{"tuExtractPositionPattern", "[", 
              RowBox[{"Tensor", "[", 
               RowBox[{"_", ",", "_", ",", "_"}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"ipos\[Delta]", "=", "1"}], ",", 
             RowBox[{"ipos\[Delta]", "\[LessEqual]", 
              RowBox[{"Length", "[", "pos\[Delta]", "]"}]}], ",", 
             RowBox[{"ipos\[Delta]", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"indices", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Apply", "[", 
                   RowBox[{"List", ",", 
                    RowBox[{"pos\[Delta]", "[", 
                    RowBox[{"[", 
                    RowBox[{"ipos\[Delta]", ",", "2"}], "]"}], "]"}]}], "]"}],
                   "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ";;", "3"}], "]"}], "]"}], "//", 
                 "Flatten"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"indices", "=", 
                RowBox[{"DeleteCases", "[", 
                 RowBox[{"indices", ",", "Void"}], "]"}]}], ";"}], 
              "\[IndentingNewLine]", ";", "\[IndentingNewLine]", 
              RowBox[{"indices", "=", 
               RowBox[{"MapThread", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"#1", ",", "#2"}], "}"}], "&"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"indices", ",", 
                   RowBox[{"Array", "[", 
                    RowBox[{"\[Epsilon]", ",", 
                    RowBox[{"Length", "[", "indices", "]"}]}], "]"}]}], 
                  "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"post", "=", 
               RowBox[{"post", "//", 
                RowBox[{"IndexChangeTU", "[", "indices", "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tmpp", "=", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"tmpp", ",", "post"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"ipos", ",", "2"}], "]"}], "]"}], "=", "tmpp"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"tmp", "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"tmp", ",", "pos"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Expands", " ", "and", " ", "changes", " ", "each", " ", "term", " ", 
     "in", " ", "expression", " ", "so", " ", "that", " ", "all", " ", 
     "\[Epsilon]", " ", "indices", " ", "are", " ", "in", " ", "down", " ", 
     RowBox[{"position", ".", "  ", "May"}], " ", "not", " ", "handle", " ", 
     "summing", " ", "over", " ", "2", " ", "\[Epsilon]", " ", 
     RowBox[{"tensors", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"All\[Epsilon]Down", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "pos", ",", "ipos", ",", "tmpp", 
         ",", "pos\[Epsilon]", ",", "ipos\[Epsilon]", ",", "indices"}], "}"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"Expand", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Times", " ", "terms", " ", "with", " ", "\[Epsilon]"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Times", "[", 
            RowBox[{"a___", ",", 
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Epsilon]", ",", "_", ",", "_"}], "]"}], ",", 
             "b___"}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"ipos", "=", "1"}], ",", 
          RowBox[{"ipos", "\[LessEqual]", 
           RowBox[{"Length", "[", "pos", "]"}]}], ",", 
          RowBox[{"ipos", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmpp", "=", 
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"ipos", ",", "2"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"pos\[Epsilon]", "=", 
            RowBox[{"tmpp", "//", 
             RowBox[{"tuExtractPositionPattern", "[", 
              RowBox[{"Tensor", "[", 
               RowBox[{"\[Epsilon]", ",", "_", ",", "_"}], "]"}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"ipos\[Epsilon]", "=", "1"}], ",", 
             RowBox[{"ipos\[Epsilon]", "\[LessEqual]", 
              RowBox[{"Length", "[", "pos\[Epsilon]", "]"}]}], ",", 
             RowBox[{"ipos\[Epsilon]", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"indices", "=", 
               RowBox[{
                RowBox[{"pos\[Epsilon]", "[", 
                 RowBox[{"[", "ipos\[Epsilon]", "]"}], "]"}], "  ", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"indices", "=", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{"indices", ",", "Void"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tmpp", "=", 
               RowBox[{"tmpp", "//", 
                RowBox[{"SwapUpDownIndices", "[", "indices", "]"}]}]}], 
              ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"ipos", ",", "2"}], "]"}], "]"}], "=", "tmpp"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"tmp", "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"tmp", ",", "pos"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuLeviCivitaSimplify", "::", "usage"}], "=", 
     "\"\<tuLeviCivitaSimplify[dimension_Integer][exp_] simplifies exp_ with \
dimension_-space LeviCivita Tensor[]s by zeroing terms with duplicate \
indices, expanding \[Epsilon] Tensor products into \[Delta]'s which are \
simple2\[Epsilon]'d, tests for sum\[Rule]0 of the EinsteinSum[] of LeviCivita \
terms (terms are zeroed if so.). *24Jul2013*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuLeviCivitaSimplify", "[", "dimension_Integer", "]"}], "[", 
      "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "up", ",", "dn", ",", "rest", ",", "pos", ",", "tensors", 
         ",", "test"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"0", " ", "for", " ", "duplicate", " ", "indices", 
         RowBox[{"(", 
          RowBox[{"Not", " ", "needed", " ", "due", " ", "to", " ", 
           RowBox[{"Symmetry", "."}]}], ")"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "/.", 
          RowBox[{
           RowBox[{"term", ":", 
            RowBox[{"(", 
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Epsilon]", ",", "up_List", ",", "dn_List"}], "]"}], 
             ")"}]}], "\[RuleDelayed]", 
           RowBox[{"0", "/;", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"test", "=", 
                RowBox[{"DeleteCases", "[", " ", 
                 RowBox[{
                  RowBox[{"Join", "[", 
                   RowBox[{"up", ",", "dn"}], "]"}], ",", "Void"}], "]"}]}], 
               ")"}], "=!=", 
              RowBox[{"DeleteDuplicates", "[", "test", "]"}]}], ")"}]}]}]}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Assign", " ", "numeric", " ", 
          RowBox[{"indices", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"ee", ":", 
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Epsilon]", ",", "up_List", ",", "dn_List"}], "]"}]}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"numericLeviCivita", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", "1", ",", "1", ",", "1", ",", "1", 
               ",", "1", ",", "1"}], "}"}], "]"}], "[", "ee", "]"}]}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Simplify", " ", "\[Epsilon]", " ", "Tensor", " ", 
          RowBox[{"pairs", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", "tmp", "]"}], "//", 
           RowBox[{
            RowBox[{"simple2\[Epsilon]", "[", 
             RowBox[{"#", ",", "dimension"}], "]"}], "&"}]}], "//", 
          "Expand"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{
           "raise", " ", "all", " ", "dummy", " ", "indices", " ", "in", " ", 
            "\[Epsilon]"}], "-", 
           RowBox[{"Tensor", "."}]}], ")"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"term", ":", 
            RowBox[{"HoldPattern", "[", 
             RowBox[{"Times", "[", "a__", "]"}], "]"}]}], ":>", 
           RowBox[{"raiseLeviCivitaDummyIndices", "[", "term", "]"}]}]}]}], 
        ";", "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"simplifyLeviCivita", "[", "dimension_Integer", "]"}], "[", 
      "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuLeviCivitaSimplify", "[", "dimension", "]"}], "[", "exp", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuLeviCivitaNumeric", "::", "usage"}], "=", 
     "\"\<tuLeviCivitaNumeric[metric_List][exp_Tensor]  evalates LeviCivita \
exp_Tensor. The metric_List specifies the diagonal of the metric, e.g., \
{-1,1,1,1} for this application and are used for raising indices of \
exp_Tensor. Assumes that indices are numbered from 0 and \
<Length[metric_List].  *16Apr2019*12Apr2020*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuLeviCivitaNumeric", "[", "metric_List", "]"}], "[", 
      "exp_Tensor", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "sym", ",", "up", ",", "dn", ",", 
         "indices", ",", "allnumeric"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"sym", ",", "up", ",", "dn"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "exp"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"indices", "=", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"up", "+", "dn"}], ")"}], "/.", 
            RowBox[{"Void", "\[Rule]", "0"}]}], ",", "Void"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"DuplicateFreeQ", "[", "indices", "]"}]}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"allnumeric", "=", 
         RowBox[{"!", 
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"NumericQ", "/@", "indices"}], ")"}], ",", "False"}], 
           "]"}]}]}], ";", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"xPrint", "[", 
           RowBox[{"indices", ",", "allnumeric"}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"allnumeric", "&&", 
           RowBox[{
            RowBox[{"Max", "[", "indices", "]"}], "<", 
            RowBox[{"Length", "[", "metric", "]"}]}]}], ",", 
          RowBox[{"(*", 
           RowBox[{
           "Test", " ", "indicies", " ", "to", " ", "see", " ", "if", " ", 
            "they", " ", "are", " ", "within", " ", "range", " ", "of", " ", 
            RowBox[{"dimension", "."}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Apply", " ", "metric", " ", "factors", " ", "for", " ", "Raising",
             " ", 
            RowBox[{"index", ".", " ", "The"}], " ", "first", " ", "index", 
            " ", "is", " ", "always", " ", "0", " ", "for", " ", "the", " ", 
            "time", " ", 
            RowBox[{"being", "."}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp", "=", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"metric", "[", 
                RowBox[{"[", 
                 RowBox[{"#", "+", "1"}], "]"}], "]"}], "&"}], ",", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{"dn", ",", "Void"}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"Apply", "[", 
             RowBox[{"Times", ",", 
              RowBox[{"Append", "[", 
               RowBox[{"tmp", ",", "1"}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", " ", 
             RowBox[{"Signature", "[", "indices", "]"}]}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"TEST", "\[IndentingNewLine]", 
       RowBox[{"T", "[", 
        RowBox[{"\[Epsilon]", ",", "\"\<uu\>\"", ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "2"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
       "%"}], "//", 
      RowBox[{
       RowBox[{"tuLeviCivitaNumeric", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1", ",", "1", ",", "1"}], "}"}], "]"}], 
       "\[IndentingNewLine]", "TEST", "\[IndentingNewLine]", 
       RowBox[{"T", "[", 
        RowBox[{"\[Epsilon]", ",", "\"\<duu\>\"", ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "3"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", "%"}]}], "//", 
     RowBox[{"tuLeviCivitaNumeric", "[", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], "]"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"numericLeviCivita", ":=", "tuLeviCivitaNumeric"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuLeviCivitaNumericF", "[", 
      RowBox[{"exp_", ",", 
       RowBox[{"symbol_:", "\[Epsilon]"}], ",", 
       RowBox[{"metric_:", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1", ",", "1", ",", "1"}], "}"}]}]}], 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"exp", "/.", " ", 
        RowBox[{
         RowBox[{"tt", ":", 
          RowBox[{"Tensor", "[", 
           RowBox[{"symbol", ",", "_", ",", "_"}], "]"}]}], ":>", 
         RowBox[{
          RowBox[{"tuLeviCivitaNumeric", "[", "metric", "]"}], "[", "tt", 
          "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"raiseLeviCivitaDummyIndices", "[", 
       RowBox[{"term_Times", "|", "Dot", "|", "xDot"}], "]"}], " ", "raises", 
      " ", "all", " ", "indices", " ", "of", " ", "LeviCivita", " ", "Tensor",
       " ", "in", " ", "term_Times"}], "|", "Dot", "|", 
     RowBox[{
      RowBox[{"xDot", "."}], "  ", "*", "15", "Oct2012"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"raiseLeviCivitaDummyIndices", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"term_", "?", "MemberQ"}], "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"Times", ",", "dotOps"}], "}"}], "]"}], ",", "#"}], "]"}], 
       "&"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "term"}], ",", "i", ",", "LCs", ",", "LCdn", ",",
          "dummies", ",", "dnup"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dummies", "=", 
         RowBox[{
          RowBox[{"tuIndexParser", "[", "tmp", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"LCs", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Epsilon]", ",", "up_List", ",", "dn_List"}], "]"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", "1"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "May", " ", "want", " ", "to", " ", "extend", " ", "to", " ", 
             "all", " ", "\[Epsilon]"}], "-", 
            RowBox[{
            "Tensors", " ", "where", " ", "the", " ", "last", " ", "one", " ",
              "encountered", " ", "is", " ", 
             RowBox[{"dominant", "."}]}]}], "*)"}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"LCdn", "=", 
            RowBox[{
             RowBox[{"tuIndexParser", "[", 
              RowBox[{"LCs", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"dnup", "=", 
            RowBox[{"Intersection", "[", 
             RowBox[{"LCdn", ",", "dummies"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"UpDownIndexSwap", "[", "dnup", "]"}], "[", "tmp", 
             "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"antisymmetrizeLeviCivitaCoef", "[", "term_", "]"}], " ", 
     "antisymmetrizes", " ", "over", " ", "dummy", " ", "indices", " ", "the",
      " ", "coefficient", " ", "of", " ", "the", " ", "first", " ", 
     "LeviCivita", " ", 
     RowBox[{"tensor", ".", "  ", "Symmetric"}], " ", "coefficients", " ", 
     "are", " ", 
     RowBox[{"zero", ".", " ", "UNTESTED"}], " ", "*", "16", "Oct2012"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"antisymmetrizeLeviCivitaCoef", "[", "term_Times", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "dum", ",", "LCs", ",", "LCind", ",", "antiInd", ",", "tmp1", ",", 
         "tmp2", ",", "i"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dum", "=", 
         RowBox[{
          RowBox[{"tuIndexParser", "[", "term", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"LCs", "=", 
         RowBox[{"term", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Epsilon]", ",", "up_List", ",", "dn_List"}], "]"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", "term"}], ";", 
        RowBox[{"tmp2", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", "1"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Length", "[", "LCs", "]"}], " ", "complicated", " ", 
            "if", " ", "there", " ", "more", " ", "than", " ", "one", " ", 
            "such", " ", 
            RowBox[{"Tensor", "."}]}], "*)"}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"LCind", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"tuIndexParser", "[", 
               RowBox[{"LCs", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "//", "Flatten"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"antiInd", "=", 
            RowBox[{"Intersection", "[", 
             RowBox[{"LCind", ",", "dum"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp2", "*=", 
            RowBox[{
             RowBox[{"LCs", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Delete", "[", 
                RowBox[{"tmp1", ",", 
                 RowBox[{"LCs", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "]"}], "//", 
               RowBox[{"AntiSymmetrizeIndices", "[", "antiInd", "]"}]}], 
              ")"}]}]}]}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
         "dum", ",", "LCs", ",", "LCind", ",", "antiInd", ",", "tmp2"}], 
         "}"}], ";", "\[IndentingNewLine]", "tmp2"}]}], "\[IndentingNewLine]",
       "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"symmetricCoefQ", "[", "term_", "]"}], " ", "determines", " ", 
     "if", " ", "the", " ", "coefficients", " ", "of", " ", 
     "LeviCivitaTensor", " ", "are", " ", "symmetric", " ", "over", " ", 
     "dummy", " ", "sum", " ", 
     RowBox[{"indices", ".", " ", "UNTESTED"}], " ", "*", "16", "Oct2012"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"symmetricCoefQ", "[", "term_Times", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "dum", ",", "LCs", ",", "LCind", ",", "antiInd", ",", "tmp1", ",", 
         "tmp2", ",", "i"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dum", "=", 
         RowBox[{
          RowBox[{"tuIndexParser", "[", "term", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"LCs", "=", 
         RowBox[{"term", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Epsilon]", ",", "up_List", ",", "dn_List"}], "]"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", "term"}], ";", 
        RowBox[{"tmp2", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", 
           RowBox[{"Length", "[", "LCs", "]"}]}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"LCind", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"tuIndexParser", "[", 
               RowBox[{"LCs", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "//", "Flatten"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"antiInd", "=", 
            RowBox[{"Intersection", "[", 
             RowBox[{"LCind", ",", "dum"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp2", "*=", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Delete", "[", 
               RowBox[{"tmp1", ",", 
                RowBox[{"LCs", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "]"}], "//", 
              RowBox[{"AntiSymmetrizeIndices", "[", "antiInd", "]"}]}], 
             ")"}]}]}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
         "dum", ",", "LCs", ",", "LCind", ",", "antiInd", ",", "tmp2"}], 
         "}"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp2", "\[Equal]", "0"}]}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Returns", " ", "a", " ", 
     RowBox[{"{", 
      RowBox[{"exp_", ",", " ", 
       RowBox[{
       "Down", " ", "index", " ", "version", " ", "of", " ", "exp_", " ", 
        "of", " ", "indices_List"}]}], "}"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"WithIndexDown", "[", "indices_List", "]"}], "[", "exp_", "]"}],
      ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"exp", ",", 
          RowBox[{"Fold", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"LowerIndex", "[", 
               RowBox[{"#2", ",", "#2"}], "]"}], "[", "#1", "]"}], "&"}], ",",
             "exp", ",", "indices"}], "]"}]}], "}"}], "//", "Flatten"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexChange", "::", "usage"}], "=", 
     "\"\<tuIndexChange[pairs_List][exp_] replaces indices in exp_ specified \
in pairs_List which is of form {{a,b},{c,d}}. In this case \
a\[Rule]b,c\[Rule]d. This routine can handle indices used in DerivOps. \
*5Sep2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexChange", "[", "pairs_List", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "rules", ",", "ipos", ",", "indices"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"rules", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Apply", "[", 
             RowBox[{"Rule", ",", "#"}], "]"}], "&"}], ",", 
           RowBox[{"Partition", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"{", "pairs", "}"}], "]"}], ",", "2"}], "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"exp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"_", ",", "_", ",", "_"}], "]"}], "|", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"_", ",", "_"}], "]"}], "&"}], ",", "DerivOps"}], 
             "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"ipos", "=", "1"}], ",", 
          RowBox[{"ipos", "\[LessEqual]", 
           RowBox[{"Length", "[", "pos", "]"}]}], ",", 
          RowBox[{"ipos", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"indices", "=", 
            RowBox[{
             RowBox[{"tuIndexParser", "[", 
              RowBox[{"pos", "[", 
               RowBox[{"[", "ipos", "]"}], "]"}], "]"}], "//", "Flatten"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", "ipos", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"pos", "[", 
              RowBox[{"[", "ipos", "]"}], "]"}], "//.", 
             RowBox[{
              RowBox[{"tuRuleSelect", "[", "rules", "]"}], "[", "indices", 
              "]"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"exp", ",", "pos"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"IndexChangeTU", "[", "pairs_List", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexChange", "[", "pairs", "]"}], "[", "exp", "]"}]}], 
    ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"UpDownSymmetrize", "[", "index_", "]"}], "[", "exp_", "]"}], 
     " ", "symmetrizes", " ", "UpDn", " ", "index_", " ", "in", " ", "exp_", 
     " ", "*", "11", "Apr2014"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"UpDownSymmetrize", "[", "index_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp1", ",", "tmp2", ",", "symSub"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"symSub", "[", "term_", "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"term", "+", 
              RowBox[{
               RowBox[{"UpDownIndexSwap", "[", "index", "]"}], "[", "term", 
               "]"}]}], ")"}], "/", "2"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", 
         RowBox[{"exp", "//", "Expand"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"symSub", "[", "#", "]"}], "&"}], ",", "tmp1"}], 
          "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Simplifies", " ", "\[Delta]uu"}], ",", "\[Delta]ud", ",", 
     "\[Delta]du", ",", 
     RowBox[{
      RowBox[{
      "\[Delta]dd", " ", "and", " ", "contractions", " ", "into", " ", 
       "standard", " ", 
       RowBox[{"form", ".", "  ", "Does"}], " ", "not", " ", "care", " ", 
       "about", " ", "Einstein", " ", 
       RowBox[{"notation", ".", " ", 
        RowBox[{"Usage", ":", " ", "exp_"}]}]}], "//.", 
      RowBox[{"simple\[Delta]", "[", "dim_", "]"}]}]}], "  ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"simple\[Delta]", "[", "\[Delta]_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"KroneckerAbsorb", "[", "\[Delta]", "]"}]}]}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{
         "This", " ", "only", " ", "works", " ", "with", " ", "UpDown", " ", 
          RowBox[{"\[Delta]", "'"}], "s"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"\[Delta]", "@", 
              RowBox[{"uu", "[", 
               RowBox[{"a_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
             RowBox[{
              RowBox[{"\[Delta]", "@", 
               RowBox[{"uu", "[", 
                RowBox[{"b", ",", "a"}], "]"}]}], "/;", 
              RowBox[{"OrderedQ", "[", 
               RowBox[{"b", ",", "a"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"\[Delta]", "@", 
              RowBox[{"dd", "[", 
               RowBox[{"a_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
             RowBox[{
              RowBox[{"\[Delta]", "@", 
               RowBox[{"dd", "[", 
                RowBox[{"b", ",", "a"}], "]"}]}], "/;", 
              RowBox[{"OrderedQ", "[", 
               RowBox[{"b", ",", "a"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"\[Delta]", "@", 
              RowBox[{"du", "[", 
               RowBox[{"a_", ",", "b_"}], "]"}]}], ":>", 
             RowBox[{
              RowBox[{"\[Delta]", "@", 
               RowBox[{"ud", "[", 
                RowBox[{"b", ",", "a"}], "]"}]}], "/;", 
              RowBox[{"OrderedQ", "[", 
               RowBox[{"b", ",", "a"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
             "Following", " ", "not", " ", "recognized", " ", "by", " ", 
              RowBox[{"KroneckerAbsorb", "[", "\[Delta]", "]"}]}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Delta]", "@", 
               RowBox[{"uu", "[", 
                RowBox[{"a_", ",", "b_"}], "]"}]}], 
              RowBox[{"\[Delta]", "@", 
               RowBox[{"dd", "[", 
                RowBox[{"a_", ",", "c_"}], "]"}]}]}], ":>", 
             RowBox[{"\[Delta]", "@", 
              RowBox[{"ud", "[", 
               RowBox[{"b", ",", "c"}], "]"}]}]}], ",", 
            RowBox[{"(*", " ", 
             RowBox[{"Einstein", " ", "sums"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Delta]", "@", 
               RowBox[{"uu", "[", 
                RowBox[{"a_", ",", "b_"}], "]"}]}], 
              RowBox[{"\[Delta]", "@", 
               RowBox[{"dd", "[", 
                RowBox[{"c_", ",", "a_"}], "]"}]}]}], ":>", 
             RowBox[{"\[Delta]", "@", 
              RowBox[{"ud", "[", 
               RowBox[{"b", ",", "c"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Delta]", "@", 
               RowBox[{"uu", "[", 
                RowBox[{"b_", ",", "a_"}], "]"}]}], 
              RowBox[{"\[Delta]", "@", 
               RowBox[{"dd", "[", 
                RowBox[{"a_", ",", "c_"}], "]"}]}]}], ":>", 
             RowBox[{"\[Delta]", "@", 
              RowBox[{"ud", "[", 
               RowBox[{"b", ",", "c"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Delta]", "@", 
               RowBox[{"uu", "[", 
                RowBox[{"b_", ",", "a_"}], "]"}]}], 
              RowBox[{"\[Delta]", "@", 
               RowBox[{"dd", "[", 
                RowBox[{"c_", ",", "a_"}], "]"}]}]}], ":>", 
             RowBox[{"\[Delta]", "@", 
              RowBox[{"ud", "[", 
               RowBox[{"b", ",", "c"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Delta]", ",", "a_List", ",", "b_List"}], "]"}], 
             "\[RuleDelayed]", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"GetBaseIndices", "[", 
                RowBox[{"First", "[", 
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{
                   RowBox[{"Join", "[", 
                    RowBox[{"a", ",", "b"}], "]"}], ",", "Void"}], "]"}], 
                 "]"}], "]"}], "]"}], "/;", 
              RowBox[{"Apply", "[", 
               RowBox[{"Equal", ",", 
                RowBox[{"DeleteCases", "[", 
                 RowBox[{
                  RowBox[{"Join", "[", 
                   RowBox[{"a", ",", "b"}], "]"}], ",", "Void"}], "]"}]}], 
               "]"}]}]}]}], "\[IndentingNewLine]", "}"}]}]}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Contracts", " ", "\[Delta]", " ", 
      RowBox[{"(", "KroneckerDelta", ")"}], " ", "indices", " ", "with", " ", 
      "other", " ", "expression", " ", 
      RowBox[{"indices", ".", " ", "Does"}], " ", "not", " ", "respect", " ", 
      "Einstein", " ", 
      RowBox[{"up", "/", "down"}], " ", 
      RowBox[{"notation", ".", " ", "KroneckerContract"}], " ", "works", " ", 
      "better", " ", "although", " ", "needs", " ", "up"}], "-", 
     RowBox[{"down", " ", 
      RowBox[{"convention", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Contract\[Delta]", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "pos", ",", "ipos", ",", "tmpp", 
         ",", "pos\[Delta]", ",", "ipos\[Delta]", ",", "indices", ",", "post",
          ",", "testindices"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"Expand", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Times", "[", 
            RowBox[{"a___", ",", 
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Delta]", ",", "_", ",", "_"}], "]"}], ",", "b___"}], 
            "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"List", "[", "pos", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"ipos", "=", "1"}], ",", 
          RowBox[{"ipos", "\[LessEqual]", 
           RowBox[{"Length", "[", "pos", "]"}]}], ",", 
          RowBox[{"ipos", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmpp", "=", 
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"ipos", ",", "2"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"pos\[Delta]", "=", 
            RowBox[{"tmpp", "//", 
             RowBox[{"tuExtractPositionPattern", "[", 
              RowBox[{"Tensor", "[", 
               RowBox[{"\[Delta]", ",", "_", ",", "_"}], "]"}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"List", "[", "pos\[Delta]", "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmpp", "=", 
            RowBox[{"tmpp", "/.", 
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"\[Delta]", ",", "_", ",", "_"}], "]"}], "\[Rule]", 
              "1"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"post", "=", 
            RowBox[{"tmpp", "//", 
             RowBox[{"tuExtractPositionPattern", "[", 
              RowBox[{"Tensor", "[", 
               RowBox[{"_", ",", "_", ",", "_"}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"ipos\[Delta]", "=", "1"}], ",", 
             RowBox[{"ipos\[Delta]", "\[LessEqual]", 
              RowBox[{"Length", "[", "pos\[Delta]", "]"}]}], ",", 
             RowBox[{"ipos\[Delta]", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"indices", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"Apply", "[", 
                  RowBox[{"List", ",", 
                   RowBox[{"pos\[Delta]", "[", 
                    RowBox[{"[", 
                    RowBox[{"ipos\[Delta]", ",", "2"}], "]"}], "]"}]}], "]"}],
                  "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ";;", "3"}], "]"}], "]"}], "//", "Flatten"}]}],
               ";", "\[IndentingNewLine]", 
              RowBox[{"indices", "=", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{"indices", ",", "Void"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "Check", " ", "if", " ", "indices", " ", "match", " ", "to", 
                " ", "see", " ", "if", " ", "\[Delta]", " ", "is", " ", 
                RowBox[{"consumed", "."}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"testindices", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"ParseTermIndices", "[", "tmpp", "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "//", "Flatten"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{"testindices", ",", 
                  RowBox[{"First", "[", "indices", "]"}]}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"post", "=", 
                  RowBox[{"post", "//", 
                   RowBox[{"IndexChangeTU", "[", 
                    RowBox[{"{", "indices", "}"}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"tmpp", "=", 
                  RowBox[{"ReplacePart", "[", 
                   RowBox[{"tmpp", ",", "post"}], "]"}]}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"tmpp", "=", 
                 RowBox[{"tmpp", " ", 
                  RowBox[{"pos\[Delta]", "[", 
                   RowBox[{"[", 
                    RowBox[{"ipos\[Delta]", ",", "2"}], "]"}], "]"}]}]}]}], 
               "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"ipos", ",", "2"}], "]"}], "]"}], "=", "tmpp"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"tmp", "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"tmp", ",", "pos"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Rules", " ", "for", " ", "expanding", " ", "Einstein", " ", "indices", 
     " ", "in", " ", 
     RowBox[{"Dot", "'"}], "d", " ", 
     RowBox[{"expression", ".", "  ", "Handles"}], " ", 
     RowBox[{
      RowBox[{"xPartialD", "[", "]"}], "'"}], "s", " ", "and", " ", "Uses", 
     " ", 
     RowBox[{"\[Eta]dd", "[", "]"}], " ", "as", " ", "coefficients", " ", 
     "in", " ", "sum", " ", "and", " ", "preference", " ", "for", " ", 
     "results", " ", "with", " ", "lower", " ", 
     RowBox[{"indices", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DotSumExpand", "[", "range_List", "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Tensor", "[", 
          RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ".", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"d_", ",", "e_"}], "]"}]}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Tensor", "[", 
              RowBox[{"a", ",", "b", ",", "c"}], "]"}], ".", 
             RowBox[{"xPartialD", "[", 
              RowBox[{"d", ",", "e"}], "]"}]}], "/.", 
            RowBox[{"e", "\[Rule]", "j"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "range"}], "}"}]}], "]"}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"b", ",", "e"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"xPartialD", "[", 
          RowBox[{"d_", ",", "e_"}], "]"}], ".", 
         RowBox[{"Tensor", "[", 
          RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}]}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"xPartialD", "[", 
              RowBox[{"d", ",", "e"}], "]"}], ".", 
             RowBox[{"Tensor", "[", 
              RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], "/.", 
            RowBox[{"e", "\[Rule]", "j"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "range"}], "}"}]}], "]"}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"b", ",", "e"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"xPartialD", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], ".", 
         RowBox[{"xPartialDu", "[", 
          RowBox[{"d_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"xPartialD", "[", 
             RowBox[{"a", ",", "b"}], "]"}], ".", 
            RowBox[{"xPartialDu", "[", 
             RowBox[{"d", ",", "b"}], "]"}]}], "/.", 
           RowBox[{"b", "\[Rule]", "j"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "range"}], "}"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"xPartialDu", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], ".", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"d_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"xPartialDu", "[", 
             RowBox[{"a", ",", "b"}], "]"}], ".", 
            RowBox[{"xPartialD", "[", 
             RowBox[{"d", ",", "b"}], "]"}]}], "/.", 
           RowBox[{"b", "\[Rule]", "j"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "range"}], "}"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"NOT", " ", "FINISHED", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Tensor", "[", 
           RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ".", 
          RowBox[{"Tensor", "[", 
           RowBox[{"d_", ",", "e_", ",", "f_"}], "]"}]}]}], "\[RuleDelayed]", 
        
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"\[Eta]uu", "[", 
              RowBox[{"e", ",", "e"}], "]"}], 
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"a", ",", "b", ",", "c"}], "]"}], ".", 
              RowBox[{"Tensor", "[", 
               RowBox[{"d", ",", "e", ",", "f"}], "]"}]}]}], "/.", 
            RowBox[{"e", "\[Rule]", "j"}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"j", ",", "range"}], "}"}], "//", "Flatten"}]}], "]"}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"b", ",", "e"}], "]"}]}]}], 
       RowBox[{"(*", 
        RowBox[{"FIND", " ", "mutual", " ", "index"}], "*)"}], 
       "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Rules", " ", "for", " ", "expanding", " ", "Einstein", " ", "indices", 
      " ", "in", " ", 
      RowBox[{"Dot", "'"}], "d", " ", 
      RowBox[{"expression", ".", "  ", "Handles"}], " ", 
      RowBox[{
       RowBox[{"xPartialDu", "[", "]"}], "'"}], "s", " ", "and", " ", "uses", 
      " ", 
      RowBox[{"\[Eta]dd", "[", "]"}], " ", "to", " ", "convert", " ", "from", 
      " ", "xPartialDu"}], "->", "xPartialD"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DotSumExpand\[Eta]", "[", "range_List", "]"}], ":=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Tensor", "[", 
          RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ".", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"d_", ",", "e_"}], "]"}]}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Tensor", "[", 
              RowBox[{"a", ",", "b", ",", "c"}], "]"}], ".", 
             RowBox[{"xPartialD", "[", 
              RowBox[{"d", ",", "e"}], "]"}]}], "/.", 
            RowBox[{"e", "\[Rule]", "j"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "range"}], "}"}]}], "]"}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"b", ",", "e"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Tensor", "[", 
          RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ".", 
         RowBox[{"xPartialDu", "[", 
          RowBox[{"d_", ",", "e_"}], "]"}]}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"a", ",", "b", ",", "c"}], "]"}], ".", 
              RowBox[{"xPartialD", "[", 
               RowBox[{"d", ",", "e"}], "]"}]}], 
             RowBox[{"\[Eta]uu", "[", 
              RowBox[{"e", ",", "e"}], "]"}]}], "/.", 
            RowBox[{"e", "\[Rule]", "j"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "range"}], "}"}]}], "]"}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"c", ",", "e"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"xPartialD", "[", 
          RowBox[{"d_", ",", "e_"}], "]"}], ".", 
         RowBox[{"Tensor", "[", 
          RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}]}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"xPartialD", "[", 
              RowBox[{"d", ",", "e"}], "]"}], ".", 
             RowBox[{"Tensor", "[", 
              RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], "/.", 
            RowBox[{"e", "\[Rule]", "j"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "range"}], "}"}]}], "]"}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"b", ",", "e"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"xPartialDu", "[", 
          RowBox[{"d_", ",", "e_"}], "]"}], ".", 
         RowBox[{"Tensor", "[", 
          RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}]}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"xPartialD", "[", 
               RowBox[{"d", ",", "e"}], "]"}], ".", 
              RowBox[{"Tensor", "[", 
               RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], 
             RowBox[{"\[Eta]uu", "[", 
              RowBox[{"e", ",", "e"}], "]"}]}], "/.", 
            RowBox[{"e", "\[Rule]", "j"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "range"}], "}"}]}], "]"}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"b", ",", "e"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"xPartialD", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], ".", 
         RowBox[{"xPartialDu", "[", 
          RowBox[{"d_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"xPartialD", "[", 
              RowBox[{"a", ",", "b"}], "]"}], ".", 
             RowBox[{"xPartialD", "[", 
              RowBox[{"d", ",", "b"}], "]"}]}], 
            RowBox[{"\[Eta]uu", "[", 
             RowBox[{"b", ",", "b"}], "]"}]}], "/.", 
           RowBox[{"b", "\[Rule]", "j"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "range"}], "}"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"xPartialDu", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], ".", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"d_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"xPartialD", "[", 
              RowBox[{"a", ",", "b"}], "]"}], ".", 
             RowBox[{"xPartialD", "[", 
              RowBox[{"d", ",", "b"}], "]"}]}], 
            RowBox[{"\[Eta]uu", "[", 
             RowBox[{"b", ",", "b"}], "]"}]}], "/.", 
           RowBox[{"b", "\[Rule]", "j"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "range"}], "}"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"NOT", " ", "FINISHED", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Tensor", "[", 
           RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ".", 
          RowBox[{"Tensor", "[", 
           RowBox[{"d_", ",", "e_", ",", "f_"}], "]"}]}]}], "\[RuleDelayed]", 
        
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"\[Eta]uu", "[", 
              RowBox[{"e", ",", "e"}], "]"}], 
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"a", ",", "b", ",", "c"}], "]"}], ".", 
              RowBox[{"Tensor", "[", 
               RowBox[{"d", ",", "e", ",", "f"}], "]"}]}]}], "/.", 
            RowBox[{"e", "\[Rule]", "j"}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"j", ",", "range"}], "}"}], "//", "Flatten"}]}], "]"}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"b", ",", "e"}], "]"}]}]}], 
       RowBox[{"(*", 
        RowBox[{"FIND", " ", "mutual", " ", "index"}], "*)"}], 
       "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"DotIndexSum", "[", 
      RowBox[{"exp_", ",", "range_List"}], "]"}], " ", "sums", " ", "indices",
      " ", "over", " ", "range_list", " ", "in", " ", 
     RowBox[{"Dot", "[", "]"}], " ", "expressions", " ", "in", " ", "exp_.", "  ",
      "This", " ", "routine", " ", "removes", " ", "difficiences", " ", "in", 
     " ", "NewIndexChangePatterns", " ", "and", " ", 
     RowBox[{
      RowBox[{"EinsteinSum", "[", "]"}], ".", "  ", "Replaces"}], " ", 
     RowBox[{"DotSumExpand", "[", "]"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DotIndexSum", "[", 
      RowBox[{"exp_", ",", "range_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"exp0", "=", "exp"}], ",", "tmp", ",", "onetime", ",", 
         "list", ",", "dlist", ",", "ilist", ",", "i", ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mname", "=", "\"\<DotIndexSum\>\""}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"exp0", "=", 
         RowBox[{"exp", "/.", 
          RowBox[{"Dot", "\[Rule]", "xDot"}]}]}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "Next", " ", "line", " ", "does", " ", "not", " ", "work", " ", 
           "with", " ", 
           RowBox[{"Dot", "[", "]"}]}], ",", " ", 
          RowBox[{"needs", " ", 
           RowBox[{"xDot", "[", "]"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"list", "=", 
         RowBox[{"exp0", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"xDot", "[", "__", "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"list", ",", 
            RowBox[{"Length", "[", "list", "]"}], ",", "onetime"}], "}"}], 
          ",", "\"\<list\>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", 
           RowBox[{"Length", "[", "list", "]"}]}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"dlist", "=", 
            RowBox[{
             RowBox[{"list", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}], "/.", 
             RowBox[{"xDot", "\[Rule]", "Dot"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"IfDEBUG", "[", 
            RowBox[{"mname", ",", 
             RowBox[{"DEBUG", ">", "0"}], ",", 
             RowBox[{"{", "dlist", "}"}], ",", "\"\<dlist\>\""}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ilist", "=", 
            RowBox[{
             RowBox[{"ParseTermIndices", "[", "dlist", "]"}], "//", 
             "First"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"dlist", "=", 
            RowBox[{"dlist", "//", 
             RowBox[{"EinsteinSum", "[", "range", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"IfDEBUG", "[", 
            RowBox[{"mname", ",", 
             RowBox[{"DEBUG", ">", "0"}], ",", 
             RowBox[{"{", 
              RowBox[{"ilist", ",", "dlist"}], "}"}], ",", 
             "\"\<ilist,dlist\>\""}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"dlist", "=", 
            RowBox[{"dlist", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"xPartialD", "[", 
                RowBox[{"a_", ",", "b_"}], "]"}], ".", "s___", ".", 
               RowBox[{"xPartialDu", "[", 
                RowBox[{"d_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"xPartialD", "[", 
                    RowBox[{"a", ",", "b"}], "]"}], ".", "s", ".", 
                   RowBox[{"xPartialDu", "[", 
                    RowBox[{"d", ",", "b"}], "]"}]}], "/.", 
                  RowBox[{"b", "\[Rule]", "j"}]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", "range"}], "}"}]}], "]"}], "/;", 
               RowBox[{"MemberQ", "[", 
                RowBox[{"ilist", ",", "b"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"dlist", "=", 
            RowBox[{"dlist", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"xPartialDu", "[", 
                RowBox[{"a_", ",", "b_"}], "]"}], ".", "s___", ".", 
               RowBox[{"xPartialD", "[", 
                RowBox[{"d_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"xPartialD", "[", 
                    RowBox[{"a", ",", "b"}], "]"}], ".", "s", ".", 
                   RowBox[{"xPartialDu", "[", 
                    RowBox[{"d", ",", "b"}], "]"}]}], "/.", 
                  RowBox[{"b", "\[Rule]", "j"}]}], ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"j", ",", "range"}], "}"}], "//", "Flatten"}]}], 
                "]"}], "/;", 
               RowBox[{"MemberQ", "[", 
                RowBox[{"ilist", ",", "b"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"list", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2"}], "]"}], "]"}], "=", "dlist"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"IfDEBUG", "[", 
            RowBox[{"mname", ",", 
             RowBox[{"DEBUG", ">", "0"}], ",", 
             RowBox[{"{", "list", "}"}], ",", "\"\<list\>\""}], "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "exp0", "]"}], "===", "xDot"}], ",", 
          RowBox[{"list", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ReplacePart", "[", 
           RowBox[{"exp0", ",", "list"}], "]"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DotIndexSum", "[", "range_List", "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"DotIndexSum", "[", 
     RowBox[{"exp", ",", "range"}], "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"Computes", " ", "Euler"}], "-", 
      RowBox[{
      "Lagrange", " ", "equation", " ", "for", " ", "single", " ", "field", 
       " ", 
       RowBox[{"(", "field_", ")"}], "given", " ", "Lagrangian_", " ", "and", 
       " ", "indices"}]}], ",", "  ", 
     RowBox[{
      RowBox[{
       RowBox[{"t_", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "2", ",", "3"}], "}"}], ".", "  ", 
         "Uses"}], " ", 
        RowBox[{"\[Eta]uu", "[", "]"}], " ", "for", " ", "summing", " ", 
        "over", " ", "indices", " ", "t_.", "  ", "Returns", " ", "Euler"}], 
       "-", 
       RowBox[{"Lagrange", " ", "equation"}]}], " ", "\[Rule]", " ", "0"}]}], 
    " ", "*)"}], 
   RowBox[{
    RowBox[{
     RowBox[{"EulerLagrange", "[", 
      RowBox[{"Lagrangian_", ",", "field_", ",", "t_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "tL", ",", "tEL", ",", "tEL0", ",", "tEL1", ",", "\[Mu]", 
         ",", "i", ",", "j", ",", "out", ",", "dfield", ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mname", "=", "\"\<EulerLagrange\>\""}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tL", "=", 
         RowBox[{"Lagrangian", "/.", 
          RowBox[{"DotSumExpand\[Eta]", "[", "t", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tL", "}"}], ",", "\"\<{tL}\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dfield", "=", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"field", ",", "\[Mu]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tEL", "=", 
         RowBox[{
          RowBox[{"xPartialD", "[", 
           RowBox[{
            RowBox[{"xPartialD", "[", 
             RowBox[{"tL", ",", 
              RowBox[{"xPartialD", "[", 
               RowBox[{"field", ",", "\[Mu]"}], "]"}]}], "]"}], ",", 
            "\[Mu]"}], "]"}], "-", 
          RowBox[{"xPartialD", "[", 
           RowBox[{"tL", ",", "field"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tEL0", "=", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"tL", ",", "field"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tEL0", "=", 
         RowBox[{"tEL0", "/.", 
          RowBox[{
           RowBox[{"xPartialD", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
           RowBox[{"D", "[", 
            RowBox[{"a", ",", "b"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"tEL1", "=", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"tL", ",", "dfield"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"tEL1", "=", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"tEL1", ",", "\[Mu]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "t", ",", "tEL1"}], "}"}], ",", 
          "\"\<{j,t,tEL1}\>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tEL1", "=", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{"tEL1", "/.", 
            RowBox[{"\[Mu]", "\[Rule]", "j"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "t"}], "}"}]}], "  ", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tEL1", "}"}], ",", "\"\<{tEL1}\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", 
           RowBox[{"Length", "[", "t", "]"}]}], ",", 
          RowBox[{"i", "++"}], ",", 
          RowBox[{"tEL1", "=", 
           RowBox[{"tEL1", "/.", 
            RowBox[{
             RowBox[{"xPartialD", "[", 
              RowBox[{"a_", ",", 
               RowBox[{"dfield", "/.", 
                RowBox[{"\[Mu]", "\[Rule]", 
                 RowBox[{"t", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}]}]}], "]"}], ":>", 
             RowBox[{"D", "[", 
              RowBox[{"a", ",", 
               RowBox[{"dfield", "/.", 
                RowBox[{"\[Mu]", "\[Rule]", 
                 RowBox[{"t", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}]}]}], "]"}]}]}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"out", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"tEL1", "-", "tEL0"}], "/.", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Derivative", "[", "__", "]"}], "[", "_", "]"}], "[", 
              "__", "]"}], "\[Rule]", "0"}]}], "//.", 
           RowBox[{"xPartialDExpand", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "_", "]"}]}], ",", 
              RowBox[{"\[Gamma]", "[", "_", "]"}]}], "}"}], "]"}]}], "//.", 
          "simpleDot"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"out", "\[Rule]", "0"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuBraKetSwap", "::", "usage"}], "=", 
     "\"\<tuBraKetSwap[exp_] convert Ket[] expressions into Bra[]'s and \
visa-versa by the ConjugateTranspose operator. *26Mar2017*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuBraKetSwap", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", 
         RowBox[{"reals", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"scalars", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"hermitean", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"ct", "=", "ConjugateTranspose"}], ",", 
         RowBox[{"cc", "=", "Conjugate"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"ct", "[", "$", "]"}], "//", 
          "tuConjugateTransposeExpand"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Convert", " ", 
          RowBox[{"ct", "[", 
           RowBox[{"Ket", "|", 
            RowBox[{
             RowBox[{"Bra", "[", "]"}], "s"}]}], "]"}], " ", "generated", " ",
           "above"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"$", "//.", 
           RowBox[{
            RowBox[{"ct", "[", 
             RowBox[{"Ket", "[", "a__", "]"}], "]"}], "\[RuleDelayed]", " ", 
            RowBox[{"Bra", "[", "a", "]"}]}]}], "//.", 
          RowBox[{
           RowBox[{"ct", "[", 
            RowBox[{"Bra", "[", "a__", "]"}], "]"}], "\[RuleDelayed]", " ", 
           RowBox[{"Ket", "[", "a", "]"}]}]}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuBraKetSimplify", "::", "usage"}], "=", 
     "\"\<tuBraKetSimplify[scalars_List] are Rules that simplify BraKet[] \
expressions.  Extracts scalars_ and NumericQ[] *20Feb2015*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuBraKetSimplify", "[", " ", 
      RowBox[{"scalars_List:", 
       RowBox[{"{", "}"}]}], "]"}], ":=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bb", ":", 
           RowBox[{"BraKet", "|", "Bra", "|", "Ket"}]}], ")"}], "[", 
         RowBox[{"a_", "+", "b_"}], "]"}], "\[Rule]", 
        RowBox[{
         RowBox[{"bb", "[", "a", "]"}], "+", 
         RowBox[{"bb", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bb", ":", 
           RowBox[{"BraKet", "|", "Bra", "|", "Ket"}]}], ")"}], "[", 
         RowBox[{"a_", " ", "b_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"a", " ", 
          RowBox[{"bb", "[", "b", "]"}]}], "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "a", "]"}], "||", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"a", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalars", ",", 
               SuperscriptBox["scalars", "_"]}], "}"}], "]"}]}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bb", ":", 
           RowBox[{"BraKet", "|", "Bra", "|", "Ket"}]}], ")"}], "[", "a_", 
         " ", "]"}], "\[RuleDelayed]", 
        RowBox[{"a", " ", "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "a", "]"}], "||", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"a", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalars", ",", 
               SuperscriptBox["scalars", "_"]}], "}"}], "]"}]}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bb", ":", 
           RowBox[{"BraKet", "|", "Bra", "|", "Ket"}]}], ")"}], "[", 
         RowBox[{"q1_", ",", 
          RowBox[{"a_", "+", "q2_"}]}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"bb", "[", 
          RowBox[{"q1", ",", "a"}], "]"}], "+", 
         RowBox[{"bb", "[", 
          RowBox[{"q1", ",", "q2"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bb", ":", 
           RowBox[{"BraKet", "|", "Bra", "|", "Ket"}]}], ")"}], "[", 
         RowBox[{
          RowBox[{"a_", "+", "q1_"}], ",", "q2_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"bb", "[", 
          RowBox[{"a", ",", "q2"}], "]"}], "+", 
         RowBox[{"bb", "[", 
          RowBox[{"q1", ",", "q2"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bb", ":", 
           RowBox[{"BraKet", "|", "Bra", "|", "Ket"}]}], ")"}], "[", 
         RowBox[{"q1_", ",", 
          RowBox[{"a_", "  ", "q2_"}]}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"a", " ", 
          RowBox[{"bb", "[", 
           RowBox[{"q1", ",", "q2"}], "]"}]}], "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "a", "]"}], "||", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"a", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalars", ",", 
               SuperscriptBox["scalars", "_"]}], "}"}], "]"}]}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bb", ":", 
           RowBox[{"BraKet", "|", "Bra", "|", "Ket"}]}], ")"}], "[", 
         RowBox[{
          RowBox[{"a_", " ", "q1_"}], ",", "  ", "q2_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"a", " ", 
          RowBox[{"bb", "[", 
           RowBox[{"q1", ",", "q2"}], "]"}]}], "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "a", "]"}], "||", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"a", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalars", ",", 
               SuperscriptBox["scalars", "_"]}], "}"}], "]"}]}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bb", ":", 
           RowBox[{"BraKet", "|", "Bra", "|", "Ket"}]}], ")"}], "[", 
         RowBox[{"q1_", ",", 
          RowBox[{"a_", "+", "b_"}], ",", "q2_"}], "]"}], "\[Rule]", 
        RowBox[{
         RowBox[{"bb", "[", 
          RowBox[{"q1", ",", "a", ",", "q2"}], "]"}], "+", 
         RowBox[{"bb", "[", 
          RowBox[{"q1", ",", "b", ",", "q2"}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bb", ":", 
           RowBox[{"BraKet", "|", "Bra", "|", "Ket"}]}], ")"}], "[", 
         RowBox[{"q1_", ",", 
          RowBox[{"a_", " ", "b_"}], ",", "q2_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"a", " ", 
          RowBox[{"bb", "[", 
           RowBox[{"q1", ",", "b", ",", "q2"}], "]"}]}], "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "a", "]"}], "||", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"a", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalars", ",", 
               SuperscriptBox["scalars", "_"]}], "}"}], "]"}]}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bb", ":", 
           RowBox[{"BraKet", "|", "Bra", "|", "Ket"}]}], ")"}], "[", 
         RowBox[{"q1_", ",", " ", 
          RowBox[{"b_", "/", "a_"}], ",", "q2_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{
          RowBox[{"bb", "[", 
           RowBox[{"q1", ",", "b", ",", "q2"}], "]"}], "/", "a"}], "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "a", "]"}], "||", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"a", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalars", ",", 
               SuperscriptBox["scalars", "_"]}], "}"}], "]"}]}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"bb", ":", 
           RowBox[{"BraKet", "|", "Bra", "|", "Ket"}]}], ")"}], "[", 
         RowBox[{"q1_", ",", "a_", ",", "q2_"}], " ", "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"a", " ", 
          RowBox[{"bb", "[", 
           RowBox[{"q1", ",", "q2"}], "]"}]}], " ", "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "a", "]"}], "||", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"a", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalars", ",", 
               SuperscriptBox["scalars", "_"]}], "}"}], "]"}]}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"Bra", "[", "]"}], " ", ".", " ", "A", " ", ".", " ", 
          RowBox[{"Ket", "[", "]"}]}], " ", "expressions"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{"Bra", "[", "a_", "]"}], ",", 
          RowBox[{"(", 
           RowBox[{"b_", "+", "c_"}], ")"}], " ", ",", 
          RowBox[{"Ket", "[", "d_", "]"}]}], "]"}], "\[Rule]", 
        RowBox[{
         RowBox[{"dd", "[", 
          RowBox[{
           RowBox[{"Bra", "[", "a", "]"}], ",", "b", ",", 
           RowBox[{"Ket", "[", "d", "]"}]}], "]"}], "+", 
         RowBox[{"d", "[", 
          RowBox[{
           RowBox[{"Bra", "[", "a", "]"}], ",", "c", ",", 
           RowBox[{"Ket", "[", "d", "]"}]}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{"Bra", "[", "a_", "]"}], " ", ",", " ", 
          RowBox[{"(", 
           RowBox[{"b_", "  ", "c_"}], ")"}], " ", ",", 
          RowBox[{"Ket", "[", "d_", "]"}]}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"b", " ", 
          RowBox[{"dd", "[", " ", 
           RowBox[{
            RowBox[{"Bra", "[", "a", "]"}], " ", ",", " ", "c", " ", ",", " ", 
            RowBox[{"Ket", "[", "d", "]"}]}], "]"}]}], "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "b", "]"}], "||", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"b", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalars", ",", 
               SuperscriptBox["scalars", "_"]}], "}"}], "]"}]}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{"Bra", "[", "a_", "]"}], ",", 
          RowBox[{"(", " ", 
           RowBox[{"c_", "/", "b_"}], ")"}], " ", ",", " ", 
          RowBox[{"Ket", "[", "d_", "]"}]}], "]"}], ":>", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"dd", "[", 
           RowBox[{
            RowBox[{"Bra", "[", "a", "]"}], " ", ",", " ", "c", " ", ",", 
            RowBox[{"Ket", "[", "d", "]"}]}], "]"}], "/", "b"}], "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "b", "]"}], "||", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"b", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalars", ",", 
               SuperscriptBox["scalars", "_"]}], "}"}], "]"}]}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{"Bra", "[", "a_", "]"}], ",", " ", "b_", ",", " ", 
          RowBox[{"Ket", "[", "d_", "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"b", " ", 
          RowBox[{"dd", "[", 
           RowBox[{
            RowBox[{"Bra", "[", "a", "]"}], ",", 
            RowBox[{"Ket", "[", "d", "]"}]}], "]"}]}], "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "b", "]"}], "||", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"b", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalars", ",", 
               SuperscriptBox["scalars", "_"]}], "}"}], "]"}]}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{"Bra", "[", "a_", "]"}], ",", 
          RowBox[{"(", 
           RowBox[{"1", "/", "b_"}], ")"}], " ", ",", 
          RowBox[{"Ket", "[", "d_", "]"}]}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{
          RowBox[{"dd", "[", 
           RowBox[{
            RowBox[{"Bra", "[", "a", "]"}], ",", 
            RowBox[{"Ket", "[", "d", "]"}]}], "]"}], "/", "b"}], "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "b", "]"}], "||", 
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"b", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalars", ",", 
               SuperscriptBox["scalars", "_"]}], "}"}], "]"}]}], 
           "]"}]}]}]}]}], "\[IndentingNewLine]", "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simpleBraKet", "[", " ", 
      RowBox[{"scalars_List:", 
       RowBox[{"{", "}"}]}], "]"}], ":=", 
     RowBox[{"tuBraKetSimplify", "[", "scalars", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Generates", " ", "a", " ", "list", " ", "of", " ", "Clifford", " ", 
     "algebra", " ", "basis", " ", "in", " ", "Wedge", " ", "form", 
     "\[IndentingNewLine]", "assuming", " ", "basis", " ", 
     RowBox[{"ed", "[", "i", "]"}], " ", "for", " ", "vector", " ", "space", 
     " ", "V", " ", "of", " ", "dimension", " ", 
     RowBox[{"d", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"WedgeClifBasis", "[", "d_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"Subsets", "[", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ed", "[", "#", "]"}], "&"}], ",", 
            RowBox[{"Table", "[", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "d"}], "}"}]}], "]"}]}], "]"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"\[ScriptCapitalC]\[ScriptL]", "[", 
           RowBox[{
            RowBox[{"V", "[", "d", "]"}], ",", "Q"}], "]"}], "->", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "#", "]"}], ">", "1"}], ",", 
               RowBox[{"Apply", "[", 
                RowBox[{"Wedge", ",", 
                 RowBox[{"Sequence", "[", "#", "]"}]}], "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", "#", "]"}], "==", "1"}], ",", 
                 RowBox[{"#", "//", "First"}], ",", 
                 RowBox[{"Id", "[", "d", "]"}]}], "]"}]}], 
              "\[IndentingNewLine]", "]"}], "&"}], ",", "tmp"}], 
           "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Wedge", " ", "Attributes"}], " ", "*)"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"Wedge", ",", 
      RowBox[{"Attributes", "[", "Dot", "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "TEST", " ", "removed", " ", "Attributes", " ", "to", " ", "be", " ", 
     "compatible", " ", "with", " ", 
     RowBox[{"diffgeo", ".", "m"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "/@", 
     RowBox[{"{", "tuWedgeSimplify1", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuWedgeSimplify1", "::", "usage"}], "=", 
     "\"\<tuWedgeSimplify1[keep_List:{difForm[_]}][exp_] Distributes Wedge \
exp_ over Plus expression and retains terms whose patterns are on the \
keep_List in the Wedge[] expression. The variables that are not on the \
keep_List are become coefficients of the Wedge[] as Dot[]d expression in \
order of appearance in the original Wedge expression. This is an alternative \
to tuWedgeSimplify. *12Apr2019*.\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuWedgeSimplify1", "[", 
       RowBox[{"keep_List:", 
        RowBox[{"{", 
         RowBox[{"difForm", "[", "_", "]"}], "}"}]}], "]"}], "[", "exp_", 
      "]"}], ":=", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$0", "=", "exp"}], ",", "$", ",", "$1", ",", "$vars", ",", 
         "$scal", ",", "$keep", ",", "$keepv"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"$0", "//", 
           RowBox[{"expandDot", "[", 
            RowBox[{"{", 
             RowBox[{"tuOpDistribute", "[", "Wedge", "]"}], "}"}], "]"}]}], "//",
           "Expand"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$vars", "=", 
         RowBox[{"$", "//", "tuVarsInExp"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$scal", "=", 
         RowBox[{"$vars", "//", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"tuHasNoneQ", "[", 
               RowBox[{"#", ",", "keep"}], "]"}], "&"}]}], "]"}], "&"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"$scal", "=", 
         RowBox[{
          RowBox[{"SortBy", "[", 
           RowBox[{"$scal", ",", "Depth"}], "]"}], "//", "Reverse"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$keep", "=", 
         RowBox[{"$vars", "//", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"tuHasAnyQ", "[", 
               RowBox[{"#", ",", "keep"}], "]"}], "&"}]}], "]"}], "&"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"$keepv", "=", 
         RowBox[{"tuVarsInExp", "[", "$keep", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$scal", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"$scal", ",", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"tuMemberQ", "[", 
              RowBox[{"#", ",", "$keepv"}], "]"}]}], "&"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$scal", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"$scal", "\[Rule]", "1"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$keep", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"$keep", "\[Rule]", "1"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"$", "/.", 
           RowBox[{
            RowBox[{"ww", ":", 
             RowBox[{"Wedge", "[", "__", "]"}]}], "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ww", "/.", "$keep"}], "/.", 
               RowBox[{"Wedge", "\[Rule]", "Dot"}]}], ")"}], ".", 
             RowBox[{"(", 
              RowBox[{"ww", "/.", "$scal"}], ")"}]}]}]}], "//", 
          RowBox[{"tuOpSimplifyF", "[", "dotOps", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"$", "//.", 
           RowBox[{
            RowBox[{"Wedge", "[", 
             RowBox[{"a___", ",", 
              RowBox[{"-", "b_"}], ",", "c___"}], "]"}], "\[Rule]", 
            RowBox[{"-", 
             RowBox[{"Wedge", "[", 
              RowBox[{"a", ",", "b", ",", "c"}], "]"}]}]}]}], "//.", 
          RowBox[{"tuOpSimplify", "[", "Wedge", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", "\[IndentingNewLine]", 
         RowBox[{"$", "//", 
          RowBox[{"tuOpSimplifyF", "[", "dotOps", "]"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", 
      RowBox[{"A", ".", " ", 
       RowBox[{"Wedge", "[", 
        RowBox[{"a", ",", "b", ",", 
         RowBox[{"Wedge", "[", 
          RowBox[{"c", ",", 
           RowBox[{"d", "+", "e"}]}], "]"}]}], "]"}]}], "\[IndentingNewLine]",
       "%"}], "//", 
     RowBox[{"tuWedgeSimplify1", "[", 
      RowBox[{"{", 
       RowBox[{"a", ",", "b", ",", "d"}], "}"}], "]"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuWedgeSimplify", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuWedgeSimplify", "::", "usage"}], "=", 
     "\"\<tuWedgeSimplify[scalar_List:{},product_:Times|dotOps,order_:\
NotOrdered][exp_] removes term in scalar_List from Wedge expressions in exp_. \
The scalar terms are dotted together with the simplified Wedge expression in \
order of appearance and to the left of the expression. In the event that \
there is an isolated scalar in a Wedge expression it will be brought out of \
the expression. order_ \[Rule]Ordered canonically orders the Wedge[](for \
1-forms only).  NOTE: The routine does not assume asymmetry of Wedge \
arguements. Inverse of scalars must be specified explicitly. \
*3Feb2016,22July2017*9May2018**5July2018**2Apr2020*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuWedgeSimplify", "[", 
       RowBox[{
        RowBox[{"scalar_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"productOp_:", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Times", "|", "dotOps"}], "]"}]}], ",", 
        RowBox[{"order_:", "NotOrdered"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", ",", "$tmp", ",", 
         RowBox[{"$cnt", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SetAttributes", "[", 
         RowBox[{"Wedge", ",", 
          RowBox[{"Attributes", "[", "Dot", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"SetAttributes", "[", 
         RowBox[{"xWedge", ",", 
          RowBox[{"Attributes", "[", "Dot", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", "exp"}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"$tmp", "=!=", "$"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$tmp", "=", "$"}], ";", "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "//", 
             RowBox[{"tuOpDistributeF", "[", 
              RowBox[{"Wedge", "|", "xWedge"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"remove", " ", "scalars", " ", 
             RowBox[{"PROBLEM", ":", " ", 
              RowBox[{
              "does", " ", "not", " ", "work", " ", "in", " ", "all", " ", 
               "cases"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "//.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"ww", ":", 
                   RowBox[{"Wedge", "|", "xWedge"}]}], ")"}], "[", " ", 
                 RowBox[{"a___", ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"op", ":", "productOp"}], ")"}], "[", 
                    RowBox[{"b1___", ",", 
                    SuperscriptBox["c1_", 
                    RowBox[{"n_:", "1"}]], ",", "b___"}], "]"}], ")"}], ",", 
                  "f___"}], "]"}], "\[RuleDelayed]", 
                RowBox[{
                 RowBox[{"op", "[", 
                  RowBox[{
                   SuperscriptBox["c1", "n"], ",", " ", 
                   RowBox[{"ww", "[", 
                    RowBox[{"a", ",", "b1", ",", "b", ",", "f"}], "]"}]}], 
                  "]"}], "/;", 
                 RowBox[{
                  RowBox[{"tuMemberQ", "[", 
                   RowBox[{"c1", ",", "scalar"}], "]"}], "||", 
                  RowBox[{"NumericQ", "[", "c1", "]"}]}]}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"ww", ":", 
                   RowBox[{"Wedge", "|", "xWedge"}]}], ")"}], "[", " ", 
                 RowBox[{"a___", ",", 
                  SuperscriptBox["c1_", 
                   RowBox[{"n_:", "1"}]], ",", "f___"}], "]"}], 
                "\[RuleDelayed]", 
                RowBox[{
                 RowBox[{
                  SuperscriptBox["c1", "n"], "  ", "\[CenterDot]", " ", 
                  RowBox[{"ww", "[", 
                   RowBox[{"a", ",", "f"}], "]"}]}], "/;", 
                 RowBox[{
                  RowBox[{"tuMemberQ", "[", 
                   RowBox[{"c1", ",", "scalar"}], "]"}], "||", 
                  RowBox[{"NumericQ", "[", "c1", "]"}]}]}]}]}], "}"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "//.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"ww", ":", 
                 RowBox[{"Wedge", "|", "xWedge"}]}], ")"}], "[", "a___", 
               "]"}], "\[RuleDelayed]", 
              RowBox[{"0", "/;", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"{", "a", "}"}], "]"}], "=!=", 
                RowBox[{"Length", "[", 
                 RowBox[{"DeleteDuplicates", "[", 
                  RowBox[{"{", "a", "}"}], "]"}], "]"}]}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"duplicate", " ", "arguements"}], " ", "\[Rule]", "0"}], 
            " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "//.", 
             RowBox[{
              RowBox[{"ww", ":", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Wedge", "|", "xWedge"}], ")"}], "[", "a_", "]"}]}], 
              "\[RuleDelayed]", 
              RowBox[{"a", "/;", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"{", "a", "}"}], "]"}], "\[Equal]", "1"}]}]}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "//.", 
             RowBox[{
              RowBox[{"ww", ":", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Wedge", "|", "xWedge"}], ")"}], "[", "a__", "]"}]}],
               "\[RuleDelayed]", 
              RowBox[{"0", "/;", 
               RowBox[{"MemberQ", "[", 
                RowBox[{
                 RowBox[{"{", "a", "}"}], ",", "0"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$", "//.", 
             RowBox[{"tuOpSimplify", "[", "dotOps", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "removes", " ", "Wedge", " ", "of", " ", "single", " ", 
             "arguement"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"order", " ", "===", " ", "Ordered"}], ",", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"Order", " ", "1"}], "-", 
               RowBox[{"forms", " ", "only"}]}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"$", "=", 
              RowBox[{"$", "/.", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"ww", ":", 
                   RowBox[{"Wedge", "|", "xWedge"}]}], ")"}], "[", "a__", 
                 "]"}], ":>", 
                RowBox[{
                 RowBox[{"Signature", "[", 
                  RowBox[{"{", "a", "}"}], "]"}], 
                 RowBox[{"ww", "[", 
                  RowBox[{"Apply", "[", 
                   RowBox[{"Sequence", ",", 
                    RowBox[{"Sort", "[", 
                    RowBox[{"{", "a", "}"}], "]"}]}], "]"}], "]"}]}]}]}]}]}], 
            "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", 
      RowBox[{"Wedge", "[", 
       RowBox[{"a", ",", 
        RowBox[{"b", "+", "c"}], ",", 
        RowBox[{"d", " ", "c"}]}], "]"}]}], "//", 
     RowBox[{"tuWedgeSimplify", "[", 
      RowBox[{"{", "c", "}"}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Simplifies", " ", "Wedge", " ", "expressions", " ", "leaving", " ", 
     "Wedge", " ", "arguement", " ", "in", " ", "canonical", " ", "order", 
     " ", "*", "16", "July2012"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SimpleWedge", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp0"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SetAttributes", "[", 
         RowBox[{"Wedge", ",", 
          RowBox[{"Attributes", "[", "Dot", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp0", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"Wedge", "[", "a__", "]"}], ":>", 
              RowBox[{
               RowBox[{
                RowBox[{"Signature", "[", 
                 RowBox[{"{", "a", "}"}], "]"}], 
                RowBox[{"Wedge", "[", 
                 RowBox[{"Apply", "[", 
                  RowBox[{"Sequence", ",", 
                   RowBox[{"Sort", "[", 
                    RowBox[{"{", "a", "}"}], "]"}]}], "]"}], "]"}]}], "/;", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"Wedge", "[", "a", "]"}], "]"}], ">", "1"}]}]}]}]}], 
           ";", 
           RowBox[{"(*", 
            RowBox[{"canonical", " ", "ordering"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "remove", " ", "Wedge", " ", "of", " ", "single", " ", 
             "variable"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"Wedge", "[", "a_", "]"}], ":>", 
              RowBox[{"a", "/;", 
               RowBox[{"MemberQ", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"Symbol", ",", "Tensor"}], "}"}], ",", 
                 RowBox[{"Head", "[", "a", "]"}]}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"ww", ":", 
               RowBox[{"Wedge", "[", "a_", "]"}]}], "\[RuleDelayed]", 
              RowBox[{"a", "/;", 
               RowBox[{
                RowBox[{"Length", "[", "ww", "]"}], "\[Equal]", "1"}]}]}]}]}],
            ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ClearAttributes", "[", 
         RowBox[{"Wedge", ",", "Flat"}], "]"}], ";", "\[IndentingNewLine]", 
        "tmp"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"ExpandWedge", "[", "scalar_List", "]"}], "[", "exp_", "]"}], 
     " ", "expands", " ", "Wedge", " ", "product", " ", "exp_", " ", 
     "accounting", " ", "for", " ", 
     RowBox[{"scalar_List", "."}], "  ", "*", "16", "July2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"WedgeSimplify", "[", 
       RowBox[{"scalar_List:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "sub", ",", "tmp0", ",", "xtmp"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SetAttributes", "[", 
         RowBox[{"Wedge", ",", 
          RowBox[{"Attributes", "[", "Dot", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp0", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"Wedge", "[", "a__", "]"}], ":>", 
              RowBox[{"ExpandWedge", "[", 
               RowBox[{"Wedge", "[", "a", "]"}], "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"Wedge", "[", 
               RowBox[{
               "c1___", ",", "a_", ",", "c2___", ",", "a_", ",", "c3___"}], 
               "]"}], ":>", 
              RowBox[{"0", "/;", 
               RowBox[{"MemberQ", "[", 
                RowBox[{"scalar", ",", "a"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"move", " ", "scalars", " ", "out", " ", "of", " ", 
             RowBox[{"Wedge", "[", "]"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"Wedge", "[", " ", 
               RowBox[{"a___", ",", 
                RowBox[{"c1_", "  ", "b_"}], ",", "f___"}], "]"}], 
              "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"c1", " ", 
                RowBox[{"Wedge", "[", 
                 RowBox[{"a", ",", "b", ",", "f"}], "]"}]}], "/;", 
               RowBox[{
                RowBox[{"ListMemberQ", "[", 
                 RowBox[{"c1", ",", "scalar"}], "]"}], "||", 
                RowBox[{"NumberQ", "[", "c1", "]"}]}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"Wedge", "[", 
               RowBox[{"a___", ",", "c1_", "  ", ",", "b___"}], "]"}], 
              "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"c1", " ", 
                RowBox[{"Wedge", "[", 
                 RowBox[{"a", "  ", ",", "b"}], "]"}]}], "/;", 
               RowBox[{
                RowBox[{"ListMemberQ", "[", 
                 RowBox[{"c1", ",", "scalar"}], "]"}], "||", 
                RowBox[{"NumberQ", "[", "c1", "]"}]}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", "SimpleWedge"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ClearAttributes", "[", 
         RowBox[{"Wedge", ",", "Flat"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "//", "ExpandAll"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"ExpandWedge", " ", "from", " ", "ExpandNCM", " ", 
     RowBox[{"example", ".", " ", "Not"}], " ", "needed", " ", "with", " ", 
     "SetAttributes", " ", 
     RowBox[{"above", "."}], " ", "*", "16", "July2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ExpandWedge", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"h", ":", "Wedge"}], ")"}], "[", 
       RowBox[{"a___", ",", "b_Plus", ",", "c___"}], "]"}], "]"}], ":=", 
     RowBox[{"Distribute", "[", 
      RowBox[{
       RowBox[{"h", "[", 
        RowBox[{"a", ",", "b", ",", "c"}], "]"}], ",", "Plus", ",", "h", ",", 
       "Plus", ",", 
       RowBox[{
        RowBox[{"ExpandWedge", "[", 
         RowBox[{"h", "[", "##", "]"}], "]"}], "&"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ExpandWedge", "[", "a_", "]"}], ":=", 
     RowBox[{"ExpandAll", "[", "a", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ExteriorDContract", "[", 
        RowBox[{"scalars_List", ",", "constants_List"}], "]"}], "[", "exp_", 
       "]"}], " ", "contracts", " ", 
      RowBox[{"ExteriorD", "[", "a_", "]"}], 
      RowBox[{
       RowBox[{"PartialD", "[", "l_", "]"}], "[", 
       RowBox[{"b_", ",", "a_"}], "]"}]}], " ", "\[Rule]", " ", 
     RowBox[{
      RowBox[{"ExteriorD", "[", "b", "]"}], " ", "*", "16", "July2012"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "ExteriorDContract", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ExteriorDContract", "[", "exp_", "]"}], ":=", 
     RowBox[{"exp", "//.", 
      RowBox[{
       RowBox[{"HoldPattern", " ", "[", 
        RowBox[{
         RowBox[{"ExteriorD", "[", "a_", "]"}], 
         RowBox[{
          RowBox[{"PartialD", "[", "l_", "]"}], "[", 
          RowBox[{"b_", ",", "a_"}], "]"}]}], "]"}], "\[Rule]", 
       RowBox[{"ExteriorD", "[", "b", "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ExteriorDContract", "[", 
       RowBox[{"scalars_List", ",", "constants_List"}], "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp0", ",", "xtmp"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp0", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"WedgeSimplify", "[", 
              RowBox[{"Join", "[", 
               RowBox[{"scalars", ",", "constants"}], "]"}], "]"}], "[", 
             "tmp", "]"}]}], ";", 
           RowBox[{"(*", 
            RowBox[{"Expand", " ", "Wedge", " ", 
             RowBox[{"ExteriorD", "[", "exp_", "]"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", "ExteriorDContract"}]}], ";", 
           RowBox[{"(*", 
            RowBox[{
            "Contracts", " ", "PartialD", " ", "ExteriorD", " ", 
             "expressions"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"ExteriorD", "[", 
               RowBox[{"c1_", " ", "a__"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{
                RowBox[{"Wedge", "[", 
                 RowBox[{
                  RowBox[{"ExteriorD", "[", "c1", "]"}], ",", "a"}], "]"}], 
                "+", 
                RowBox[{"c1", " ", 
                 RowBox[{"Wedge", "[", "a", "]"}]}]}], "/;", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"c1", ",", "scalars"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"ExteriorD", "[", "a_", "]"}], "\[RuleDelayed]", 
              RowBox[{"0", "/;", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "constants"}], "]"}]}]}]}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ExpandExteriorD0", "[", 
        RowBox[{"scalars_List", ",", "constants_List"}], "]"}], "[", "exp_", 
       "]"}], " ", "expands", " ", 
      RowBox[{"ExteriorD", "[", "]"}], " ", "in", " ", "exp_", " ", "based", 
      " ", "upon", " ", "scalars_List"}], ",", 
     RowBox[{
      RowBox[{"constants_List", ".", "  ", "Overlaps"}], " ", "with", " ", 
      RowBox[{"ExpandExteriorD", "."}], " ", "*", "17", "July2012"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ExpandExteriorD0", "[", 
       RowBox[{"scalars_List", ",", "constants_List"}], "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp0", ",", 
         RowBox[{"d", "=", "ExteriorD"}], ",", "xtmp"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp0", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", 
             RowBox[{"WedgeSimplify", "[", 
              RowBox[{"Join", "[", 
               RowBox[{"scalars", ",", "constants"}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"d", "[", 
               RowBox[{"a_", "  ", "b__"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"Wedge", "[", 
                RowBox[{
                 RowBox[{"d", "[", "a", "]"}], ",", "b"}], "]"}], "+", 
               RowBox[{"Wedge", "[", 
                RowBox[{"a", ",", " ", 
                 RowBox[{"d", "[", 
                  RowBox[{"Times", "[", "b", "]"}], "]"}]}], "]"}]}]}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"d", "[", 
               RowBox[{"d", "[", "a__", " ", "]"}], "]"}], "->", "0"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"d", "[", "a_", "]"}], "\[RuleDelayed]", 
              RowBox[{"0", "/;", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "constants"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"d", "[", 
               RowBox[{"Wedge", "[", 
                RowBox[{"a_", ",", "b__"}], "]"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"Wedge", "[", 
                RowBox[{
                 RowBox[{"d", "[", "a", "]"}], ",", "b"}], "]"}], "-", 
               RowBox[{"Wedge", "[", 
                RowBox[{"a", ",", 
                 RowBox[{"d", "[", 
                  RowBox[{"Wedge", "[", "b", "]"}], "]"}]}], "]"}]}]}]}]}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "tmp"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "******)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"dDifForm", "[", 
       RowBox[{"scalars_List", ",", "constants_List"}], "]"}], "[", "exp_", 
      "]"}], " ", "computes", " ", "the", " ", "exterior", " ", "derivative", 
     " ", "of", " ", "exp_", " ", "accounting", " ", "for", " ", 
     "scalars_List", " ", "and", " ", 
     RowBox[{"constants_List", "."}], "  ", "*", "27", "Mar2013"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"dDifForm", "[", 
       RowBox[{"scalars_List", ",", "constants_List"}], "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"difForm", "[", "exp", "]"}]}], ",", "tmp0"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp0", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"WedgeSimplify", "[", 
              RowBox[{"Join", "[", 
               RowBox[{"scalars", ",", "constants"}], "]"}], "]"}], "[", 
             "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{"a_", " ", "b__"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"Wedge", "[", 
                RowBox[{
                 RowBox[{"difForm", "[", "a", "]"}], ",", "b"}], "]"}], "/;", 
               
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "scalars"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{"difForm", "[", "a__", " ", "]"}], "]"}], "->", 
              "0"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", 
             RowBox[{"\[Delta]Expand", "[", 
              RowBox[{"difForm", ",", "constants"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"difForm", "[", "a_", "]"}], "\[RuleDelayed]", 
              RowBox[{"0", "/;", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "constants"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{"Wedge", "[", 
                RowBox[{"a_", ",", "b__"}], "]"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"Wedge", "[", 
                RowBox[{
                 RowBox[{"difForm", "[", "a", "]"}], ",", "b"}], "]"}], "+", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"-", "1"}], ")"}], "^", 
                 RowBox[{"Length", "[", 
                  RowBox[{"{", "a", "}"}], "]"}]}], 
                RowBox[{"Wedge", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"difForm", "[", 
                   RowBox[{"Wedge", "[", "b", "]"}], "]"}]}], "]"}]}]}]}]}]}],
            ";", 
           RowBox[{"(*", "INCORRECT", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{"Wedge", "[", "a_", "]"}], "]"}], "\[Rule]", 
              RowBox[{"Wedge", "[", 
               RowBox[{"difForm", "[", "a", "]"}], "]"}]}]}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{" ", 
       RowBox[{
        RowBox[{
        "stdDifForm", " ", "may", " ", "replace", " ", "the", " ", "need", 
         " ", "for", " ", "this", " ", 
         RowBox[{"routine", ".", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"dDifFormX", "[", 
            RowBox[{
            "constants_List", ",", "scalars_List", ",", "forms_List"}], 
            "\[IndentingNewLine]", "]"}], "[", "exp_", "]"}]}], " ", 
         "expands", " ", 
         RowBox[{"difForm", "[", "]"}], " ", "where", " ", "constants_List"}],
         ",", "scalars_List", ",", 
        RowBox[{"forms_List", " ", "are", " ", 
         RowBox[{
         "specified", ".", "  ", "\[IndentingNewLine]", "forms_List"}], " ", 
         "are", " ", "as", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a", ",", "na"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"b", ",", "nb"}], "}"}]}], "}"}]}]}], "}"}], " ", "where",
       " ", "na"}], ",", 
     RowBox[{
      RowBox[{"nb", " ", "are", " ", "n"}], "-", 
      RowBox[{"form", " ", "values", " ", "for", " ", "a"}]}], ",", 
     RowBox[{
      RowBox[{"b", ".", "  ", "\[IndentingNewLine]", 
       RowBox[{"Restrictions", ":", " ", 
        RowBox[{"a_", " ", "must", " ", "not", " ", "have", " ", 
         RowBox[{"Times", "[", "]"}], " ", "operations", " ", "only", " ", 
         "have", " ", "ProductOp"}]}]}], "=", 
      RowBox[{
       RowBox[{"Dot", "|", "xDot", "|", 
        RowBox[{"Wedge", ".", "\[IndentingNewLine]", 
         RowBox[{"Usage", ":", " ", "exp_"}]}]}], "//.", 
       RowBox[{
        RowBox[{"difForm", "[", "a_", "]"}], ":>", 
        RowBox[{
         RowBox[{
          RowBox[{"dDifFormX", "[", 
           RowBox[{"constants_List", ",", "scalars_List", ",", "forms_List"}],
            "]"}], "[", "a", "]"}], "\[IndentingNewLine]", "*", "31", 
         "July2014"}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"dDifFormX", "[", 
       RowBox[{"constants_List", ",", "scalars_List", ",", "forms_List"}], 
       "\[IndentingNewLine]", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "tmp0", ",", "pos", ",", "xdForm", ",", "dForms", ",", 
         RowBox[{"ProductOp", "=", 
          RowBox[{"Dot", "|", "xDot", "|", "CenterDot", "|", "Times"}]}], ",",
          "xtmp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"stdDifForm", "[", 
           RowBox[{"constants", ",", "scalars", ",", "forms"}], "]"}], "[", 
          "exp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<exp_:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"op", ":", "ProductOp"}], ")"}], "->", "Wedge"}]}]}], ";", 
        RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "->", 
              RowBox[{"dForm", "[", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "&"}], ",", 
            "forms"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"dd", ":", 
            RowBox[{"difForm", "[", "a_", "]"}]}], ":>", 
           RowBox[{
            RowBox[{"dForm", "[", 
             RowBox[{"a", ",", "1"}], "]"}], "/;", 
            RowBox[{"ListMemberQ", "[", 
             RowBox[{"a", ",", "scalars"}], "]"}]}]}]}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<B:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"SimplexWedge", "[", 
           RowBox[{"constants", ",", "scalars", ",", "forms"}], "]"}], "[", 
          "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<C:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Apply", " ", "difForm"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"difForm", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"\[Delta]Expand", "[", "difForm", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"op", ":", "ProductOp"}], ")"}], "->", "Wedge"}]}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"SimplexWedge", "[", 
           RowBox[{"constants", ",", "scalars", ",", "forms"}], "]"}], "[", 
          "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<E:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp0", "=!=", "tmp"}], ",", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"df", ":", 
               RowBox[{"difForm", "[", "a_", "]"}]}], ":>", 
              RowBox[{"Distribute", "[", "df", "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"tmp", "/.", 
               RowBox[{"Wedge", "->", "xWedge"}]}], "//.", 
              RowBox[{
               RowBox[{"difForm", "[", 
                RowBox[{"xWedge", "[", 
                 RowBox[{"a_", ",", "b__"}], "]"}], "]"}], "\[RuleDelayed]", 
               RowBox[{
                RowBox[{"xWedge", "[", 
                 RowBox[{
                  RowBox[{"difForm", "[", "a", "]"}], ",", "b"}], "]"}], "+", 
                
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"-", "1"}], ")"}], "^", 
                  RowBox[{"nForm", "[", "a", "]"}]}], 
                 RowBox[{"xWedge", "[", 
                  RowBox[{"a", ",", 
                   RowBox[{"difForm", "[", 
                    RowBox[{"xWedge", "[", "b", "]"}], "]"}]}], "]"}]}]}]}]}],
              "/.", 
             RowBox[{"xWedge", "->", "Wedge"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<F:\>\"", ",", "tmp"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"SimplexWedge", "[", 
              RowBox[{"constants", ",", "scalars", ",", "forms"}], "]"}], "[",
              "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"xReturn", "[", "tmp", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<G:\>\"", ",", "tmp"}], "]"}], ";", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "//", 
            RowBox[{"stdDifForm", "[", 
             RowBox[{"constants", ",", "scalars", ",", "forms"}], "]"}]}]}], 
          ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"SimplexWedge", "[", 
           RowBox[{"constants", ",", "scalars", ",", "forms"}], "]"}], "[", 
          "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<H:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDifFormWedgeSimplify", "::", "usage"}], "=", 
     "\"\<tuDifFormWedgeSimplify[constants_List,scalars_List,forms_List][EXP_]\
 simplifies Wedge, dForm, difForm expressions in EXP_.  Converts ProductOp[] \
into Wedge[]. The scalars/forms differences are distinguished by scalar_List. \
Return an expression that is { not Distributable in Wedge[], constants_List \
and scalars_List(dotted in order) to the left of each \
term,\[IndentingNewLine]no Times[] terms}.  EXP_ can have a mix of DF's.  All \
forms are specified by DF's. Used in dDifFormX[]. \
*31Jul2014*28Jun2019**2Apr2020*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SimplexWedge", ":=", "tuDifFormWedgeSimplify"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDifFormWedgeSimplify", "[", 
       RowBox[{"constants_List", ",", "scalars_List", ",", "forms_List"}], 
       "]"}], "[", "EXP_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "EXP"}], " ", ",", "tmp0", ",", 
         RowBox[{"DF", "=", 
          RowBox[{"{", 
           RowBox[{"dForm", ",", "difForm"}], "}"}]}], ",", 
         RowBox[{"formLabels", "=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", "forms"}], "]"}]}], 
         ",", 
         RowBox[{"loop", "=", "0"}], ",", 
         RowBox[{"ProductOp", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"dotOps", "|", "Times", "|", "xWedge"}], "]"}]}], ",", "a",
          " ", ",", 
         RowBox[{"$cnt", "=", "0"}]}], "\[IndentingNewLine]", "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{"tuOpSimplify", "[", "dotOps", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"all", " ", "Products", " ", "to", " ", 
          RowBox[{"xWedges", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"tmp", "/.", 
           RowBox[{"ProductOp", "->", "Wedge"}]}], "//.", 
          RowBox[{"Wedge", "\[Rule]", "xWedge"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{"move", " ", "non"}], "-", 
           RowBox[{"Form", " ", "to", " ", "the", " ", "left"}]}], "==", 
          RowBox[{"default", " ", "position"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp0", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"loop", "++"}], ">", "20"}], ",", 
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{"\"\<loop limit:\>\"", ",", "tmp"}], "]"}], ";", 
               RowBox[{"Return", "[", "tmp", "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<tuDifFormWedgeSimplify 0:\>\"", ",", "tmp"}], 
               "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Move", " ", "non"}], "-", 
              RowBox[{"difForms", " ", "to", " ", "Left"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "//.", 
              RowBox[{
               RowBox[{"xWedge", "[", 
                RowBox[{
                "c0___", ",", "a_", " ", ",", " ", "b_", ",", "c1___"}], " ", 
                "]"}], "\[RuleDelayed]", 
               RowBox[{
                RowBox[{"xWedge", "[", 
                 RowBox[{"c0", ",", "b", ",", "a", ",", "c1"}], "]"}], "/;", 
                RowBox[{
                 RowBox[{"tuHasNoneQ", "[", 
                  RowBox[{"b", ",", 
                   RowBox[{"{", 
                    RowBox[{"DF", ",", "formLabels"}], "}"}]}], "]"}], "&&", 
                 RowBox[{"tuHasAnyQ", "[", 
                  RowBox[{"a", ",", 
                   RowBox[{"{", 
                    RowBox[{"DF", ",", "formLabels"}], "}"}]}], 
                  "]"}]}]}]}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "//.", 
              RowBox[{
               RowBox[{"ww", ":", 
                RowBox[{"xWedge", "[", "a_", "]"}]}], ":>", 
               RowBox[{"a", "/;", 
                RowBox[{
                 RowBox[{"Length", "[", "ww", "]"}], "==", "1"}]}]}]}]}], ";", 
            RowBox[{"(*", 
             RowBox[{"single", " ", "arguement"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"Wedge", " ", "Pair"}], " ", "\[Rule]", "0"}], " ", 
             "*)"}], " ", "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "/.", 
              RowBox[{
               RowBox[{"xWedge", "[", 
                RowBox[{"c1___", ",", 
                 RowBox[{"df", ":", 
                  RowBox[{
                   RowBox[{"difForm", "[", "a_", "]"}], "|", 
                   RowBox[{"dForm", "[", 
                    RowBox[{"a_", ",", "1"}], "]"}]}]}], ",", "c2___", ",", 
                 RowBox[{"df", ":", 
                  RowBox[{
                   RowBox[{"difForm", "[", "a_", "]"}], "|", 
                   RowBox[{"dForm", "[", 
                    RowBox[{"a_", ",", "1"}], "]"}]}]}], ",", "c3___"}], 
                "]"}], ":>", 
               RowBox[{"0", "/;", 
                RowBox[{"df", "===", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"difForm", "[", "a", "]"}], "|", 
                   RowBox[{"dForm", "[", 
                    RowBox[{"a", ",", "1"}], "]"}]}], ")"}]}]}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", "  ", 
             RowBox[{"Simplification", " ", "of", " ", 
              RowBox[{"difForm", "[", "]"}], " ", "expressions"}], "  ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "/.", 
              RowBox[{
               RowBox[{"df", ":", 
                RowBox[{"difForm", "[", "a_", "]"}]}], ":>", 
               RowBox[{"Distribute", "[", "df", "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<tuDifFormWedgeSimplify 2 :\>\"", ",", "tmp"}], 
               "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "//", 
              RowBox[{"tuRepeat", "[", 
               RowBox[{
                RowBox[{"{", "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"tuDifFormExpand", "[", "scalars", "]"}], ",", 
                  RowBox[{"tuWedgeSimplify", "[", "scalars", "]"}]}], "}"}], 
                ",", "5"}], "]"}]}]}], ";", "\[IndentingNewLine]", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "//", 
              RowBox[{"tudExpandvI", "[", "difForm", "]"}]}]}], ";", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"**", "**", "PROBLEM"}], " ", "with", " ", "nested", 
              " ", 
              RowBox[{"d", "[", 
               RowBox[{"d", "[", "_", "]"}], "]"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"(*", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<tuDifFormWedgeSimplify 2.1 :\>\"", ",", "tmp"}], 
               "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "//", 
              RowBox[{"tuWedgeSimplify", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{"{", 
                 RowBox[{"scalars", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Derivative", "[", "__", "]"}], "[", "f_", "]"}], 
                   "[", "__", "]"}]}], "}"}], "]"}], " ", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "//.", 
              RowBox[{
               RowBox[{"ww", ":", 
                RowBox[{"xWedge", "[", "a__", "]"}]}], "\[RuleDelayed]", 
               RowBox[{"0", "/;", 
                RowBox[{"tuMemberQ", "[", 
                 RowBox[{"ww", ",", 
                  RowBox[{"{", "0", "}"}]}], "]"}]}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Distribute", " ", "DerivOps"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "//.", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"op", ":", "DerivOps"}], " ", ")"}], "[", 
                RowBox[{
                 RowBox[{"xWedge", "[", 
                  RowBox[{"a_", ",", " ", "c__"}], "]"}], ",", "b_"}], "]"}], 
               "\[Rule]", 
               RowBox[{
                RowBox[{"xWedge", "[", 
                 RowBox[{
                  RowBox[{"op", "[", 
                   RowBox[{"a", ",", "b"}], "]"}], ",", "c"}], "]"}], "+", 
                " ", 
                RowBox[{"xWedge", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"op", "[", " ", 
                   RowBox[{
                    RowBox[{"xWedge", "[", "c", "]"}], ",", "b"}], "]"}]}], 
                 "]"}]}]}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<tuDifFormWedgeSimplify 2.4 :\>\"", ",", "tmp"}], 
               "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "//.", 
              RowBox[{
               RowBox[{"dd", ":", 
                RowBox[{"DerivOps", " ", "[", 
                 RowBox[{"a_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
               RowBox[{
                RowBox[{
                 RowBox[{"tuDerivativeExpand", "[", "constants", "]"}], "[", 
                 "dd", "]"}], "/;", 
                RowBox[{"tuHasNoneQ", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"{", 
                   RowBox[{"DF", ",", "formLabels"}], "}"}]}], "]"}]}]}]}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"(*", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<tuDifFormWedgeSimplify 2.5 :\>\"", ",", "tmp"}], 
               "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "//.", 
              RowBox[{
               RowBox[{
                RowBox[{"difForm", "[", "a_", "]"}], "|", 
                RowBox[{"dForm", "[", 
                 RowBox[{"a_", ",", "1"}], "]"}]}], ":>", 
               RowBox[{"0", "/;", 
                RowBox[{"tuHasAnyQ", "[", 
                 RowBox[{"a", ",", "constants"}], "]"}]}]}]}]}], ";", 
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "//.", 
              RowBox[{
               RowBox[{"difForm", "[", 
                RowBox[{
                 RowBox[{"difForm", "[", "a_", " ", "]"}], "|", 
                 RowBox[{"dForm", "[", 
                  RowBox[{"a_", ",", "_"}], "]"}]}], "]"}], ":>", "0"}]}]}], 
            ";"}], "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"difForm", " ", "Rule"}], " ", "/;", 
             RowBox[{
              RowBox[{"ListMemberQ", "[", 
               RowBox[{"a", ",", "scalars"}], "]"}], " ", "??"}]}], " ", 
            "*)"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"difForm", " ", "[", 
               RowBox[{"a_", "^", "n_"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"xWedge", "[", 
                RowBox[{"n", " ", ",", " ", 
                 RowBox[{"Apply", "[", 
                  RowBox[{"Sequence", ",", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"a", "^", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Sign", "[", "n", "]"}], "1"}], ")"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Abs", "[", 
                    RowBox[{"n", "-", "1"}], "]"}], "}"}]}], "]"}]}], "]"}], 
                 ",", 
                 RowBox[{"dForm", "[", 
                  RowBox[{"a", ",", "1"}], "]"}]}], "]"}], "/;", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "scalars"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"xWedge", "[", "a_", "]"}], ":>", 
              RowBox[{"a", "/;", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"{", "a", "}"}], "]"}], "==", "1"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Distribute", " ", "difForm"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{"xWedge", "[", 
                RowBox[{"a_", ",", "b__"}], "]"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"xWedge", "[", 
                RowBox[{
                 RowBox[{"difForm", "[", "a", "]"}], ",", "b"}], "]"}], "+", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"-", "1"}], ")"}], "^", 
                 RowBox[{"nForm", "[", "a", "]"}]}], 
                RowBox[{"xWedge", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"difForm", "[", 
                   RowBox[{"xWedge", "[", "b", "]"}], "]"}]}], 
                 "]"}]}]}]}]}]}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tmp", "/.", 
              RowBox[{"ProductOp", "->", "Wedge"}]}], "/.", 
             RowBox[{"Wedge", "\[Rule]", "xWedge"}]}]}], ";"}]}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<tuDifFormWedgeSimplify 3 :\>\"", ",", "tmp"}], "]"}],
            ";"}], "*)"}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmp", "//.", 
          RowBox[{"xWedge", "\[Rule]", "Wedge"}]}], "//", 
         RowBox[{"tuWedgeSimplify", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"scalars", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Derivative", "[", "__", "]"}], "[", "f_", "]"}], "[",
                "__", "]"}]}], "}"}], "]"}], ",", ",", "Ordered"}], 
          "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"tuDifFormBasis", "//", "Clear"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDifFormBasis", "::", "usage"}], "=", 
     "\"\<tuDifFormBasis[basis_List][exp_] expands the difForm[]s in exp_ \
into basis components: \
difForm[A]\[Rule]Sum[tuDPartial[A,a].difForm[a],{a,basis}] *17Apr2019*\>\""}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDifFormBasis", "[", "basis_List", "]"}], "[", "exp_", "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "$", "}"}], ",", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"exp", "/.", 
          RowBox[{
           RowBox[{"dd", ":", 
            RowBox[{"difForm", "[", "a_", "]"}]}], "\[RuleDelayed]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"tuHasNoneQ", "[", 
              RowBox[{"a", ",", "basis"}], "]"}], ",", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"tuDPartial", "[", 
                 RowBox[{"a", ",", "i"}], "]"}], ".", 
                RowBox[{"difForm", "[", "i", "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "basis"}], "}"}]}], "]"}], ",", "dd"}], 
            "]"}]}]}]}], ";", "\[IndentingNewLine]", "$"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", "B", " ", 
      RowBox[{
       RowBox[{"difForm", "[", "A", "]"}], "\[Wedge]", 
       RowBox[{"difForm", "[", "a", "]"}]}]}], "//", 
     RowBox[{"tuDifFormBasis", "[", 
      RowBox[{"{", 
       RowBox[{"a", ",", "b", ",", "c"}], "}"}], "]"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", "B", " ", 
      RowBox[{
       RowBox[{"difForm", "[", "A", "]"}], "\[Wedge]", 
       RowBox[{"difForm", "[", "a", "]"}]}]}], "//", 
     RowBox[{"tuDifFormBasis", "[", 
      RowBox[{"{", 
       RowBox[{"a", ",", "b", ",", "c"}], "}"}], "]"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDifFormSimplify1", "::", "usage"}], "\[Equal]", 
     "\"\<tuDifFormSimplify1[forms_List:{difForm[_]}][exp_] simplifies \
difForm expression exp_ by first applying tuWedgeSimplify1[forms] and \
canonically ordering the Wedge term accounting for sign changes *12Apr2019*\>\
\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDifFormSimplify1", "[", 
       RowBox[{"forms_List:", 
        RowBox[{"{", 
         RowBox[{"difForm", "[", "_", "]"}], "}"}]}], "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$0", ",", "$"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"exp", "//", 
          RowBox[{"tuWedgeSimplify1", "[", "forms", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"ww", ":", 
            RowBox[{"Wedge", "[", "a__", "]"}]}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{
             RowBox[{"Signature", "[", "ww", "]"}], 
             RowBox[{"Sort", "[", "ww", "]"}]}], "/;", 
            RowBox[{"tuHasNoneQ", "[", 
             RowBox[{"ww", ",", 
              RowBox[{"difForm", "[", 
               RowBox[{"_", ",", "_"}], "]"}]}], 
             RowBox[{"(*", 
              RowBox[{"extended", " ", "form"}], "*)"}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "//.", 
         RowBox[{"tuOpSimplify", "[", "dotOps", "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuDifFormSimplify", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDifFormSimplify", "::", "usage"}], "=", 
     "\"\<tuDifFormSimplify[constants_List:{},scalars_List:{},forms_List:{},\
flags_List:{}][exp_] puts difForm[] expressions into standard form where \
0-Forms are to the left of the other terms. ProductOp's between n-Forms are \
considered Wedge[] products.  constants_List, scalars_List, forms_List are \
inputs that determine how terms are manipulated.  forms_List are in a form \
{f1\[Rule]n1,f2\[Rule]n2} where f1,f2 are labels to n1,n2-Forms in \
expressions, respectively. Functions specified by form fn[arg] in flags_List \
are expanded by difForm \[PartialD] . Other flags: {NoSymmetric->zeros \
symmetric Wedge[]s, }. xPartialD[difForm[a_],a_]\[Rule]0 Rule[] is \
considered. Results include CenterDot[] In Development. *22Jan2016\>\""}], 
    ";", 
    RowBox[{
     RowBox[{
      RowBox[{"tuDifFormSimplify", "[", 
       RowBox[{
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"scalars_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"forms_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"flags_List:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp0", ",", "pos", ",", "xdForm", 
         ",", "dForms", ",", 
         RowBox[{"ProductOp", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Times", "|", "dotOps", "|", "Wedge"}], "]"}]}], ",", 
         RowBox[{"DF", "=", 
          RowBox[{"{", 
           RowBox[{"dForm", ",", "difForm"}], "}"}]}], ",", 
         RowBox[{"formLabels", "=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", "forms"}], "]"}]}], 
         ",", 
         RowBox[{"loopcnt", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Standard", " ", "0"}], "-", 
         RowBox[{"form", " ", "on", " ", "left"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Label", " ", "forms_List"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp0"}], ",", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"ProductOp", "->", "Wedge"}]}]}], ";", 
           RowBox[{"(*", 
            RowBox[{
            "change", " ", "all", " ", "operators", " ", "to", " ", "Wedge", 
             " ", "and", " ", "extract", " ", "scalars"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<dfSimplify0:\>\"", ",", "tmp"}], "]"}], ";"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{"ff", ":", 
                RowBox[{"fn_", "[", "aa_", "]"}]}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{
                RowBox[{"tuDPartial", "[", 
                 RowBox[{"ff", ",", "aa"}], "]"}], "\[CenterDot]", 
                RowBox[{"difForm", "[", "aa", "]"}]}], "/;", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{"flags", ",", 
                  RowBox[{"fn", "[", "]"}]}], "]"}], "&&", 
                RowBox[{"AtomQ", "[", "aa", "]"}]}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "single", " ", "arguement", " ", "function", " ", "expand"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"tuDPartial", "|", "tuDPartialu"}], ")"}], "[", 
               RowBox[{
                RowBox[{"difForm", "[", "a_", "]"}], ",", "a_"}], "]"}], 
              "\[Rule]", "0"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"\[PartialD]", " ", "and"}], " ", "difForm", " ", 
             "commute"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"df", ":", 
               RowBox[{"difForm", "[", "a_", "]"}]}], ":>", 
              RowBox[{"Distribute", "[", "df", "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Put", " ", "forms", " ", "into", " ", 
              RowBox[{"dForm", ".", " ", "dForm"}], " ", "have", " ", 
              "form"}], "-", 
             RowBox[{"degree", " ", "arguement"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"ff", ":", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "->", 
                 RowBox[{"dForm", "[", 
                  RowBox[{"ff", ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "&"}], ",", 
               "forms"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"dd", ":", 
               RowBox[{"difForm", "[", "a_", "]"}]}], ":>", 
              RowBox[{
               RowBox[{"dForm", "[", 
                RowBox[{"a", ",", "1"}], "]"}], "/;", 
               RowBox[{"tuMemberQ", "[", 
                RowBox[{"a", ",", "scalars"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<dfSimplify2:\>\"", ",", "tmp"}], "]"}], ";"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tuDifFormWedgeSimplify", "[", 
              RowBox[{"constants", ",", "scalars", ",", "forms"}], "]"}], "[",
              "tmp", "]"}]}], ";", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<dfSimplify3:\>\"", ",", "tmp"}], "]"}], ";"}], 
            "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "put", " ", "scalars", " ", "in", " ", "Dot", " ", "expression"}],
             "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"Wedge", "[", 
               RowBox[{"a_", ",", "b__"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"CenterDot", "[", 
                RowBox[{"a", " ", ",", "  ", 
                 RowBox[{"Wedge", "[", "b", "]"}]}], "]"}], "/;", 
               RowBox[{
                RowBox[{"ListFreeQ", "[", 
                 RowBox[{"a", ",", "DF"}], "]"}], "&&", 
                RowBox[{"ListFreeQ", "[", 
                 RowBox[{"a", ",", "formLabels"}], "]"}]}]}]}]}]}], ";", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"xPrint", "[", 
              RowBox[{"\"\<Estd:\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"ww", ":", 
               RowBox[{"Wedge", "[", "a_", "]"}]}], "\[RuleDelayed]", 
              RowBox[{"a", "/;", 
               RowBox[{
                RowBox[{"Length", "[", "ww", "]"}], "==", "1"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"ww", ":", 
               RowBox[{"Wedge", "[", "_", "]"}]}], ":>", 
              RowBox[{"OrderdFormWedge", "[", "ww", "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"return", " ", "to", " ", "input", " ", "notation"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"dForm", "[", 
               RowBox[{"a_", ",", "1"}], "]"}], ":>", 
              RowBox[{
               RowBox[{"difForm", "[", "a", "]"}], "/;", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "scalars"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"dForm", "[", 
               RowBox[{"a_", ",", "_"}], "]"}], ":>", 
              RowBox[{"a", "/;", 
               RowBox[{"tuMemberQ", "[", 
                RowBox[{"a", ",", "formLabels"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{"flags", ",", "Ordered"}], "]"}], ",", 
              RowBox[{
               RowBox[{"tuWedgeSimplify", "[", 
                RowBox[{"scalars", ",", "ProductOp", ",", "Ordered"}], "]"}], 
               "[", "tmp", "]"}], ",", 
              RowBox[{
               RowBox[{"tuWedgeSimplify", "[", 
                RowBox[{"scalars", ",", "ProductOp", ",", "NotOrdered"}], 
                "]"}], "[", "tmp", "]"}]}], "]"}]}], ";", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"xPrint", "[", 
              RowBox[{"\"\<Fsimp:\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Inactive", "[", "tuRepeat", "]"}], "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"tuOpDistribute", "[", "ProductOp", "]"}], ",", 
               RowBox[{"tuOpSimplify", "[", "ProductOp", "]"}]}], "}"}], ",", 
             "scalars", ",", "3"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", 
             RowBox[{"tuRepeat", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"tuOpDistribute", "[", "ProductOp", "]"}], ",", 
                 RowBox[{"tuOpSimplify", "[", 
                  RowBox[{"ProductOp", ",", "scalars"}], "]"}]}], "}"}], ",", 
               
               RowBox[{"{", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<end:\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"loopcnt", "++"}], ">", "10"}], ",", 
             RowBox[{"Break", "[", "]"}]}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"TEST", "\[IndentingNewLine]", 
     RowBox[{"PR", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"difForm", "[", 
          RowBox[{
           RowBox[{"a", ".", "c", ".", 
            RowBox[{"y", "[", "x", "]"}]}], "+", 
           RowBox[{"Wedge", "[", 
            RowBox[{"\[Omega]", ",", "a"}], "]"}], "+", 
           RowBox[{
            RowBox[{"difForm", "[", "a", "]"}], ".", 
            RowBox[{"y", "[", "x", "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "tuDifFormSimplify", "]"}], "[", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"c", ",", "y"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Omega]", ",", "3"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"a", ",", "1"}], "}"}]}], "}"}]}], "]"}], "[", "$", 
          "]"}]}], ";", 
        RowBox[{"$", "//", "ColumnSumExp"}]}], ",", "\[IndentingNewLine]", 
       "Yield", ",", 
       RowBox[{
        RowBox[{"Activate", "[", "$", "]"}], "//", "ColumnSumExp"}], ",", 
       "\[IndentingNewLine]", "NL", ",", "\"\<Next: \>\"", ",", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"difForm", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "/", "r"}], ")"}], ".", 
           RowBox[{"difForm", "[", "r", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "tuDifFormSimplify", "]"}], "[", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            RowBox[{"{", "r", "}"}], ",", 
            RowBox[{"{", "}"}]}], "]"}], "[", "$", "]"}]}]}], ",", 
       "\[IndentingNewLine]", "Yield", ",", 
       RowBox[{"Activate", "[", "$", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Work", " ", "out", " ", "later"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuDifFormStd", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDifFormStd", "::", "usage"}], "=", 
     "\"\<tuDifFormStd[constants_List,scalars_List,forms_List,flags_List][exp_\
] puts difForm[] expressions into standard form where 0-Forms are to the left \
of the other terms. ProductOp's between n-Forms are considered Wedge[] \
products.  constants_List,scalars_List,forms_List are inputs that determine \
how terms are manipulated.  forms_List are in a form {{f1,n1},{f2,n2}} where \
f1,f2 represent n1,n2-Form form expressions, respectively. Functions \
specified by form fn[arg] in flags_List are expanded. Other flags: \
{NoSymmetric->zeros symmetric Wedge[]s, }. xPartialD[difForm[a_],a_]\[Rule]0 \
Rule[] is considered. *01Aug2014\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDifFormStd", "[", 
       RowBox[{
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"scalars_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"forms_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"flags_List:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp0", ",", "pos", ",", "xdForm", 
         ",", "dForms", ",", 
         RowBox[{"ProductOp", "=", 
          RowBox[{
          "Times", "|", "Dot", "|", "xDot", "|", "xWedge", "|", 
           "CenterDot"}]}], ",", 
         RowBox[{"DF", "=", 
          RowBox[{"{", 
           RowBox[{"dForm", ",", "difForm"}], "}"}]}], ",", 
         RowBox[{"formLabels", "=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", "forms"}], 
           "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Standard", " ", "0"}], "-", 
         RowBox[{"form", " ", "on", " ", "left"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Label", " ", "forms_List"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<exp_:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp0"}], ",", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"tuOpSimplify", "[", 
              RowBox[{"dotOps", ",", "constants"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"ProductOp", "->", "Wedge"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{"ff", ":", 
                RowBox[{"fn_", "[", "aa_", "]"}]}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{
                RowBox[{"tuDPartial", "[", 
                 RowBox[{"ff", ",", "aa"}], "]"}], ".", 
                RowBox[{"difForm", "[", "aa", "]"}]}], "/;", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{"flags", ",", 
                  RowBox[{"fn", "[", "]"}]}], "]"}], "&&", 
                RowBox[{"AtomQ", "[", "aa", "]"}]}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"function", " ", "expand"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"tuDPartial", "[", 
               RowBox[{
                RowBox[{"difForm", "[", "a_", "]"}], ",", "a_"}], "]"}], 
              "\[Rule]", "0"}]}]}], ";", 
           RowBox[{"(*", "TEST", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"df", ":", 
               RowBox[{"difForm", "[", "a_", "]"}]}], ":>", 
              RowBox[{"Distribute", "[", "df", "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"ff", ":", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "->", 
                 RowBox[{"dForm", "[", 
                  RowBox[{"ff", ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "&"}], ",", 
               "forms"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"dd", ":", 
               RowBox[{"difForm", "[", "a_", "]"}]}], ":>", 
              RowBox[{
               RowBox[{"dForm", "[", 
                RowBox[{"a", ",", "1"}], "]"}], "/;", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "scalars"}], "]"}]}]}]}]}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<Bs:\>\"", ",", "tmp"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tuDifFormWedgeSimplify", "[", 
              RowBox[{"constants", ",", "scalars", ",", "forms"}], "]"}], "[",
              "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<Cs:\>\"", ",", "tmp"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "put", " ", "scalars", " ", "in", " ", "Dot", " ", "expression"}],
             "*)"}], 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"Wedge", "[", 
               RowBox[{"a_", ",", "b__"}], "]"}], ":>", 
              RowBox[{
               RowBox[{"Dot", "[", 
                RowBox[{"a", " ", ",", "  ", 
                 RowBox[{"Wedge", "[", "b", "]"}]}], "]"}], "/;", 
               RowBox[{
                RowBox[{"ListFreeQ", "[", 
                 RowBox[{"a", ",", "DF"}], "]"}], "&&", 
                RowBox[{"ListFreeQ", "[", 
                 RowBox[{"a", ",", "formLabels"}], "]"}]}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<Dstd:\>\"", ",", "tmp"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tmp", "//.", 
              RowBox[{
               RowBox[{"Dot", "[", 
                RowBox[{"a__", " ", ",", 
                 RowBox[{"ww", ":", 
                  RowBox[{"Wedge", "[", "_", "]"}]}]}], "]"}], 
               "\[RuleDelayed]", 
               RowBox[{"Dot", "[", 
                RowBox[{
                 RowBox[{"Times", "[", "a", "]"}], ",", "ww"}], "]"}]}]}], "/.", 
             RowBox[{"Times", "\[Rule]", "Dot"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<Estd:\>\"", ",", "tmp"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"tmp", "/.", 
               RowBox[{"Wedge", "->", "xWedge"}]}], "//.", 
              RowBox[{
               RowBox[{"xWedge", "[", "a_", "]"}], ":>", 
               RowBox[{"a", "/;", 
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"{", "a", "}"}], "]"}], "==", "1"}]}]}]}], "/.", 
             RowBox[{"xWedge", "->", "Wedge"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"ww", ":", 
               RowBox[{"Wedge", "[", "_", "]"}]}], ":>", 
              RowBox[{"OrderdFormWedge", "[", "ww", "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"return", " ", "to", " ", "input", " ", "notation"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"dForm", "[", 
               RowBox[{"a_", ",", "1"}], "]"}], ":>", 
              RowBox[{
               RowBox[{"difForm", "[", "a", "]"}], "/;", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "scalars"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"dForm", "[", 
               RowBox[{"a_", ",", "_"}], "]"}], ":>", 
              RowBox[{"a", "/;", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "formLabels"}], "]"}]}]}]}]}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"flags", ",", "NotOrdered"}], "]"}], ",", "tmp", ",", 
           RowBox[{
            RowBox[{"WedgeSimplify", "[", 
             RowBox[{"{", "}"}], "]"}], "[", "tmp", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{"tuOpSimplify", "[", 
           RowBox[{"dotOps", ",", "scalars"}], "]"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuStdDifForm", "[", 
     RowBox[{
      RowBox[{"constants_List:", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"scalars_List:", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"forms_List:", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"flags_List:", 
       RowBox[{"{", "}"}]}]}], "]"}], ":=", 
    RowBox[{"tuDifFormStd", "[", 
     RowBox[{"constants", ",", "scalars", ",", "forms", ",", "flags"}], 
     "]"}]}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"stdDifForm", "[", 
       RowBox[{"constants_List", ",", "scalars_List", ",", "forms_List"}], 
       "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuStdDifForm", "[", 
       RowBox[{"constants", ",", "scalars", ",", "forms", ",", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"TEST", ":", "\[IndentingNewLine]", 
     RowBox[{"PR", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"difForm", "[", 
          RowBox[{
           RowBox[{"a", ".", "c", ".", "y"}], "+", 
           RowBox[{"Wedge", "[", 
            RowBox[{"\[Omega]", ",", "a"}], "]"}], "+", 
           RowBox[{
            RowBox[{"difForm", "[", "a", "]"}], ".", "y"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "tuDifFormStd", "]"}], "[", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"c", ",", "y"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Omega]", ",", "3"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"a", ",", "1"}], "}"}]}], "}"}]}], "]"}], "[", "$", 
          "]"}]}], ";", 
        RowBox[{"$", "//", "ColumnSumExp"}]}], ",", "\[IndentingNewLine]", 
       "Yield", ",", 
       RowBox[{
        RowBox[{"Activate", "[", "$", "]"}], "//", "ColumnSumExp"}], ",", 
       "\[IndentingNewLine]", "NL", ",", "\"\<Next: \>\"", ",", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"difForm", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "/", "r"}], ")"}], ".", 
           RowBox[{"difForm", "[", "r", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "tuDifFormStd", "]"}], "[", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            RowBox[{"{", "r", "}"}], ",", 
            RowBox[{"{", "}"}]}], "]"}], "[", "$", "]"}]}]}], ",", 
       "\[IndentingNewLine]", "Yield", ",", 
       RowBox[{"Activate", "[", "$", "]"}], ",", 
       RowBox[{"CG", "[", "\"\<should be 0.\>\"", "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDifFormCnt", "::", "usage"}], "=", 
     "\"\<tuDifFormCnt[forms_List:{}][wedgeform_List] determines the difForm \
n-form value in wedgeform_List, which is a List of arguements of a Wedge \
expression. forms_List specifies non-default n-form values of terms in \
wedgeform_List as {A\[Rule]n,B\[Rule]m}. Explicit DifForms are accepted.  \
Default n-Form value is 1. *18Jan2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDifFormCnt", "[", 
       RowBox[{"forms_List:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "wedgeform_List", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "wedgeform"}], ",", "$s", ",", "ret", ",", "tmp"}],
         "}"}], ",", 
       RowBox[{
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tuDifFormCnt:\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"forms", ",", "wedgeform"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", "forms"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", 
          RowBox[{
           RowBox[{"difForm", "[", "n_", "]"}], "\[Rule]", 
           RowBox[{"n", "+", "1"}]}]}]}], ";", 
        RowBox[{"xPrint", "[", "$", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "/.", 
            RowBox[{"a_", "\[RuleDelayed]", 
             RowBox[{"1", "/;", 
              RowBox[{"!", 
               RowBox[{"NumberQ", "[", "a", "]"}]}]}]}]}], "&"}], "/@", 
          "$"}]}], ";", 
        RowBox[{"xPrint", "[", "$", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"Plus", ",", "$"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuDifFormExpand", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDifFormExpand", "::", "usage"}], "=", 
     "\"\<tuDifFormExpand[scalars_List:{},constants_List:{},forms_List:{},\
product_:Times][exp_] expands DifForm's in exp_.forms_List specifies \
non-(default\[Rule]1) n-form values of terms in exp_ as \
{A\[Rule]n,B\[Rule]m}.*18Jan2016*5Jul2018*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDifFormExpand", "[", 
       RowBox[{
        RowBox[{"scalars_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"forms_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"product_:", "Times"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp0"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp0", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{"tuOpDistribute", "[", "difForm", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"difForm", "[", "a_", "]"}], "\[RuleDelayed]", 
              RowBox[{"0", "/;", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"tuMemberQ", "[", 
                  RowBox[{"a", ",", "constants"}], "]"}], "||", 
                 RowBox[{"NumericQ", "[", "a", "]"}]}], ")"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"pp", ":", "product"}], ")"}], "[", 
                RowBox[{"a_", ",", "b__"}], "]"}], " ", "]"}], 
              "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"pp", "[", 
                RowBox[{"a", ",", 
                 RowBox[{"difForm", "[", 
                  RowBox[{"pp", "[", "b", "]"}], "]"}]}], "]"}], "/;", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"tuMemberQ", "[", 
                  RowBox[{"a", ",", "constants"}], "]"}], "||", 
                 RowBox[{"NumericQ", "[", "a", "]"}]}], ")"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"pp", ":", "product"}], ")"}], "[", 
                RowBox[{"a__", ",", "b_"}], "]"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"pp", "[", 
                RowBox[{
                 RowBox[{"difForm", "[", 
                  RowBox[{"pp", "[", "a", "]"}], "]"}], ",", "b"}], "]"}], "/;", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"tuMemberQ", "[", 
                  RowBox[{"b", ",", "constants"}], "]"}], "||", 
                 RowBox[{"NumericQ", "[", "b", "]"}]}], ")"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"pp", ":", "product"}], ")"}], "[", 
                RowBox[{"a_", ",", "b_"}], "]"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{
                RowBox[{"Wedge", "[", 
                 RowBox[{
                  RowBox[{"difForm", "[", "a", "]"}], ",", "b"}], "]"}], "+", 
                
                RowBox[{"Wedge", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"difForm", "[", "b", "]"}]}], "]"}]}], "/;", 
               RowBox[{
                RowBox[{"tuMemberQ", "[", 
                 RowBox[{"a", ",", "scalars"}], "]"}], "||", 
                RowBox[{"tuMemberQ", "[", 
                 RowBox[{"b", ",", "scalars"}], "]"}]}]}]}]}]}], ";", 
           RowBox[{"(*", 
            RowBox[{"Is", " ", "this", " ", "too", " ", "simplistic"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{"Wedge", "[", 
                RowBox[{"a_", ",", "b__"}], "]"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"Wedge", "[", 
                RowBox[{
                 RowBox[{"difForm", "[", "a", "]"}], ",", "b"}], "]"}], "+", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"-", "1"}], ")"}], "^", 
                 RowBox[{
                  RowBox[{"tuDifFormCnt", "[", "forms", "]"}], "[", 
                  RowBox[{"{", "a", "}"}], "]"}]}], 
                RowBox[{"Wedge", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"difForm", "[", 
                   RowBox[{"Wedge", "[", "b", "]"}], "]"}]}], "]"}]}]}]}]}]}],
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"difForm", "[", 
               RowBox[{"difForm", "[", "a__", " ", "]"}], "]"}], "->", 
              "0"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"tmp", "/.", 
               RowBox[{"Wedge", "\[Rule]", "xWedge"}]}], "/.", 
              RowBox[{
               RowBox[{"xWedge", "[", "a_", "]"}], "\[Rule]", "a"}]}], "/.", 
             RowBox[{"xWedge", "\[Rule]", "Wedge"}]}]}]}]}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Attribute", "[", "Wedge", "]"}], " ", 
           RowBox[{"don", "'"}], "t", " ", 
           RowBox[{"work", "."}]}], "*)"}], "\[IndentingNewLine]", "]"}], ";",
         "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDifFormFunctionExpand", "::", "usage"}], "=", 
     "\"\<tuDifFormFunctionExpand[function_List][exp_] expands difForm[]s in \
exp_ if difForm[]s contain functions in function_List. The functions are \
expanded via tuDPartial through their argument list.  EG: \
\!\(\*InterpretationBox[RowBox[{UnderscriptBox[\"d\", \"_\"], \"[\", RowBox[{\
\"A\", \"[\", \"r\", \"]\"}], \"]\"}],$CellContext`DifForm[
$CellContext`A[$CellContext`r]],Editable->False,SyntaxForm->Automatic]\) \
\[Rule]tuDPartial[A[r],r] \
\[CenterDot]\!\(\*InterpretationBox[RowBox[{UnderscriptBox[\"d\", \"_\"], \"[\
\", \"r\", \
\"]\"}],$CellContext`DifForm[$CellContext`r],Editable->False,SyntaxForm->\
Automatic]\). *21Jan2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDifFormFunctionExpand", "[", "function_List", "]"}], "[", 
      "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$p"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$p", "=", 
         RowBox[{"$", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"difForm", "[", "_", "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$p", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"$p", ",", 
           RowBox[{
            RowBox[{"tuHasAnyQ", "[", 
             RowBox[{"#", ",", "function"}], "]"}], "&"}]}], "]"}]}], ";", 
        RowBox[{"Print", "[", "$p", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$p", "=", 
         RowBox[{"$p", "/.", 
          RowBox[{
           RowBox[{"difForm", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"fn", ":", 
               RowBox[{"Apply", "[", 
                RowBox[{"Alternatives", ",", "function"}], "]"}]}], ")"}], 
             "[", "arg__", "]"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"Plus", "@@", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"tuDPartial", "[", 
                 RowBox[{
                  RowBox[{"fn", "[", "arg", "]"}], ",", "#"}], "]"}], 
                RowBox[{"difForm", "[", "#", "]"}]}], "&"}], ",", 
              RowBox[{"{", "arg", "}"}]}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"$", ",", "$p"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"OrderdFormWedge", "[", "exp_Wedge", "]"}], " ", "canonically", 
      " ", "orders", " ", "Wedge", " ", "expression", " ", "accounting", " ", 
      "for", " ", "n"}], "-", 
     RowBox[{"Forms", " ", "permutations", " ", "*", "4", "Aug2014"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OrderdFormWedge", "[", "exp_Wedge", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp0"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"Wedge", "->", "xWedge"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp0"}], ",", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<OO:\>\"", ",", "tmp"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"xWedge", "[", 
               RowBox[{"c0___", ",", "a_", ",", "b_", ",", "c1___"}], "]"}], ":>",
               " ", 
              RowBox[{
               RowBox[{"xWedge", "[", 
                RowBox[{"c0", ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", 
                   RowBox[{"nForm", "[", "a", "]"}]}], " ", "b"}], ",", "a", 
                 ",", "c1"}], "]"}], "/;", 
               RowBox[{"!", 
                RowBox[{"OrderedQ", "[", 
                 RowBox[{"{", 
                  RowBox[{"a", ",", "b"}], "}"}], "]"}]}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tmp", "/.", 
              RowBox[{"xWedge", "->", "Wedge"}]}], "/.", 
             RowBox[{"Wedge", "->", "xWedge"}]}]}], 
           RowBox[{"(*", 
            RowBox[{"use", " ", "Wedge", " ", "simplification"}], "*)"}], 
           "\[IndentingNewLine]", ";", 
           RowBox[{"xReturn", "[", "tmp", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "/.", 
         RowBox[{"xWedge", "->", "Wedge"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"nForm", "[", "a_", "]"}], " ", "sums", " ", "n_", " ", "of", 
     " ", 
     RowBox[{
      RowBox[{"dForm", "[", 
       RowBox[{"_", ",", "n"}], "]"}], "'"}], "s", " ", "in", " ", "a_.", " ",
      "Used", " ", "in", " ", 
     RowBox[{
      RowBox[{"dDifFormX", "[", "]"}], "."}], " ", "*", "31", "July2014"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"nForm", "[", "a_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ret", ",", "tmp"}], "}"}], ",", 
       RowBox[{
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<nForm:\>\"", ",", "a"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"a", "/.", 
          RowBox[{
           RowBox[{"difForm", "[", "b_", "]"}], ":>", 
           RowBox[{"dForm", "[", 
            RowBox[{"b", ",", "1"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"ret", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ExtractPattern", "[", 
             RowBox[{"dForm", "[", "__", "]"}], "]"}], "[", "tmp", "]"}], "/.", 
           RowBox[{
            RowBox[{"dForm", "[", 
             RowBox[{"_", ",", "n_"}], "]"}], "->", "n"}]}], "//", 
          RowBox[{
           RowBox[{"Apply", "[", 
            RowBox[{"Plus", ",", "#"}], "]"}], "&"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ret", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "ret", "]"}], "===", "List"}], ",", 
           RowBox[{"ret", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "ret"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<nForm:ret:\>\"", ",", "ret"}], "]"}], ";", 
        "\[IndentingNewLine]", "ret"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDifFormSimplifydForm", "::", "usage"}], "=", 
     "\"\<tuWedgeSimplifydForm[constants_List:{},forms_List:{},flags_List:{}][\
exp_] simplifies exp_ containing difForm[]'s, dForm[]'s and Wedge[]'s.  \
constants_List:{constants removed from difForm[] and Wedge[] \
operators},forms_List:{specifies n-form variables in format: var \[Rule] n}. \
Converts all n-form variables, var, into dForm[var,n] and \
difForm[var]\[Rule]dForm[var,1]. Scalars are designated: scalar\[Rule]0  \
Returns exp_ with Wedge[], difForm[] terms and dForm[var,n] terms if not \
specified in forms_List.  \n*22July2017*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuDifFormSimplifydForm", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDifFormSimplifydForm", "[", 
       RowBox[{
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"forms_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"flags_List:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], " ", ",", "tmp0", ",", 
         RowBox[{"DF", "=", 
          RowBox[{"{", "dForm", "}"}]}], ",", "scalarForm", ",", 
         "scalarLabel", ",", "$forms", ",", "$formvar", ",", 
         RowBox[{"formLabels", "=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", "forms"}], "]"}]}], 
         ",", 
         RowBox[{"loop", "=", "0"}], ",", 
         RowBox[{"ProductOp", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"dotOps", "|", "Times", "|", "Wedge"}], "]"}]}], ",", 
         RowBox[{"looptest", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"SetAttributes", "[", 
         RowBox[{"Wedge", ",", 
          RowBox[{"Attributes", "[", "Dot", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "replace", " ", "Pattern", " ", "specified", " ", "forms", " ", "in",
           " ", "exp_", " ", "with", " ", "explicit", " ", "variables"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$forms", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"tuExtractPattern", "[", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", "exp", "]"}], 
               "\[Rule]", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", 
            "forms"}], "//", "Flatten"}], "//", "DeleteDuplicates"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<$forms: \>\"", ",", "$forms"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"convert", " ", "all", " ", 
          RowBox[{"Form", "[", "]"}], "s", " ", "to", " ", 
          RowBox[{"dForm", "[", 
           RowBox[{"_", ",", "n"}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"scalarLabel", "=", 
         RowBox[{"Cases", "[", 
          RowBox[{"$forms", ",", 
           RowBox[{"HoldPattern", "[", 
            RowBox[{"_", "\[Rule]", "0"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"scalarForm", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"dForm", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "]"}], "&"}], ",", 
           "scalarLabel"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{"tuOpSimplify", "[", 
           RowBox[{"dotOps", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"scalarForm", ",", "constants"}], "}"}], "]"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{"difForm", "[", "aa_", "]"}], "\[Rule]", 
           RowBox[{"dForm", "[", 
            RowBox[{"aa", ",", "1"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "->", 
              RowBox[{"dForm", "[", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "&"}], ",", 
            "$forms"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp0", "=!=", "tmp"}], ",", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<tmp0:\>\"", ",", "tmp0"}], "]"}], ";", 
           RowBox[{"looptest", "++"}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"loop", "++"}], ">", "20"}], ",", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<tuDifFormSimplifydForm:loop limit \>\"", ",", "tmp"}], 
               "]"}], ";", 
              RowBox[{"Return", "[", "tmp", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tmp", "//.", 
              RowBox[{"tuOpDistribute", "[", "dForm", "]"}]}], "//", 
             RowBox[{"tuOpSimplifyFirst", "[", 
              RowBox[{"dForm", ",", "constants"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"tuOpDistribute", "[", "ProductOp", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"ProductOp", "->", "Wedge"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"move", " ", "non", " ", "n"}], "-", 
             RowBox[{"form", 
              RowBox[{"(", "b_", ")"}], " ", "to", " ", "the", " ", 
              "left"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"Wedge", "[", 
               RowBox[{
               "c0___", ",", "a_", " ", ",", " ", "b_", ",", "c1___"}], " ", 
               "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"Wedge", "[", 
                RowBox[{"c0", ",", "b", ",", "a", ",", "c1"}], "]"}], "/;", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"tuFreeQ", "[", 
                  RowBox[{"b", ",", "DF"}], "]"}], "&&", 
                 RowBox[{"tuFreeQ", "[", 
                  RowBox[{"b", ",", "formLabels"}], "]"}]}], ")"}]}]}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "avoid", " ", "Wedge", " ", "Pattern", " ", "match", " ", 
             "problem"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", 
             RowBox[{"tuWedgeSimplify", "[", 
              RowBox[{"Flatten", "[", 
               RowBox[{"{", "constants", "}"}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", "CHECK", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"expand", " ", 
             RowBox[{"dForm", "[", 
              RowBox[{
               RowBox[{"Wedge", "[", "]"}], ",", "1"}], "]"}], " ", "CAN", 
             " ", "WE", " ", "DO", " ", 
             RowBox[{
              RowBox[{"dForm", "[", 
               RowBox[{",", "n"}], "]"}], "?"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"dForm", "[", 
               RowBox[{
                RowBox[{"Wedge", "[", 
                 RowBox[{"a_", ",", "b__"}], "]"}], ",", "1"}], "]"}], 
              "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"Wedge", "[", 
                RowBox[{
                 RowBox[{"dForm", "[", 
                  RowBox[{"a", ",", "1"}], "]"}], ",", "b"}], "]"}], "+", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"-", "1"}], ")"}], "^", 
                 RowBox[{"nForm", "[", "a", "]"}]}], 
                RowBox[{"Wedge", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"dForm", "[", 
                   RowBox[{
                    RowBox[{"Wedge", "[", "b", "]"}], ",", "1"}], "]"}]}], 
                 "]"}]}]}]}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"ww", ":", 
               RowBox[{"Wedge", "[", "a_", "]"}]}], "\[RuleDelayed]", 
              RowBox[{"a", "/;", 
               RowBox[{
                RowBox[{"Length", "[", "ww", "]"}], "\[Equal]", "1"}]}]}]}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"expand", " ", 
             RowBox[{"dForm", "[", 
              RowBox[{
               SuperscriptBox["scalar", "n"], ",", "1"}], "]"}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"dForm", " ", "[", 
               RowBox[{
                RowBox[{"aa_", "^", "n_"}], ",", "1"}], "]"}], 
              "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"Times", "[", 
                RowBox[{"n", " ", ",", " ", 
                 RowBox[{"Apply", "[", 
                  RowBox[{"Sequence", ",", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"aa", "^", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Sign", "[", "n", "]"}], "1"}], ")"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Abs", "[", 
                    RowBox[{"n", "-", "1"}], "]"}], "}"}]}], "]"}]}], "]"}], 
                 ",", 
                 RowBox[{"dForm", "[", 
                  RowBox[{"aa", ",", "1"}], "]"}]}], "]"}], "/;", 
               RowBox[{"tuMemberQ", "[", 
                RowBox[{"aa", ",", "scalarForm"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"simplify", " ", 
             RowBox[{"dForm", "[", "]"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"dForm", "[", 
               RowBox[{"a_", ",", "n_"}], "]"}], ":>", 
              RowBox[{"0", "/;", 
               RowBox[{
                RowBox[{"tuMemberQ", "[", 
                 RowBox[{"a", ",", "constants"}], "]"}], "&&", 
                RowBox[{"n", ">", "0"}]}]}]}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"dForm", "[", 
               RowBox[{
                RowBox[{"dForm", "[", 
                 RowBox[{"a_", ",", "n_"}], "]"}], ",", "m_"}], "]"}], 
              "\[RuleDelayed]", 
              RowBox[{"0", "/;", 
               RowBox[{
                RowBox[{"n", ">", "0"}], "&&", 
                RowBox[{"m", ">", "0"}], "&&", 
                RowBox[{"tuMemberQ", "[", 
                 RowBox[{"a", ",", "scalarForm"}], "]"}]}]}]}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", 
             RowBox[{"tuOpSimplifyFirst", "[", 
              RowBox[{"dForm", ",", "constants"}], "]"}]}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", 
             RowBox[{"tuWedgeSimplify", "[", 
              RowBox[{"Flatten", "[", 
               RowBox[{"{", 
                RowBox[{"constants", ",", "scalarForm"}], "}"}], "]"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"ww", ":", 
               RowBox[{"Wedge", "[", "a_", "]"}]}], "\[RuleDelayed]", 
              RowBox[{"a", "/;", 
               RowBox[{
                RowBox[{"Length", "[", "ww", "]"}], "\[Equal]", 
                "1"}]}]}]}]}]}]}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "ABOVE", " ", "tuWedgeSimplify", " ", "misses", " ", "this", " ", 
           "??"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"looptest", ">", "5"}], ",", 
             RowBox[{"Return", "[", "tmp", "]"}]}], "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"dForm", "[", 
            RowBox[{"a_", ",", "_"}], "]"}], ":>", 
           RowBox[{"a", "/;", 
            RowBox[{"tuMemberQ", "[", 
             RowBox[{"a", ",", "formLabels"}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{"dForm", "[", 
            RowBox[{"a_", ",", "1"}], "]"}], ":>", 
           RowBox[{"difForm", "[", "a", "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ClearAttributes", "[", 
         RowBox[{"Wedge", ",", "Flat"}], "]"}], ";", "\[IndentingNewLine]", 
        "tmp"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "TEST", "*)"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"$", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"difForm", "[", 
         RowBox[{"a", " ", "\[Wedge]", 
          RowBox[{"(", 
           RowBox[{"b", "+", 
            RowBox[{"const", " ", 
             SuperscriptBox["c", "2"]}], "+", "scal"}], ")"}]}], "]"}], "+", 
        RowBox[{
         RowBox[{"difForm", "[", " ", 
          RowBox[{
           SuperscriptBox["scal", "2"], "  ", 
           RowBox[{"F", "[", "xs", "]"}]}], "]"}], "\[IndentingNewLine]", 
         "$s"}]}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"scal", "->", "0"}], ",", 
           RowBox[{"a", "\[Rule]", "1"}], ",", 
           RowBox[{"b", "\[Rule]", "1"}], ",", 
           RowBox[{"c", "\[Rule]", "0"}], ",", 
           RowBox[{
            RowBox[{"F", "[", "xs", "]"}], "\[Rule]", "2"}]}], "}"}], 
         "\[IndentingNewLine]", "$"}], "=", 
        RowBox[{"$", "//", 
         RowBox[{"tuDifFormSimplifydForm", "[", 
          RowBox[{
           RowBox[{"{", "const", "}"}], ",", "$s", ",", 
           RowBox[{"{", "}"}]}], "]"}]}]}]}]}], ";", 
     RowBox[{"$", "//", "ColumnSumExp"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"**", "**", "**"}], "*", 
     RowBox[{"**", "**", "**", "**", "**"}]}], "********)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Inserts", " ", "right", " ", "arguement", " ", "into", " ", "operator", 
      " ", "style", " ", "xPartialD", " ", "into", " ", 
      RowBox[{"xPartialD", ".", "\[IndentingNewLine]", 
       RowBox[{"xPartialD", "[", 
        RowBox[{"_", ",", "mu"}], "]"}], ".", "RightArguement"}]}], " ", "->",
      " ", 
     RowBox[{"xPartialD", "[", 
      RowBox[{"RightArugement", ",", "mu"}], "]"}]}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"OperateDotRight", "=", 
     RowBox[{
      RowBox[{"Dot", "[", 
       RowBox[{"a___", ",", 
        RowBox[{"c___", " ", 
         RowBox[{"xPartialD", "[", 
          RowBox[{
           RowBox[{"HoldPattern", "[", "_", "]"}], ",", "mu_"}], "]"}]}], ",",
         "b_"}], "]"}], "\[Rule]", 
      RowBox[{"Dot", "[", 
       RowBox[{"a", ",", 
        RowBox[{"c", " ", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"b", ",", "mu"}], "]"}]}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Forms", " ", "dot", " ", "product", " ", "of", " ", "Tensor", " ", "ku_",
      " ", "over", " ", "index", " ", "m_"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dot2", "[", 
      RowBox[{"ku_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"ku", ".", 
      RowBox[{
       RowBox[{"LowerIndex", "[", 
        RowBox[{"m", ",", "m"}], "]"}], "[", "ku", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDIndexOrder", "::", "usage"}], "=", 
     "\"\<tuDIndexOrder[index_List] Rule[]s for canonically ordering indices \
in index_List of double derivatives *12Jan2016*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDIndexOrder", "[", "index_List", "]"}], ":=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"pp1", ":", 
          RowBox[{
           RowBox[{"tuDDown", "[", "s_", "]"}], "|", 
           RowBox[{"tuDUp", "[", "s_", "]"}]}]}], ")"}], "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"pp2", ":", 
            RowBox[{
             RowBox[{"tuDDown", "[", "s_", "]"}], "|", 
             RowBox[{"tuDUp", "[", "s_", "]"}]}]}], ")"}], "[", 
          RowBox[{"a_", ",", "i_"}], "]"}], ",", "j_"}], "]"}], 
       "\[RuleDelayed]", 
       RowBox[{
        RowBox[{"pp2", "[", 
         RowBox[{
          RowBox[{"pp1", "[", 
           RowBox[{"a", ",", "j"}], "]"}], ",", "i"}], "]"}], "/;", 
        RowBox[{
         RowBox[{"allMemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", "j"}], "}"}], ",", "index"}], "]"}], "&&", 
         RowBox[{"OrderedQ", "[", 
          RowBox[{"{", 
           RowBox[{"i", ",", "j"}], "}"}], "]"}]}]}]}], " ", 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"orderxPartialD", ":=", "tuDIndexOrder"}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"permutes", " ", "xPartialD", " ", "variables"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xPartialDPermute", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"xPartialD", "[", 
       RowBox[{
        RowBox[{"xPartialD", "[", 
         RowBox[{"v_", ",", "b"}], "]"}], ",", "a"}], "]"}], "->", 
      RowBox[{"xPartialD", "[", 
       RowBox[{
        RowBox[{"xPartialD", "[", 
         RowBox[{"v", ",", "a"}], "]"}], ",", "b"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Permutes", " ", 
     RowBox[{"IntegralOp", "'"}], "s"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"IntegralOpPermute", ":=", 
     RowBox[{
      RowBox[{"IntegralOp", "[", 
       RowBox[{"a_", ",", 
        RowBox[{"IntegralOp", "[", 
         RowBox[{"b_", ",", "c_"}], "]"}]}], "]"}], "->", 
      RowBox[{"IntegralOp", "[", 
       RowBox[{"b", ",", 
        RowBox[{"IntegralOp", "[", 
         RowBox[{"a", ",", "c"}], "]"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSeparateIntegralOpVar", "::", "usage"}], "=", 
     "\"\<tuIntegralOpInnerVar[var_List][int_IntegralOp] separates \
int_IntegralOp into two IntegralOp with variables not FreeQ of var_List in \
inner IntegralOp  *6Dec2012*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuSeparateIntegralOpVar", "[", "var_List", "]"}], "[", 
      "int_IntegralOp", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ivars", ",", "integrand", ",", "tmp"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ivars", ",", "integrand"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "int"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"var", ",", "ivars"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"int", "/.", 
          RowBox[{
           RowBox[{"IntegralOp", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
           RowBox[{"IntegralOp", "[", 
            RowBox[{
             RowBox[{"Select", "[", 
              RowBox[{"a", ",", 
               RowBox[{
                RowBox[{"ListFreeQ", "[", 
                 RowBox[{"#", ",", "var"}], "]"}], "&"}]}], "]"}], ",", 
             RowBox[{"IntegralOp", "[", 
              RowBox[{
               RowBox[{"Select", "[", 
                RowBox[{"a", ",", 
                 RowBox[{
                  RowBox[{"!", 
                   RowBox[{"ListFreeQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", "var", "}"}]}], "]"}]}], "&"}]}], "]"}], ",",
                "b"}], "]"}]}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        "tmp"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"IntegralOpInnerVar", "[", "var_List", "]"}], "[", 
      "int_IntegralOp", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuSeparateIntegralOpVar", "[", "var", "]"}], "[", "int", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "separateIntegralOp", " ", "Rule", " ", "for", " ", "separating", " ", 
     "multiple", " ", 
     RowBox[{"IntegralOp", "'"}], 
     RowBox[{"s", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"separateIntegralOp", ":=", 
    RowBox[{
     RowBox[{"IntegralOp", "[", 
      RowBox[{"a_List", ",", "b_"}], "]"}], "\[RuleDelayed]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "a", "]"}], ">", "1"}], ",", 
       RowBox[{"IntegralOp", "[", 
        RowBox[{
         RowBox[{"Most", "[", "a", "]"}], ",", 
         RowBox[{"IntegralOp", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Last", "[", "a", "]"}], "}"}], ",", "b"}], "]"}]}], 
        "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"IntegralOpInnerVar", "[", "var_List", "]"}], "[", 
      "int_IntegralOp", "]"}], " ", "separates", " ", "int_IntegralOp", " ", 
     "into", " ", "two", " ", "IntegralOp", " ", "with", " ", "variables", 
     " ", "not", " ", "FreeQ", " ", "of", " ", "var_List", " ", "in", " ", 
     "inner", " ", "IntegralOp", "  ", "*", "6", "Dec2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"IntegralOpInnerVar", "[", "var_List", "]"}], "[", 
      "int_IntegralOp", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ivars", ",", "integrand", ",", "tmp"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ivars", ",", "integrand"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "int"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"var", ",", "ivars"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"int", "/.", 
          RowBox[{
           RowBox[{"IntegralOp", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
           RowBox[{"IntegralOp", "[", 
            RowBox[{
             RowBox[{"Select", "[", 
              RowBox[{"a", ",", 
               RowBox[{
                RowBox[{"ListFreeQ", "[", 
                 RowBox[{"#", ",", "var"}], "]"}], "&"}]}], "]"}], ",", 
             RowBox[{"IntegralOp", "[", 
              RowBox[{
               RowBox[{"Select", "[", 
                RowBox[{"a", ",", 
                 RowBox[{
                  RowBox[{"!", 
                   RowBox[{"ListFreeQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", "var", "}"}]}], "]"}]}], "&"}]}], "]"}], ",",
                "b"}], "]"}]}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        "tmp"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"timespaceIntegralOpVar", "[", 
       RowBox[{"var_", ",", "index_"}], "]"}], "[", "int_IntegralOp", "]"}], 
     " ", "takes", " ", "all", " ", "var_", " ", "in", " ", "the", " ", 
     "int_IntegralOp", " ", "variables", " ", "and", " ", "separates", " ", 
     "their", " ", "index_", " ", "variable", " ", "into", " ", "time", " ", 
     "and", " ", "space", " ", 
     RowBox[{"components", "."}], "  ", "*", "7", "Dec2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"timespaceIntegralOpVar", "[", 
       RowBox[{"var_", ",", "index_"}], "]"}], "[", "int_IntegralOp", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "ivars", ",", "integrand", ",", "ivar0", ",", "ivar1", ",", "ivar10", 
         ",", "ivar11"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ivars", ",", "integrand"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "int"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"var", ",", "ivars"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ivar0", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"ivars", ",", 
           RowBox[{
            RowBox[{"ListFreeQ", "[", 
             RowBox[{"#", ",", 
              RowBox[{"{", "var", "}"}]}], "]"}], "&"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ivar1", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"ivars", ",", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"ListFreeQ", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", "var", "}"}]}], "]"}]}], "&"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"var", ",", "ivar1"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ivar10", "=", 
         RowBox[{"ivar1", "/.", 
          RowBox[{"var", ":>", 
           RowBox[{
            RowBox[{"IndexChangeTU", "[", 
             RowBox[{"{", 
              RowBox[{"index", ",", 
               RowBox[{"timespace", "@", "0"}]}], "}"}], "]"}], "[", "var", 
            "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ivar11", "=", 
         RowBox[{"ivar1", "/.", 
          RowBox[{"var", ":>", 
           RowBox[{
            RowBox[{"IndexChangeTU", "[", 
             RowBox[{"{", 
              RowBox[{"index", ",", 
               RowBox[{"timespace", "@", "1"}]}], "}"}], "]"}], "[", "var", 
            "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IntegralOp", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ivar0", ",", "ivar10", ",", "ivar11"}], "}"}], ",", 
            "1"}], "]"}], ",", "integrand"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"subtimespaceSum", "[", "index_", "]"}], " ", "Rule", " ", 
     "that", " ", "separates", " ", "UpDn", " ", "index_", " ", "of", " ", 
     "Tensor", " ", "product", " ", "into", " ", "sum", " ", "of", " ", 
     "products", " ", "of", " ", 
     RowBox[{"timespace", "@", "0"}], " ", "and", " ", 
     RowBox[{"timespace", "@", "1"}], " ", 
     RowBox[{"Tensors", "."}], " ", "*", "7", "Dec2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subtimespaceSum", "[", "index_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Tensor", "[", 
       RowBox[{"a_", ",", "au_List", ",", "ad_List"}], "]"}], 
      RowBox[{"Tensor", "[", 
       RowBox[{"b_", ",", "bu_List", ",", "bd_List"}], "]"}]}], ":>", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Tensor", "[", 
         RowBox[{"a", ",", 
          RowBox[{"(", 
           RowBox[{"au", "/.", 
            RowBox[{"index", "->", 
             RowBox[{"timespace", "@", "0"}]}]}], ")"}], ",", "ad"}], "]"}], 
        RowBox[{"Tensor", "[", 
         RowBox[{"b", ",", "bu", ",", 
          RowBox[{"(", 
           RowBox[{"bd", "/.", 
            RowBox[{"index", "->", 
             RowBox[{"timespace", "@", "0"}]}]}], ")"}]}], "]"}]}], "+", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tensor", "[", 
         RowBox[{"a", ",", 
          RowBox[{"(", 
           RowBox[{"au", "/.", 
            RowBox[{"index", "->", 
             RowBox[{"timespace", "@", "1"}]}]}], ")"}], ",", "ad"}], "]"}], 
        RowBox[{"Tensor", "[", 
         RowBox[{"b", ",", "bu", ",", 
          RowBox[{"(", 
           RowBox[{"bd", "/.", 
            RowBox[{"index", "->", 
             RowBox[{"timespace", "@", "1"}]}]}], ")"}]}], "]"}]}]}], "/;", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{"au", ",", "index"}], "]"}], "&&", 
       RowBox[{"MemberQ", "[", 
        RowBox[{"bd", ",", "index"}], "]"}]}]}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"sub\[Delta]func", "[", "var_", "]"}], " ", "converts", " ", 
      RowBox[{"\[Delta]", "[", 
       RowBox[{"func_", "[", "var_", "]"}], " ", "]"}], " ", "to", " ", 
      RowBox[{
       RowBox[{"\[Delta]", "[", " ", 
        RowBox[{"var_", "-", " ", 
         RowBox[{"fn", "[", "]"}]}], " ", "]"}], "/", 
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"D", ",", "var"}], "]"}], ".", "  ", 
        RowBox[{"NOTE", ":", " ", 
         RowBox[{
         "There", " ", "is", " ", "a", " ", "difference", " ", "if", " ", 
          "UpDn", " ", "contractions", " ", "are", " ", "used", " ", "in", 
          " ", "func_", " ", "of", " ", "a", " ", "factor", " ", "of", " ", 
          "2", " ", "and", " ", 
          RowBox[{
           RowBox[{"Sqrt", "[", "]"}], ".", "  ", "Only"}], " ", "uses", " ", 
          "last", " ", 
          RowBox[{"Solve", "[", "]"}], " ", 
          RowBox[{"result", ".", " ", "Also"}]}]}]}]}]}], ",", " ", 
     RowBox[{
     "only", " ", "for", " ", "scalar", " ", "var_.", " ", " ", "*", "8", 
      "Dec2012"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"sub\[Delta]func", "[", "var_", "]"}], ":=", 
     RowBox[{
      RowBox[{"\[Delta]", "[", "func_", "]"}], ":>", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Delta]", "[", 
         RowBox[{
          RowBox[{"$$t", "=", 
           RowBox[{
            RowBox[{"Solve", "[", 
             RowBox[{
              RowBox[{"func", "==", "0"}], ",", "var"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ";", 
          RowBox[{
           RowBox[{"$$t", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "-", 
           RowBox[{"$$t", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], "/", 
        RowBox[{"Abs", "[", 
         RowBox[{"D", "[", 
          RowBox[{"func", ",", "var"}], "]"}], "]"}]}], "/;", 
       RowBox[{"!", 
        RowBox[{"FreeQ", "[", 
         RowBox[{"func", ",", "var"}], "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"integrate\[Delta]func", "[", "var_", "]"}], " ", "applies", 
        " ", "the", " ", "relation", "  ", 
        RowBox[{"DiracDelta", "[", 
         RowBox[{"f", "[", "x", "]"}], "]"}]}], "\[Equal]", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"DiracDelta", "[", 
           RowBox[{"x", "-", 
            RowBox[{"Subscript", "[", 
             RowBox[{"x", ",", "j"}], "]"}]}], "]"}], "/", 
          RowBox[{"Abs", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", "1", "]"}], "[", "f", "]"}], "[", 
            RowBox[{"Subscript", "[", 
             RowBox[{"x", ",", "j"}], "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", "n"}], "}"}]}], "]"}]}], "/;", 
      RowBox[{
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"Subscript", "[", 
          RowBox[{"x", ",", "j"}], "]"}], "]"}], "\[Equal]", "0"}], "&&", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Derivative", "[", "1", "]"}], "[", "f", "]"}], "[", 
         RowBox[{"Subscript", "[", 
          RowBox[{"x", ",", "j"}], "]"}], "]"}], "\[NotEqual]", 
        RowBox[{"0", " ", "\[IndentingNewLine]", "to", " ", 
         RowBox[{"IntegralOp", "[", 
          RowBox[{"var_", ",", " ", 
           RowBox[{
            RowBox[{"\[Delta]", "[", 
             RowBox[{"func_", "[", "var_", "]"}], "]"}], " ", "other_"}]}], 
          " ", "]"}]}]}]}]}], " ", "->", " ", 
     RowBox[{
      RowBox[{"x\[Delta]", "[", 
       RowBox[{"var_", "->", "fn"}], "]"}], " ", 
      RowBox[{"other_", " ", "/", " ", 
       RowBox[{"Abs", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"func_", ",", "var_"}], "]"}], ".", "  ", "The"}], " ", 
           RowBox[{"x\[Delta]", "[", 
            RowBox[{"var_", "->", "fn"}], "]"}], " ", "indicates", " ", 
           "that", " ", "the", " ", "integration", " ", "has", " ", "been", 
           " ", "appled", " ", "and", " ", "var_"}], "->", 
          RowBox[{
          "fn", " ", "is", " ", "a", " ", "relationship", " ", "that", " ", 
           "must", " ", "be", " ", 
           RowBox[{"maintained", ".", "\[IndentingNewLine]", 
            RowBox[{"NOTE", ":", " ", 
             RowBox[{
             "There", " ", "is", " ", "a", " ", "difference", " ", "if", " ", 
              "UpDn", " ", "contractions", " ", "are", " ", "used", " ", "in",
               " ", "func_", " ", "of", " ", "a", " ", "factor", " ", "of", 
              " ", "2", " ", "and", " ", 
              RowBox[{
               RowBox[{"Sqrt", "[", "]"}], ".", "  ", "Only"}], " ", "uses", 
              " ", "last", " ", 
              RowBox[{"Solve", "[", "]"}], " ", 
              RowBox[{"result", ".", " ", " ", "Also"}]}]}]}]}]}], ",", " ", 
         RowBox[{
         "only", " ", "for", " ", "scalar", " ", "var_.", "    ", "*", "5", 
          "May2014"}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"integrate\[Delta]funcRule", "[", "var_", "]"}], ":=", 
     RowBox[{
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", "var", "}"}], "}"}], ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"other_:", "1"}], ")"}], "  ", 
         RowBox[{"\[Delta]", "[", "func_", "]"}]}]}], "]"}], ":>", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"other", " ", 
           RowBox[{
            RowBox[{"x\[Delta]", "[", 
             RowBox[{"$$t", "=", 
              RowBox[{
               RowBox[{"Solve", "[", 
                RowBox[{
                 RowBox[{"func", "==", "0"}], ",", "var"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "]"}], "/", 
            RowBox[{"Abs", "[", 
             RowBox[{"D", "[", 
              RowBox[{"func", ",", "var"}], "]"}], "]"}]}]}], "/.", "$$t"}], "/.", 
         RowBox[{
          RowBox[{"x\[Delta]", "[", "_", "]"}], "->", "1"}]}], ")"}], "/;", 
       RowBox[{"!", 
        RowBox[{"FreeQ", "[", 
         RowBox[{"func", ",", "var"}], "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"integrate\[Delta]funcRule1", "[", "var_List", "]"}], "[", 
       "exp_", "]"}], " ", "perform", " ", "integration", " ", "where", " ", 
      "the", " ", "integrand", " ", "contains", " ", 
      RowBox[{
       RowBox[{"\[Delta]", "[", "func_", "]"}], ".", "  ", "Mathematica"}], 
      " ", "Integrate", " ", "is", " ", 
      RowBox[{"used", ".", "\[IndentingNewLine]", "var_List"}], " ", "is", 
      " ", "integration", " ", "variable", " ", "with", " ", "limits", " ", 
      "to", " ", "distinquish", " ", "the", " ", "integral"}], ",", " ", 
     RowBox[{"e", ".", "g", ".", " ", 
      RowBox[{"{", 
       RowBox[{"x", ",", 
        RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]"}], "}"}]}], ",", " ", 
     RowBox[{
      RowBox[{"in", " ", "multi"}], "-", 
      RowBox[{"integral", " ", 
       RowBox[{"situation", ".", " ", "The"}], " ", "result", " ", "may", " ",
        "need", " ", "further", " ", 
       RowBox[{"manipulation", ".", "  ", "Replaces"}], " ", 
       RowBox[{"integrate\[Delta]funcRule", "."}], " ", "*", "23", 
       "Jul2014"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"integrate\[Delta]funcRule1", "[", "var_List", "]"}], "[", 
      "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "terms"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"IntegralOp", "[", 
            RowBox[{
             RowBox[{"{", "var", "}"}], ",", "_"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"tmp", "/.", 
            RowBox[{
             RowBox[{"\[Delta]", "[", "a_", "]"}], ":>", 
             RowBox[{
              RowBox[{"DiracDelta", "[", "a", "]"}], "/;", 
              RowBox[{"!", 
               RowBox[{"FreeQ", "[", 
                RowBox[{"a", ",", 
                 RowBox[{"var", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}]}], "/.", 
           "subxIntegrate"}], "/.", "subIntegrate"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"exp", ",", "tmp"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegrate\[Delta]func", "::", "usage"}], "=", 
     "\"\<tuIntegrate\[Delta]func[var_]exp_?(tuMemberQ[#,{xIntegral[_,_],\
tuIntegral[_,_]}]&) 'integrates' exp_ over var_ if var_ is contained in \
\[Delta][] by Solve[]ing the integrand at Arguement[\[Delta][]]->0. NOTE: \
does not check for valid range of var_. Typical use: \
exp/.ii:xIntegral[_,_]:>integrate\[Delta]func[\!\(\*SubscriptBox[\(x\), \
\(3\)]\)][ii] *6Jan2017*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIntegrate\[Delta]func", "[", "var_", "]"}], "[", 
      RowBox[{"exp_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"tuMemberQ", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"xIntegral", "[", 
              RowBox[{"_", ",", "_"}], "]"}], ",", 
             RowBox[{"tuIntegral", "[", 
              RowBox[{"_", ",", "_"}], "]"}]}], "}"}]}], "]"}], "&"}], 
        ")"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "vars", ",", "intvar", ",", 
         "integrand", ",", "dfuncs", ",", "dfunc", ",", "df", ",", "$$t", ",",
          "x\[Delta]", ",", "head", ",", "args"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"head", "=", 
         RowBox[{"Head", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"args", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "tmp"}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{
         "\"\<args:\>\"", ",", "head", ",", "\"\<:\>\"", ",", "args"}], "]"}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"MatchQ", "[", 
            RowBox[{"tmp", ",", 
             RowBox[{"xIntegral", "[", 
              RowBox[{"_", ",", "_"}], "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"vars", ",", "integrand"}], "}"}], "=", "args"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"integrand", "=", 
             RowBox[{"First", "[", "args", "]"}]}], ",", 
            RowBox[{"vars", "=", 
             RowBox[{"Rest", "[", "args", "]"}]}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<integrand,vars\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"integrand", ",", "vars"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dfuncs", "=", 
         RowBox[{
          RowBox[{"ExtractPattern", "[", 
           RowBox[{"\[Delta]", "[", "_", "]"}], "]"}], "[", "integrand", 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"FreeQ", "[", 
            RowBox[{"vars", ",", "var"}], "]"}], "||", 
           RowBox[{"FreeQ", "[", 
            RowBox[{"dfuncs", ",", "var"}], "]"}]}], ",", 
          RowBox[{"Return", "[", "exp", "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"no", " ", "OP", " ", "var"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"form", " ", "of", " ", 
          RowBox[{"vars", ":", " ", 
           RowBox[{
            RowBox[{"{", "x", "}"}], "||", 
            RowBox[{"{", 
             RowBox[{"x", ",", "y"}], "}"}], "||", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"x", ",", "_", ",", "_"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", "_", ",", "_"}], "}"}]}], "}"}]}]}]}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"intvar", "=", 
            RowBox[{
             RowBox[{"Cases", "[", 
              RowBox[{"vars", ",", "var"}], "]"}], "//", "First"}]}], ")"}], 
          ",", "Null", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"intvar", "=", 
            RowBox[{
             RowBox[{"Cases", "[", 
              RowBox[{"vars", ",", 
               RowBox[{"{", 
                RowBox[{"var", ",", "___"}], "}"}]}], "]"}], "//", 
             "First"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"vars", "=", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"vars", ",", "intvar"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"use", " ", "first", " ", 
          RowBox[{"\[Delta]", "[", "]"}], " ", "with", " ", "var"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"df", "=", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"dfuncs", ",", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"FreeQ", "[", 
               RowBox[{"#", ",", "var"}], "]"}]}], "&"}]}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"integrand", "=", 
         RowBox[{"integrand", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"other_:", "1"}], ")"}], "  ", 
            RowBox[{"\[Delta]", "[", "df", "]"}]}], ":>", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"other", "  ", 
               RowBox[{
                RowBox[{"x\[Delta]", "[", 
                 RowBox[{"$$t", "=", 
                  RowBox[{
                   RowBox[{"Solve", "[", 
                    RowBox[{
                    RowBox[{"df", "==", "0"}], ",", "var"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "]"}], 
                "/", 
                RowBox[{"Abs", "[", 
                 RowBox[{"D", "[", 
                  RowBox[{"df", ",", "var"}], "]"}], "]"}]}]}], "/.", "$$t"}],
              "/.", 
             RowBox[{
              RowBox[{"x\[Delta]", "[", "_", "]"}], "->", "1"}]}], 
            ")"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "vars", "]"}], ">", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"MatchQ", "[", 
              RowBox[{"tmp", ",", 
               RowBox[{"xIntegral", "[", 
                RowBox[{"_", ",", "_"}], "]"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"IntegralOp", "[", 
             RowBox[{"vars", ",", "integrand"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"xIntegral", "[", 
             RowBox[{"integrand", ",", "vars"}], "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", "integrand"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"integrate\[Delta]func", "[", "var_", "]"}], "[", 
      RowBox[{
       RowBox[{"exp_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"tuMemberQ", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"xIntegral", "[", 
               RowBox[{"_", ",", "_"}], "]"}], ",", 
              RowBox[{"tuIntegral", "[", 
               RowBox[{"_", ",", "_"}], "]"}]}], "}"}]}], "]"}], "&"}], 
         ")"}]}], "_"}], "]"}], "=", 
     RowBox[{
      RowBox[{"tuIntegrate\[Delta]func", "[", "var", "]"}], "[", "exp", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"integrate\[Delta]funcUpDn", "[", "var_", "]"}], " ", "does", 
     " ", "the", " ", "same", " ", "as", " ", 
     RowBox[{"integrate\[Delta]func", "[", "var_", "]"}], " ", "except", " ", 
     "that", " ", "convert", " ", "any", " ", "UpDn", " ", "var_", " ", 
     "pairs", " ", "to", " ", "var_", " ", 
     RowBox[{"pairs", "."}], "   ", "*", "4", "May2014"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"integrate\[Delta]funcUpDn", "[", 
       RowBox[{"var_", ",", "index_"}], "]"}], "[", "exp_IntegralOp", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "subupdn"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"subupdn", "=", 
         RowBox[{
          RowBox[{"var", " ", 
           RowBox[{
            RowBox[{"UpDownIndexSwap", "[", "index", "]"}], "[", "var", 
            "]"}]}], "->", 
          RowBox[{"var", " ", "var"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", "subupdn"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"subupdn", ",", "tmp"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "/.", 
         RowBox[{
          RowBox[{"IntegralOp", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", "var", "}"}], "}"}], ",", 
            RowBox[{"other_", " ", 
             RowBox[{"\[Delta]", "[", "func_", "]"}]}]}], "]"}], ":>", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"other", " ", 
               RowBox[{
                RowBox[{"x\[Delta]", "[", 
                 RowBox[{"$$t", "=", 
                  RowBox[{
                   RowBox[{"Solve", "[", 
                    RowBox[{
                    RowBox[{"func", "==", "0"}], ",", "var"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "]"}], 
                "/", 
                RowBox[{"Abs", "[", 
                 RowBox[{"D", "[", 
                  RowBox[{"func", ",", "var"}], "]"}], "]"}]}]}], "/.", 
              "$$t"}], "/.", 
             RowBox[{
              RowBox[{"x\[Delta]", "[", "_", "]"}], "->", "1"}]}], ")"}], "/;", 
           RowBox[{"!", 
            RowBox[{"FreeQ", "[", 
             RowBox[{"func", ",", "var"}], "]"}]}]}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Print", " ", "routine", " ", "for", " ", "DEBUGing", " ", 
     RowBox[{"Modules", "."}]}], "  ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IfDEBUG", "[", 
      RowBox[{"name_", ",", "DEBUG_", ",", "list_", ",", "comment_"}], "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"DEBUG", "==", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "name", ",", "\"\<:\>\"", ",", "comment", ",", "\"\<:\>\"", ",", 
             "list"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Factors", " ", "exp_", " ", "in", " ", "form", " ", 
      RowBox[{"1", "/", 
       RowBox[{"(", 
        RowBox[{"A_", " ", "B"}], ")"}]}], " ", "into", " ", 
      RowBox[{"1", "/", "A"}]}], "-", 
     RowBox[{
      RowBox[{"1", "/", "B"}], " ", 
      RowBox[{"form", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FactorABinv", "[", 
      RowBox[{"exp_", ",", "A_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Binv", ",", "B", ",", "tmp", ",", 
         RowBox[{"numer", "=", 
          RowBox[{"Numerator", "[", "exp", "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"B", "=", 
         RowBox[{"1", "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"A", " ", 
             RowBox[{"exp", "/", "numer"}]}], "//", "Simplify"}], ")"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"1", "/", "A"}], "-", 
            RowBox[{"1", "/", "B"}]}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"B", "-", "A"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"numer", " ", "tmp", 
          RowBox[{"(", 
           RowBox[{"B", "-", "A"}], ")"}]}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Factors", " ", "exp_", " ", "in", " ", "form", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "/", "A"}], ")"}], ".", 
       RowBox[{"(", 
        RowBox[{"1", "/", "B"}], ")"}]}], " ", "into", " ", 
      RowBox[{"1", "/", "A"}]}], "-", 
     RowBox[{
      RowBox[{"1", "/", "B"}], " ", 
      RowBox[{"form", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FactorDotABinv", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"A", ",", "Binv", ",", "B", ",", "tmp", ",", 
         RowBox[{"numer", "=", 
          RowBox[{"Numerator", "[", "exp", "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"A", "=", 
         RowBox[{"1", "/", 
          RowBox[{"First", "[", "exp", "]"}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"B", "=", 
         RowBox[{"1", "/", 
          RowBox[{"Last", "[", "exp", "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"B", "-", "A"}], "/.", 
             RowBox[{"Dot", "\[Rule]", "Times"}]}], "//", "Expand"}], "//", 
           "SimplifyTensorSum"}], "//", "UpDownAdjust"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"1", "/", "A"}], "-", 
            RowBox[{"1", "/", "B"}]}], ")"}], "/", "tmp"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"ReplaceVariableNames", 
     RowBox[{"{", "}"}], " ", "replaces", " ", "exp_", " ", "with", " ", 
     "standard", " ", "set", " ", "of", " ", "variables", " ", "of", " ", 
     "form", " ", "S$nnnn", " ", "for", " ", 
     RowBox[{"manipulation", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"StandardVariableNames", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "list"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"list", "=", 
         RowBox[{
          RowBox[{"tmp", "/.", 
           RowBox[{
            RowBox[{"Dot", "|", "Times", "|", "Plus", "|", "Power"}], "->", 
            "List"}]}], "//", "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"list", "=", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"list", ",", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"NumericQ", "[", "#", "]"}]}], "&"}]}], "]"}], "//", 
          "Union"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#", "->", 
              RowBox[{"Unique", "[", "S", "]"}]}], "}"}], "&"}], ",", 
           "list"}], "]"}], "//", "Flatten"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuExtractPattern", "::", "usage"}], "=", 
     "\"\<tuExtractPattern[pattern_,maxlevel_:Infinity][exp_] extracts a List \
of items in exp_ that match pattern_ to maxlevel_. *3Feb2014* \>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuExtractPattern", "[", 
       RowBox[{"pattern_", ",", 
        RowBox[{"maxlevel_:", "Infinity"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "pos", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pos", "=", 
         RowBox[{"Position", "[", 
          RowBox[{"exp", ",", "pattern", ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "maxlevel"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Extract", "[", 
         RowBox[{"exp", ",", "pos"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"ExtractPattern", ":=", "tuExtractPattern"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"ExtractPatternXpat", "[", "pattern_", "]"}], "[", "exp_", 
      "]"}], " ", "extracts", " ", "pattern_", " ", "or", " ", "pattern_List",
      " ", "from", " ", "exp_", " ", "and", " ", "outputs", " ", "lists", " ",
      "of", " ", "matches", " ", "to", " ", 
     RowBox[{"{", 
      RowBox[{"Xpat", "[", "pattern_", "]"}], "}"}], " ", "and", " ", 
     RowBox[{"{", "exp_", "}"}], " ", "where", " ", 
     RowBox[{"Xpat", "[", "pattern_", "]"}], " ", "was", " ", 
     RowBox[{"found", ".", "  ", "Avoids"}], " ", "the", " ", 
     RowBox[{"Times", "[", "]"}], " ", "difficulty", " ", "with", " ", 
     RowBox[{
      RowBox[{"Position", "[", "]"}], "."}], "  ", "*", "26", "Jul2013"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ExtractPatternXpat", "[", "pattern_", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "$i", ",", "test", ",", 
         RowBox[{"$pat", "=", 
          RowBox[{"{", "}"}]}], ",", "list", ",", "sub", ",", "$npat", ",", 
         "$ii", ",", "xpat", ",", "ipat", ",", "patterns", ",", "testpat"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"patterns", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "pattern", "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"$i", "=", "1"}], ",", 
          RowBox[{"test", "=!=", "tmp"}], ",", 
          RowBox[{"$i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{"(*", 
            RowBox[{"for", " ", "every", " ", "pattern"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"test", "=", "tmp"}], ";", "\[IndentingNewLine]", 
             RowBox[{"tmp", "=", 
              RowBox[{"tmp", "/.", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"pp", ":", 
                  RowBox[{"patterns", "[", 
                   RowBox[{"[", "ipat", "]"}], "]"}]}], ")"}], 
                "\[RuleDelayed]", 
                RowBox[{"xpat", "[", 
                 RowBox[{"Last", "[", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"$pat", ",", 
                    RowBox[{"Xpat", "[", "pp", "]"}]}], "]"}], "]"}], 
                 "]"}]}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"tmp", "=", 
              RowBox[{"tmp", "/.", 
               RowBox[{
                RowBox[{"xpat", "[", "_", "]"}], ":>", 
                RowBox[{"$npat", "[", 
                 RowBox[{"Length", "[", "$pat", "]"}], "]"}]}]}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"ipat", ",", 
              RowBox[{"Length", "[", "patterns", "]"}]}], "}"}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"$ii", "=", "1"}], ",", 
          RowBox[{"$ii", "<=", 
           RowBox[{"Length", "[", "$pat", "]"}]}], ",", 
          RowBox[{"$ii", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{
             RowBox[{"$npat", "[", "$ii", "]"}], "\[RuleDelayed]", 
             RowBox[{"$pat", "[", 
              RowBox[{"[", "$ii", "]"}], "]"}]}]}]}]}], "\[IndentingNewLine]",
          "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"$pat", ",", "tmp"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"keepPlusTerms", "[", "ext_", "]"}], "[", "exp_", "]"}], " ", 
     "keeps", " ", "terms", " ", "in", " ", 
     RowBox[{"Plus", "[", "]"}], " ", "that", " ", "are", " ", "not", " ", 
     "FreeQ", " ", "of", " ", "ext_", " ", "*", "25", "Oct2014"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"keepPlusTerms", "[", "ext_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"exp", "/.", 
          RowBox[{"Plus", "\[Rule]", "xPlus"}]}], "/.", 
         RowBox[{
          RowBox[{"xx", ":", 
           RowBox[{"xPlus", "[", "a__", "]"}]}], "\[RuleDelayed]", 
          RowBox[{"Select", "[", 
           RowBox[{"xx", ",", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"FreeQ", "[", 
               RowBox[{"#", ",", "ext"}], "]"}]}], "&"}]}], "]"}]}]}], "/.", 
        RowBox[{"xPlus", "\[Rule]", "Plus"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Applies", " ", "function_", " ", "to", " ", "Tensor", " ", "products", 
     " ", "in", " ", "Times", " ", "expression", " ", "exp_."}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ApplyToTensorProductOnly", "[", 
      RowBox[{"function_", ",", "exp_Times"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "tmpt", ",", "tmpa"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "exp"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmpt", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Head", "[", "#", "]"}], "===", "Tensor"}], ",", "#", 
              ",", "1"}], "]"}], "&"}], ",", "tmp"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmpa", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Head", "[", "#", "]"}], "===", "Tensor"}], ",", "1", 
              ",", "#"}], "]"}], "&"}], ",", "tmp"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmpt", "=", 
         RowBox[{"function", "[", 
          RowBox[{"Apply", "[", 
           RowBox[{"Times", ",", "tmpt"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmpa", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"Times", ",", "tmpa"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmpa", " ", "tmpt"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "returns", " ", "Tensor", " ", "product", " ", "terms", " ", "in", " ", 
     "Times", " ", "expression", " ", "exp_."}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"TensorProductOnly", "[", "exp_Times", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "exp"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Head", "[", "#", "]"}], "===", "Tensor"}], ",", "#", 
              ",", "1"}], "]"}], "&"}], ",", "tmp"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"Times", ",", "tmp"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"returns", " ", "Position"}], "->", 
     RowBox[{"Patterns", " ", "of", " ", "Tensor", " ", "products"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ExtractTensorProducts", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Times", "[", 
            RowBox[{"a___", ",", 
             RowBox[{"Tensor", "[", "___", "]"}], ",", "b___"}], "]"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MapAt", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"TensorProductOnly", "[", "#", "]"}], "&"}], ",", "#", 
             ",", "2"}], "]"}], "&"}], ",", "tmp"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "apply", " ", "function_", " ", "to", " ", "Tensor", " ", "products", " ",
      "in", " ", "exp_."}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ApplyToTensorProducts", "[", 
      RowBox[{"function_", ",", "exp_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Times", "[", 
            RowBox[{"a___", ",", 
             RowBox[{"Tensor", "[", "___", "]"}], ",", "b___"}], "]"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"MapAt", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ApplyToTensorProductOnly", "[", 
                RowBox[{"function", ",", "#"}], "]"}], "&"}], ",", "#", ",", 
              "2"}], "]"}], "&"}], ",", "tmp"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ReplacePart", "[", 
         RowBox[{"exp", ",", "tmp"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "ReplaceExtract", " ", "returns", " ", "extract_List", " ", "second", " ",
      "items", " ", "with", " ", "repl_List"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ReplaceExtract", "[", 
      RowBox[{"extract_List", ",", "repl_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Rule", "[", 
           RowBox[{
            RowBox[{"First", "[", "#1", "]"}], ",", "#2"}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"extract", ",", "repl"}], "}"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Tests", " ", "exp_", " ", "to", " ", "be", " ", "FreeQ", " ", "of", " ", 
     "any", " ", "patterns_."}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FreePattern", "[", 
      RowBox[{"exp_", ",", "patterns_List"}], "]"}], ":=", 
     RowBox[{"And", "@@", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FreeQ", "[", 
          RowBox[{"exp", ",", "#"}], "]"}], "&"}], ",", "patterns"}], 
       "]"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Runs", " ", "Collect", " ", "after", " ", "substituting", " ", "for", 
       " ", "matched", " ", 
       RowBox[{"patterns", ".", "  ", "The"}], " ", "pattern", " ", "may", 
       " ", "be", " ", "of", " ", "form", " ", "P1"}], "|", 
      RowBox[{
       RowBox[{"P2", ".", "  ", "Patterns"}], " ", "involving", " ", "Times", 
       " ", "do", " ", "not", " ", "work"}]}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"e", ".", "g", ".", " ", "pattern_"}], "->", " ", 
            RowBox[{
             RowBox[{"Tensor", "[", 
              RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], 
             RowBox[{"Tensor", "[", 
              RowBox[{"d_", ",", "e_", ",", "f_"}], "]"}], 
             "\[IndentingNewLine]", "One", " ", "way", " ", "around", " ", 
             "it", " ", "is", " ", "to", " ", "use", " ", "substitution", " ", 
             RowBox[{"first", ":", "\[IndentingNewLine]", "sub"}]}]}], "=", 
           RowBox[{
            RowBox[{
             RowBox[{"Tensor", "[", 
              RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], 
             RowBox[{"Tensor", "[", 
              RowBox[{"d_", ",", "e_", ",", "f_"}], "]"}]}], "\[Rule]", 
            RowBox[{"Tensor2", "[", 
             RowBox[{"a", ",", "b", ",", "c", ",", "d", ",", "e", ",", "f"}], 
             "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"subr", "=", 
           RowBox[{"RuleX1", "[", 
            RowBox[{"sub", ",", " ", 
             RowBox[{"Tensor2", "[", "___", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "b", ",", "c", ",", "d", ",", "e", ",", "f"}],
               "}"}]}], "]"}]}], ";"}], " ", "\[LongLeftArrow]", "reverse"}], 
        " ", "substitution", "\[IndentingNewLine]", "tmp"}], "=", 
       RowBox[{"tmp", "/.", " ", "sub"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"CollectPattern", "[", 
        RowBox[{"tmp", ",", 
         RowBox[{"Tensor2", "[", "___", "]"}]}], "]"}], "/.", "subr"}]}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CollectPattern", "[", 
      RowBox[{"exp_", ",", "pattern_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"pos", "=", 
          RowBox[{"Position", "[", 
           RowBox[{"exp", ",", "pattern"}], "]"}]}], ",", "tmp", ",", 
         "varlist", ",", "sub", ",", "uvar"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"varlist", "=", 
         RowBox[{
          RowBox[{"Extract", "[", 
           RowBox[{"exp", ",", "pos"}], "]"}], "//", "Union"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"uvar", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Unique", "[", "]"}], "&"}], ",", "varlist"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"sub", "=", 
         RowBox[{"MapThread", "[", 
          RowBox[{"Rule", ",", 
           RowBox[{"{", 
            RowBox[{"varlist", ",", "uvar"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "/.", "sub"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Collect", "[", 
          RowBox[{"tmp", ",", "uvar"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "/.", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Reverse", "[", "#", "]"}], "&"}], ",", "sub"}], 
          "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Extract", " ", "from", " ", 
     RowBox[{"Dot", "[", "]"}], " ", "expression", " ", "elements", " ", 
     "that", " ", "do", " ", "not", " ", "match", " ", "any", " ", "of", " ", 
     "the", " ", 
     RowBox[{"patterns", ".", " ", 
      RowBox[{"Usage", ":", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"DotKeepPattern1", "[", "patternlist", "]"}], "[", 
          "expression", "]"}], ".", "  ", "Returns"}], " ", 
        RowBox[{"(", "nokeeps", ")"}], " ", 
        RowBox[{"Dot", "[", " ", "keeps", " ", "]"}]}]}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DotKeepPattern1", "[", "patterns_", "]"}], "[", "exp_", "]"}], 
     ":=", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "dot", ",", "times", ",", "test", 
         ",", "dots", ",", "pos", ",", 
         RowBox[{"repl", "=", 
          RowBox[{"{", "}"}]}], ",", "i", ",", 
         RowBox[{"DEBUG", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        StyleBox[
         RowBox[{"DotExpandMode", "[", "False", "]"}],
         FontWeight->"Bold"], 
        StyleBox[";",
         FontWeight->"Bold"], 
        StyleBox["\[IndentingNewLine]",
         FontWeight->"Bold"], 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotKeepPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "exp", "}"}], ",", "\"\<exp\>\""}], "]"}], ";", 
        StyleBox["\[IndentingNewLine]",
         FontWeight->"Bold"], 
        StyleBox[
         RowBox[{"pos", "=", 
          RowBox[{"Position", "[", 
           RowBox[{"exp", ",", 
            RowBox[{"HoldPattern", "[", 
             RowBox[{"Dot", "[", "__", "]"}], "]"}]}], "]"}]}],
         FontWeight->"Bold"], 
        StyleBox[";",
         FontWeight->"Bold"], 
        StyleBox["\[IndentingNewLine]",
         FontWeight->"Bold"], 
        StyleBox[
         RowBox[{"dots", "=", 
          RowBox[{"Extract", "[", 
           RowBox[{"exp", ",", "pos"}], "]"}]}],
         FontWeight->"Bold"], 
        StyleBox[";",
         FontWeight->"Bold"], 
        StyleBox["\[IndentingNewLine]",
         FontWeight->"Bold"], 
        RowBox[{
         StyleBox["For",
          FontWeight->"Bold"], 
         StyleBox["[",
          FontWeight->"Bold"], 
         RowBox[{
          StyleBox[
           RowBox[{"i", "=", "1"}],
           FontWeight->"Bold"], 
          StyleBox[",",
           FontWeight->"Bold"], 
          RowBox[{
           StyleBox["i",
            FontWeight->"Bold"], 
           StyleBox["\[LessEqual]",
            FontWeight->"Bold"], 
           RowBox[{"Length", "[", "dots", "]"}]}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"dot", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"dots", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"IfDEBUG", "[", 
            RowBox[{"\"\<DotKeepPattern\>\"", ",", 
             RowBox[{"DEBUG", ">", "0"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "tmp"}], "}"}], ",", "\"\<{i,tmp}\>\""}], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"Times", "->", "Dot"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"Apply", "[", 
             RowBox[{"List", ",", "tmp"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"test", "=", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"FreePattern", "[", 
                RowBox[{"#", ",", "patterns"}], "]"}], "&"}], ",", "tmp"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"times", "=", 
            RowBox[{"Pick", "[", 
             RowBox[{"tmp", ",", "test", ",", "True"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"times", "=", 
            RowBox[{"Apply", "[", 
             RowBox[{"Times", ",", "times"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"dot", "=", 
            RowBox[{"Pick", "[", 
             RowBox[{"tmp", ",", "test", ",", "False"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"dot", "=", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "dot", "]"}], ">", "0"}], ",", 
              RowBox[{"Apply", "[", 
               RowBox[{"Dot", ",", "dot"}], "]"}], ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"repl", ",", 
             RowBox[{
              RowBox[{"pos", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "->", 
              RowBox[{"(", 
               RowBox[{"times", " ", "dot"}], ")"}]}]}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"exp", ",", "repl"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*****)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Extracts", " ", "terms", " ", "in", " ", "DotExp_", " ", "that", " ", 
      "do", " ", "not", " ", "match", " ", "patterns_", " ", "in", " ", 
      RowBox[{"Dot", "[", "]"}]}], "->", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"no", " ", "match"}], ")"}], " ", 
      RowBox[{
       RowBox[{"Dot", "[", "match", "]"}], ".", "  ", 
       RowBox[{"Doesn", "'"}]}], "t", " ", "work", " ", "for", " ", 
      RowBox[{
       RowBox[{"Power", "[", 
        RowBox[{
         RowBox[{"a", " ", "b"}], ",", 
         RowBox[{"n", " ", "m"}]}], "]"}], "."}]}]}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DotPatternIn", "[", "patterns_", "]"}], "[", "DotExp_", "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "DotExp"}], ",", "test", ",", "times", ",", 
         "dot", ",", 
         RowBox[{"DEBUG", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"patterns", ",", "tmp"}], "}"}], ",", "\"\<{tmp}\>\""}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", "tmp", "]"}], "//.", 
           RowBox[{
            RowBox[{"Times", "|", "Dot"}], "->", "List"}]}], "//", 
          "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "2"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<{tmp}\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"test", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"FreePattern", "[", 
             RowBox[{"#", ",", "patterns"}], "]"}], "&"}], ",", "tmp"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "2"}], ",", 
          RowBox[{"{", "test", "}"}], ",", "\"\<{test}\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"times", "=", 
         RowBox[{"Pick", "[", 
          RowBox[{"tmp", ",", "test", ",", "True"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"times", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"Times", ",", "times"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dot", "=", 
         RowBox[{"Pick", "[", 
          RowBox[{"tmp", ",", "test", ",", "False"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dot", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "dot", "]"}], ">", "0"}], ",", 
           RowBox[{"Apply", "[", 
            RowBox[{"Dot", ",", "dot"}], "]"}], ",", "1"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "2"}], ",", 
          RowBox[{"{", 
           RowBox[{"times", ",", "dot"}], "}"}], ",", "\"\<{times,dot}\>\""}],
          "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"times", " ", "dot"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<result\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"4.25", ".10"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DotPatternIn1", "[", "patterns_", "]"}], "[", "DotExp_", "]"}],
      ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "DotExp"}], ",", "test", ",", "times", ",", 
         "dot", ",", 
         RowBox[{"DEBUG", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"patterns", ",", "tmp"}], "}"}], ",", "\"\<{input}\>\""}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", "tmp", "]"}], "//.", 
           RowBox[{
            RowBox[{"Times", "|", "Dot"}], "\[Rule]", "xDot"}]}], "//", 
          "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "2"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<{tmp}\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"test", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"FreePattern", "[", 
             RowBox[{"#", ",", "patterns"}], "]"}], "&"}], ",", "tmp"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "2"}], ",", 
          RowBox[{"{", "test", "}"}], ",", "\"\<{test}\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"times", "=", 
         RowBox[{"Pick", "[", 
          RowBox[{"tmp", ",", "test", ",", "True"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"times", "=", 
         RowBox[{"times", "/.", 
          RowBox[{"xDot", "\[Rule]", "Times"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dot", "=", 
         RowBox[{"Pick", "[", 
          RowBox[{"tmp", ",", "test", ",", "False"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dot", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "dot", "]"}], ">", "0"}], ",", 
           RowBox[{"dot", "/.", 
            RowBox[{"xDot", "\[Rule]", "Dot"}]}], ",", "1"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "2"}], ",", 
          RowBox[{"{", 
           RowBox[{"times", ",", "dot"}], "}"}], ",", "\"\<{times,dot}\>\""}],
          "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"times", " ", "dot"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<result\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"4.9", ".2010"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DotKeepPattern", "[", "patterns_", "]"}], "[", "exp_", "]"}], ":=",
      "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Extract", " ", "from", " ", 
        RowBox[{"Dot", "[", "]"}], " ", "expression", " ", "elements", " ", 
        "that", " ", "do", " ", "not", " ", "match", " ", "any", " ", "of", 
        " ", "the", " ", 
        RowBox[{"patterns", ".", " ", "\[IndentingNewLine]", 
         RowBox[{"Usage", ":", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"DotKeepPattern", "[", "patternlist", "]"}], "[", 
             "expression", "]"}], ".", "\[IndentingNewLine]", "  ", 
            "Returns"}], " ", "expression", " ", "with", " ", 
           RowBox[{
            RowBox[{"Dot", "[", "]"}], "'"}], "s"}]}]}]}], "->", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", "nokeeps", ")"}], " ", 
        RowBox[{
         RowBox[{"Dot", "[", " ", "keeps", " ", "]"}], ".", "  ", "This"}], 
        " ", "is", " ", "a", " ", "frontend", " ", "routine", " ", "expands", 
        " ", 
        RowBox[{"xPartialD", "'"}], "s", " ", "and", " ", "eliminates", " ", 
        "remembering", " ", 
        RowBox[{"HoldPattern", "[", "]"}], " ", "on", " ", 
        RowBox[{
         RowBox[{"Dot", "[", "__", "]"}], "."}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "dot", ",", "times", ",", "test", ",", "dots", ",", "pos",
          ",", 
         RowBox[{"DEBUG", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DotExpandMode", "[", "True", "]"}], ";", 
        StyleBox["\[IndentingNewLine]",
         FontWeight->"Bold"], 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotKeepPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "exp", "}"}], ",", "\"\<input\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "/.", 
          RowBox[{
           RowBox[{"xPartialD", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
           RowBox[{"xPartialDDot", "[", 
            RowBox[{"a", ",", "b"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"pos", "=", 
         RowBox[{"Position", "[", 
          RowBox[{"tmp", ",", 
           RowBox[{"HoldPattern", "[", 
            RowBox[{"Dot", "[", "__", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotKeepPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "pos", "}"}], ",", "\"\<pos\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"MapAt", "[", 
          RowBox[{
           RowBox[{"DotPatternIn1", "[", "patterns", "]"}], ",", "tmp", ",", 
           "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Apply", " ", "twice", " ", "to", " ", "clean", " ", "up"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"Position", "[", 
          RowBox[{"tmp", ",", 
           RowBox[{"HoldPattern", "[", 
            RowBox[{"Dot", "[", "__", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<DotKeepPattern\>\"", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "pos", "}"}], ",", "\"\<pos\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"MapAt", "[", 
          RowBox[{
           RowBox[{"DotPatternIn1", "[", "patterns", "]"}], ",", "tmp", ",", 
           "pos"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Solves", " ", "for", " ", "pattern_", " ", "in", " ", "EqualExp_.", " ", 
     "Returns", " ", "solution", " ", "using", " ", "first", " ", "variable", 
     " ", "from", " ", 
     RowBox[{"ExtractPositionPattern", "[", 
      RowBox[{"_", ",", "pattern"}], "]"}], "  ", "*", "19", "Oct2013"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Solve4Pattern", "[", 
      RowBox[{"EqualExp_", ",", "pattern_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"EqualExp", "/.", 
           RowBox[{"Rule", "->", "Equal"}]}]}], ",", "pos", ",", "posd"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pos", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", "pattern", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"posd", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", "$$XX"}], "&"}], ",",
            "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"tmp", ",", "posd"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"Solve", "[", 
           RowBox[{"tmp", ",", "$$XX"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"$$XX", "\[Rule]", 
           RowBox[{"pos", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}]}]}]}], 
      RowBox[{"(*", 
       RowBox[{"Substitute", " ", "for", " ", "only", " ", "first", " ", 
        RowBox[{"variable", "."}]}], "*)"}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"Simpler", " ", "version", " ", "of", " ", 
     RowBox[{"above", ".", "  ", "Forgot"}], " ", "why", " ", "previous", " ",
      "one", " ", "was", " ", "rewritten", " ", "that", " ", 
     RowBox[{"way", "."}], " ", "*", "6", "Sep2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"Solve4Pattern", "[", 
       RowBox[{"EqualExp_", ",", "pattern_"}], "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"tmp", "=", 
           RowBox[{"EqualExp", "/.", 
            RowBox[{"Rule", "->", "Equal"}]}]}], ",", "$XX"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{"pattern", "\[Rule]", "$XX"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"Solve", "[", 
           RowBox[{"tmp", ",", "$XX"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "/.", 
           RowBox[{"$XX", "\[Rule]", "pattern"}]}]}]}]}], 
       "\[IndentingNewLine]", "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Solves", " ", "for", " ", "pattern_", " ", "in", " ", "RuleExp_", " ", 
     "29", "June2012"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Rule4Pattern", "[", 
      RowBox[{"RuleExp_", ",", "pattern_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "RuleExp"}], ",", "patList", ",", "$X"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"Rule", "->", "Equal"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"patList", "=", 
         RowBox[{
          RowBox[{"ExtractPattern", "[", "pattern", "]"}], "[", "tmp", 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", "patList", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"pattern", "\[Rule]", "$X"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Solve", "[", 
          RowBox[{"tmp", ",", "$X"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"$X", "\[Rule]", 
           RowBox[{"patList", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MatrixSubs", " ", "applies", " ", "Rules"}], "->", 
     RowBox[{
      RowBox[{
      "sublist_", " ", "to", " ", "matrix", " ", "equation", " ", "where", 
       " ", 
       RowBox[{"Plus", "[", "]"}], " ", "is", " ", 
       RowBox[{"disabled", ".", "  ", "The"}], " ", "auto"}], "-", 
      RowBox[{"evaluation", " ", "of", " ", 
       RowBox[{"Plus", "[", "]"}], " ", "creates", " ", "unwanted", " ", 
       RowBox[{"results", "."}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MatrixSubs", "[", 
      RowBox[{"exp_", ",", "sublist_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "i", ",", 
         RowBox[{"DEBUG", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"Plus", "\[Rule]", "xPlus"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"\"\<MatrixSubs\>\"", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<tmp\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp", "=", " ", 
           RowBox[{"ReplaceAll", "[", 
            RowBox[{"tmp", ",", 
             RowBox[{"sublist", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "sublist", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"xPlus", "\[Rule]", "Plus"}]}]}]}]}], "\[IndentingNewLine]",
       "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "EvenPowers", " ", "eliminates", " ", "odd", " ", "powers", " ", "of", 
     " ", "var_List", " ", "in", " ", "exp_."}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"EvenPowers", "[", "var_List", "]"}], "[", "exp_", "]"}], ":=", 
     
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "sub", ",", "tmp", ",", "delete", ",", "n", ",", "V", ",", "L"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"V", ",", "L"}], "}"}], "=", 
         RowBox[{"Unique", "[", 
          RowBox[{"{", 
           RowBox[{"V", ",", "L"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sub", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"V", ":", "#"}], ",", 
              RowBox[{"L", " ", "V"}]}], "]"}], "&"}], ",", "var"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "/.", "sub"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"CoefficientList", "[", 
          RowBox[{"tmp", ",", "L"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"delete", "=", 
         RowBox[{"Range", "[", 
          RowBox[{"2", ",", 
           RowBox[{"Length", "[", "tmp", "]"}], ",", "2"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"tmp", ",", 
           RowBox[{"{", "delete", "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Apply", "[", 
         RowBox[{"Plus", ",", "tmp"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "IntegralOpDeleteOddPowers", " ", "deletes", " ", "odd", " ", "powers", 
     " ", "of", " ", "var_List", " ", "from", " ", "the", " ", "deepest", " ",
      "level", " ", "IntegralOp", " ", "in", " ", "exp_"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"IntegralOpDeleteOddPowers", "[", "var_List", "]"}], "[", 
      "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmpe", ",", "tmpd", ",", "tmpn"}],
         "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmpe", "=", 
         RowBox[{"ExtractIntegrand", "[", "tmp", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmpd", "=", 
         RowBox[{
          RowBox[{"tmpe", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}], "//", "Denominator"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"tmpn", "=", 
         RowBox[{
          RowBox[{"tmpe", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}], "//", "Numerator"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"tmpn", "=", 
         RowBox[{"tmpn", "//", 
          RowBox[{"EvenPowers", "[", 
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"pu", "[", "_", "]"}], ",", 
             RowBox[{"pd", "[", "_", "]"}]}], " ", "}"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"tmp", ",", 
           RowBox[{
            RowBox[{"tmpe", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "->", 
            RowBox[{"tmpn", "/", "tmpd"}]}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"DifNoDependance", "[", 
       RowBox[{"exp_", ",", "set1_List", ",", "set2_List"}], "]"}], " ", 
      "zeros", " ", 
      RowBox[{"xPartialD", "[", 
       RowBox[{"a", ",", "b"}], "]"}], " ", "if", " ", "a"}], "\[Element]", 
     RowBox[{"set1", " ", "and", " ", "b"}], "\[Element]", 
     RowBox[{"set2", " ", "or", " ", "a"}], "\[Element]", 
     RowBox[{"set2", " ", "and", " ", "b"}], "\[Element]", "set1"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DifNoDependance", "[", 
      RowBox[{"exp_", ",", "set1_List", ",", "set2_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"xPartialD", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
           RowBox[{"0", "/;", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "set1"}], "]"}], "&&", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"b", ",", "set2"}], "]"}]}], "||", 
              RowBox[{
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"b", ",", "set1"}], "]"}], "&&", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "set2"}], "]"}]}]}], "\[IndentingNewLine]", 
             ")"}]}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"xPartialDu", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
           RowBox[{"0", "/;", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "set1"}], "]"}], "&&", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"b", ",", "set2"}], "]"}]}], "||", 
              RowBox[{
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"b", ",", "set1"}], "]"}], "&&", 
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "set2"}], "]"}]}]}], "\[IndentingNewLine]", 
             ")"}]}]}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Rule", " ", "that", " ", "lowers", " ", "all", " ", "indices", " ", "in",
      " ", "Tensor", " ", "if", " ", "possible"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sLowerAllIndices", "=", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Tensor", "[", 
       RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
      RowBox[{"Tensor", "[", 
       RowBox[{"a", ",", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#2", "===", "Void"}], ",", "Void", ",", "#1"}], "]"}], 
           "&"}], ",", 
          RowBox[{"{", 
           RowBox[{"b", ",", "c"}], "}"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#2", "===", "Void"}], ",", "#1", ",", "#2"}], "]"}], 
           "&"}], ",", 
          RowBox[{"{", 
           RowBox[{"b", ",", "c"}], "}"}]}], "]"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Rule", " ", "that", " ", "raises", " ", "all", " ", "indices", " ", "in",
      " ", "Tensor", " ", "except", " ", "except_List"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"sRaiseAllIndices", "[", "except_List", "]"}], "=", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Tensor", "[", 
         RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
        RowBox[{"Tensor", "[", 
         RowBox[{"a", ",", "\[IndentingNewLine]", 
          RowBox[{"MapThread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"#1", "===", "Void"}], "&&", 
                RowBox[{"!", 
                 RowBox[{"MemberQ", "[", 
                  RowBox[{"except", ",", "#2"}], "]"}]}]}], ",", "#2", ",", 
               "#1"}], "]"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"b", ",", "c"}], "}"}]}], "]"}], ",", 
          RowBox[{"MapThread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"#1", "===", "Void"}], "&&", 
                RowBox[{"!", 
                 RowBox[{"MemberQ", "[", 
                  RowBox[{"except", ",", "#2"}], "]"}]}]}], ",", "Void", ",", 
               "#2"}], "]"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"b", ",", "c"}], "}"}]}], "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xPartialD", "[", 
         RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"xPartialDu", "[", 
          RowBox[{"a", ",", "b"}], "]"}], "/;", 
         RowBox[{"!", 
          RowBox[{"MemberQ", "[", 
           RowBox[{"except", ",", "b"}], "]"}]}]}]}], ",", 
       RowBox[{
        RowBox[{"xCovariantD", "[", 
         RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"xCovariantDu", "[", 
          RowBox[{"a", ",", "b"}], "]"}], "/;", 
         RowBox[{"!", 
          RowBox[{"MemberQ", "[", 
           RowBox[{"except", ",", "b"}], "]"}]}]}]}]}], "\[IndentingNewLine]",
       "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Lowers", " ", "indices", " ", "in", " ", 
     RowBox[{"Tensor", "'"}], "s", " ", "based", " ", "upon", " ", 
     RowBox[{"index_List", ".", "  ", "Applies"}], " ", "\[Eta]uu", " ", 
     RowBox[{"(", 
      RowBox[{"signature", " ", "factor"}], ")"}], " ", "on", " ", "Tensor", 
     " ", "indices", " ", "that", " ", "are", " ", 
     RowBox[{"lowered", ".", "  ", "\[IndentingNewLine]", 
      RowBox[{"Usage", ":", "  ", 
       RowBox[{
        RowBox[{"LowerIndex\[Eta]", "[", 
         RowBox[{"{", 
          RowBox[{"i1", ",", "i2", ",", "..."}], "}"}], "]"}], "[", 
        "expression", "]"}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"LowerIndex\[Eta]", "[", "index_List", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "tmp1", ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mname", "=", "\"\<LowerIndex\[Eta]\>\""}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"index", ",", "exp"}], "}"}], ",", "\"\<{index,exp}\>\""}],
          "]"}], ";", 
        RowBox[{
         RowBox[{"m", "\[IndentingNewLine]", "tmp"}], "=", 
         RowBox[{"exp", "/.", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"a", ",", "\[IndentingNewLine]", 
              RowBox[{"MapThread", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#2", "===", "Void"}], "&&", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"index", ",", "#1"}], "]"}]}], ",", "Void", ",", 
                   "#1"}], "]"}], "&"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b", ",", "c"}], "}"}]}], "]"}], ",", 
              RowBox[{"MapThread", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#2", "===", "Void"}], "&&", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"index", ",", "#1"}], "]"}]}], ",", "#1", ",", 
                   "#2"}], "]"}], "&"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b", ",", "c"}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", "]"}], 
            RowBox[{"Apply", "[", 
             RowBox[{"Times", ",", 
              RowBox[{"MapThread", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#2", "===", "Void"}], "&&", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"index", ",", "#1"}], "]"}]}], ",", 
                   RowBox[{"\[Eta]uu", "[", 
                    RowBox[{"#1", ",", "#1"}], "]"}], ",", "1"}], "]"}], 
                 "&"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b", ",", "c"}], "}"}]}], "]"}]}], "]"}]}]}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "/.", "fixTensorWithArg"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Rule", " ", "version", " ", "of", " ", 
     RowBox[{"LowerIndex\[Eta]", ".", "  ", "Does"}], " ", "not", " ", 
     "fixTensorWithArg"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"sLowerIndex\[Eta]", "[", "index_List", "]"}], ":=", 
     RowBox[{
      RowBox[{"Tensor", "[", 
       RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
      RowBox[{
       RowBox[{"Tensor", "[", 
        RowBox[{"a", ",", "\[IndentingNewLine]", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#2", "===", "Void"}], "&&", 
               RowBox[{"MemberQ", "[", 
                RowBox[{"index", ",", "#1"}], "]"}]}], ",", "Void", ",", 
              "#1"}], "]"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"b", ",", "c"}], "}"}]}], "]"}], ",", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#2", "===", "Void"}], "&&", 
               RowBox[{"MemberQ", "[", 
                RowBox[{"index", ",", "#1"}], "]"}]}], ",", "#1", ",", "#2"}],
              "]"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"b", ",", "c"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
        "]"}], 
       RowBox[{"Apply", "[", 
        RowBox[{"Times", ",", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#2", "===", "Void"}], "&&", 
               RowBox[{"MemberQ", "[", 
                RowBox[{"index", ",", "#1"}], "]"}]}], ",", 
              RowBox[{"\[Eta]uu", "[", 
               RowBox[{"#1", ",", "#1"}], "]"}], ",", "1"}], "]"}], "&"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"b", ",", "c"}], "}"}]}], "]"}]}], "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "repairs", " ", "notation", " ", "of", " ", "Tensor", " ", "with", " ", 
      "arguements"}], ",", " ", 
     RowBox[{
      RowBox[{"e", ".", "g", ".", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"-", 
          RowBox[{"Au", "[", "i", "]"}]}], ")"}], "[", "x", "]"}]}], "->", 
      RowBox[{"-", 
       RowBox[{
        RowBox[{"Au", "[", "i", "]"}], "[", "x", "]"}]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fixTensorWithArg", ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"a_", " ", 
          RowBox[{"Tensor", "[", 
           RowBox[{"b_", ",", "c_", ",", "d_"}], "]"}]}], ")"}], "[", "e_", 
        "]"}], "->", 
       RowBox[{"a", " ", 
        RowBox[{
         RowBox[{"Tensor", "[", 
          RowBox[{"b", ",", "c", ",", "d"}], "]"}], "[", "e", "]"}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Manipulates", " ", "limit", " ", "expression", " ", "into", " ", 
      "integration", " ", "variable", " ", "specification"}], ",", " ", 
     RowBox[{"e", ".", "g", "."}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"a", "<", "x", "<", "b"}], " ", "&&", " ", 
       RowBox[{"c", "<", "y", "<", "d"}]}], " ", "->", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "a", ",", "b"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "c", ",", "d"}], "}"}]}], "}"}]}]}], "  ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Limits2IntRange", "[", "limit_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "limit"}], ",", "tmp1"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"LessEqual", "->", "Less"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "multiple", " ", "Alternative", " ", "does", " ", "not", " ", 
          "work"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", 
         RowBox[{
          RowBox[{"ExtractPattern", "[", 
           RowBox[{"Inequality", "[", 
            RowBox[{"a_", ",", "Less", ",", "b_", ",", "Less", ",", "c_"}], 
            "]"}], "]"}], "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "5", "]"}], "]"}]}], "}"}], "&"}], ",", "tmp1"}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Zeros", " ", "are", " ", "Rules", " ", "of", " ", "local", " ", 
     "functions", " ", "that", " ", "are", " ", "0.", " ", "*", "17", 
     "Oct2013"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Zeros", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"IntegralOp", "[", 
        RowBox[{"_", ",", "0"}], "]"}], "->", "0"}], ",", 
      RowBox[{
       RowBox[{"xSum", "[", 
        RowBox[{"0", ",", "__"}], "]"}], "->", "0"}], ",", 
      RowBox[{
       RowBox[{"DerivOps", "[", 
        RowBox[{"0", ",", "__"}], "]"}], "->", "0"}], ",", 
      RowBox[{
       RowBox[{"xProduct", "[", 
        RowBox[{"0", ",", "__"}], "]"}], "->", "0"}]}], "}"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"includeFactors", "[", 
        RowBox[{"op_Pattern", ",", "pos_"}], "]"}], "[", "exp_", "]"}], " ", 
      "includes", " ", "Times", " ", "factor", " ", "into", " ", 
      "op_Pattern"}], ",", " ", 
     RowBox[{"e", ".", "g", "."}], ",", " ", 
     RowBox[{"xSum", "[", 
      RowBox[{"_", ",", "_"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{
      "at", " ", "position", " ", "pos_", " ", "in", " ", "argument", " ", 
       "of", " ", 
       RowBox[{"op_Pattern", ".", "  ", "Takes"}], " ", "terms", " ", "like", 
       " ", "A", " ", 
       RowBox[{"xSum", "[", 
        RowBox[{"B", ",", "n"}], "]"}]}], "->", 
      RowBox[{
       RowBox[{"xSum", "[", 
        RowBox[{
         RowBox[{"A", " ", "B"}], ",", "n"}], "]"}], " ", "*", "17", 
       "Nov2013"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"includeFactors", "[", 
      RowBox[{"op_Pattern", ",", "pos_"}], "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//.", 
        RowBox[{
         RowBox[{"a_", " ", 
          RowBox[{"(", 
           RowBox[{"oo", ":", "op"}], ")"}]}], "\[RuleDelayed]", 
         RowBox[{"MapAt", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", " ", "a"}], "&"}], ",", "oo", ",", "pos"}], 
          "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"contourIntegralPrep", "[", "exp_", "]"}], " ", "prepares", " ", 
     "exp_", " ", "for", " ", "applying", " ", 
     RowBox[{"Residue", "--"}], "attempts", " ", "to", " ", "reduce", " ", 
     "express", " ", "so", " ", "that", " ", "IntegralOp", " ", "is", " ", 
     "on", " ", "the", " ", "interior", " ", "most", " ", 
     RowBox[{"arguement", ".", " ", "PROTOTYPE"}], " ", "*", "17", 
     "Nov2013"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"contourIntegralPrep", "[", "exp_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "tmp1"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//", "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//", 
         RowBox[{"DistributeOp", "[", 
          RowBox[{"xSum", "[", 
           RowBox[{"_", ",", "_"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//", 
         RowBox[{"DistributeOp", "[", 
          RowBox[{"xPartialD", "[", 
           RowBox[{"_", ",", "_"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{"xPartialD", "[", 
            RowBox[{
             RowBox[{"xSum", "[", 
              RowBox[{"a_", ",", "n_"}], "]"}], ",", "b_"}], "]"}], "\[Rule]", 
           RowBox[{"xSum", "[", 
            RowBox[{
             RowBox[{"xPartialD", "[", 
              RowBox[{"a", ",", "b"}], "]"}], ",", "n"}], "]"}]}]}], "//", 
         "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//", 
         RowBox[{"DistributeOp", "[", 
          RowBox[{"IntegralOp", "[", 
           RowBox[{"_", ",", "_"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//", 
         RowBox[{"includeFactors", "[", 
          RowBox[{
           RowBox[{"xSum", "[", 
            RowBox[{"_", ",", "_"}], "]"}], ",", "1"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{
          RowBox[{"IntegralOp", "[", 
           RowBox[{"b_", ",", 
            RowBox[{"xSum", "[", 
             RowBox[{"a_", ",", "n_"}], "]"}]}], "]"}], "\[Rule]", 
          RowBox[{"xSum", "[", 
           RowBox[{
            RowBox[{"IntegralOp", "[", 
             RowBox[{"b", ",", "a"}], "]"}], ",", "n"}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", 
     "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.631454020698941*^9, 3.631454027380699*^9}, 
   3.632428898950508*^9, {3.6324333867432013`*^9, 3.6324333917098*^9}, {
   3.632844038984488*^9, 3.6328440615431023`*^9}, 3.63284428192625*^9, {
   3.632846011704399*^9, 3.6328460578050632`*^9}, 3.632846151477849*^9, {
   3.632846190063108*^9, 3.6328461927161283`*^9}, {3.6328462604035463`*^9, 
   3.632846269337926*^9}, {3.632846517420719*^9, 3.6328465289361677`*^9}, {
   3.633440925817774*^9, 3.633440940224862*^9}, 3.63346292217347*^9, 
   3.6334943160484743`*^9, {3.6372432439035387`*^9, 3.637243262661422*^9}, {
   3.637459792853993*^9, 3.6374597938811893`*^9}, {3.640437596745634*^9, 
   3.640437671149033*^9}, {3.6411316678975563`*^9, 3.641131692726796*^9}, {
   3.641300904475754*^9, 3.641300953953162*^9}, {3.641300987465343*^9, 
   3.6413010545345783`*^9}, {3.641301111762044*^9, 3.641301223097891*^9}, {
   3.641301915858335*^9, 3.641301924600706*^9}, {3.641302440274757*^9, 
   3.641302442161625*^9}, {3.641302476038959*^9, 3.6413025403322363`*^9}, {
   3.641302588549993*^9, 3.641302777575961*^9}, {3.641480142414383*^9, 
   3.6414801542629013`*^9}, 3.641485576075871*^9, 3.641489162586782*^9, 
   3.6416532637815113`*^9, 3.641653329659669*^9, 3.6416670059130373`*^9, {
   3.642081367477064*^9, 3.642081399270821*^9}, {3.642082477079373*^9, 
   3.6420824968034563`*^9}, 3.642082738707312*^9, {3.6420913958868847`*^9, 
   3.642091398595077*^9}, 3.642599701409562*^9, {3.642939214976811*^9, 
   3.6429392585593977`*^9}, {3.6429394696310053`*^9, 3.642939515249154*^9}, {
   3.642939601549823*^9, 3.642939603326457*^9}, {3.6433824083374567`*^9, 
   3.64338241805261*^9}, {3.643553040909666*^9, 3.643553155964315*^9}, {
   3.643553198258109*^9, 3.6435533346465197`*^9}, {3.643553367887*^9, 
   3.643553388277409*^9}, {3.643994439722986*^9, 3.643994441197049*^9}, 
   3.6439944791711206`*^9, {3.644598307508293*^9, 3.644598374423582*^9}, {
   3.644888262398275*^9, 3.644888433120316*^9}, {3.644888609950045*^9, 
   3.644888643540148*^9}, 3.6464966333883247`*^9, {3.6484754498966703`*^9, 
   3.648475468417671*^9}, {3.648475633293613*^9, 3.648475636441329*^9}, {
   3.6504196778688087`*^9, 3.650419736755715*^9}, {3.650419780136663*^9, 
   3.650419911152689*^9}, {3.650419954365883*^9, 3.650419994692729*^9}, {
   3.6504587706951714`*^9, 3.650458804546167*^9}, {3.650897307891182*^9, 
   3.650897308994708*^9}, {3.651591090987208*^9, 3.65159120243889*^9}, {
   3.652357943348782*^9, 3.652357969361709*^9}, {3.652363026642367*^9, 
   3.652363029361619*^9}, {3.6523643897939167`*^9, 3.652364435991899*^9}, {
   3.6523655629951963`*^9, 3.652365563482129*^9}, 3.652366408405045*^9, 
   3.652366877785427*^9, {3.652367659880842*^9, 3.652367667707198*^9}, {
   3.652465051229319*^9, 3.652465087283462*^9}, {3.652489846023509*^9, 
   3.652489858086629*^9}, {3.6524898981058807`*^9, 3.65248992136709*^9}, 
   3.652628480271941*^9, {3.652793754025487*^9, 3.652793757018043*^9}, {
   3.652793787399165*^9, 3.6527938202478037`*^9}, {3.652793903682659*^9, 
   3.652793904578889*^9}, {3.652793945336499*^9, 3.652793956729909*^9}, {
   3.652794022437001*^9, 3.6527940422009583`*^9}, {3.652794364045796*^9, 
   3.652794371438621*^9}, {3.652887806092939*^9, 3.652887809913209*^9}, {
   3.652895454050972*^9, 3.6528954541980143`*^9}, {3.652897911743766*^9, 
   3.652897921602048*^9}, {3.654269127236198*^9, 3.6542691597276087`*^9}, {
   3.654270703531555*^9, 3.654270857606565*^9}, 3.654273460926977*^9, 
   3.654274387163666*^9, {3.6542760109033833`*^9, 3.654276013703273*^9}, 
   3.654621611052959*^9, {3.6546218753293343`*^9, 3.654621883061843*^9}, 
   3.654697164607666*^9, {3.654880903930006*^9, 3.654880939178134*^9}, {
   3.6552091448046093`*^9, 3.655209282294209*^9}, 3.6553391082637453`*^9, {
   3.655390803624235*^9, 3.655390850726363*^9}, {3.655996011901524*^9, 
   3.655996031212739*^9}, 3.655999576338619*^9, 3.6559998905817833`*^9, 
   3.656007257120654*^9, {3.6560896439768963`*^9, 3.656089656184638*^9}, {
   3.656210789300026*^9, 3.6562107962449303`*^9}, {3.656426018086953*^9, 
   3.656426176033125*^9}, 3.656888715726651*^9, {3.6568929555282288`*^9, 
   3.656892981209876*^9}, 3.656937868259451*^9, {3.656937918717174*^9, 
   3.656937919332306*^9}, 3.659912007610816*^9, 3.659912168725828*^9, {
   3.6604007288071327`*^9, 3.66040080887674*^9}, {3.661017838526067*^9, 
   3.6610178660238743`*^9}, {3.6610179115602016`*^9, 3.661017919415704*^9}, {
   3.661018460657398*^9, 3.661018501052878*^9}, {3.661620663901902*^9, 
   3.661620701225588*^9}, {3.661620841190835*^9, 3.6616208551533813`*^9}, 
   3.661620954875214*^9, {3.661621018960384*^9, 3.661621057480298*^9}, {
   3.661621209833726*^9, 3.661621260417314*^9}, {3.661621455552906*^9, 
   3.6616214788067427`*^9}, {3.661906771121043*^9, 3.66190681125097*^9}, 
   3.661907574722973*^9, {3.661907638918819*^9, 3.66190764155834*^9}, {
   3.6619621925300903`*^9, 3.6619622735615463`*^9}, {3.6619623337074213`*^9, 
   3.661962338023738*^9}, 3.6619625906091013`*^9, {3.661964292784068*^9, 
   3.661964339200717*^9}, 3.661965104569584*^9, 3.661972668497904*^9, {
   3.66205043603935*^9, 3.6620504588549967`*^9}, {3.662050497236375*^9, 
   3.662050568780946*^9}, 3.662089817587186*^9, 3.6620900369342003`*^9, {
   3.6621403556913977`*^9, 3.662140374327427*^9}, {3.6621416736979313`*^9, 
   3.662141674871149*^9}, {3.662168655443161*^9, 3.66216865754699*^9}, {
   3.66216879713232*^9, 3.662168808064611*^9}, {3.662214153733788*^9, 
   3.662214167263191*^9}, {3.662220526572399*^9, 3.662220547875301*^9}, {
   3.662220741421756*^9, 3.6622207427230577`*^9}, 3.6622221180274067`*^9, 
   3.662233269505645*^9, 3.6622379985202627`*^9, {3.6622388182573633`*^9, 
   3.6622388202399483`*^9}, {3.662480969775175*^9, 3.662481008750998*^9}, {
   3.662483320268114*^9, 3.6624833216860647`*^9}, {3.662483925770872*^9, 
   3.662483959388274*^9}, {3.662486141389008*^9, 3.6624862229356327`*^9}, {
   3.662490701509281*^9, 3.6624907388472013`*^9}, {3.663512615875965*^9, 
   3.663512636263836*^9}, 3.664125489189787*^9, {3.6641257474836197`*^9, 
   3.6641259236538973`*^9}, {3.664126061673539*^9, 3.6641260730288343`*^9}, {
   3.6645544606410637`*^9, 3.664554511627345*^9}, 3.664673448811037*^9, {
   3.664727683367898*^9, 3.6647277592765493`*^9}, {3.664741884605733*^9, 
   3.664741924199807*^9}, {3.664742138389728*^9, 3.664742283647546*^9}, 
   3.66474251030193*^9, {3.6647430546113453`*^9, 3.66474306668117*^9}, {
   3.664761330819831*^9, 3.664761330987821*^9}, {3.664761368585127*^9, 
   3.664761487803891*^9}, {3.6648060985596447`*^9, 3.664806099330715*^9}, 
   3.664806396147334*^9, {3.6658581047392263`*^9, 3.665858118858934*^9}, {
   3.6658582859695873`*^9, 3.665858308418936*^9}, {3.6658876161669064`*^9, 
   3.66588767425354*^9}, {3.665933135847131*^9, 3.665933147326509*^9}, {
   3.6659336416909103`*^9, 3.665933926949031*^9}, {3.665955154020149*^9, 
   3.665955167778615*^9}, 3.665955200115761*^9, {3.665957784686517*^9, 
   3.665957787530751*^9}, 3.665968219884535*^9, 3.665974509806114*^9, 
   3.665979904469287*^9, {3.666012984860166*^9, 3.666013058023883*^9}, 
   3.666016141089316*^9, {3.66601679160673*^9, 3.666016815782654*^9}, {
   3.666119533442227*^9, 3.6661195508798647`*^9}, {3.666188015168437*^9, 
   3.6661880156074867`*^9}, {3.66618979905262*^9, 3.666189813192979*^9}, 
   3.666194291080756*^9, {3.666196110671419*^9, 3.666196129490431*^9}, 
   3.666534605968815*^9, {3.666534727893858*^9, 3.6665347308387947`*^9}, 
   3.666966124928452*^9, 3.66722660736381*^9, {3.6674952199337482`*^9, 
   3.667495220426689*^9}, {3.6675032875091143`*^9, 3.6675033079962*^9}, {
   3.667504732859726*^9, 3.667504738710124*^9}, 3.667504811090186*^9, 
   3.667505122754509*^9, {3.668348537044797*^9, 3.668348538371204*^9}, {
   3.668348744505822*^9, 3.668348842468686*^9}, 3.668348962659667*^9, {
   3.6687776409395742`*^9, 3.668777784479327*^9}, {3.668777907146625*^9, 
   3.6687779153187523`*^9}, 3.6693748096076193`*^9, {3.669641487349009*^9, 
   3.6696415012917767`*^9}, 3.6696437678742447`*^9, {3.669664610303274*^9, 
   3.669664663076295*^9}, {3.669664734183783*^9, 3.669664749518941*^9}, 
   3.669690549147621*^9, {3.669691466350378*^9, 3.6696914816483593`*^9}, {
   3.669728536051653*^9, 3.669728539003014*^9}, {3.669728601232201*^9, 
   3.669728613383646*^9}, 3.669729345742236*^9, {3.669749126708235*^9, 
   3.669749140970319*^9}, {3.669821774671136*^9, 3.6698218780305967`*^9}, {
   3.6698219275800962`*^9, 3.669821991910098*^9}, {3.66985757338903*^9, 
   3.669857624072918*^9}, 3.6699486731621313`*^9, 3.670166306482266*^9, 
   3.671471627285593*^9, {3.6714717767355747`*^9, 3.671471777091617*^9}, {
   3.671471904772046*^9, 3.671471985797967*^9}, 3.672147932897675*^9, {
   3.672366680263205*^9, 3.672366708537211*^9}, 3.672367918946711*^9, {
   3.672368573143702*^9, 3.672368577733088*^9}, {3.672404604946645*^9, 
   3.672404606828691*^9}, 3.6724296487098846`*^9, {3.672537946462919*^9, 
   3.67253797381061*^9}, 3.672577668596032*^9, {3.6725778899621572`*^9, 
   3.672577960355227*^9}, 3.672578248109288*^9, {3.672747751642931*^9, 
   3.672747752242826*^9}, {3.672747914134005*^9, 3.6727480034455757`*^9}, {
   3.672749745571497*^9, 3.672749819405505*^9}, {3.67274989538904*^9, 
   3.6727499223233633`*^9}, 3.6727504198096123`*^9, {3.672755039635844*^9, 
   3.6727550742574577`*^9}, 3.6727602984409227`*^9, 3.673017556677479*^9, 
   3.673018082410417*^9, {3.673038033779648*^9, 3.6730380346642647`*^9}, {
   3.673038085440549*^9, 3.673038111923091*^9}, {3.6730381474386263`*^9, 
   3.673038166264045*^9}, {3.673099458863679*^9, 3.673099516401145*^9}, {
   3.6732681581541157`*^9, 3.673268213272154*^9}, {3.673271247184198*^9, 
   3.673271307965226*^9}, {3.673271368405723*^9, 3.6732713939103413`*^9}, {
   3.673272184789819*^9, 3.6732722067382593`*^9}, {3.675998991605044*^9, 
   3.675999030919559*^9}, 3.676298339807547*^9, {3.676298590033471*^9, 
   3.676298592588151*^9}, {3.676636572989365*^9, 3.6766365754863377`*^9}, {
   3.6766367210910463`*^9, 3.676636791182431*^9}, {3.676639149013729*^9, 
   3.676639202382298*^9}, 3.6766401455692167`*^9, {3.684671637586774*^9, 
   3.684671699157449*^9}, {3.684678506608968*^9, 3.68467854481318*^9}, 
   3.692810051089484*^9, {3.692810104608921*^9, 3.6928101423096724`*^9}, {
   3.6928101784834957`*^9, 3.6928102040885477`*^9}, {3.692810254810058*^9, 
   3.692810257437152*^9}, {3.6928105402797823`*^9, 3.6928105640082607`*^9}, {
   3.692810599116312*^9, 3.6928106007560987`*^9}, {3.695760657224167*^9, 
   3.6957607555535517`*^9}, {3.6960184441363297`*^9, 3.696018446440439*^9}, {
   3.699730345160562*^9, 3.699730525668345*^9}, {3.699730596183834*^9, 
   3.699730600324767*^9}, {3.699795305263751*^9, 3.699795376538499*^9}, 
   3.699795590721675*^9, {3.7000596776629753`*^9, 3.70005971018688*^9}, {
   3.700145196745041*^9, 3.7001451992134333`*^9}, 3.7005104478242893`*^9, {
   3.7005319528819838`*^9, 3.700532025915608*^9}, {3.702908981315598*^9, 
   3.702909009339609*^9}, {3.702909124650179*^9, 3.702909133386319*^9}, 
   3.702909229841138*^9, {3.70290930112983*^9, 3.702909340572324*^9}, {
   3.705425236120822*^9, 3.705425412547868*^9}, 3.70618899609035*^9, 
   3.706189050121154*^9, {3.7061919705632467`*^9, 3.706191971672722*^9}, {
   3.706193747700667*^9, 3.7061937565478363`*^9}, {3.706276651272471*^9, 
   3.706276651979137*^9}, 3.7062830526610947`*^9, {3.706283854334947*^9, 
   3.706283860038677*^9}, {3.706284051766115*^9, 3.706284062019075*^9}, {
   3.7065415467376757`*^9, 3.706541572921536*^9}, {3.70661613020744*^9, 
   3.706616223643427*^9}, {3.7066162697632017`*^9, 3.7066163343028507`*^9}, {
   3.7067070524150553`*^9, 3.706707058753839*^9}, {3.7067150466630707`*^9, 
   3.706715093349308*^9}, {3.706715130682253*^9, 3.706715239806683*^9}, {
   3.706715269991983*^9, 3.7067152756070747`*^9}, {3.706715314089157*^9, 
   3.706715320479817*^9}, 3.706715366842103*^9, {3.706746085366786*^9, 
   3.706746128067687*^9}, 3.706970955391959*^9, {3.707048775534836*^9, 
   3.7070487937303247`*^9}, 3.707049303781548*^9, {3.707050175292858*^9, 
   3.707050213271031*^9}, {3.707050288257737*^9, 3.707050295459003*^9}, {
   3.707050651221012*^9, 3.70705070528307*^9}, 3.707050763360126*^9, {
   3.707051704096389*^9, 3.707051768522393*^9}, {3.707054752987678*^9, 
   3.707054759453504*^9}, {3.707137339386839*^9, 3.707137368639917*^9}, {
   3.7071374514385853`*^9, 3.707137524789641*^9}, {3.707137557650523*^9, 
   3.7071375594659767`*^9}, {3.707137627384221*^9, 3.707137639606925*^9}, {
   3.707138046565593*^9, 3.70713805013868*^9}, 3.707139043444018*^9, {
   3.707139075982935*^9, 3.70713924007904*^9}, 3.707139305773929*^9, 
   3.707139667233945*^9, 3.707144512062256*^9, 3.707147467654188*^9, {
   3.7072284573913603`*^9, 3.707228465390966*^9}, {3.707237377019594*^9, 
   3.707237378158589*^9}, {3.707244299725877*^9, 3.707244318774763*^9}, {
   3.7072443524136963`*^9, 3.707244408649255*^9}, {3.707271115915471*^9, 
   3.707271224388166*^9}, 3.707271588101906*^9, {3.707396565286146*^9, 
   3.707396565751334*^9}, {3.707396687873204*^9, 3.707396688519669*^9}, 
   3.707482004527174*^9, {3.707482266704711*^9, 3.7074822689441547`*^9}, {
   3.707482489954526*^9, 3.707482505633757*^9}, {3.7074825710036917`*^9, 
   3.707482651754388*^9}, {3.707487040173044*^9, 3.7074870441335506`*^9}, {
   3.707568733565856*^9, 3.707568861178486*^9}, {3.707568893754353*^9, 
   3.7075689362263327`*^9}, {3.7075690401442223`*^9, 
   3.7075690795239887`*^9}, {3.7076583787209883`*^9, 3.7076583851205997`*^9}, 
   3.710941225234943*^9, {3.7139673237218246`*^9, 3.7139673275583057`*^9}, {
   3.730659754736932*^9, 3.730659777058352*^9}, {3.730951207206792*^9, 
   3.730951224084894*^9}, {3.730988296825965*^9, 3.730988299857511*^9}, 
   3.7309927178043547`*^9, {3.731069701005458*^9, 3.7310697113031816`*^9}, 
   3.731069785862782*^9, {3.731070315228795*^9, 3.731070332134898*^9}, {
   3.7348694253655148`*^9, 3.734869429887721*^9}, {3.7348731378028793`*^9, 
   3.7348731735829887`*^9}, 3.734873330057575*^9, {3.734873501054707*^9, 
   3.734873532362094*^9}, {3.734873736701043*^9, 3.734873772029936*^9}, {
   3.734875007654566*^9, 3.73487511772279*^9}, {3.738079520339527*^9, 
   3.738079525753264*^9}, {3.738079578556005*^9, 3.738079598920429*^9}, {
   3.7380968947292423`*^9, 3.7380968973583727`*^9}, {3.738157609996582*^9, 
   3.7381576237059917`*^9}, {3.738245758833042*^9, 3.738245761890189*^9}, {
   3.739793238732009*^9, 3.739793291340363*^9}, {3.739793853307807*^9, 
   3.7397938954267597`*^9}, 3.739793951366165*^9, {3.739794088480843*^9, 
   3.7397940940925083`*^9}, {3.739794446946855*^9, 3.739794491668631*^9}, {
   3.739794614347329*^9, 3.739794628322472*^9}, {3.7398169205873632`*^9, 
   3.739816933577242*^9}, {3.7400543536007338`*^9, 3.74005435374095*^9}, {
   3.740055712724443*^9, 3.7400557331514587`*^9}, {3.740055888476727*^9, 
   3.740055893506165*^9}, {3.740055951577075*^9, 3.7400559708628387`*^9}, {
   3.7400567117835073`*^9, 3.740056732931466*^9}, {3.740060042946086*^9, 
   3.740060073025462*^9}, {3.741609101212578*^9, 3.741609104654625*^9}, {
   3.741609258246085*^9, 3.7416092946158867`*^9}, {3.742069118534897*^9, 
   3.742069167386345*^9}, {3.742069307657531*^9, 3.74206931653115*^9}, 
   3.7421338207449417`*^9, {3.746619679271554*^9, 3.746619685299954*^9}, {
   3.7477054009504137`*^9, 3.747705429469758*^9}, 3.753117489630516*^9, 
   3.7531197879094477`*^9, {3.7560481213780527`*^9, 3.756048421540288*^9}, {
   3.756049293018862*^9, 3.756049298699171*^9}, {3.756049346765026*^9, 
   3.756049460841002*^9}, {3.7560495051080437`*^9, 3.75604952622826*^9}, {
   3.756141656266478*^9, 3.7561416704975348`*^9}, {3.756141715753625*^9, 
   3.756141719651697*^9}, {3.7561417652154293`*^9, 3.7561417975495243`*^9}, {
   3.756214869273436*^9, 3.756214936284938*^9}, {3.756215027326435*^9, 
   3.756215042005745*^9}, {3.756215307346813*^9, 3.756215345523735*^9}, {
   3.759847066321952*^9, 3.759847101097331*^9}, {3.759847274497252*^9, 
   3.759847275060814*^9}, {3.7599810323485518`*^9, 3.7599810350335293`*^9}, {
   3.760014963843835*^9, 3.7600149639621763`*^9}, 3.760883399483*^9, {
   3.761480266757044*^9, 3.761480267037253*^9}, 3.761480557132193*^9, {
   3.761480637176564*^9, 3.7614806633853903`*^9}, 3.761654810608347*^9, 
   3.762434042862534*^9, {3.762434240542323*^9, 3.762434252905293*^9}, {
   3.7624342879370823`*^9, 3.762434318340478*^9}, 3.76252111015805*^9, 
   3.762955012610818*^9, {3.764071542011086*^9, 3.7640715785691757`*^9}, {
   3.764071632899755*^9, 3.764071669254861*^9}, {3.764071705749031*^9, 
   3.764071717657322*^9}, {3.764071872531867*^9, 3.764071914042671*^9}, {
   3.7640719738399677`*^9, 3.764071991924944*^9}, {3.764072053726911*^9, 
   3.764072106770259*^9}, {3.764087873316288*^9, 3.7640879106002893`*^9}, 
   3.764090048026244*^9, {3.764092803192071*^9, 3.764092840356374*^9}, {
   3.764112174515141*^9, 3.76411221099907*^9}, {3.76442108264316*^9, 
   3.7644211451332073`*^9}, {3.76446186696646*^9, 3.764461877726383*^9}, 
   3.764501673242496*^9, 3.764503164151588*^9, 3.7645041284072323`*^9, {
   3.764504328003199*^9, 3.7645043307572317`*^9}, {3.764688351603356*^9, 
   3.7646883699687433`*^9}, {3.76571564573993*^9, 3.7657156721344852`*^9}, {
   3.766068347563555*^9, 3.7660683987290573`*^9}, {3.766068495434299*^9, 
   3.766068503686747*^9}, {3.770735726721292*^9, 3.770735749900487*^9}, 
   3.770735820718267*^9, {3.770812552698637*^9, 3.77081255503181*^9}, {
   3.7708126006227837`*^9, 3.770812602933079*^9}, {3.783859940801653*^9, 
   3.7838599446270037`*^9}, {3.791552992879282*^9, 3.791553044069416*^9}, {
   3.792681149632663*^9, 3.7926811878141747`*^9}, {3.792774654314542*^9, 
   3.7927747040460377`*^9}, 3.79277804098267*^9, {3.792779399214571*^9, 
   3.7927794035616627`*^9}, 3.792782239193572*^9, {3.79327809353727*^9, 
   3.793278127924065*^9}, {3.7932781649632874`*^9, 3.7932781742883368`*^9}, {
   3.793370704094586*^9, 3.793370766988755*^9}, {3.794233000538954*^9, 
   3.7942331290078373`*^9}, {3.794580935105645*^9, 3.7945810143160973`*^9}, 
   3.794841109339184*^9, 3.794842229246043*^9, 3.794842584800899*^9, {
   3.7948427343834343`*^9, 3.7948427606782017`*^9}, {3.7948478136017027`*^9, 
   3.7948478286734123`*^9}, {3.794926898567548*^9, 3.7949270107274113`*^9}, {
   3.794927093354912*^9, 3.794927102378213*^9}, {3.794927153110085*^9, 
   3.794927165737874*^9}, {3.794927205251872*^9, 3.7949272417094307`*^9}, {
   3.794927496523445*^9, 3.794927500260593*^9}, 3.795016623377564*^9, 
   3.795092858466899*^9, 3.7950987589882717`*^9, 3.795099098804037*^9, {
   3.7951926941114473`*^9, 3.7951927157140217`*^9}, {3.795192754706931*^9, 
   3.7951927775389977`*^9}, {3.7951949653365183`*^9, 3.79519497454817*^9}, 
   3.795271241594845*^9, {3.795960735046085*^9, 3.795960742995042*^9}, {
   3.795960835027014*^9, 3.795960889558194*^9}, {3.7970365248772583`*^9, 
   3.797036528079361*^9}, {3.797166175688386*^9, 3.7971661763422327`*^9}, {
   3.797166527991503*^9, 3.7971665298844213`*^9}, {3.797166567692203*^9, 
   3.7971665725186243`*^9}, {3.7971668573707657`*^9, 3.797166858482938*^9}, 
   3.7973540510076113`*^9, {3.797354103379964*^9, 3.7973541257775517`*^9}, {
   3.797354346006021*^9, 3.7973543573359327`*^9}, {3.798550228238388*^9, 
   3.798550293552899*^9}, {3.798551843680821*^9, 3.7985518784429092`*^9}, {
   3.798552062681271*^9, 3.798552072755745*^9}, 
   3.798552276272938*^9},ExpressionUUID->"92917c7a-6652-4ea1-89e2-\
3f5ff51323ca"],

Cell["\<\
Transpose, ConjugateTranspose, Dot ExpandMode and simplification routines\
\>", "Text",
 CellChangeTimes->{{3.4782815530805187`*^9, 3.478281587214243*^9}, {
  3.478281681009639*^9, 3.478281689444175*^9}, {3.478543089663787*^9, 
  3.47854310673521*^9}, {3.5563011476770906`*^9, 
  3.556301168119437*^9}},ExpressionUUID->"b330affb-d9e4-445d-8121-\
2f0026fa4623"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "Transpose", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Transpose", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
    RowBox[{"a_", ",", "b__"}], "]"}], "]"}], ":=", 
  RowBox[{"dd", "[", 
   RowBox[{
    RowBox[{"Transpose", "[", 
     RowBox[{"dd", "[", "b", "]"}], "]"}], ",", 
    RowBox[{"Transpose", "[", "a", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Transpose", "[", 
   RowBox[{"Times", "[", 
    RowBox[{"c_", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
      RowBox[{"a_", ",", "b__"}], "]"}]}], "]"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"c", " ", 
    RowBox[{"dd", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"dd", "[", "b", "]"}], "]"}], ",", 
      RowBox[{"Transpose", "[", "a", "]"}]}], "]"}]}], "/;", 
   RowBox[{"FreeQ", "[", 
    RowBox[{"c", ",", "dotOps"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Transpose", "[", 
   RowBox[{"Times", "[", 
    RowBox[{"c_", ",", "a_"}], "]"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"c", " ", 
    RowBox[{"Transpose", "[", "a", "]"}]}], "/;", 
   RowBox[{"NumericQ", "[", "c", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Transpose", "[", 
   RowBox[{"Transpose", "[", "a_", "]"}], "]"}], ":=", 
  "a"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Transpose", "[", 
   RowBox[{"a_", "+", "b_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Transpose", "[", "a", "]"}], "+", 
   RowBox[{"Transpose", "[", "b", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Protect", "[", "Transpose", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Unprotect", "[", "ConjugateTranspose", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ConjugateTranspose", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
    RowBox[{"a_", ",", "b_"}], "]"}], "]"}], ":=", 
  RowBox[{"op", "[", 
   RowBox[{
    RowBox[{"ConjugateTranspose", "[", "b", "]"}], ",", 
    RowBox[{"ConjugateTranspose", "[", "a", "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ConjugateTranspose", "[", 
   RowBox[{"Times", "[", 
    RowBox[{"a_", ",", "b_"}], "]"}], "]"}], ":=", 
  RowBox[{"Times", "[", 
   RowBox[{
    RowBox[{"ConjugateTranspose", "[", "b", "]"}], ",", 
    RowBox[{"ConjugateTranspose", "[", "a", "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ConjugateTranspose", "[", 
   RowBox[{"Times", "[", 
    RowBox[{"c_", ",", 
     RowBox[{"Dot", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}]}], "]"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"ConjugateTranspose", "[", "c", "]"}], " ", 
    RowBox[{"Dot", "[", 
     RowBox[{
      RowBox[{"ConjugateTranspose", "[", "b", "]"}], ",", 
      RowBox[{"ConjugateTranspose", "[", "a", "]"}]}], "]"}]}], "/;", 
   RowBox[{"FreeQ", "[", 
    RowBox[{"c", ",", "Dot"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ConjugateTranspose", "[", 
   RowBox[{"ConjugateTranspose", "[", "a_", "]"}], "]"}], ":=", 
  "a"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ConjugateTranspose", "[", 
   RowBox[{"a_", "+", "b_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"ConjugateTranspose", "[", "a", "]"}], "+", 
   RowBox[{"ConjugateTranspose", "[", "b", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConjugateTranspose", "[", 
    RowBox[{"Exp", "[", "a_", "]"}], "]"}], ":=", 
   RowBox[{"Exp", "[", 
    RowBox[{"ConjugateTranspose", "[", "a", "]"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ConjugateTranspose", "[", 
   RowBox[{"Rule", "[", 
    RowBox[{"a_", ",", "b_"}], "]"}], "]"}], ":=", 
  RowBox[{"Rule", "[", 
   RowBox[{
    RowBox[{"ConjugateTranspose", "[", "a", "]"}], ",", 
    RowBox[{"ConjugateTranspose", "[", "b", "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Conjugate", "[", "a", "]"}], "/;", 
   RowBox[{"NumericQ", "[", "a", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Protect", "[", "ConjugateTranspose", "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Rule", " ", "for", " ", "distributing", " ", "Transpose", " ", "over", 
     " ", "Sums", " ", "and", " ", 
     RowBox[{"Dot", ".", "\[IndentingNewLine]", 
      RowBox[{"Usage", ":", "  ", "exp"}]}]}], "//.", "sTransposeExpand"}], 
   "  ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sTransposeExpand", ":=", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{"a__", "+", "b__"}], "]"}], "->", 
       RowBox[{
        RowBox[{"Transpose", "[", "a", "]"}], "+", 
        RowBox[{"Transpose", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
      
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{"Dot", "[", "a__", "]"}], "]"}], ":>", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Transpose", "[", "#", "]"}], "&"}], ",", 
         RowBox[{"Dot", "[", 
          RowBox[{"Reverse", "[", "a", "]"}], "]"}]}], "]"}]}]}], "}"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Rule", " ", "to", " ", "ease", " ", "typing", " ", "of", " ", 
    RowBox[{"ConjugateTranspose", "."}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"subDaggerCT", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"SuperDagger", "->", "ConjugateTranspose"}], ",", 
      RowBox[{"SuperStar", "->", "Conjugate"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"egRule", ":", " ", 
     RowBox[{
     "distribute", " ", "SuperDagger", " ", "over", " ", "Matrix", " ", 
      "elements"}], ":", "$s"}], "=", 
    RowBox[{
     RowBox[{"SuperDagger", "[", "a_", "]"}], "\[RuleDelayed]", 
     RowBox[{
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"SuperDagger", "[", "#", "]"}], "]"}], "&"}], ",", 
        RowBox[{"Transpose", "[", "a", "]"}]}], "]"}], "/;", 
      RowBox[{"MatrixQ", "[", "a", "]"}]}]}]}], "\[IndentingNewLine]", "*)"}],
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Replaces", " ", 
      RowBox[{"Conjugate", "[", "realVar", "]"}]}], "|", 
     RowBox[{"ConjugateTranspose", "[", "realVar", "]"}]}], "->", 
    RowBox[{
    "realVar", " ", "in", " ", "exp_", " ", "if", " ", "realVar", " ", "is", 
     " ", "MemberQ", " ", "of", " ", "reals_"}]}], "  ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConjugateReals", "[", 
     RowBox[{"exp_", ",", "reals_List"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tmp", "=", 
        RowBox[{"ExpandConjugateTranspose", "[", "tmp", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
          RowBox[{"a", "/;", 
           RowBox[{"a", "\[Element]", "Reals"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
          RowBox[{"a", "/;", 
           RowBox[{"ListMemberQ", "[", 
            RowBox[{"a", ",", "reals"}], "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"ExpandConjugateTranspose", "[", "tmp", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "/.", 
         RowBox[{
          RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ":>", 
          RowBox[{
           RowBox[{"Transpose", "[", "a", "]"}], "/;", 
           RowBox[{"ListMemberQ", "[", 
            RowBox[{"a", ",", "reals"}], "]"}]}]}]}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "tuConjugateSimplify", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuConjugateSimplify", "::", "usage"}], "=", 
   "\"\<tuConjugateSimplify[reals_List:{}][exp_] simplifies Conjugate[]'s in \
exp_ with optional reals_List of variables.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"tuConjugateSimplify", "[", 
     RowBox[{"reals_List:", 
      RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tmp", "=", 
       RowBox[{"Expand", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{
        RowBox[{"tmp", "//.", "tuConjugateDistribute"}], "//.", 
        RowBox[{"tuOpSimplify", "[", "dotOps", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//.", 
        RowBox[{
         RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
         RowBox[{"a", "/;", 
          RowBox[{"a", "\[Element]", "Reals"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//.", 
        RowBox[{
         RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
         RowBox[{"a", "/;", 
          RowBox[{"tuMemberQ", "[", 
           RowBox[{"a", ",", "reals"}], "]"}]}]}]}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConjugateSimplify", "[", 
    RowBox[{"exp_", ",", 
     RowBox[{"reals_List:", 
      RowBox[{"{", "}"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"tuConjugateSimplify", "[", "reals", "]"}], "[", "exp", "]"}]}], 
  RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuConjugateDistribute", "::", "usage"}], "=", 
   "\"\<tuConjugateDistribute are Rules for distribution Conjugate[] over an \
expression. EG. exp_//.tuConjugateDistribute *19Jul2015*20Apr2018** \>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tuConjugateDistribute", ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{"a_", "+", "b_"}], "]"}], "->", 
      RowBox[{
       RowBox[{"Conjugate", "[", "a", "]"}], "+", 
       RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{"a_", " ", "b_"}], "]"}], "->", 
      RowBox[{
       RowBox[{"Conjugate", "[", "a", "]"}], " ", 
       RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{"Power", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], "]"}], "->", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"Conjugate", "[", "a", "]"}], ",", 
        RowBox[{"Conjugate", "[", "b", "]"}]}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{"a_", "==", "b_"}], "]"}], "->", 
      RowBox[{
       RowBox[{"Conjugate", "[", "a", "]"}], "==", 
       RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{"a_", "->", "b_"}], "]"}], "->", 
      RowBox[{
       RowBox[{"Conjugate", "[", "a", "]"}], "->", 
       RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{"Sum", "[", 
        RowBox[{"a_", ",", "b__"}], "]"}], "]"}], ":>", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"Conjugate", "[", "a", "]"}], ",", "b"}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{"xSum", "[", 
        RowBox[{"a_", ",", "d__"}], "]"}], "]"}], "->", 
      RowBox[{"xSum", "[", 
       RowBox[{
        RowBox[{"Conjugate", "[", "a", "]"}], ",", "d"}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{"Integrate", "[", 
        RowBox[{"a_", ",", "b__List"}], "]"}], "]"}], "->", 
      RowBox[{"Integrate", "[", 
       RowBox[{
        RowBox[{"Conjugate", "[", "a", "]"}], ",", "b"}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{"xIntegral", "[", 
        RowBox[{"a_", ",", "b__List"}], "]"}], "]"}], "\[Rule]", 
      RowBox[{"xIntegral", "[", 
       RowBox[{
        RowBox[{"Conjugate", "[", "a", "]"}], ",", "b"}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{"IntegralOp", "[", 
        RowBox[{"a_", ",", "d_"}], "]"}], "]"}], "->", 
      RowBox[{"IntegralOp", "[", 
       RowBox[{"a", ",", 
        RowBox[{"Conjugate", "[", "d", "]"}]}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"oo", ":", "DerivOps"}], ")"}], "[", 
        RowBox[{"a_", ",", "d_"}], "]"}], "]"}], "\[Rule]", 
      RowBox[{"oo", "[", 
       RowBox[{
        RowBox[{"Conjugate", "[", "a", "]"}], ",", 
        RowBox[{"Conjugate", "[", "d", "]"}]}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Conjugate", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"op", ":", 
          RowBox[{"dotOps", "|", "Times"}]}], ")"}], "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], "]"}], "->", 
      RowBox[{"op", "[", 
       RowBox[{
        RowBox[{"Conjugate", "[", "a", "]"}], " ", ",", " ", 
        RowBox[{"Conjugate", "[", "b", "]"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DistributeConjugate", "[", "exp_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", 
      RowBox[{"exp", "//.", "tuConjugateDistribute"}]}], "]"}]}], ";"}], " ", 
  
  RowBox[{"(*", "Compatibility", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuConjugateTransposeExpand", "::", "usage"}], "=", 
   "\"\<tuConjugateTransposeExpand[exp_] expands ConjugateTranspose and \
Conjugate terms in exp_. Aware of IntegralOp and DerivOps. *30Jul2015*\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"tuConjugateTransposeExpand", "[", "exp_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", 
        RowBox[{"tmp1", "=", "Null"}], ",", "sub", ",", 
        RowBox[{"cOps", "=", 
         RowBox[{"Conjugate", "|", "ConjugateTranspose"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", "subDaggerCT"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"superDagger", " ", "mean", " ", "ConjugateTranspose"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"sub", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{"Conjugate", "[", "a_", "]"}], "]"}], "->", 
           RowBox[{"Transpose", "[", "a", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{"ConjugateTranspose", "[", "a_", "]"}], "]"}], "->", 
           RowBox[{"Transpose", "[", "a", "]"}]}], " ", ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"cOp", ":", "cOps"}], ")"}], "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", 
               RowBox[{"Sum", "|", "xSum"}]}], ")"}], "[", 
             RowBox[{"a_", ",", "b__"}], "]"}], "]"}], "->", 
           RowBox[{"op", "[", 
            RowBox[{
             RowBox[{"cOp", "[", "a", "]"}], ",", "b"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"cOp", ":", "cOps"}], ")"}], "[", 
            RowBox[{"xIntegral", "[", 
             RowBox[{"a_", ",", "b__"}], "]"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"xIntegral", "[", 
            RowBox[{
             RowBox[{"cOp", "[", "a", "]"}], ",", "b"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{"Power", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "]"}], "->", 
           RowBox[{"Power", "[", 
            RowBox[{
             RowBox[{"Conjugate", "[", "a", "]"}], ",", 
             RowBox[{"Conjugate", "[", "b", "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Conjugate", "[", "#", "]"}], "&"}], ",", "a"}], "]"}],
             "/;", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"{", 
                RowBox[{
                "List", ",", "Plus", ",", "Equal", ",", "Rule", ",", 
                 "productOps", ",", "DerivOps"}], "}"}], "]"}], ",", 
              RowBox[{"Head", "[", "a", "]"}]}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "DerivOps"}], ")"}], "[", 
             RowBox[{"a_", ",", "d_"}], "]"}], "]"}], "->", 
           RowBox[{"op", "[", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", "a", "]"}], ",", 
             RowBox[{"Conjugate", "[", "d", "]"}]}], "]"}]}], ",", 
          RowBox[{"(*", 
           RowBox[{"d", " ", "always", " ", "scalar"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
             RowBox[{"a_", ",", 
              RowBox[{"Longest", "[", "b__", "]"}]}], "]"}], "]"}], 
           "\[RuleDelayed]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "b", "}"}], "]"}], ">", "1"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"op", "[", 
              RowBox[{
               RowBox[{"ConjugateTranspose", "[", 
                RowBox[{"op", "[", "b", "]"}], "]"}], ",", 
               RowBox[{"ConjugateTranspose", "[", "a", "]"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"op", "[", 
              RowBox[{
               RowBox[{"ConjugateTranspose", "[", "b", "]"}], ",", 
               RowBox[{"ConjugateTranspose", "[", "a", "]"}]}], "]"}]}], 
            "\[IndentingNewLine]", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ":>", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ConjugateTranspose", "[", "#", "]"}], "&"}], ",", 
              "a"}], "]"}], "/;", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "List", ",", "Plus", ",", "Equal", ",", "Rule", ",", 
                "CircleTimes", ",", "CirclePlus"}], "}"}], ",", 
              RowBox[{"Head", "[", "a", "]"}]}], "]"}]}]}]}], 
         "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", "sub"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuConjugateTransposeSimplify", "::", "usage"}], "=", 
   "\"\<tuConjugateTransposeSimplify[reals_List:{}][exp_] simplifies \
ConjugateTranspose and Conjugate terms in exp_ accounting for reals_List.  \n\
tuConjugateTransposeSimplify[reals_List:{},scalars_List:{}][exp_] simplifies \
ConjugateTranspose and Conjugate terms in exp_ accounting for reals_List and \
scalars_List.\n\
tuConjugateTransposeSimplify[reals_List:{},scalars_List:{},hermitian_List:{}][\
exp_] simplifies ConjugateTranspose and Conjugate terms in exp_ accounting \
for reals_List, scalars_List, and hermitian_List. *30Jul2015*\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"tuConjugateTransposeSimplify", "[", 
     RowBox[{"reals_List:", 
      RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tmp", "=", 
       RowBox[{"Expand", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{
        RowBox[{"tuConjugateTransposeExpand", "[", "tmp", "]"}], "//", 
        RowBox[{"tuOpSimplifyF", "[", "dotOps", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//", 
        RowBox[{"tuConjugateSimplify", "[", "reals", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//.", 
        RowBox[{
         RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ":>", 
         RowBox[{
          RowBox[{"Transpose", "[", "a", "]"}], "/;", 
          RowBox[{"tuMemberQ", "[", 
           RowBox[{"a", ",", "reals"}], "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//.", 
        RowBox[{
         RowBox[{"ConjugateTranspose", "[", 
          SuperscriptBox["a_", "n_"], "]"}], ":>", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"ConjugateTranspose", "[", "a", "]"}], "n"], "/;", 
          RowBox[{"tuMemberQ", "[", 
           RowBox[{"n", ",", "reals"}], "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//", 
        RowBox[{"tuConjugateSimplify", "[", "reals", "]"}]}]}]}]}], 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"tmp", "=", 
      RowBox[{"tmp", "//.", 
       RowBox[{
        RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
        RowBox[{"a", "/;", 
         RowBox[{
          RowBox[{"ListMemberQ", "[", 
           RowBox[{"a", ",", "reals"}], "]"}], ">", "0"}]}]}]}]}], "*)"}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"tuConjugateTransposeSimplify", "[", 
     RowBox[{
      RowBox[{"reals_List:", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"scalars_List:", 
       RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"tmp", "=", "exp"}], ",", "scal"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"scal", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"scalars", ",", 
          RowBox[{"Conjugate", "/@", "scalars"}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"Expand", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{
        RowBox[{"tuConjugateTransposeExpand", "[", "tmp", "]"}], "//", 
        RowBox[{"tuOpSimplifyF", "[", 
         RowBox[{"dotOps", ",", "scal"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//", 
        RowBox[{"tuConjugateSimplify", "[", "reals", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//.", 
        RowBox[{
         RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ":>", 
         RowBox[{
          RowBox[{"Transpose", "[", "a", "]"}], "/;", 
          RowBox[{"tuMemberQ", "[", 
           RowBox[{"a", ",", "reals"}], "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//.", 
        RowBox[{
         RowBox[{"ConjugateTranspose", "[", 
          SuperscriptBox["a_", "n_"], "]"}], ":>", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"ConjugateTranspose", "[", "a", "]"}], "n"], "/;", 
          RowBox[{"tuMemberQ", "[", 
           RowBox[{"n", ",", "reals"}], "]"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//.", 
        RowBox[{"tuTransposeSimplify", "[", "scal", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "//.", 
        RowBox[{"tuOpSimplify", "[", 
         RowBox[{"dotOps", ",", "scal"}], "]"}]}]}]}]}], 
    RowBox[{"(*", 
     RowBox[{";", "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "/.", 
        RowBox[{
         RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
         RowBox[{"a", "/;", 
          RowBox[{
           RowBox[{"ListMemberQ", "[", 
            RowBox[{"a", ",", "reals"}], "]"}], ">", "0"}]}]}]}]}]}], "*)"}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"tuConjugateTransposeSimplify", "[", 
      RowBox[{
       RowBox[{"reals_List:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"scalars_List:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"hermitian_List:", 
        RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "scal"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"scal", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"scalars", ",", 
           RowBox[{"Conjugate", "/@", "scalars"}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"Expand", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"tuConjugateTransposeExpand", "[", "tmp", "]"}], "//", 
         RowBox[{"tuOpSimplifyF", "[", 
          RowBox[{"dotOps", ",", "scal"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//", 
         RowBox[{"tuConjugateSimplify", "[", "reals", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{
          RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ":>", 
          RowBox[{
           RowBox[{"Transpose", "[", "a", "]"}], "/;", 
           RowBox[{"tuMemberQ", "[", 
            RowBox[{"a", ",", "reals"}], "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{
          RowBox[{"ConjugateTranspose", "[", 
           SuperscriptBox["a_", "n_"], "]"}], ":>", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"ConjugateTranspose", "[", "a", "]"}], "n"], "/;", 
           RowBox[{"tuMemberQ", "[", 
            RowBox[{"n", ",", "reals"}], "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{"tuTransposeSimplify", "[", "scal", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{"simpleHermitian", "[", "hermitian", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{"tuOpSimplify", "[", 
          RowBox[{"dotOps", ",", "scal"}], "]"}]}]}]}]}], 
     RowBox[{"(*", 
      RowBox[{";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "/.", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
          RowBox[{"a", "/;", 
           RowBox[{
            RowBox[{"ListMemberQ", "[", 
             RowBox[{"a", ",", "reals"}], "]"}], ">", "0"}]}]}]}]}]}], "*)"}],
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Distributes", " ", "Conjugate", " ", "and", " ", "ConjugateTranspose", 
    " ", "over", " ", "exp_.", " ", "Replaces", " ", "SuperDagger", " ", 
    "with", " ", 
    RowBox[{"ConjugateTranspose", "."}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DistributeConjugateCT", "[", "exp_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", 
        RowBox[{"tmp1", "=", "Null"}], ",", "sub"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"tmp", "//.", "subDaggerCT"}], "/.", 
         RowBox[{"Dot", "->", "xDot"}]}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"Dot", " ", "interferes", " ", "with", " ", "Rule", " ", 
         RowBox[{"sometimes", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"sub", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{"Power", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "]"}], "->", 
           RowBox[{"Power", "[", 
            RowBox[{
             RowBox[{"Conjugate", "[", "a", "]"}], ",", 
             RowBox[{"Conjugate", "[", "b", "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{"Sum", "[", 
             RowBox[{"a_", ",", "b__"}], "]"}], "]"}], ":>", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"Conjugate", "[", "a", "]"}], ",", "b"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{"xSum", "[", 
             RowBox[{"a_", ",", "d__"}], "]"}], "]"}], "->", 
           RowBox[{"xSum", "[", 
            RowBox[{
             RowBox[{"Conjugate", "[", "a", "]"}], ",", "d"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{"Integrate", "[", 
             RowBox[{"a_", ",", "b__List"}], "]"}], "]"}], "->", 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{"Conjugate", "[", "a", "]"}], ",", "b"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{"IntegralOp", "[", 
             RowBox[{"a_", ",", "d_"}], "]"}], "]"}], "->", 
           RowBox[{"IntegralOp", "[", 
            RowBox[{"a", ",", 
             RowBox[{"Conjugate", "[", "d", "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Conjugate", "[", "#", "]"}], "&"}], ",", "a"}], "]"}],
             "/;", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "List", ",", "Plus", ",", "Equal", ",", "Rule", ",", "Times", 
                ",", "xPartialD", ",", "xPartialDu", ",", "Dot", ",", 
                "xDot"}], "}"}], ",", 
              RowBox[{"Head", "[", "a", "]"}]}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{"Sum", "[", 
             RowBox[{"a_", ",", "b__"}], "]"}], "]"}], "->", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", "a", "]"}], ",", "b"}], 
            "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{"xSum", "[", 
             RowBox[{"a_", ",", "d__"}], "]"}], "]"}], "->", 
           RowBox[{"xSum", "[", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", "a", "]"}], ",", "d"}], 
            "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{"IntegralOp", "[", 
             RowBox[{"a_", ",", "d_"}], "]"}], "]"}], "->", 
           RowBox[{"IntegralOp", "[", 
            RowBox[{"a", ",", 
             RowBox[{"ConjugateTranspose", "[", "d", "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{"xPartialD", "[", 
             RowBox[{"a_", ",", "d_"}], "]"}], "]"}], "->", 
           RowBox[{"xPartialD", "[", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", "a", "]"}], ",", 
             RowBox[{"Conjugate", "[", "d", "]"}]}], "]"}]}], ",", 
          RowBox[{"(*", 
           RowBox[{"d", " ", "scalar"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{"xPartialDu", "[", 
             RowBox[{"a_", ",", "d_"}], "]"}], "]"}], "->", 
           RowBox[{"xPartialDu", "[", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", "a", "]"}], ",", 
             RowBox[{"Conjugate", "[", "d", "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{"xDot", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "]"}], "->", 
           RowBox[{"xDot", "[", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", "b", "]"}], " ", ",", " ", 
             RowBox[{"ConjugateTranspose", "[", "a", "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ":>", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ConjugateTranspose", "[", "#", "]"}], "&"}], ",", 
              "a"}], "]"}], "/;", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"List", ",", "Plus", ",", "Equal", ",", "Rule"}], 
               "}"}], ",", 
              RowBox[{"Head", "[", "a", "]"}]}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{"Conjugate", "[", "a_", "]"}], "]"}], "->", 
           RowBox[{"Transpose", "[", "a", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{"ConjugateTranspose", "[", "a_", "]"}], "]"}], "->", 
           RowBox[{"Transpose", "[", "a", "]"}]}]}], "\[IndentingNewLine]", 
         "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"tmp", "//.", "sub"}], "/.", 
         RowBox[{"xDot", "->", "Dot"}]}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ExpandConjugateTranspose", "[", "exp_", "]"}], " ", "expands", 
    " ", "ConjugateTranspose", " ", "and", " ", "Conjugate", " ", "terms", 
    " ", "in", " ", "exp_.", " ", 
    RowBox[{"(", 
     RowBox[{"Replaces", " ", 
      RowBox[{"DistributeConjugateCT", "."}]}], ")"}], " ", "*", "10", 
    "Sep2012"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ExpandConjugateTranspose", "[", "exp_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", 
        RowBox[{"tmp1", "=", "Null"}], ",", "sub", ",", 
        RowBox[{"cOps", "=", 
         RowBox[{"Conjugate", "|", "ConjugateTranspose"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", "subDaggerCT"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"superDagger", " ", "mean", " ", "ConjugateTranspose"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"sub", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{"Conjugate", "[", "a_", "]"}], "]"}], "->", 
           RowBox[{"Transpose", "[", "a", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{"ConjugateTranspose", "[", "a_", "]"}], "]"}], "->", 
           RowBox[{"Transpose", "[", "a", "]"}]}], " ", ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"cOp", ":", "cOps"}], ")"}], "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", 
               RowBox[{"Sum", "|", "xSum"}]}], ")"}], "[", 
             RowBox[{"a_", ",", "b__"}], "]"}], "]"}], "->", 
           RowBox[{"op", "[", 
            RowBox[{
             RowBox[{"cOp", "[", "a", "]"}], ",", "b"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"cOp", ":", "cOps"}], ")"}], "[", 
            RowBox[{"IntegralOp", "[", 
             RowBox[{"a_List", ",", "d_"}], "]"}], "]"}], "->", 
           RowBox[{"IntegralOp", "[", 
            RowBox[{"a", ",", 
             RowBox[{"cOp", "[", "d", "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"cOp", ":", "cOps"}], ")"}], "[", 
            RowBox[{"Integrate", "[", 
             RowBox[{"a_", ",", "b__List"}], "]"}], "]"}], "->", 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{"cOp", "[", "a", "]"}], ",", "b"}], "]"}]}], ",", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{"Power", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "]"}], "->", 
           RowBox[{"Power", "[", 
            RowBox[{
             RowBox[{"Conjugate", "[", "a", "]"}], ",", 
             RowBox[{"Conjugate", "[", "b", "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Conjugate", "[", "#", "]"}], "&"}], ",", "a"}], "]"}],
             "/;", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"{", 
                RowBox[{
                "List", ",", "Plus", ",", "Equal", ",", "Rule", ",", "Times", 
                 ",", "DerivOps", ",", "Dot", ",", "xDot"}], "}"}], "]"}], 
              ",", 
              RowBox[{"Head", "[", "a", "]"}]}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "DerivOps"}], ")"}], "[", 
             RowBox[{"a_", ",", "d_"}], "]"}], "]"}], "->", 
           RowBox[{"op", "[", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", "a", "]"}], ",", 
             RowBox[{"Conjugate", "[", "d", "]"}]}], "]"}]}], ",", 
          RowBox[{"(*", 
           RowBox[{"d", " ", "scalar"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
             RowBox[{"a_", ",", "b__"}], "]"}], "]"}], "->", 
           RowBox[{"op", "[", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{"op", "[", "b", "]"}], "]"}], " ", ",", " ", 
             RowBox[{"ConjugateTranspose", "[", "a", "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ":>", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ConjugateTranspose", "[", "#", "]"}], "&"}], ",", 
              "a"}], "]"}], "/;", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"List", ",", "Plus", ",", "Equal", ",", "Rule"}], 
               "}"}], ",", 
              RowBox[{"Head", "[", "a", "]"}]}], "]"}]}]}]}], 
         "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", "sub"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"SimpleConjugateTranspose", "[", 
       RowBox[{"reals_List", ",", "scalars_List", ",", "hermitian_List"}], 
       "]"}], "[", "exp_", "]"}], " ", "expands", " ", "and", " ", 
     "simplifies", " ", "exp_", " ", "based", " ", "upon", " ", 
     "reals_List"}], ",", "scalars_List", ",", 
    RowBox[{"hermitian_List", "  ", "*", "10", "Sep2012"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SimpleConjugateTranspose", "[", 
      RowBox[{"reals_List", ",", "scalars_List", ",", "hermitian_List"}], 
      "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tmp", "=", 
        RowBox[{"Expand", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"ExpandConjugateTranspose", "[", "tmp", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//", 
         RowBox[{"simpleDot1a", "[", "scalars", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
          RowBox[{"a", "/;", 
           RowBox[{"a", "\[Element]", "Reals"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a_", "]"}], ":>", 
          RowBox[{"a", "/;", 
           RowBox[{"ListMemberQ", "[", 
            RowBox[{"a", ",", "reals"}], "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{
          RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ":>", 
          RowBox[{
           RowBox[{"Transpose", "[", "a", "]"}], "/;", 
           RowBox[{"ListMemberQ", "[", 
            RowBox[{"a", ",", "reals"}], "]"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{"simpleTranspose", "[", "scalars", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{"simpleHermitian", "[", "hermitian", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//", 
         RowBox[{"simpleDot1a", "[", "scalars", "]"}]}]}], ";", 
       "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Rules", " ", "for", " ", "simplifying", " ", "Hermitian", " ", 
    RowBox[{"variables", "."}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"simpleHermitian", "[", "hermitian_List", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ConjugateTranspose", "[", "a_", "]"}], ":>", 
      RowBox[{"a", "/;", 
       RowBox[{"ListMemberQ", "[", 
        RowBox[{"a", ",", "hermitian"}], "]"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuCommutatorExpand", "::", "usage"}], "=", 
   "\"\<tuCommutatorExpand is Rule[] to replace Commutator expression into \
Dot[]d notation. *21Mar2016*\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tuCommutatorExpand", ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"CommutatorP", "->", "ACommutator"}], ",", 
     RowBox[{"CommutatorM", "->", "MCommutator"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"commutatorDot", ":=", "tuCommutatorExpand"}], ";"}], 
  RowBox[{"(*", "Compatibility", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuCommutatorSimplify", "::", "usage"}], "=", 
   "\"\<tuCommutatorSimplify[constant_List:{}][exp_] expands and simplify \
CommutatorM|P in exp_. *12Oct2015*7Apr2018*\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"tuCommutatorSimplify", "[", 
     RowBox[{"constant_List:", 
      RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", 
       RowBox[{"cOp", "=", 
        RowBox[{"CommutatorM", "|", "CommutatorP"}]}], ",", "$const"}], "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"$const", "[", "a_", "]"}], ":=", 
       RowBox[{
        RowBox[{"tuMemberQ", "[", 
         RowBox[{"a", ",", "constant"}], "]"}], "||", 
        RowBox[{"NumericQ", "[", "a", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"tmp1", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
         RowBox[{"xPrint", "[", 
          RowBox[{"\"\<tmp:  \>\"", ",", "tmp"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "/.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "cOp"}], ")"}], "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
            RowBox[{"op", "[", 
             RowBox[{
              RowBox[{"Expand", "[", "a", "]"}], ",", 
              RowBox[{"Expand", "[", "b", "]"}]}], "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "cOp"}], ")"}], "[", 
             RowBox[{
              RowBox[{"a_", "+", "a1_"}], ",", "b_"}], "]"}], 
            "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"op", "[", 
              RowBox[{"a", ",", "b"}], "]"}], "+", 
             RowBox[{"op", "[", 
              RowBox[{"a1", ",", "b"}], "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "cOp"}], ")"}], "[", 
             RowBox[{"a_", ",", 
              RowBox[{"b_", "+", "b1_"}]}], "]"}], "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"op", "[", 
              RowBox[{"a", ",", "b"}], "]"}], "+", 
             RowBox[{"op", "[", 
              RowBox[{"a", ",", "b1"}], "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "cOp"}], ")"}], "[", 
             RowBox[{
              RowBox[{"a_", "  ", "a1_"}], ",", "b_"}], "]"}], 
            "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"a", "  ", 
              RowBox[{"op", "[", 
               RowBox[{"a1", ",", "b"}], "]"}]}], "/;", 
             RowBox[{"$const", "[", "a", "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "cOp"}], ")"}], "[", 
             RowBox[{"a_", "  ", ",", 
              RowBox[{"b_", " ", "b1_"}]}], "]"}], "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"b", "  ", 
              RowBox[{"op", "[", 
               RowBox[{"a", ",", "b1"}], "]"}]}], "/;", 
             RowBox[{"$const", "[", "b", "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "CommutatorP"}], ")"}], "[", 
             RowBox[{"a_", "  ", ",", "b_"}], "]"}], "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"2", " ", "a", "  ", "b"}], "/;", 
             RowBox[{
              RowBox[{"$const", "[", "a", "]"}], "||", 
              RowBox[{"$const", "[", "b", "]"}]}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "CommutatorM"}], ")"}], "[", 
             RowBox[{"a_", "  ", ",", "b_"}], "]"}], "\[RuleDelayed]", 
            RowBox[{"0", "/;", 
             RowBox[{
              RowBox[{"$const", "[", "a", "]"}], "||", 
              RowBox[{"$const", "[", "b", "]"}]}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "cOp"}], ")"}], "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"ss", ":", 
                 RowBox[{"(", 
                  RowBox[{"Sum", "|", "xSum"}], ")"}]}], ")"}], "[", 
               RowBox[{"a_", ",", "b_"}], "]"}], ",", "c_"}], "]"}], 
            "\[Rule]", 
            RowBox[{"ss", "[", 
             RowBox[{
              RowBox[{"op", "[", 
               RowBox[{"a", ",", "c"}], "]"}], ",", "b"}], "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"op", ":", "cOp"}], ")"}], "[", 
             RowBox[{"c_", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"ss", ":", 
                 RowBox[{"(", 
                  RowBox[{"Sum", "|", "xSum"}], ")"}]}], ")"}], "[", 
               RowBox[{"a_", ",", "b_"}], "]"}]}], "]"}], "\[Rule]", 
            RowBox[{"ss", "[", 
             RowBox[{
              RowBox[{"op", "[", 
               RowBox[{"c", ",", "a"}], "]"}], ",", "b"}], "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"cop", ":", "CommutatorM"}], ")"}], "[", 
             RowBox[{"a_", " ", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dop", ":", "dotOps"}], ")"}], "[", 
               RowBox[{"b_", " ", ",", "b1__"}], "]"}]}], "]"}], 
            "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"dop", "[", 
              RowBox[{
               RowBox[{"cop", "[", 
                RowBox[{"a", ",", "b"}], "]"}], ",", "b1"}], "]"}], "+", 
             RowBox[{"dop", "[", 
              RowBox[{"b", ",", 
               RowBox[{"cop", "[", 
                RowBox[{"a", ",", 
                 RowBox[{"dop", "[", "b1", "]"}]}], "]"}]}], "]"}]}]}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"cop", ":", "CommutatorM"}], ")"}], "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dop", ":", "dotOps"}], ")"}], "[", 
               RowBox[{"a_", " ", ",", "b__"}], "]"}], ",", "b1_"}], "]"}], 
            "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"dop", "[", 
              RowBox[{"a", ",", 
               RowBox[{"cop", "[", 
                RowBox[{
                 RowBox[{"dop", "[", "b", "]"}], ",", "b1"}], "]"}]}], "]"}], 
             "+", 
             RowBox[{"dop", "[", 
              RowBox[{
               RowBox[{"cop", "[", 
                RowBox[{
                 RowBox[{"dop", "[", "a", "]"}], ",", "b1"}], "]"}], ",", 
               "b"}], "]"}]}]}]}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "/.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"cop", ":", "CommutatorM"}], ")"}], "[", 
             RowBox[{"a_", ",", "a_"}], "]"}], "\[Rule]", "0"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "/.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"cop", ":", "CommutatorP"}], ")"}], "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"cop", "[", 
              RowBox[{"b", ",", "a"}], "]"}], "/;", 
             RowBox[{"OrderedQ", "[", 
              RowBox[{"{", 
               RowBox[{"b", ",", "a"}], "}"}], "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "/.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"cop", ":", "CommutatorM"}], ")"}], "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"cop", "[", 
               RowBox[{"b", ",", "a"}], "]"}]}], "/;", 
             RowBox[{"OrderedQ", "[", 
              RowBox[{"{", 
               RowBox[{"b", ",", "a"}], "}"}], "]"}]}]}]}]}]}]}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"simpleCommutator", "[", 
      RowBox[{"constant_List:", 
       RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{
     RowBox[{"tuCommutatorSimplify", "[", "constant", "]"}], "[", "exp", 
     "]"}]}], ";"}], 
  RowBox[{"(*", "Compatibility", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuCommutatorSolve", "::", "usage"}], "=", 
   "\"\<tuCommutatorSolve[nterm_Integer][commutator_] Solves for \
CommutatorM|CommutatorP Rules where nterm_Integer select the term; \
1\[Rule]Solve for first term in commutator. If commutator is not a Rule then \
an expression is output with the commutator_ is used in the solution. \
*6May2016*\>\""}], ";", 
  RowBox[{"Clear", "[", "tuCommutatorSolve", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"tuCommutatorSolve", "[", 
      RowBox[{"nterm_Integer:", "1"}], "]"}], "[", "commutator_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"$", ",", 
        RowBox[{"$0", "=", "commutator"}], ",", "term"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"$", "=", 
        RowBox[{"$0", "/.", "tuCommutatorExpand"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "commutator", "]"}], "===", "Rule"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"term", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"nterm", "\[Equal]", "1"}], ",", 
             RowBox[{"Apply", "[", 
              RowBox[{"Dot", ",", 
               RowBox[{"$0", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"Apply", "[", 
              RowBox[{"Dot", ",", 
               RowBox[{"Reverse", "[", 
                RowBox[{"$0", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], "]"}]}], 
          ";", 
          RowBox[{"xPrint", "[", "term", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"$", "=", 
           RowBox[{
            RowBox[{"tuRuleSolve", "[", 
             RowBox[{"$", ",", "term"}], "]"}], "//", "First"}]}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"term", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"nterm", "\[Equal]", "1"}], ",", 
             RowBox[{"Apply", "[", 
              RowBox[{"Dot", ",", "$0"}], "]"}], ",", 
             RowBox[{"Apply", "[", 
              RowBox[{"Dot", ",", 
               RowBox[{"Reverse", "[", "$0", "]"}]}], "]"}]}], "]"}]}], ";", 
          RowBox[{"xPrint", "[", "term", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"$", "=", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tuRuleSolve", "[", 
              RowBox[{
               RowBox[{"$", "\[Rule]", "0"}], ",", "term"}], "]"}], "//", 
             "First"}], ")"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"$", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "+", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"nterm", "\[Equal]", "1"}], ",", "1", ",", 
               RowBox[{"-", "1"}]}], "]"}], "$0"}]}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuCommutatorForm", "::", "usage"}], "=", 
   "\"\<tuCommutatorForm Rules for combining sum of two terms into either \
CommutatorM|CommutatorP if possible.  Used in combination: \
tuRepeat[{tuCommutatorForm,tuOpSimplify[Dot]},{tuCommutatorSimplify[]},1]. \
*1Sep2016*\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuCommutatorForm", ":=", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tt", ":", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"sa_:", "1"}], ")"}], " ", 
          RowBox[{"a_", " ", ".", "a1_"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"sb_:", "1"}], ")"}], " ", 
          RowBox[{"a1_", " ", ".", "a_"}]}]}], ")"}]}], " ", "\[RuleDelayed]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"sa", "\[Equal]", 
         RowBox[{"-", "sb"}]}], ",", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"sa", " ", 
           RowBox[{"a", ".", "a1"}]}], " ", "+", 
          RowBox[{"sb", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"CommutatorM", "[", 
              RowBox[{"a1", ",", "a"}], "]"}], " ", "+", 
             RowBox[{"a", ".", "a1"}]}], ")"}]}]}], ")"}], ",", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"sa", "\[Equal]", "sb"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"sa", " ", 
             RowBox[{"a", ".", "a1"}]}], " ", "+", 
            RowBox[{"sb", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"CommutatorP", "[", 
                RowBox[{"a1", ",", "a"}], "]"}], " ", "-", 
               RowBox[{"a", ".", "a1"}]}], ")"}]}]}], ")"}], ",", "tt"}], 
         "]"}]}], "]"}]}], "\[IndentingNewLine]", "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"expandCom", "::", "usage"}], "=", 
   "\"\<expandCom[subs_:{}][exp_] expands Commutator expressions \
*22Mar2019*\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"expandCom", "[", 
      RowBox[{"subs_:", 
       RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"tmp", "//.", "tuCommutatorExpand"}], "//", 
         RowBox[{"expandDot", "[", "subs", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "/.", "toxDot"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"tmp", "//", "tuMatrixOrderedMultiply"}], "//", 
         RowBox[{"expandDot", "[", "toDot", "]"}]}]}], ";", 
       "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"jacobiID", "[", 
      RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], " ", "generates", " ", 
     "Jacobi", " ", "identity", " ", "form", " ", "from", " ", "a_"}], ",", 
    "b_", ",", 
    RowBox[{"c_.", " ", "*", "25", "Nov2013"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"jacobiID", "[", 
   RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"$aa", ",", "$bb", ",", "$cc", ",", "$p", ",", "$t"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"$t", "=", 
      RowBox[{"CommutatorM", "[", 
       RowBox[{"$aa", ",", 
        RowBox[{"CommutatorM", "[", 
         RowBox[{"$bb", ",", "$cc"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"$p", "=", 
      RowBox[{"Permute", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"$aa", ",", "$bb", ",", "$cc"}], "}"}], ",", 
        RowBox[{"AlternatingGroup", "[", "3", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"$p", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"#", "->", 
           RowBox[{"{", 
            RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], "]"}], "&"}], ",", 
        "$p"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"$p", "=", 
      RowBox[{"Apply", "[", 
       RowBox[{"Plus", ",", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"$t", "/.", "#"}], "&"}], ",", "$p"}], "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", "$p"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.474902202988223*^9, 3.474902218781245*^9}, {
   3.474902249452106*^9, 3.474902252358342*^9}, 3.4749022885666847`*^9, {
   3.474904002467537*^9, 3.474904015966226*^9}, {3.474904313637267*^9, 
   3.474904314548793*^9}, {3.4749048751484833`*^9, 3.474904921574607*^9}, {
   3.474904979979472*^9, 3.4749049974963837`*^9}, {3.474905066647118*^9, 
   3.4749050811369257`*^9}, {3.47490523544936*^9, 3.474905236168868*^9}, {
   3.474944627432186*^9, 3.474944639810153*^9}, {3.4749447417941303`*^9, 
   3.474944745533605*^9}, {3.47494480052849*^9, 3.474944888358387*^9}, {
   3.4749449236275597`*^9, 3.4749449266154633`*^9}, {3.4749449876399603`*^9, 
   3.4749450212062597`*^9}, {3.474945424838657*^9, 3.4749454345521097`*^9}, {
   3.474945466141786*^9, 3.474945538456306*^9}, {3.474945628035927*^9, 
   3.4749456296334476`*^9}, {3.474945732962715*^9, 3.474945737890752*^9}, {
   3.4749482603608637`*^9, 3.474948281093103*^9}, {3.4749483840846977`*^9, 
   3.4749483992388697`*^9}, {3.47494875051725*^9, 3.474948803611261*^9}, {
   3.474948884947719*^9, 3.474948931840364*^9}, {3.4749492406201077`*^9, 
   3.47494925331595*^9}, 3.4749494733800087`*^9, {3.4749495113089247`*^9, 
   3.474949513753845*^9}, 3.474949573354327*^9, 3.4749499896837673`*^9, 
   3.474950029369328*^9, {3.474950131732786*^9, 3.474950132368799*^9}, {
   3.474981806402833*^9, 3.474981899327038*^9}, {3.474981930863414*^9, 
   3.4749819526597548`*^9}, {3.474982139741414*^9, 3.474982219964347*^9}, 
   3.4749823960052423`*^9, {3.474982459470777*^9, 3.4749824720743837`*^9}, {
   3.474984800287813*^9, 3.4749848254758472`*^9}, {3.474985004182403*^9, 
   3.4749850117712927`*^9}, {3.474985086786294*^9, 3.474985134182914*^9}, {
   3.474985177061207*^9, 3.4749851963052073`*^9}, {3.4749852770738363`*^9, 
   3.474985279382162*^9}, {3.474985317981666*^9, 3.474985318796495*^9}, {
   3.474985397408358*^9, 3.4749854396534157`*^9}, {3.475036704893425*^9, 
   3.475036731196498*^9}, {3.4750389758328333`*^9, 3.475039012093803*^9}, {
   3.475039049487483*^9, 3.4750390689880657`*^9}, {3.475039105243697*^9, 
   3.475039159964554*^9}, {3.4750392870967073`*^9, 3.475039385368299*^9}, {
   3.475039458528109*^9, 3.475039503603745*^9}, {3.475063508482891*^9, 
   3.475063663796075*^9}, {3.475063695597624*^9, 3.475063763677724*^9}, 
   3.475063796432467*^9, {3.475063970321206*^9, 3.475064036031556*^9}, 
   3.475064099865511*^9, {3.4750641864351683`*^9, 3.475064298812497*^9}, {
   3.475064353035616*^9, 3.4750644186614227`*^9}, {3.475064520693749*^9, 
   3.475064524811913*^9}, {3.475064601896146*^9, 3.475064610046653*^9}, {
   3.475064688899332*^9, 3.4750647411643953`*^9}, {3.47506479413098*^9, 
   3.475064868797393*^9}, {3.475327441006032*^9, 3.475327452271845*^9}, {
   3.475327660591365*^9, 3.475327669398367*^9}, {3.475333293468802*^9, 
   3.47533329498803*^9}, {3.475333430884448*^9, 3.475333507277213*^9}, {
   3.475509439666131*^9, 3.475509440215962*^9}, {3.475808837281938*^9, 
   3.475808862101738*^9}, {3.475808893363825*^9, 3.4758090991040487`*^9}, {
   3.475809285434099*^9, 3.475809308024102*^9}, {3.475809566820257*^9, 
   3.4758095722907352`*^9}, {3.475898672757971*^9, 3.475898765258114*^9}, {
   3.475899848905645*^9, 3.4758998957129507`*^9}, {3.4763897180650787`*^9, 
   3.476389718908877*^9}, {3.476394465322373*^9, 3.476394470317672*^9}, {
   3.476394524776701*^9, 3.476394532918673*^9}, {3.476475121496636*^9, 
   3.476475148939528*^9}, {3.476475180297505*^9, 3.4764752046779013`*^9}, {
   3.476475244590598*^9, 3.4764754125132837`*^9}, {3.476824581316856*^9, 
   3.47682466249527*^9}, {3.476824721532248*^9, 3.476824789474885*^9}, {
   3.47682488084687*^9, 3.476824889776174*^9}, {3.476825118436091*^9, 
   3.476825133069786*^9}, {3.4768251972628813`*^9, 3.476825201005974*^9}, {
   3.476891015110813*^9, 3.4768911658439093`*^9}, {3.47689128459365*^9, 
   3.476891327240355*^9}, {3.4781225088749332`*^9, 3.478122510170926*^9}, {
   3.478281524916589*^9, 3.478281541989093*^9}, {3.478282567922708*^9, 
   3.478282593251577*^9}, {3.478542113886857*^9, 3.478542247165222*^9}, {
   3.478542280901883*^9, 3.478542326541152*^9}, {3.478542564934021*^9, 
   3.4785426055524797`*^9}, {3.478542985795989*^9, 3.478542990425305*^9}, 
   3.478543048125431*^9, {3.478739712963337*^9, 3.478739739292533*^9}, {
   3.478740135179277*^9, 3.478740167554812*^9}, {3.478750737455007*^9, 
   3.478750751132345*^9}, {3.482152394602234*^9, 3.482152549400078*^9}, {
   3.482417280894374*^9, 3.482417313959673*^9}, {3.482417360851695*^9, 
   3.482417400715022*^9}, {3.482417527440649*^9, 3.482417540050824*^9}, {
   3.482419113278393*^9, 3.482419173561716*^9}, {3.482419218393256*^9, 
   3.4824192461395473`*^9}, {3.4824193535031843`*^9, 3.482419355074546*^9}, {
   3.4824196427340384`*^9, 3.4824196663043413`*^9}, {3.482419726452313*^9, 
   3.482419727275962*^9}, {3.482419998541047*^9, 3.4824200127574253`*^9}, {
   3.48242009418847*^9, 3.4824201583681803`*^9}, {3.482422181571136*^9, 
   3.482422200702643*^9}, {3.482422349869032*^9, 3.4824223536512117`*^9}, {
   3.483802724072695*^9, 3.4838027242784557`*^9}, {3.483890609630702*^9, 
   3.483890610606539*^9}, {3.4838906873666773`*^9, 3.4838906894511538`*^9}, {
   3.483890720243185*^9, 3.483890805040807*^9}, {3.4869870593998337`*^9, 
   3.4869870889702587`*^9}, {3.487814331867058*^9, 3.4878146971943293`*^9}, {
   3.48781474540722*^9, 3.487814805428728*^9}, {3.4878148422683783`*^9, 
   3.487814857976061*^9}, {3.4878148986641483`*^9, 3.487814905830181*^9}, {
   3.487814943633572*^9, 3.487815012079419*^9}, {3.487815068726634*^9, 
   3.487815091619801*^9}, {3.4878153476325808`*^9, 3.4878153664660683`*^9}, 
   3.487815528343542*^9, {3.488027676484577*^9, 3.488027726163932*^9}, {
   3.4880278187584467`*^9, 3.4880278318477507`*^9}, {3.488027870865732*^9, 
   3.488027898592762*^9}, {3.488120888801943*^9, 3.488120971614522*^9}, {
   3.488715948540353*^9, 3.488715997501904*^9}, {3.488716194097541*^9, 
   3.488716252638253*^9}, {3.4887162908560953`*^9, 3.4887163774731817`*^9}, {
   3.488716599357139*^9, 3.4887166469443903`*^9}, {3.488716846349348*^9, 
   3.4887168513008213`*^9}, 3.488716917130862*^9, {3.4887272445934553`*^9, 
   3.488727245878105*^9}, {3.489235042492752*^9, 3.489235043496998*^9}, {
   3.489235127021331*^9, 3.4892351510448933`*^9}, {3.4899289331771183`*^9, 
   3.489928964398836*^9}, {3.489929066482153*^9, 3.4899290978225203`*^9}, 
   3.48992915098853*^9, {3.4899292159807997`*^9, 3.4899292233358917`*^9}, {
   3.489929324176581*^9, 3.489929353032815*^9}, {3.489929606806863*^9, 
   3.489929609723671*^9}, {3.490620935398858*^9, 3.490621188005164*^9}, {
   3.490670392069662*^9, 3.490670444142055*^9}, {3.4906705383281937`*^9, 
   3.490670558773653*^9}, {3.490670947683103*^9, 3.4906709553644867`*^9}, {
   3.49070464268841*^9, 3.49070476584444*^9}, {3.4907049192328873`*^9, 
   3.490704947662567*^9}, {3.490988856829043*^9, 3.49098888970508*^9}, {
   3.491341073476224*^9, 3.491341076933086*^9}, 3.491341231947568*^9, {
   3.4915862154421377`*^9, 3.49158621754423*^9}, {3.492432337084391*^9, 
   3.492432446992922*^9}, {3.4924324974597692`*^9, 3.492432508732259*^9}, 
   3.4924325781432257`*^9, 3.492432640109314*^9, {3.492432689293271*^9, 
   3.492432709267672*^9}, {3.494853609452252*^9, 3.4948537103938932`*^9}, {
   3.508791185121291*^9, 3.508791196007641*^9}, {3.509226463984026*^9, 
   3.509226542154163*^9}, {3.509226609649604*^9, 3.509226633234239*^9}, {
   3.5092268432015257`*^9, 3.50922687102273*^9}, 3.5092270235388813`*^9, {
   3.509227060980633*^9, 3.509227061657419*^9}, 3.509227572044039*^9, {
   3.509227849775589*^9, 3.509227851056636*^9}, {3.509228129042069*^9, 
   3.50922819348845*^9}, {3.509228299168318*^9, 3.509228302851684*^9}, {
   3.509229070046472*^9, 3.50922909557236*^9}, {3.509229162530674*^9, 
   3.509229192322863*^9}, {3.509229235662715*^9, 3.5092293073306417`*^9}, {
   3.5092293397890053`*^9, 3.50922935302642*^9}, {3.509229391653954*^9, 
   3.5092294396174097`*^9}, {3.509229489222184*^9, 3.5092295000024633`*^9}, {
   3.5092295350601387`*^9, 3.509229536557579*^9}, {3.511278976606083*^9, 
   3.5112789771634817`*^9}, {3.513014409543192*^9, 3.513014447597735*^9}, {
   3.51308415663741*^9, 3.5130842934579363`*^9}, {3.513428179198797*^9, 
   3.5134283016368027`*^9}, {3.5237181578698072`*^9, 
   3.5237181636449614`*^9}, {3.537196341343886*^9, 3.537196383486946*^9}, {
   3.556298523761634*^9, 3.5562985437100058`*^9}, {3.556371654164624*^9, 
   3.556371672771963*^9}, {3.556376890708191*^9, 3.5563768958190107`*^9}, {
   3.556376942184918*^9, 3.5563769511276913`*^9}, {3.556385028158307*^9, 
   3.556385123636518*^9}, {3.556385154590642*^9, 3.556385202948544*^9}, {
   3.5563853359527483`*^9, 3.556385348683778*^9}, {3.556387343137115*^9, 
   3.556387433773408*^9}, {3.5575765964511843`*^9, 3.557576813693362*^9}, {
   3.557576846947955*^9, 3.557576865082117*^9}, {3.557576937101405*^9, 
   3.55757697314158*^9}, {3.5575770065744047`*^9, 3.557577032148601*^9}, 
   3.557577082687705*^9, {3.564239207196857*^9, 3.564239210522871*^9}, {
   3.564239281766251*^9, 3.564239285902173*^9}, {3.5713672775334387`*^9, 
   3.571367355085452*^9}, {3.5713673916292458`*^9, 3.571367423902912*^9}, {
   3.5713674638434057`*^9, 3.5713674815826263`*^9}, {3.5713675119047413`*^9, 
   3.571367575472863*^9}, 3.571367626649247*^9, 3.571367674998756*^9, {
   3.571402296577619*^9, 3.571402314005125*^9}, {3.583287982829413*^9, 
   3.58328798561476*^9}, {3.583288241185718*^9, 3.583288247560069*^9}, {
   3.5921449011037683`*^9, 3.592145030280686*^9}, {3.592224386762691*^9, 
   3.5922244129285088`*^9}, {3.592224495933861*^9, 3.5922244968991127`*^9}, {
   3.594477895883294*^9, 3.594477956309063*^9}, {3.5945624700393887`*^9, 
   3.594562491877901*^9}, {3.595270961573194*^9, 3.595270993553879*^9}, 
   3.621211045921248*^9, {3.6262747663499327`*^9, 3.6262748286624117`*^9}, 
   3.626274865948793*^9, {3.626275859671712*^9, 3.626275870665744*^9}, {
   3.626275943650673*^9, 3.626275946148505*^9}, {3.640711154866536*^9, 
   3.640711156668387*^9}, {3.6435433402325706`*^9, 3.643543341813291*^9}, {
   3.643668723033681*^9, 3.64366872914778*^9}, 3.6436691783485413`*^9, {
   3.643681637677586*^9, 3.6436816773292437`*^9}, {3.643682436244766*^9, 
   3.643682466333283*^9}, {3.643682891369066*^9, 3.6436829437084217`*^9}, {
   3.64368331452636*^9, 3.643683372488085*^9}, {3.643683431830168*^9, 
   3.6436834395260963`*^9}, {3.6440224099479628`*^9, 3.6440224442961283`*^9}, 
   3.644022553016281*^9, {3.644022759318872*^9, 3.644022784458474*^9}, 
   3.644022844184807*^9, {3.64402312252921*^9, 3.644023123894788*^9}, 
   3.6440231747951517`*^9, {3.6440232189026737`*^9, 3.644023288198951*^9}, 
   3.647300441842754*^9, {3.6473035814121647`*^9, 3.6473037607025347`*^9}, {
   3.6473038014106827`*^9, 3.647303839859475*^9}, {3.6473039629604187`*^9, 
   3.647303967128271*^9}, {3.6473040356852503`*^9, 3.6473040613001127`*^9}, {
   3.6473041532526493`*^9, 3.647304162281414*^9}, {3.6536645209094353`*^9, 
   3.653664572639413*^9}, {3.653664823844349*^9, 3.6536648437342157`*^9}, {
   3.653669410420027*^9, 3.653669412351961*^9}, 3.66412014716325*^9, 
   3.665778701382865*^9, {3.667567732308051*^9, 3.667567925246887*^9}, {
   3.669077931486888*^9, 3.669077931769569*^9}, 3.669820792789699*^9, {
   3.669822158372745*^9, 3.669822160333508*^9}, {3.669822191308235*^9, 
   3.6698222182263327`*^9}, {3.669822322395638*^9, 3.669822341362442*^9}, 
   3.6699482156495543`*^9, 3.66994834701366*^9, {3.671540825360042*^9, 
   3.671540860612186*^9}, {3.671544844588636*^9, 3.67154484751084*^9}, {
   3.672101524190621*^9, 3.672101624202017*^9}, {3.6721017407861147`*^9, 
   3.672101764896057*^9}, {3.681757025753992*^9, 3.681757044665299*^9}, {
   3.684671699175758*^9, 3.684671699249579*^9}, {3.688830412386057*^9, 
   3.688830419664905*^9}, {3.699796028638098*^9, 3.6997960397504463`*^9}, 
   3.713967166490385*^9, 3.713967528377659*^9, 3.731636379825345*^9, {
   3.732106804048501*^9, 3.732106888187929*^9}, {3.732106966990028*^9, 
   3.732107026577485*^9}, {3.732107067581237*^9, 3.732107076842907*^9}, {
   3.732107482082603*^9, 3.732107487523706*^9}, {3.7321914039217443`*^9, 
   3.7321914183450613`*^9}, {3.7332401884579487`*^9, 3.73324019918316*^9}, {
   3.733240375016313*^9, 3.73324037761627*^9}, 3.7451542915935793`*^9, 
   3.745492019655382*^9, {3.745492353882601*^9, 3.745492392813621*^9}, {
   3.745492444311184*^9, 3.745492446318734*^9}, {3.7454924791460247`*^9, 
   3.7454925353899107`*^9}, {3.745492571561788*^9, 3.7454925883292522`*^9}, {
   3.7454927895510597`*^9, 3.745492854678069*^9}, {3.762433650187731*^9, 
   3.7624336588749647`*^9}, 
   3.763860962028824*^9},ExpressionUUID->"c74bf4d0-9eea-4635-8794-\
7d5fbe1add2e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\"\<e[] == unit vector.\>\"", ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Distributes", " ", "pair", " ", "operator", " ", "op_", " ", "in", " ", 
     "expression", " ", "op_.", 
     RowBox[{"A", ".", "op_"}], " ", "over", " ", "each", " ", "term", " ", 
     "in", " ", "exp_"}], ",", " ", 
    RowBox[{"e", ".", "g", "."}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"op_.", "A", " ", 
      RowBox[{"B", ".", "op_"}]}], "->", 
     RowBox[{"op_.", 
      RowBox[{"A", ".", "op_."}], "op_.", 
      RowBox[{"B", ".", "op_"}]}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ExpandPairOp", "[", 
     RowBox[{"op_", ",", "exp_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "tmp1"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"tmp1", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{"{", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"Odd", " ", "that"}], " ", "//.", " ", 
               RowBox[{"yields", " ", "different", " ", 
                RowBox[{"results", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"DotExpand", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Dot", "[", 
                RowBox[{"op", ",", 
                 RowBox[{"b_", " ", "c_"}], ",", "op"}], "]"}], ":>", 
               RowBox[{
                RowBox[{"Dot", "[", 
                 RowBox[{
                 "op", ",", "b", ",", "op", ",", "op", ",", "c", ",", "op"}], 
                 "]"}], "/;", 
                RowBox[{
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"b", ",", "op"}], "]"}], "&&", 
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"c", ",", "op"}], "]"}]}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Dot", "[", 
                RowBox[{"op", ",", "b_", ",", "c_", ",", "op"}], "]"}], ":>", 
               
               RowBox[{
                RowBox[{"Dot", "[", 
                 RowBox[{
                 "op", ",", "b", ",", "op", " ", ",", "op", ",", "c", ",", 
                  "op"}], "]"}], "/;", 
                RowBox[{
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"b", ",", "op"}], "]"}], "&&", 
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"c", ",", "op"}], "]"}]}]}]}]}], 
             "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "//.", "simpleDot"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"NOTE", ":", " ", 
    RowBox[{
    "DotExpand", " ", "works", " ", "for", " ", "only", " ", "simple", " ", 
     RowBox[{"sums", ".", "  ", "Need"}], " ", "to", " ", "precede", " ", 
     "it", " ", "with", " ", 
     RowBox[{"ExpandAll", "."}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DotExpand", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"op", ":", 
         RowBox[{"Dot", "|", "xDot"}]}], ")"}], "[", 
       RowBox[{"a___", ",", 
        RowBox[{"b_", "+", "c_"}], ",", "d___"}], "]"}], ":>", 
      RowBox[{
       RowBox[{"op", "[", 
        RowBox[{"a", ",", "b", ",", "d"}], "]"}], "+", 
       RowBox[{"op", "[", 
        RowBox[{"a", ",", "c", ",", "d"}], "]"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Keeps", " ", "under", " ", "Dot", " ", "items", " ", "in", " ", 
     RowBox[{"clist", ".", " ", "Usage"}], "  ", "expression"}], "/.", 
    RowBox[{
     RowBox[{"Dot", "[", "a___", "]"}], "\[RuleDelayed]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"dotKeep", "[", 
         RowBox[{"{", " ", "keep_list", " ", "}"}], "]"}], "  ", "[", "a", 
        "]"}], ".", "  ", "Returns"}], "  ", "nokeep_list", " ", 
      RowBox[{"Dot", "[", " ", "keep_list", " ", "]"}]}]}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Newer", " ", 
    RowBox[{"version", ".", " ", "2010.2"}], ".16"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DotKeep1", "[", 
     RowBox[{"clist_", ",", "seq_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "seq"}], ",", "i", ",", "j", ",", "member", ",", 
        RowBox[{"dot", "=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"times", "=", 
         RowBox[{"{", "1", "}"}]}], ",", "test", ",", 
        RowBox[{"DEBUG", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"tmp", "/.", 
          RowBox[{"Times", "->", "Dot"}]}], "/.", "simpleDot"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<DotKeep< \>\"", ",", "clist", ",", "\"\< : \>\"", ",", "tmp", 
           ",", "\"\< \>\"", ",", 
           RowBox[{"Length", "[", "tmp", "]"}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", 
          RowBox[{"Length", "[", "tmp", "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"test", "=", 
           RowBox[{"tmp", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"DEBUG", ">", "1"}], ",", 
            RowBox[{"Print", "[", 
             RowBox[{
             "\"\<DotKeep: \>\"", ",", "test", ",", "\"\< : \>\"", ",", 
              "clist"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"member", "=", "False"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"clist", ",", "test"}], "]"}], ",", 
            RowBox[{"member", "=", "True"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", 
             RowBox[{"Length", "[", "clist", "]"}]}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"!", " ", 
               RowBox[{"FreeQ", "[", 
                RowBox[{"test", ",", 
                 RowBox[{"clist", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ",", 
              RowBox[{"member", "=", "True"}]}], "]"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", " ", 
           RowBox[{"member", ",", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", " ", 
             RowBox[{"dot", ",", "test"}], "]"}], ",", "\[IndentingNewLine]", 
            
            RowBox[{"AppendTo", "[", " ", 
             RowBox[{"times", ",", "test"}], "]"}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"DEBUG", ">", "1"}], ",", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<DotKeep: \>\"", ",", "dot", ",", "times"}], "]"}]}],
            "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "times", "]"}], ">", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"Apply", "[", 
           RowBox[{"Times", ",", "times"}], "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "dot", "]"}], ">", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", " ", 
           RowBox[{"Apply", "[", 
            RowBox[{"Dot", ",", "dot"}], "]"}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<DotKeep>> \>\"", ",", "tmp"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "tuDotTermLeft", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuDotTermLeft", "::", "usage"}], "=", 
   "\"\<tuDotTermLeft[term_,block_List:{},commuteRule_List:{},scalars_List:{}]\
 [ exp_ ] commutes term_ to the left in dotOps expressions in exp_. \
block_List contains terms that block the movement of term_.  commuteRule_List \
contains Rule[]s that are used when terms are commuted.  scalars_List lists \
scalars that are used in tuOpSimplify. NOTE: all dotOps need to be the same \
in expressions. *6Sep2018*\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"tuDotTermLeft", "[", 
      RowBox[{"term_", ",", 
       RowBox[{"block_List:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"pairRule_List:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"scalars_List:", 
        RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", "$", ",", 
        RowBox[{"cnt", "=", "0"}], ",", "$pair", ",", "$newpair"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"tmp1", "=!=", "tmp"}], "&&", 
          RowBox[{
           RowBox[{"cnt", "++"}], "<", "20"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{
             RowBox[{"dd0", ":", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
               RowBox[{"a0___", ",", 
                RowBox[{"Shortest", "[", "a_", "]"}], " ", ",", "term", ",", 
                "b0___"}], "]"}]}], " ", "\[RuleDelayed]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"ListFreeQ", "[", 
                RowBox[{"a", ",", "block"}], "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"$pair", "=", 
                 RowBox[{"dd", "[", 
                  RowBox[{"a", ",", "term"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"$newpair", "=", 
                 RowBox[{"$pair", "/.", "pairRule"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"$pair", "==", "$newpair"}], ",", 
                  RowBox[{"(*", 
                   RowBox[{"no", " ", "pairRule"}], "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{"$newpair", "=", 
                   RowBox[{"Reverse", "[", "$pair", "]"}]}]}], "]"}], ";", 
                RowBox[{"(*", "default", "*)"}], "\[IndentingNewLine]", 
                RowBox[{"dd", "[", 
                 RowBox[{"a0", ",", "$newpair", ",", "b0"}], "]"}]}], ",", 
               "\[IndentingNewLine]", "dd0"}], "\[IndentingNewLine]", 
              "]"}]}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"tmp", "//", "Expand"}], "//", 
             RowBox[{"tuOpDistributeF", "[", "dotOps", "]"}]}], "//", 
            RowBox[{"tuOpSimplifyF", "[", 
             RowBox[{"dotOps", ",", "scalars"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"xPrint", "[", "tmp", "]"}], ";"}]}], "\[IndentingNewLine]",
         "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TEST", "\[IndentingNewLine]", "$scc"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"tuGammaIdentities", "//", 
         RowBox[{"tuRuleSelect", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
              RowBox[{"{", "a_", "}"}]}], "]"}], ".", 
            RowBox[{"T", "[", 
             RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
              RowBox[{"{", "b_", "}"}]}], "]"}]}], ",", 
           RowBox[{"{", "\[Nu]", "}"}]}], "]"}]}], "//", "tuPatternRemove"}], 
       "//", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "/.", 
           RowBox[{"\[Nu]", "\[Rule]", "k"}]}], "/.", 
          RowBox[{"Dot", "\[Rule]", "CenterDot"}]}], "&"}], ")"}]}], "//", 
      RowBox[{
       RowBox[{"tuAddPatternVariable", "[", "\[Mu]", "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"T", "[", 
         RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
          RowBox[{"{", "i", "}"}]}], "]"}], "\[CenterDot]", 
        RowBox[{"T", "[", 
         RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
          RowBox[{"{", "j", "}"}]}], "]"}], "\[CenterDot]", 
        RowBox[{"T", "[", 
         RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
          RowBox[{"{", "k", "}"}]}], "]"}], "\[CenterDot]", 
        RowBox[{"T", "[", 
         RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
          RowBox[{"{", "l", "}"}]}], "]"}]}], "\[IndentingNewLine]", "%"}]}], 
     "//", 
     RowBox[{"tuDotTermLeft", "[", 
      RowBox[{
       RowBox[{"T", "[", 
        RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
         RowBox[{"{", "k", "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"T", "[", 
         RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
          RowBox[{"{", "i", "}"}]}], "]"}], "}"}], ",", "$scc"}], "]"}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "tuDotTermRight", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuDotTermRight", "::", "usage"}], "=", 
   "\"\<tuDotTermRight[term_,block_List:{},commuteRule_List:{},scalars_List:{}\
][exp_] commutes term_ to the right in dotOps expressions in exp_. block_List \
contains terms that block the movement of term_.  commuteRule_List contains \
Rule[]s that are used when terms are commuted.  scalars_List lists scalars \
that are used in tuOpSimplify. NOTE: all dotOps need to be the same in \
expressions. *6Sep2018*\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"tuDotTermRight", "[", 
      RowBox[{"term_", ",", 
       RowBox[{"block_List:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"pairRule_List:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"scalars_List:", 
        RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", "$", ",", 
        RowBox[{"cnt", "=", "0"}], ",", "$pair", ",", "$newpair"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"tmp1", "=!=", "tmp"}], "&&", 
          RowBox[{
           RowBox[{"cnt", "++"}], "<", "20"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{
             RowBox[{"dd0", ":", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
               RowBox[{"a0___", ",", "term", ",", 
                RowBox[{"Shortest", "[", "a_", "]"}], " ", ",", "b0___"}], 
               "]"}]}], " ", "\[RuleDelayed]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"ListFreeQ", "[", 
                RowBox[{"a", ",", "block"}], "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"$pair", "=", 
                 RowBox[{"dd", "[", 
                  RowBox[{"term", ",", "a"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"$newpair", "=", 
                 RowBox[{"$pair", "/.", "pairRule"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"$pair", "==", "$newpair"}], ",", 
                  RowBox[{"(*", 
                   RowBox[{"no", " ", "pairRule"}], "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{"$newpair", "=", 
                   RowBox[{"Reverse", "[", "$pair", "]"}]}]}], "]"}], ";", 
                RowBox[{"(*", "default", "*)"}], "\[IndentingNewLine]", 
                RowBox[{"dd", "[", 
                 RowBox[{"a0", ",", "$newpair", ",", "b0"}], "]"}]}], ",", 
               "\[IndentingNewLine]", "dd0"}], "\[IndentingNewLine]", 
              "]"}]}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"tmp", "//", "Expand"}], "//", 
             RowBox[{"tuOpDistributeF", "[", "dotOps", "]"}]}], "//", 
            RowBox[{"tuOpSimplifyF", "[", 
             RowBox[{"dotOps", ",", "scalars"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"xPrint", "[", "tmp", "]"}], ";"}]}], "\[IndentingNewLine]",
         "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", "$scci"}], "=", 
     RowBox[{
      RowBox[{"tuGammaIdentities", "//", 
       RowBox[{"tuRuleSelect", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
            RowBox[{"{", "a_", "}"}]}], "]"}], ".", 
          RowBox[{"T", "[", 
           RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
            RowBox[{"{", "b_", "}"}]}], "]"}]}], ",", 
         RowBox[{"{", "\[Nu]", "}"}]}], "]"}]}], "//", "tuPatternRemove"}]}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"$scci", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"$scci", "/.", 
             RowBox[{"\[Mu]", "\[Rule]", "\[Nu]"}]}], "//", 
            RowBox[{"tuRuleSolveF", "[", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
                RowBox[{"{", "\[Nu]", "}"}]}], "]"}], ".", 
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
                RowBox[{"{", "\[Nu]", "}"}]}], "]"}]}], "]"}]}], ",", 
           RowBox[{"$scci", "/.", 
            RowBox[{"\[Mu]", "\[Rule]", "i"}]}]}], "}"}], "/.", 
         RowBox[{"Dot", "\[Rule]", "CenterDot"}]}], "//", "Flatten"}], "//", 
       RowBox[{
        RowBox[{"tuAddPatternVariable", "[", "\[Nu]", "]"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
           RowBox[{"{", "i", "}"}]}], "]"}], "\[CenterDot]", 
         RowBox[{"T", "[", 
          RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
           RowBox[{"{", "j", "}"}]}], "]"}], "\[CenterDot]", 
         RowBox[{"T", "[", 
          RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
           RowBox[{"{", "i", "}"}]}], "]"}], "\[CenterDot]", 
         RowBox[{"T", "[", 
          RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
           RowBox[{"{", "l", "}"}]}], "]"}]}], "\[IndentingNewLine]", "%"}]}],
       "//", 
      RowBox[{"tuDotTermRight", "[", 
       RowBox[{
        RowBox[{"T", "[", 
         RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
          RowBox[{"{", "i", "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"T", "[", 
          RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
           RowBox[{"{", "x", "}"}]}], "]"}], "}"}], ",", "$scci", ",", 
        RowBox[{"{", 
         RowBox[{"T", "[", 
          RowBox[{"g", ",", "\"\<dd\>\"", ",", 
           RowBox[{"{", 
            RowBox[{"_", ",", "_"}], "}"}]}], "]"}], "}"}]}], "]"}]}]}]}], 
   "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MoveDotLeft", "[", 
     RowBox[{"term_", ",", "block_List"}], "]"}], "[", "exp_Dot", "]"}], ":=", 
   RowBox[{
    RowBox[{"tuDotTermLeft", "[", 
     RowBox[{"term", ",", "block"}], "]"}], "[", "exp", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"MoveDotRight", "[", 
      RowBox[{"term_", ",", "block_List"}], "]"}], "[", "exp_Dot", "]"}], ":=", 
    RowBox[{
     RowBox[{"tuDotTermRight", "[", 
      RowBox[{"term", ",", "block"}], "]"}], "[", "exp", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GammaRight", "[", 
    RowBox[{"exp_", ",", "gamma_"}], "]"}], ":=", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Moves", " ", "gamma_", " ", "in", " ", 
      RowBox[{"Dot", "[", "]"}], " ", "expression", " ", "to", " ", "the", 
      " ", "right", " ", "until", " ", "the", " ", "end", " ", "or", " ", 
      "the", " ", "term", " ", 
      RowBox[{"disappears", ".", "  ", 
       RowBox[{"Usage", ":", " ", "expression"}]}]}], "/.", 
     RowBox[{
      RowBox[{"Dot", "[", "a__", "]"}], ":>", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"GammaRight", "[", "a", "]"}], ".", "  ", "Returns"}], " ", 
       "replacement", " ", "for", " ", 
       RowBox[{
        RowBox[{"Dot", "[", "]"}], "."}]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", "out", ",", "gpos", ",",
        "Ngpos", ",", "igpos", ",", 
       RowBox[{"indu", "=", "Null"}], ",", 
       RowBox[{"indd", "=", "Null"}], ",", "pair", ",", 
       RowBox[{"DEBUG", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"DEBUG", ">", "0"}], ",", 
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<GammaRight: \>\"", ",", "tmp", ",", "\"\< : \>\"", ",", 
          "gamma"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"tmp1", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
         RowBox[{"indu", "=", 
          RowBox[{"gamma", "/.", 
           RowBox[{
            RowBox[{"\[Gamma]", "@", 
             RowBox[{"u", "[", "a_", "]"}]}], "->", "a"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"indd", "=", 
          RowBox[{"gamma", "/.", 
           RowBox[{
            RowBox[{"\[Gamma]", "@", 
             RowBox[{"d", "[", "a_", "]"}]}], "->", "a"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "/.", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{"a___", ",", "gamma", ",", "b_", ",", "c___"}], "]"}], ":>", 
            RowBox[{
             RowBox[{"Dot", "[", 
              RowBox[{"a", ",", 
               RowBox[{"CommuteG", "[", 
                RowBox[{"gamma", ",", "b"}], "]"}], ",", "c"}], "]"}], "/;", 
             RowBox[{"(", 
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", "b", "}"}], ",", 
                RowBox[{
                 RowBox[{"\[Gamma]", "@", 
                  RowBox[{"u", "[", "_", "]"}]}], "||", 
                 RowBox[{"MemberQ", "[", 
                  RowBox[{
                   RowBox[{"{", "b", "}"}], ",", 
                   RowBox[{"\[Gamma]", "@", 
                    RowBox[{"d", "[", "_", "]"}]}]}], "]"}]}]}], "]"}], 
              ")"}]}]}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"Expand", "[", "tmp", "]"}], "/.", "simpleDot"}], "//", 
           "Expand"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"DEBUG", ">", "0"}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<GammaRight>  \>\"", ",", "tmp"}], "]"}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "/.", 
           RowBox[{"Dot", "->", "xDot"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{"xDot", "[", "a__", "]"}], ":>", 
            RowBox[{"DotKeep1", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\[Gamma]", "@", 
                 RowBox[{"d", "[", "_", "]"}]}], ",", 
                RowBox[{"\[Gamma]", "@", 
                 RowBox[{"u", "[", "_", "]"}]}]}], "}"}], ",", 
              RowBox[{"{", "a", "}"}]}], "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{
           RowBox[{"Expand", "[", "tmp", "]"}], "/.", "simpleDot"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmp", "//.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"a___", ",", 
                RowBox[{"\[Gamma]", "@", 
                 RowBox[{"d", "[", "b_", "]"}]}], ",", 
                RowBox[{"\[Gamma]", "@", 
                 RowBox[{"u", "[", "b_", "]"}]}], ",", "c___"}], "]"}], ":>", 
              
              RowBox[{
               RowBox[{"dim", "[", "x", "]"}], 
               RowBox[{"Dot", "[", 
                RowBox[{"a", ",", "c"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"a___", ",", 
                RowBox[{"\[Gamma]", "@", 
                 RowBox[{"u", "[", "b_", "]"}]}], ",", 
                RowBox[{"\[Gamma]", "@", 
                 RowBox[{"d", "[", "b_", "]"}]}], ",", "c___"}], "]"}], ":>", 
              
              RowBox[{
               RowBox[{"dim", "[", "x", "]"}], " ", 
               RowBox[{"Dot", "[", 
                RowBox[{"a", ",", "c"}], "]"}]}]}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"DEBUG", ">", "0"}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<GammaRight>> \>\"", ",", "tmp"}], "]"}]}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "tmp"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GammaRight", "[", 
     RowBox[{"exp_", ",", "gamma_Tensor"}], "]"}], ":=", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Moves", " ", "gamma", " ", "matrix", " ", "gamma_", " ", "in", " ", 
      "expression", " ", "with", " ", 
      RowBox[{
       RowBox[{"Dot", "[", 
        RowBox[{",", "gamma_", ",", "\[Gamma]", ",", 
         RowBox[{"\[Gamma]", "..."}]}], "]"}], "'"}], "s", " ", "through", 
      " ", 
      RowBox[{"\[Gamma]", "'"}], "s", " ", "to", " ", "the", " ", "far", " ", 
      "right", " ", "or", " ", "until", " ", "it", " ", 
      RowBox[{"disappears", ".", "  ", "\[IndentingNewLine]", 
       RowBox[{"Usage", ":", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"GammaLeft", "[", 
           RowBox[{"exp_", ",", "gamma_"}], "]"}], ".", "  ", "Returns"}], 
         " ", "exp_", " ", "with", " ", 
         RowBox[{
          RowBox[{"Dot", "[", 
           RowBox[{",", "gamma_", ",", "..."}], "]"}], "'"}], "s", " ", 
         "replaced", " ", "with", " ", 
         RowBox[{"Dot", "[", 
          RowBox[{",", "gamma_", ","}], "]"}], " ", "where", " ", "gamma_", 
         " ", "is", " ", "moved", " ", "to", " ", "the", " ", 
         RowBox[{"right", "."}]}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", "gammaT", ",", 
        "isgamma", ",", "out", ",", 
        RowBox[{"DEBUG", "=", "0"}], ",", 
        RowBox[{"mname", "=", "\"\<GammaRight\>\""}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"IfDEBUG", "[", 
        RowBox[{"mname", ",", 
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{"tmp", ",", "gamma"}], "}"}], ",", "\"\<{tmp,gamma}\>\""}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"gammaT", "=", 
        RowBox[{"Apply", "[", 
         RowBox[{"List", ",", "gamma"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"isgamma", "=", 
        RowBox[{
         RowBox[{"Count", "[", 
          RowBox[{
           RowBox[{"{", "gamma", "}"}], ",", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", 
             RowBox[{"{", "_", "}"}], ",", 
             RowBox[{"{", "_", "}"}]}], "]"}]}], "]"}], "\[Equal]", "1"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"tmp1", "=!=", "tmp"}], "&&", "isgamma"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{
             RowBox[{"Dot", "[", 
              RowBox[{"a___", ",", "gamma", ",", "b_", ",", "c___"}], "]"}], ":>", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"a", ",", 
                RowBox[{"CommuteG", "[", 
                 RowBox[{"gamma", ",", "b"}], "]"}], ",", "c"}], "]"}], "/;", 
              
              RowBox[{
               RowBox[{"Count", "[", 
                RowBox[{
                 RowBox[{"{", "b", "}"}], ",", 
                 RowBox[{"Tensor", "[", 
                  RowBox[{"\[Gamma]", ",", 
                   RowBox[{"{", "_", "}"}], ",", 
                   RowBox[{"{", "_", "}"}]}], "]"}]}], "]"}], "\[Equal]", 
               "1"}]}]}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Expand", "[", "tmp", "]"}], "//.", "DotExpand"}], "//.",
              "simpleDot"}], "//", "Expand"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GammaLeft", "[", 
     RowBox[{"exp_", ",", "gamma_Tensor"}], "]"}], ":=", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Moves", " ", "gamma", " ", "matrix", " ", "gamma_", " ", "in", " ", 
      "expression", " ", "exp_", " ", "with", " ", 
      RowBox[{
       RowBox[{"Dot", "[", 
        RowBox[{",", "\[Gamma]", ",", "\[Gamma]", ",", "gamma_", ",", "..."}],
         "]"}], "'"}], "s", " ", "through", " ", 
      RowBox[{"\[Gamma]", "'"}], "s", " ", "to", " ", "the", " ", "far", " ", 
      "left", " ", "or", " ", "until", " ", "it", " ", 
      RowBox[{"disappears", ".", "  ", "\[IndentingNewLine]", 
       RowBox[{"Usage", ":", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"GammaLeft", "[", 
           RowBox[{"exp_", ",", "gamma_"}], "]"}], ".", "  ", "Returns"}], 
         " ", "exp_", " ", "with", " ", 
         RowBox[{
          RowBox[{"Dot", "[", 
           RowBox[{",", "gamma_", ",", "..."}], "]"}], "'"}], "s", " ", 
         "replaced", " ", "with", " ", 
         RowBox[{"Dot", "[", 
          RowBox[{",", "gamma_", ","}], "]"}], " ", "where", " ", "gamma_", 
         " ", "is", " ", "moved", " ", "to", " ", "the", " ", 
         RowBox[{"left", "."}]}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", "gammaT", ",", 
        "isgamma", ",", 
        RowBox[{"DEBUG", "=", "0"}], ",", 
        RowBox[{"mname", "=", "\"\<GammaLeft\>\""}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"IfDEBUG", "[", 
        RowBox[{"mname", ",", 
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{"tmp", ",", "gamma"}], "}"}], ",", "\"\<{tmp,gamma}\>\""}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"gammaT", "=", 
        RowBox[{"Apply", "[", 
         RowBox[{"List", ",", "gamma"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"isgamma", "=", 
        RowBox[{
         RowBox[{"Count", "[", 
          RowBox[{
           RowBox[{"{", "gamma", "}"}], ",", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", 
             RowBox[{"{", "_", "}"}], ",", 
             RowBox[{"{", "_", "}"}]}], "]"}]}], "]"}], "\[Equal]", "1"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"tmp1", "=!=", "tmp"}], "&&", "isgamma"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{
             RowBox[{"Dot", "[", 
              RowBox[{"a___", ",", "b_", ",", "gamma", ",", "c___"}], "]"}], ":>", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"a", ",", 
                RowBox[{"CommuteG", "[", 
                 RowBox[{"b", ",", "gamma"}], "]"}], ",", "c"}], "]"}], "/;", 
              
              RowBox[{
               RowBox[{"Count", "[", 
                RowBox[{
                 RowBox[{"{", "b", "}"}], ",", 
                 RowBox[{"Tensor", "[", 
                  RowBox[{"\[Gamma]", ",", 
                   RowBox[{"{", "_", "}"}], ",", 
                   RowBox[{"{", "_", "}"}]}], "]"}]}], "]"}], "\[Equal]", 
               "1"}]}]}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Expand", "[", "tmp", "]"}], "//.", "DotExpand"}], "//.",
              "simpleDot"}], "//", "Expand"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GammaRight", "[", "gamma_Tensor", "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Moves", " ", "gamma", " ", "matrix", " ", "gamma_", " ", "in", " ", 
      "expression", " ", "exp_", " ", "with", " ", 
      RowBox[{
       RowBox[{"Dot", "[", 
        RowBox[{",", "gamma_", ",", "\[Gamma]", ",", "\[Gamma]", ",", "..."}],
         "]"}], "'"}], "s", " ", "through", " ", 
      RowBox[{"\[Gamma]", "'"}], "s", " ", "to", " ", "the", " ", "far", " ", 
      "right", " ", "or", " ", "until", " ", "it", " ", 
      RowBox[{"disappears", ".", "  ", "\[IndentingNewLine]", 
       RowBox[{"Usage", ":", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"GammaRight", "[", "gamma_", "]"}], "[", "exp_", "]"}], 
          ".", "  ", "Returns"}], " ", "exp_", " ", "with", " ", 
         RowBox[{
          RowBox[{"Dot", "[", 
           RowBox[{",", "gamma_", ",", "..."}], "]"}], "'"}], "s", " ", 
         "replaced", " ", "with", " ", 
         RowBox[{"Dot", "[", 
          RowBox[{"...", ",", "gamma_", ","}], "]"}], " ", "where", " ", 
         "gamma_", " ", "is", " ", "moved", " ", "to", " ", "the", " ", 
         "right", " ", "through", " ", "other", " ", 
         RowBox[{"gamma", "'"}], 
         RowBox[{"s", "."}]}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", "gammaT", ",", 
        "isgamma", ",", 
        RowBox[{"DEBUG", "=", "0"}], ",", 
        RowBox[{"mname", "=", "\"\<GammaRight\>\""}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"IfDEBUG", "[", 
        RowBox[{"mname", ",", 
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{"tmp", ",", "gamma"}], "}"}], ",", "\"\<{tmp,gamma}\>\""}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"gammaT", "=", 
        RowBox[{"Apply", "[", 
         RowBox[{"List", ",", "gamma"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"isgamma", "=", 
        RowBox[{
         RowBox[{"Count", "[", 
          RowBox[{
           RowBox[{"{", "gamma", "}"}], ",", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", 
             RowBox[{"{", "_", "}"}], ",", 
             RowBox[{"{", "_", "}"}]}], "]"}]}], "]"}], "\[Equal]", "1"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"tmp1", "=!=", "tmp"}], "&&", "isgamma"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{
             RowBox[{"Dot", "[", 
              RowBox[{"a___", ",", "gamma", ",", "b_", ",", "c___"}], "]"}], ":>", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"a", ",", 
                RowBox[{"CommuteG", "[", 
                 RowBox[{"gamma", ",", "b"}], "]"}], ",", "c"}], "]"}], "/;", 
              
              RowBox[{
               RowBox[{"Count", "[", 
                RowBox[{
                 RowBox[{"{", "b", "}"}], ",", 
                 RowBox[{"Tensor", "[", 
                  RowBox[{"\[Gamma]", ",", 
                   RowBox[{"{", "_", "}"}], ",", 
                   RowBox[{"{", "_", "}"}]}], "]"}]}], "]"}], "\[Equal]", 
               "1"}]}]}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Expand", "[", "tmp", "]"}], "//.", "DotExpand"}], "//.",
              "simpleDot"}], "//", "Expand"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GammaLeft", "[", "gamma_Tensor", "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Moves", " ", "gamma", " ", "matrix", " ", "gamma_", " ", "in", " ", 
      "expression", " ", "exp_", " ", "with", " ", 
      RowBox[{
       RowBox[{"Dot", "[", 
        RowBox[{",", "\[Gamma]", ",", "\[Gamma]", ",", "gamma_", ",", "..."}],
         "]"}], "'"}], "s", " ", "through", " ", 
      RowBox[{"\[Gamma]", "'"}], "s", " ", "to", " ", "the", " ", "far", " ", 
      "left", " ", "or", " ", "until", " ", "it", " ", 
      RowBox[{"disappears", ".", "  ", "\[IndentingNewLine]", 
       RowBox[{"Usage", ":", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"GammaLeft", "[", 
           RowBox[{"exp_", ",", "gamma_"}], "]"}], ".", "  ", "Returns"}], 
         " ", "exp_", " ", "with", " ", 
         RowBox[{
          RowBox[{"Dot", "[", 
           RowBox[{",", "gamma_", ",", "..."}], "]"}], "'"}], "s", " ", 
         "replaced", " ", "with", " ", 
         RowBox[{"Dot", "[", 
          RowBox[{",", "gamma_", ","}], "]"}], " ", "where", " ", "gamma_", 
         " ", "is", " ", "moved", " ", "to", " ", "the", " ", 
         RowBox[{"left", "."}]}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", "gammaT", ",", 
        "isgamma", ",", 
        RowBox[{"DEBUG", "=", "0"}], ",", 
        RowBox[{"mname", "=", "\"\<GammaLeft\>\""}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"IfDEBUG", "[", 
        RowBox[{"mname", ",", 
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{"tmp", ",", "gamma"}], "}"}], ",", "\"\<{tmp,gamma}\>\""}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"gammaT", "=", 
        RowBox[{"Apply", "[", 
         RowBox[{"List", ",", "gamma"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"isgamma", "=", 
        RowBox[{
         RowBox[{"Count", "[", 
          RowBox[{
           RowBox[{"{", "gamma", "}"}], ",", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", 
             RowBox[{"{", "_", "}"}], ",", 
             RowBox[{"{", "_", "}"}]}], "]"}]}], "]"}], "\[Equal]", "1"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"tmp1", "=!=", "tmp"}], "&&", "isgamma"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{
             RowBox[{"Dot", "[", 
              RowBox[{"a___", ",", "b_", ",", "gamma", ",", "c___"}], "]"}], ":>", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"a", ",", 
                RowBox[{"CommuteG", "[", 
                 RowBox[{"b", ",", "gamma"}], "]"}], ",", "c"}], "]"}], "/;", 
              
              RowBox[{
               RowBox[{"Count", "[", 
                RowBox[{
                 RowBox[{"{", "b", "}"}], ",", 
                 RowBox[{"Tensor", "[", 
                  RowBox[{"\[Gamma]", ",", 
                   RowBox[{"{", "_", "}"}], ",", 
                   RowBox[{"{", "_", "}"}]}], "]"}]}], "]"}], "\[Equal]", 
               "1"}]}]}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Expand", "[", "tmp", "]"}], "//.", "DotExpand"}], "//.",
              "simpleDot"}], "//", "Expand"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Commutes", " ", "\[Gamma]", " ", "matrices", " ", "g1_"}], ",", 
    " ", "g2_", ",", " ", 
    RowBox[{"Returns", " ", "-", 
     RowBox[{"g2_.", "g1_"}], "+", 
     RowBox[{"2", " ", 
      RowBox[{"\[Eta]__", "[", ",", "]"}]}]}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CommuteG", "[", 
     RowBox[{"g1_Tensor", ",", "g2_Tensor"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "tmp", ",", "g1T", ",", "g2T", ",", "iup", ",", "idown", ",", "is5", 
        ",", "twog", ",", 
        RowBox[{"gtmp", "=", "1"}], ",", "out", ",", 
        RowBox[{"DEBUG", "=", "0"}], ",", 
        RowBox[{"mname", "=", "\"\<CommuteG\>\""}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"IfDEBUG", "[", 
        RowBox[{"mname", ",", 
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{"g1", ",", "g2"}], "}"}], ",", "\"\<{g1,g2}\>\""}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"g1T", "=", 
        RowBox[{"Apply", "[", 
         RowBox[{"List", ",", "g1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"g2T", "=", 
        RowBox[{"Apply", "[", 
         RowBox[{"List", ",", "g2"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"iup", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"g1T", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"g2T", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"idown", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"g1T", "[", 
            RowBox[{"[", "3", "]"}], "]"}], ",", 
           RowBox[{"g2T", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"is5", "=", 
        RowBox[{"!", 
         RowBox[{"FreeQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"iup", ",", "idown"}], "}"}], ",", "5"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"IfDEBUG", "[", 
        RowBox[{"mname", ",", 
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{"iup", ",", "idown"}], "}"}], ",", "\"\<{iup,idown}\>\""}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"twog", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{
             RowBox[{"{", "g1", "}"}], ",", 
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Gamma]", ",", 
               RowBox[{"{", "_", "}"}], ",", 
               RowBox[{"{", "_", "}"}]}], "]"}]}], "]"}], "+", 
           RowBox[{"Count", "[", 
            RowBox[{
             RowBox[{"{", "g2", "}"}], ",", 
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Gamma]", ",", 
               RowBox[{"{", "_", "}"}], ",", 
               RowBox[{"{", "_", "}"}]}], "]"}]}], "]"}]}], ")"}], "\[Equal]",
          "2"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"!", "twog"}], ",", 
         RowBox[{"out", "=", 
          RowBox[{"g1", ".", "g2"}]}], " ", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"not", " ", "2", " ", 
            RowBox[{"\[Gamma]", "'"}], "s", " ", "return"}], "\[Rule]", 
           RowBox[{"no", " ", "change"}]}], " ", "*)"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"twog", "&&", 
          RowBox[{"g1", "===", "g2"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"out", "=", 
          RowBox[{"If", "[", 
           RowBox[{"is5", ",", "1", ",", 
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Eta]", ",", "iup", ",", "idown"}], "]"}]}], "]"}]}], 
         ",", "\[IndentingNewLine]", "twog", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"gtmp", "=", 
           RowBox[{"If", "[", 
            RowBox[{"is5", ",", "0", ",", 
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Eta]", ",", "iup", ",", "idown"}], "]"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"out", "=", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"g2", ".", "g1"}]}], "+", 
            RowBox[{"2", "gtmp"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Sorts", " ", "Grassmanian", " ", "variables", " ", 
       RowBox[{"{", 
        RowBox[{"a_", ",", "b_"}], "}"}], " ", "in", " ", 
       RowBox[{"Dot", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], " ", "expression"}], ".."}], 
     "\[IndentingNewLine]", 
     RowBox[{"Usage", ":", " ", "exp"}]}], "/.", 
    RowBox[{
     RowBox[{"Dot", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
     RowBox[{
      RowBox[{"GrassmanDotSort", "[", 
       RowBox[{"a", ",", "b"}], "]"}], "."}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GrassmanDotSort", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"order", "=", 
         RowBox[{"Order", "[", 
          RowBox[{"a", ",", "b"}], "]"}]}], ",", 
        RowBox[{"tmp", "=", 
         RowBox[{"Sort", "[", 
          RowBox[{"{", 
           RowBox[{"a", ",", "b"}], "}"}], "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"order", "===", "0"}], ",", 
         RowBox[{"order", "=", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Apply", "[", 
         RowBox[{"Dot", ",", "tmp"}], "]"}], "order"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{"Dot", " ", "product", " ", "of", " ", "vectors", " ", 
    RowBox[{"{", 
     RowBox[{"a_", ",", "b_"}], "}"}], " ", "of", " ", "Grassmanian", " ", 
    RowBox[{"variables", "."}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GrassmanDot", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", ",", "tmpa", ",", "tmpb"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dimensions", "[", "a", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "1"}], "&&", 
         RowBox[{
          RowBox[{
           RowBox[{"Dimensions", "[", "b", "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "1"}], "&&", 
         RowBox[{
          RowBox[{
           RowBox[{"Dimensions", "[", "a", "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
          RowBox[{
           RowBox[{"Dimensions", "[", "b", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmpa", "=", 
          RowBox[{"Flatten", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"tmpb", "=", 
          RowBox[{"Flatten", "[", "b", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"tmpa", "=", 
          RowBox[{
           RowBox[{"MapThread", "[", 
            RowBox[{"Dot", ",", 
             RowBox[{"{", 
              RowBox[{"tmpa", ",", "tmpb"}], "}"}]}], "]"}], "/.", 
           "simpleDot"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"tmpa", "/.", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{"c_", ",", "d_"}], "]"}], ":>", 
            RowBox[{"GrassmanDotSort", "[", 
             RowBox[{"c", ",", "d"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Apply", "[", 
          RowBox[{"Plus", ",", "tmp"}], "]"}]}]}], "\[IndentingNewLine]", 
       "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"seqLabelTerm", "[", 
      RowBox[{"matrix_", ",", "seq_"}], "]"}], " ", "labels", " ", "matrix_", 
     " ", "elements", " ", "with", " ", 
     RowBox[{
      RowBox[{"seq$", "[", "seq_", "]"}], "[", "element", "]"}], " ", "where",
      " ", "matrix", " ", "is", " ", "MatrixQ"}], ",", " ", "ArrayQ", ",", 
    " ", 
    RowBox[{"or", " ", 
     RowBox[{"none", ".", "  ", "This"}], " ", "routine", " ", "is", " ", 
     "used", " ", "in", " ", 
     RowBox[{"NonCommutativeDot", "[", "]"}], " ", "where", " ", "seq_", " ", 
     "is", " ", "the", " ", "arguement", " ", "position", " ", "of", " ", 
     "the", " ", "matrix_", " ", "in", " ", 
     RowBox[{
      RowBox[{"ncDot", "[", "]"}], ".", "  ", 
      RowBox[{"NOTE", ":", " ", 
       RowBox[{"label", " ", "seq$", " ", "is", " ", 
        RowBox[{"global", "."}], "  ", "*", "1", "Apr2014"}]}]}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"seqLabelTerm", "[", 
     RowBox[{"matrix_", ",", "seq_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "matrix"}], ",", "dim"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MatrixQ", "[", "matrix", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"dim", "=", 
          RowBox[{"Dimensions", "[", 
           RowBox[{"tmp", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"dim", "=", 
          RowBox[{
           RowBox[{"Array", "[", 
            RowBox[{"List", ",", "dim"}], "]"}], "//", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"#", ",", "1"}], "]"}], "&"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tmp", "=", 
          RowBox[{"MapAt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"seq$", "[", "seq", "]"}], "[", "#", "]"}], "&"}], ",", 
            "tmp", ",", "dim"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ArrayQ", "[", "matrix", "]"}], ",", "\[IndentingNewLine]", 
          
          RowBox[{
           RowBox[{"dim", "=", 
            RowBox[{
             RowBox[{"Dimensions", "[", 
              RowBox[{"tmp", ",", "2"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"dim", "=", 
            RowBox[{
             RowBox[{"Array", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"List", "[", 
                 RowBox[{"List", "[", "#", "]"}], "]"}], "&"}], ",", "dim"}], 
              "]"}], "//", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"#", ",", "1"}], "]"}], "&"}]}]}], ";", 
           RowBox[{"Print", "[", 
            RowBox[{"dim", ",", "tmp"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"MapAt", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"seq$", "[", "seq", "]"}], "[", "#", "]"}], "&"}], 
              ",", "tmp", ",", "dim"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{"seq$", "[", "seq", "]"}], "[", "tmp", "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"NonCommutativeDot", "[", "exp_ncDot", "]"}], " ", "takes", " ", 
      RowBox[{"ncDot", "[", "]"}], " ", "expressions", " ", "and", " ", 
      "performs", " ", 
      RowBox[{"Dot", "[", "]"}], " ", "operations", " ", "among", " ", "is", 
      " ", "terms", " ", "so", " ", "that", " ", "the", " ", "elements", " ", 
      "of", " ", "each", " ", "resulting", " ", "term", " ", "have", " ", 
      "the", " ", "same", " ", "ordering", " ", "as", " ", "in", " ", 
      RowBox[{"exp_ncDot", ".", "  ", 
       RowBox[{"NOTE", ":", " ", 
        RowBox[{"all", " ", 
         RowBox[{"Times", "[", "]"}]}]}]}]}], "->", 
     RowBox[{
      RowBox[{"Dot", "[", "]"}], ".", "  ", 
      RowBox[{"Usage", ":", " ", "$exp"}]}]}], "/.", 
    RowBox[{
     RowBox[{"dd", ":", 
      RowBox[{"ncDot", "[", "__", "]"}]}], ":>", 
     RowBox[{
      RowBox[{"NonCommutativeDot", "[", "dd", "]"}], "  ", "*", "1", 
      "Apr2014"}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NonCommutativeDot", "[", "exp_ncDot", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tmp", "=", 
       RowBox[{"MapIndexed", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"seqLabelTerm", "[", 
           RowBox[{"#1", ",", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}], ",", "tmp"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "/.", 
        RowBox[{"ncDot", "->", "Dot"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "/.", 
        RowBox[{"Times", "->", "Dot"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{"tmp", "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"seq$", "[", "_", "]"}], "[", "a_", "]"}], "->", "a"}]}]}], 
      ";", "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Example", " ", "of", " ", "routine", " ", "that", " ", "moves", " ", 
    "the", " ", "left", " ", "arguement", " ", "in", " ", "pair_List", " ", 
    "contained", " ", "in", " ", "exp_", " ", "to", " ", "the", " ", "right", 
    " ", "until", " ", "they", " ", "are", " ", "adjacent", " ", 
    "alternating", " ", "arguement", " ", "pairs", " ", "each", " ", 
    RowBox[{"tranposition", "."}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MovePairRight", "[", "pair_List", "]"}], "[", "exp_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"tmp", "=", "exp"}], ",", 
      RowBox[{"tmpv", "=", "pair"}], ",", "tmpx1", ",", "x1", ",", "x2", ",", 
      "tmpp"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"tmpp", "=", 
          RowBox[{"Position", "[", 
           RowBox[{"tmp", ",", 
            RowBox[{"Apply", "[", 
             RowBox[{"Alternatives", ",", "tmpv"}], "]"}]}], "]"}]}], ";", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x2", "=", 
             RowBox[{"tmpp", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ")"}], "-", 
           RowBox[{"(", 
            RowBox[{"x1", "=", 
             RowBox[{"tmpp", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ")"}]}], ">", "1"}]}],
         ")"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmpx1", "=", 
         RowBox[{"Extract", "[", 
          RowBox[{"tmp", ",", 
           RowBox[{"{", "x1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"tmpx1", " ", "===", " ", 
           RowBox[{"tmpv", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ",", 
          RowBox[{"tmpx1", "=", 
           RowBox[{"tmpv", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"tmpx1", " ", "===", " ", 
             RowBox[{"tmpv", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{"tmpx1", "=", 
             RowBox[{"tmpv", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Permute", "[", 
          RowBox[{"tmp", ",", 
           RowBox[{"Cycles", "[", 
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{"x1", "+", "1"}]}], "}"}], "}"}], "]"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"tmp", ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x1", "+", "1"}], "}"}], "\[Rule]", "tmpx1"}]}], "]"}]}],
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "tmp"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4753465512080317`*^9, 3.475346554216423*^9}, {
   3.4753465856310472`*^9, 3.475346621892208*^9}, {3.475346668954856*^9, 
   3.475346669176675*^9}, 3.4753472519988728`*^9, {3.47534729491439*^9, 
   3.475347364623801*^9}, {3.475347396784602*^9, 3.475347433158287*^9}, {
   3.475347707841419*^9, 3.4753477082870207`*^9}, {3.475347742903981*^9, 
   3.47534782387926*^9}, {3.47534995783218*^9, 3.475350031994712*^9}, {
   3.4753500711048393`*^9, 3.475350144816533*^9}, {3.475350306389287*^9, 
   3.475350469087633*^9}, {3.475350555524749*^9, 3.475350592362454*^9}, {
   3.475350664898057*^9, 3.475350678053525*^9}, {3.475350903184366*^9, 
   3.475351003725884*^9}, {3.475351129605673*^9, 3.475351138071467*^9}, {
   3.475351175685073*^9, 3.4753511898701973`*^9}, {3.47535123151435*^9, 
   3.475351283995439*^9}, 3.4753515093495703`*^9, {3.475351800064806*^9, 
   3.47535202418405*^9}, {3.4753520668621473`*^9, 3.475352101918038*^9}, {
   3.475352334938896*^9, 3.475352518664269*^9}, {3.4753526273365793`*^9, 
   3.475352638287677*^9}, {3.4753526763962107`*^9, 3.4753527344462423`*^9}, {
   3.4753532423985577`*^9, 3.4753533212858763`*^9}, {3.475353406296814*^9, 
   3.4753534133791113`*^9}, {3.475353445171694*^9, 3.475353495856761*^9}, {
   3.475353531133277*^9, 3.475353603671583*^9}, {3.4753536352110443`*^9, 
   3.4753537615539017`*^9}, {3.475353889894141*^9, 3.475353892904949*^9}, {
   3.475353925167573*^9, 3.475354009927945*^9}, {3.475354100114399*^9, 
   3.4753541861843777`*^9}, {3.4753542428876057`*^9, 
   3.4753542749926147`*^9}, {3.4753543800384398`*^9, 
   3.4753544018476553`*^9}, {3.475354447158379*^9, 3.475354556825355*^9}, {
   3.475354634416751*^9, 3.475354813540646*^9}, {3.475354849353096*^9, 
   3.475354939979602*^9}, {3.4753559748272963`*^9, 3.475355982165483*^9}, {
   3.475356015326829*^9, 3.475356021349093*^9}, {3.475356149335154*^9, 
   3.475356149895138*^9}, {3.475356229732254*^9, 3.475356262661701*^9}, {
   3.4753563072548723`*^9, 3.4753563320771217`*^9}, {3.475356390458597*^9, 
   3.4753564309393578`*^9}, {3.475363035922538*^9, 3.475363213595894*^9}, {
   3.475363268345435*^9, 3.4753632972633677`*^9}, {3.4753633348269463`*^9, 
   3.475363348724815*^9}, {3.47536340700237*^9, 3.4753635806026793`*^9}, {
   3.475363612311414*^9, 3.475363873918358*^9}, {3.475363907884944*^9, 
   3.475363908841063*^9}, 3.47536397787424*^9, {3.475364009757326*^9, 
   3.4753640104061213`*^9}, {3.475364098991889*^9, 3.4753641452072897`*^9}, 
   3.475365260018832*^9, {3.475365658093651*^9, 3.475365949439968*^9}, {
   3.475366004856884*^9, 3.475366141720459*^9}, {3.475386134303418*^9, 
   3.475386209962783*^9}, {3.475386245836129*^9, 3.475386246680723*^9}, {
   3.4754150378389397`*^9, 3.475415096118135*^9}, {3.475415157576167*^9, 
   3.475415217406499*^9}, {3.475415313529755*^9, 3.475415329065259*^9}, {
   3.475415369736064*^9, 3.475415392087422*^9}, {3.475415428487733*^9, 
   3.475415455526229*^9}, {3.4754155177665157`*^9, 3.47541555046257*^9}, {
   3.475415638800124*^9, 3.475415752192183*^9}, {3.475415833030077*^9, 
   3.475415859154005*^9}, {3.475415895199882*^9, 3.4754159829568787`*^9}, {
   3.475416026886198*^9, 3.4754160720239162`*^9}, {3.4754161045871563`*^9, 
   3.4754161132979307`*^9}, {3.4754161650223627`*^9, 
   3.4754161757824707`*^9}, {3.475416231473404*^9, 3.475416278242137*^9}, {
   3.4754164023376427`*^9, 3.475416444314909*^9}, {3.475416561506901*^9, 
   3.4754165673771563`*^9}, {3.475416602785972*^9, 3.4754166290160933`*^9}, 
   3.4754166717953243`*^9, {3.475416705559785*^9, 3.475416747608629*^9}, {
   3.475416816396978*^9, 3.475416915215006*^9}, {3.475416984662531*^9, 
   3.475417003617631*^9}, {3.4754170402279987`*^9, 3.47541710720545*^9}, {
   3.475417142413661*^9, 3.475417158996089*^9}, {3.475417195402669*^9, 
   3.47541737468452*^9}, {3.4754467153526783`*^9, 3.4754468188230543`*^9}, {
   3.4754468546907167`*^9, 3.475446888727203*^9}, {3.475446941267878*^9, 
   3.475447008401469*^9}, {3.475447677175087*^9, 3.4754477446712933`*^9}, {
   3.475447988883189*^9, 3.475448026703464*^9}, {3.475448073077318*^9, 
   3.475448154432979*^9}, {3.475448221802416*^9, 3.4754483776065073`*^9}, {
   3.475448408722733*^9, 3.475448520042667*^9}, {3.475448952085341*^9, 
   3.475449087137871*^9}, {3.475449148314666*^9, 3.475449279585099*^9}, {
   3.475449324875442*^9, 3.475449457419395*^9}, {3.475449514698174*^9, 
   3.47544952148781*^9}, {3.475454675464456*^9, 3.475454773317904*^9}, {
   3.4754548897474947`*^9, 3.475454910894479*^9}, {3.475455008155828*^9, 
   3.475455015700056*^9}, {3.4754550631255693`*^9, 3.4754552253892717`*^9}, {
   3.475455274141914*^9, 3.4754553161379137`*^9}, {3.47545535425865*^9, 
   3.475455391838245*^9}, {3.475455433822481*^9, 3.475455443877643*^9}, {
   3.4754555096904287`*^9, 3.4754555271290817`*^9}, {3.475455696776729*^9, 
   3.4754557242910967`*^9}, {3.475455776970767*^9, 3.475455801624564*^9}, {
   3.475456198217016*^9, 3.475456202459544*^9}, {3.4754596079949102`*^9, 
   3.475459614311833*^9}, {3.475460047477614*^9, 3.4754600586481457`*^9}, {
   3.475461589826283*^9, 3.475461633882329*^9}, {3.475463374251835*^9, 
   3.4754633775024652`*^9}, {3.4754634954651003`*^9, 3.475463499979669*^9}, {
   3.475463914208621*^9, 3.475463914703012*^9}, {3.4754640703486233`*^9, 
   3.475464071152954*^9}, {3.475464596822629*^9, 3.475464598482012*^9}, {
   3.475467628195072*^9, 3.475467632883882*^9}, 3.475467808401226*^9, {
   3.475467854837569*^9, 3.475467858367579*^9}, {3.475467919966097*^9, 
   3.475467925229865*^9}, {3.4754680977570057`*^9, 3.475468104197669*^9}, {
   3.4754682504201508`*^9, 3.475468283668222*^9}, {3.4754683782786703`*^9, 
   3.4754683801489277`*^9}, {3.475468571023386*^9, 3.4754686213372593`*^9}, {
   3.475469546102528*^9, 3.475469546324548*^9}, {3.475469719124421*^9, 
   3.4754697193239326`*^9}, {3.475470307205607*^9, 3.4754703409426527`*^9}, {
   3.4754704009210978`*^9, 3.475470410527676*^9}, {3.4754704930047617`*^9, 
   3.47547051961092*^9}, {3.475470640915954*^9, 3.475470652022987*^9}, {
   3.475470779667163*^9, 3.475470809595195*^9}, {3.475470905598742*^9, 
   3.4754709172555323`*^9}, 3.4754710310452337`*^9, {3.4754710780841217`*^9, 
   3.475471078857292*^9}, {3.4754712077509108`*^9, 3.475471263098508*^9}, {
   3.475471294762836*^9, 3.475471295757835*^9}, 3.4754972971370487`*^9, {
   3.475497343571782*^9, 3.475497344874321*^9}, {3.4754974778517103`*^9, 
   3.4754975094158*^9}, {3.475497551224495*^9, 3.475497769366085*^9}, {
   3.4754978068464727`*^9, 3.475497839446032*^9}, 3.47549797887855*^9, 
   3.475498054452549*^9, {3.475498084682022*^9, 3.4754980893247747`*^9}, {
   3.4754982136296597`*^9, 3.4754982342978067`*^9}, {3.4754983037423697`*^9, 
   3.475498308983923*^9}, {3.4754984296141872`*^9, 3.475498440353137*^9}, {
   3.475498597400405*^9, 3.475498612116949*^9}, {3.47549870525282*^9, 
   3.475498706324493*^9}, {3.4754987397203608`*^9, 3.4754987411779337`*^9}, {
   3.475498900664324*^9, 3.475498905158126*^9}, {3.47550126640407*^9, 
   3.475501289509036*^9}, {3.475501386244501*^9, 3.475501422686417*^9}, {
   3.475501630329604*^9, 3.475501630925071*^9}, 3.475501701107646*^9, {
   3.4755027499069347`*^9, 3.475502922633955*^9}, {3.475502990083099*^9, 
   3.475503007384081*^9}, {3.4755030392540007`*^9, 3.4755031134276743`*^9}, {
   3.475503231196392*^9, 3.475503245004574*^9}, {3.475503280972286*^9, 
   3.475503282110127*^9}, {3.475503315021574*^9, 3.4755033351620502`*^9}, {
   3.475503410412566*^9, 3.475503423605751*^9}, {3.475503481841188*^9, 
   3.47550348527631*^9}, {3.4755036378160677`*^9, 3.475503645979293*^9}, {
   3.4755066129313498`*^9, 3.475506616377406*^9}, {3.475506662154272*^9, 
   3.475506692827354*^9}, {3.4755067232601843`*^9, 3.4755067470820427`*^9}, {
   3.475507691267541*^9, 3.4755076920022306`*^9}, {3.475507726178258*^9, 
   3.475507733766214*^9}, {3.475507787475226*^9, 3.4755077900377274`*^9}, {
   3.475507898099065*^9, 3.4755078989424667`*^9}, {3.475507965542246*^9, 
   3.4755079749700737`*^9}, {3.475508235497374*^9, 3.475508339879795*^9}, {
   3.475508417873733*^9, 3.4755084203725367`*^9}, {3.4755084999812613`*^9, 
   3.475508510309757*^9}, {3.475508543979864*^9, 3.475508663519725*^9}, {
   3.475508743636683*^9, 3.47550874729813*^9}, {3.4755089889734573`*^9, 
   3.475509004736499*^9}, {3.475509276776189*^9, 3.475509278491297*^9}, {
   3.475509349761141*^9, 3.475509426075082*^9}, {3.475509475983533*^9, 
   3.4755094775681067`*^9}, {3.475509590460648*^9, 3.475509594347418*^9}, {
   3.4755097835784197`*^9, 3.4755098221523542`*^9}, {3.475509897357624*^9, 
   3.4755099129388742`*^9}, {3.475509977557598*^9, 3.4755100565937757`*^9}, {
   3.475510089814702*^9, 3.4755101474737387`*^9}, {3.475510185736668*^9, 
   3.475510185914915*^9}, {3.4755102695572987`*^9, 3.475510277308406*^9}, {
   3.4755103404479303`*^9, 3.475510344444532*^9}, {3.47551056021583*^9, 
   3.4755106340488863`*^9}, {3.475510726204956*^9, 3.475510743836422*^9}, {
   3.475510792277956*^9, 3.475510792960672*^9}, {3.475510852256757*^9, 
   3.475510884828628*^9}, {3.475510917380827*^9, 3.475510923956871*^9}, {
   3.475510957325715*^9, 3.475510962290093*^9}, {3.4755346056140947`*^9, 
   3.475534652262253*^9}, {3.4755346863406277`*^9, 3.475534686642283*^9}, {
   3.4755383244743013`*^9, 3.4755383467610197`*^9}, {3.475538398332961*^9, 
   3.475538427636799*^9}, {3.47554307341286*^9, 3.475543106914772*^9}, {
   3.475543802211911*^9, 3.475543852873358*^9}, {3.475543918608522*^9, 
   3.475543921693429*^9}, {3.475543960247807*^9, 3.475543976558617*^9}, 
   3.4755497145716248`*^9, {3.484486050247908*^9, 3.48448606759993*^9}, {
   3.485195965286615*^9, 3.485195981876095*^9}, {3.48583049444412*^9, 
   3.485830496681006*^9}, 3.4858305273914337`*^9, {3.485830580538493*^9, 
   3.485830595144692*^9}, {3.485830706871621*^9, 3.485830773194625*^9}, {
   3.4858618341858177`*^9, 3.48586184875429*^9}, {3.485861940147129*^9, 
   3.485861964840062*^9}, {3.485862081060978*^9, 3.485862113596067*^9}, {
   3.4858621445492163`*^9, 3.4858621714852743`*^9}, {3.485862214602599*^9, 
   3.485862374549242*^9}, 3.487598356866372*^9, {3.487601950270562*^9, 
   3.4876019521414623`*^9}, {3.487602007751465*^9, 3.487602009450815*^9}, {
   3.4876020537212973`*^9, 3.4876020542753696`*^9}, {3.4888073778166513`*^9, 
   3.488807445327022*^9}, {3.488807482305338*^9, 3.488807550955323*^9}, {
   3.488808265686858*^9, 3.488808382746723*^9}, {3.4888085549033318`*^9, 
   3.4888085834938726`*^9}, {3.4888086582610292`*^9, 3.48880867292484*^9}, {
   3.4888088029022913`*^9, 3.488808818482251*^9}, {3.4888088669825697`*^9, 
   3.488808882374522*^9}, {3.488808914746084*^9, 3.4888089388304453`*^9}, {
   3.488809018684176*^9, 3.488809050258507*^9}, {3.488809080589534*^9, 
   3.4888090827257757`*^9}, {3.488809137132708*^9, 3.4888091836372757`*^9}, {
   3.488809226208148*^9, 3.488809231984322*^9}, 3.4888093095727673`*^9, {
   3.4888093475470457`*^9, 3.488809376669838*^9}, 3.488809436667774*^9, {
   3.488820228949336*^9, 3.488820235731703*^9}, {3.488820631332107*^9, 
   3.488820635805623*^9}, 3.4888208232291117`*^9, {3.488820895865839*^9, 
   3.4888209568062077`*^9}, {3.4888210487811127`*^9, 3.488821067070236*^9}, {
   3.4888558129121313`*^9, 3.488855906699357*^9}, {3.48885593980875*^9, 
   3.488855981366467*^9}, {3.4888568943016453`*^9, 3.488856999025888*^9}, {
   3.4888570401083317`*^9, 3.488857070233328*^9}, {3.492433889975027*^9, 
   3.4924339600751*^9}, {3.493400387916945*^9, 3.493400425778529*^9}, {
   3.4940831823455553`*^9, 3.49408318473433*^9}, 3.494083288763645*^9, {
   3.49411729631985*^9, 3.4941173557344017`*^9}, {3.494120115998885*^9, 
   3.494120142202883*^9}, 3.494172512335793*^9, {3.494172550462904*^9, 
   3.494172646337248*^9}, 3.4941727969916277`*^9, {3.494208356015231*^9, 
   3.494208374319687*^9}, {3.4942088540639153`*^9, 3.494208866130795*^9}, {
   3.505743269796804*^9, 3.505743521492309*^9}, 3.505743633064543*^9, {
   3.5057444203921337`*^9, 3.50574442920828*^9}, {3.52380640783531*^9, 
   3.523806541724936*^9}, {3.523806693163978*^9, 3.523806700402073*^9}, {
   3.5238068050956497`*^9, 3.5238068061021233`*^9}, {3.523806872898848*^9, 
   3.523806881442992*^9}, {3.523806914343727*^9, 3.5238069435501413`*^9}, {
   3.523807022838546*^9, 3.523807023327516*^9}, {3.523807141273609*^9, 
   3.5238071465658703`*^9}, {3.536504000957505*^9, 3.5365040425681257`*^9}, {
   3.537625179497781*^9, 3.5376251816410017`*^9}, 3.537625694845705*^9, {
   3.5473445930676193`*^9, 3.547344608326131*^9}, {3.5514518336451807`*^9, 
   3.5514518411046877`*^9}, {3.551452056500558*^9, 3.551452056765077*^9}, {
   3.553185217019547*^9, 3.5531852290973053`*^9}, {3.558963514780685*^9, 
   3.55896351547578*^9}, {3.5589635568919573`*^9, 3.558963610140999*^9}, 
   3.558963817732319*^9, {3.5618265676948357`*^9, 3.5618265701409473`*^9}, {
   3.567354906602004*^9, 3.567354916502833*^9}, {3.56737984222149*^9, 
   3.567379945970261*^9}, {3.567380029458637*^9, 3.5673800697340593`*^9}, {
   3.567380724985795*^9, 3.5673807533989697`*^9}, {3.567380994193428*^9, 
   3.567381058695154*^9}, {3.567381116716227*^9, 3.567381153381106*^9}, {
   3.567381190395151*^9, 3.5673812641906557`*^9}, {3.605021681786957*^9, 
   3.605021839020302*^9}, {3.605022641863619*^9, 3.605022660959895*^9}, {
   3.605407807047086*^9, 3.6054078323716793`*^9}, {3.605444739176714*^9, 
   3.605445083971863*^9}, {3.605445256677116*^9, 3.605445536158046*^9}, 
   3.6054457708541718`*^9, {3.6054462815536747`*^9, 3.605446338399631*^9}, {
   3.606140291495471*^9, 3.606140330707803*^9}, {3.629428771910972*^9, 
   3.6294287721722927`*^9}, {3.640624956706636*^9, 3.640624966521337*^9}, {
   3.6406253170595407`*^9, 3.640625338427999*^9}, {3.6406259999144993`*^9, 
   3.640626007757595*^9}, {3.640626288110716*^9, 3.640626293722412*^9}, 
   3.683984099212063*^9, {3.683984208243865*^9, 3.6839842245207167`*^9}, {
   3.684671699285736*^9, 3.6846716992955027`*^9}, {3.7099990411261253`*^9, 
   3.709999051343607*^9}, {3.709999139886499*^9, 3.709999142123526*^9}, {
   3.7099996103412733`*^9, 3.7099996115617733`*^9}, {3.745259979980721*^9, 
   3.74525998016663*^9}, {3.745260027638741*^9, 3.745260043254051*^9}, {
   3.7452600872189827`*^9, 3.745260126318203*^9}, {3.745260819331862*^9, 
   3.7452608424428053`*^9}, {3.745263521900393*^9, 3.7452635453104877`*^9}, {
   3.745263583587366*^9, 3.745263584798726*^9}, {3.745267292587319*^9, 
   3.7452673065891953`*^9}, {3.74528429838482*^9, 3.7452843307197523`*^9}, {
   3.745323631881328*^9, 3.745323672108305*^9}, {3.745324616022176*^9, 
   3.745324673327488*^9}, {3.74532479631153*^9, 3.745324803321987*^9}, 
   3.756347163527857*^9, {3.756347361592072*^9, 3.756347380953545*^9}, {
   3.756349473500897*^9, 3.7563495222228403`*^9}, 3.756520296146555*^9, {
   3.7565203267292643`*^9, 3.756520331380579*^9}, {3.7598535547943563`*^9, 
   3.759853560438094*^9}, {3.759862163600821*^9, 
   3.759862187876788*^9}},ExpressionUUID->"b94ada48-112c-4ee5-9028-\
b11122088dd1"],

Cell["Miscellaneous routines", "Text",
 CellChangeTimes->{{3.478551281256507*^9, 
  3.4785512883429937`*^9}},ExpressionUUID->"b8870235-8f15-4918-a05b-\
7fdb8e7e533f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Returns", " ", 
      RowBox[{"Rule", "[", 
       RowBox[{
        RowBox[{"First", "[", "mn_", "]"}], "\[Rule]", "_"}], "]"}], " ", 
      "for", " ", "exp_"}], "\[Equal]", 
     RowBox[{"0", " ", "for", " ", "pair", " ", "mn_.", " ", 
      RowBox[{"e", ".", "g", "."}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"ZeroMN", "[", 
      RowBox[{
       RowBox[{"I", " ", "2", " ", "\[Pi]", " ", "m", " ", 
        RowBox[{"t", "/", "\[Beta]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"m", ",", "n"}], "}"}]}], "]"}], " ", "=", 
     RowBox[{
      RowBox[{">", " ", "m"}], "->", "0"}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"ZeroMN", "[", 
      RowBox[{"exp_", ",", "mn_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"Solve", "[", 
          RowBox[{
           RowBox[{"exp", "==", "0"}], ",", 
           RowBox[{"First", "[", "mn", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"First", "[", "tmp", "]"}], "]"}], ">", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"First", "[", 
            RowBox[{"First", "[", "tmp", "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp", "=", 
            RowBox[{"Solve", "[", 
             RowBox[{
              RowBox[{"exp", "==", "0"}], ",", 
              RowBox[{"Last", "[", "mn", "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"First", "[", "tmp", "]"}], "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"tmp", "=", 
              RowBox[{"First", "[", 
               RowBox[{"First", "[", "tmp", "]"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"tmp", "=", "exp"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Returns", " ", 
     RowBox[{"xDiscreteDelta", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"First", "[", 
           RowBox[{"mn_", ",", "_"}], "]"}], " ", "for", " ", "exp_"}], 
         "\[Equal]", " ", 
         RowBox[{"0", " ", "for", " ", "pair", " ", "mn_"}]}], "=", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"m", ",", "n"}], "}"}], ".", " ", "e", ".", "g", "."}]}], 
       ",", " ", 
       RowBox[{
        RowBox[{"ZeroMN", "[", 
         RowBox[{
          RowBox[{"I", " ", "2", " ", "\[Pi]", " ", 
           RowBox[{"(", 
            RowBox[{"m", "-", "n"}], ")"}], " ", 
           RowBox[{"t", "/", "\[Beta]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"m", ",", "n"}], "}"}]}], "]"}], "->", 
        RowBox[{"xDiscreteDelta", "[", 
         RowBox[{"First", "[", 
          RowBox[{"m", ",", "n"}], "]"}], "]"}]}]}], "  "}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ZeroMNDiscreteDelta", "[", 
      RowBox[{"exp_", ",", "mn_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"DEBUG", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"ZeroMN", "[", 
          RowBox[{"exp", ",", "mn"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<ZeroMNDiscreteDelta: \>\"", ",", 
            RowBox[{"{", 
             RowBox[{"exp", ",", "mn", ",", "tmp", ",", 
              RowBox[{"Head", "[", "tmp", "]"}]}], "}"}]}], "]"}]}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "tmp", "]"}], "===", "Rule"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{"Rule", "\[Rule]", "xDiscreteDelta"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", "exp"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Returns", " ", 
     RowBox[{"\[Delta]uu", "[", 
      RowBox[{
       RowBox[{"First", "[", 
        RowBox[{"mn_", ",", "_"}], "]"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"DiscreteDelta", "[", "]"}], " ", "for", " ", "exp_"}], 
         "\[Equal]", " ", 
         RowBox[{"0", " ", "for", " ", "pair", " ", "mn_"}]}], "=", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"m", ",", "n"}], "}"}], ".", " ", "e", ".", "g", "."}]}], 
       ",", " ", 
       RowBox[{"ZeroMN", "[", 
        RowBox[{
         RowBox[{"I", " ", "2", " ", "\[Pi]", " ", 
          RowBox[{"(", 
           RowBox[{"m", "-", "n"}], ")"}], " ", 
          RowBox[{"t", "/", "\[Beta]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "n"}], "}"}]}], "]"}]}], " "}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ZeroMN\[Delta]", "[", 
      RowBox[{"exp_", ",", "mn_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mname", "=", "\"\<ZeroMN\[Delta]\>\""}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"ZeroMN", "[", 
          RowBox[{"exp", ",", "mn"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"exp", ",", "mn", ",", "tmp"}], "}"}], ",", "\"\<\>\""}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "tmp", "]"}], "===", "Rule"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{"Rule", "\[Rule]", "\[Delta]uu"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", "exp"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSumGatherR", "::", "usage"}], "=", 
     "\"\<tuSumGatherR Rules for consolidating Sum,xSum expressions.  Returns \
expression with all Sum[]s replaced by xSum[]s. *27Aug201825Apr2019*\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuSumGatherR", ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Sum", "->", "xSum"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xSum", "[", 
         RowBox[{
          RowBox[{"xSum", "[", 
           RowBox[{"a_", ",", "b__"}], "]"}], ",", "c__"}], "]"}], ":>", 
        RowBox[{"xSum", "[", 
         RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"d_", " ", 
         RowBox[{"xSum", "[", 
          RowBox[{"a_", ",", "b__"}], "]"}]}], ":>", 
        RowBox[{"xSum", "[", 
         RowBox[{
          RowBox[{"Expand", "[", 
           RowBox[{"d", " ", "a"}], "]"}], ",", "b"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
         RowBox[{"d1___", " ", ",", 
          RowBox[{"xSum", "[", 
           RowBox[{"a_", ",", "b__"}], "]"}], ",", "d2___"}], "]"}], "->", 
        RowBox[{"xSum", "[", 
         RowBox[{
          RowBox[{"dd", "[", 
           RowBox[{"d1", ",", "a", ",", "d2"}], "]"}], ",", "b"}], "]"}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"xSum", "[", 
          RowBox[{"a_", ",", "b__"}], "]"}], "+", 
         RowBox[{"xSum", "[", 
          RowBox[{"c_", ",", "b__"}], "]"}]}], "->", 
        RowBox[{"xSum", "[", 
         RowBox[{
          RowBox[{"a", "+", "c"}], ",", "b"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{"xSum", "[", 
           RowBox[{"a_", ",", "b1__"}], "]"}], ",", 
          RowBox[{"xSum", "[", 
           RowBox[{"c_", ",", "b2__"}], "]"}]}], "]"}], "->", 
        RowBox[{"xSum", "[", 
         RowBox[{
          RowBox[{"dd", "[", 
           RowBox[{"a", ",", "c"}], "]"}], ",", "b1", ",", "b2"}], "]"}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", "$"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{"a", "[", "i", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "m"}], "}"}]}], "]"}], "+", 
         RowBox[{"f", "\[CenterDot]", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"b", "[", "i", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "m"}], "}"}]}], "]"}], "\[CenterDot]", "d"}]}],
         ")"}], 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"dd", "[", "j", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "n"}], "}"}]}], "]"}], "\n", "$"}], "//.", 
      "tuSumGatherR"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"tuSumGather", "//", "Clear"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSumGather", "::", "usage"}], "=", 
     "\"\<tuSumGather[exp_] convert Sum to xSum amd consolidates xSum \
expressions into expression with least number of xSums.  Returns expression \
with all Sum[]s replaced by xSum[]s. Be careful of Sum's with the same dummy \
indices.  Replacement for tuSumGatherR *21May2019*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSumGather", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "$s", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$s", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sum", "->", "xSum"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"xSum", "[", 
             RowBox[{
              RowBox[{"xSum", "[", 
               RowBox[{"a_", ",", "b__"}], "]"}], ",", "c__"}], "]"}], ":>", 
            RowBox[{"xSum", "[", 
             RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"dd", ":", "productOps"}], ")"}], "[", 
             RowBox[{"d1___", " ", ",", 
              RowBox[{"xSum", "[", 
               RowBox[{"a_", ",", "b__"}], "]"}], ",", "d2___"}], "]"}], ":>", 
            RowBox[{"xSum", "[", 
             RowBox[{
              RowBox[{"dd", "[", 
               RowBox[{"d1", ",", "a", ",", "d2"}], "]"}], ",", "b"}], 
             "]"}]}], ",", 
           RowBox[{"(*", 
            RowBox[{"be", " ", "careful", " ", "of", " ", 
             RowBox[{"Sum", "'"}], "s", " ", "with", " ", "same", " ", 
             "dummy", " ", "indices"}], "*)"}], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"s1_:", "1"}], ")"}], 
              RowBox[{"xSum", "[", 
               RowBox[{"a_", ",", "b__"}], "]"}]}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"s2_:", "1"}], ")"}], 
              RowBox[{"xSum", "[", " ", 
               RowBox[{"c_", ",", "b__"}], "]"}]}]}], ":>", 
            RowBox[{"xSum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"s1", " ", "a"}], "+", 
               RowBox[{"s2", " ", "c"}]}], ",", "b"}], "]"}]}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"xSum", "[", 
             RowBox[{
              RowBox[{"xSum", "[", 
               RowBox[{"a_", ",", "b__"}], "]"}], ",", "c__"}], "]"}], ":>", 
            RowBox[{"xSum", "[", 
             RowBox[{"a", ",", "b", ",", "c"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"exp", "//", 
         RowBox[{"tuRepeat", "[", "$s", "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"xSum", "[", 
        RowBox[{
         RowBox[{"a", "[", "n", "]"}], ",", "n"}], "]"}], ".", " ", "ss", " ",
        ".", " ", 
       RowBox[{"xSum", "[", 
        RowBox[{
         RowBox[{"b", "[", "n", "]"}], ",", "n"}], "]"}]}], 
      "\[IndentingNewLine]", "%"}], "//", "tuSumGather"}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Consolidation", " ", 
     RowBox[{
      RowBox[{"Rule", "[", "]"}], "'"}], "s", " ", "for", " ", "IntegralOp"}],
     " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GatherIntOpSubs", "=", 
     RowBox[{"subGatherIntOp", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"IntegralOp", "[", 
          RowBox[{"a_List", ",", 
           RowBox[{"IntegralOp", "[", 
            RowBox[{"b_List", ",", "c_"}], "]"}]}], "]"}], ":>", 
         RowBox[{"IntegralOp", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a", ",", " ", "b"}], "}"}], ",", "c"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"d_", " ", 
          RowBox[{"IntegralOp", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}]}], ":>", 
         RowBox[{"IntegralOp", "[", 
          RowBox[{"a", ",", 
           RowBox[{"Expand", "[", 
            RowBox[{"d", " ", "b"}], "]"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"IntegralOp", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], "+", 
          RowBox[{"IntegralOp", "[", 
           RowBox[{"a_", ",", "c_"}], "]"}]}], "->", 
         RowBox[{"IntegralOp", "[", 
          RowBox[{"a", ",", 
           RowBox[{"c", "+", "b"}]}], "]"}]}]}], "\[IndentingNewLine]", 
       "}"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuIntegralGather", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegralGather", "::", "usage"}], "=", 
     "\"\<tuIntegralGather[EXP_] gathers expressions with xIntegral[] under \
the integral if possible. Applies tuIntegralGatherR repeatedly with \
tuRepeat[] since ReplaceRepeated[tuIntegralGatherR] does not seem to work in \
some cases. *1Apr2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuIntegralGather", ":=", 
     RowBox[{"tuRepeat", "[", 
      RowBox[{"{", "tuIntegralGatherR", "}"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegralGatherR", "::", "usage"}], "=", 
     "\"\<tuIntegralGatherR are Rule[]s  for consolidating expressions with \
xIntegral's. BUG: does not work in all cases. *10Mar2016**1Apr2018*\>\""}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuIntegralGatherR", ":=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Conjugate", "[", 
         RowBox[{"xIntegral", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], "]"}], "\[Rule]", 
        RowBox[{"xIntegral", "[", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a", "]"}], ",", "b"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ConjugateTranspose", "[", 
         RowBox[{"xIntegral", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], "]"}], "\[Rule]", 
        RowBox[{"xIntegral", "[", 
         RowBox[{
          RowBox[{"ConjugateTranspose", "[", "a", "]"}], ",", "b"}], "]"}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xIntegral", "[", 
         RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"a", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"b", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"b", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "/;", 
         RowBox[{
          RowBox[{"NumericQ", "[", "a", "]"}], "&&", 
          RowBox[{
           RowBox[{"Head", "[", "b", "]"}], "===", "List"}], "&&", 
          RowBox[{
           RowBox[{"Length", "[", "b", "]"}], "===", "3"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xIntegral", "[", 
         RowBox[{"a_", ",", "b__"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"xIntegral", "[", 
         RowBox[{"a", ",", 
          RowBox[{"Apply", "[", 
           RowBox[{"Sequence", ",", 
            RowBox[{"Sort", "[", 
             RowBox[{"{", "b", "}"}], "]"}]}], "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dd", ":", "productOps"}], ")"}], "[", 
         RowBox[{"a___", ",", 
          RowBox[{"xIntegral", "[", 
           RowBox[{"ia_", ",", "ib_"}], "]"}], ",", "b___"}], "]"}], ":>", 
        RowBox[{"xIntegral", "[", 
         RowBox[{
          RowBox[{"dd", "[", 
           RowBox[{"a", ",", " ", "ia", ",", " ", "b"}], "]"}], ",", "ib"}], 
         "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dd", ":", "productOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{"xIntegral", "[", 
           RowBox[{"a_", ",", "d_"}], "]"}], " ", ",", " ", 
          RowBox[{"xIntegral", "[", 
           RowBox[{"b_", ",", "c_"}], "]"}]}], " ", "]"}], ":>", 
        RowBox[{"xIntegral", "[", 
         RowBox[{
          RowBox[{"dd", "[", 
           RowBox[{"a", ",", "  ", "b"}], "]"}], ",", "d", ",", "c"}], 
         "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"c1_:", "1"}], ")"}], "  ", 
          RowBox[{"xIntegral", "[", 
           RowBox[{"b1_", ",", "a__"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"c2_:", "1"}], ")"}], " ", 
          RowBox[{"xIntegral", "[", 
           RowBox[{"b2_", ",", "a__"}], "]"}]}]}], ":>", 
        RowBox[{"xIntegral", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"c2", " ", "b2"}], "+", 
           RowBox[{"c1", " ", "b1"}]}], ",", "a"}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xIntegral", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"d_:", "1"}], ")"}], "  ", 
           RowBox[{"xIntegral", "[", 
            RowBox[{"b_", ",", "c_"}], "]"}]}], ",", "a_"}], "  ", "]"}], ":>", 
        RowBox[{"xIntegral", "[", 
         RowBox[{
          RowBox[{"d", " ", "b"}], ",", " ", "c", " ", ",", "a"}], "]"}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"EG", "\[IndentingNewLine]", 
         RowBox[{"xIntegral", "[", 
          RowBox[{"3", ",", "x", ",", 
           RowBox[{"{", 
            RowBox[{"w", ",", "a", ",", "b"}], "}"}], ",", "y"}], "]"}]}], "//", 
        RowBox[{"tuIntegralGather", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"xIntegral", "[", 
           RowBox[{"a", ",", "b"}], "]"}], " ", "\[CenterDot]", 
          RowBox[{"(", 
           RowBox[{"A1", " ", 
            RowBox[{"xIntegral", "[", 
             RowBox[{"a1", ",", "b1"}], "]"}]}], ")"}]}]}]}], "//", 
       RowBox[{"tuIntegralGather", "\[IndentingNewLine]", 
        RowBox[{"xIntegral", "[", 
         RowBox[{
          RowBox[{"aa", " ", "\[CenterDot]", " ", 
           RowBox[{"xIntegral", "[", 
            RowBox[{
             RowBox[{"a1", " ", "a2"}], ",", "b"}], "]"}], "\[CenterDot]", 
           " ", "bb"}], ",", "b1"}], "]"}]}]}], "//", 
      RowBox[{
       RowBox[{"tuIntegralGather", "\[IndentingNewLine]", "BB", " ", 
        RowBox[{"xIntegral", "[", 
         RowBox[{"aa", ",", "b"}], "]"}]}], "-", 
       RowBox[{"AA", " ", 
        RowBox[{"xIntegral", "[", 
         RowBox[{"a1", ",", "b"}], "]"}]}]}]}], "//", "tuIntegralGather"}], 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"SwitchOps", "[", 
        RowBox[{"op1_", ",", "op2_"}], "]"}], "[", "exp_", "]"}], " ", 
      "switches", " ", "positions", " ", "of", " ", "op1_"}], ",", 
     RowBox[{
      RowBox[{"op2_", " ", "in", " ", "exp_.", "  ", 
       RowBox[{"op1_", "[", 
        RowBox[{
         RowBox[{"op2_", "[", 
          RowBox[{"arg2", ",", "parm2"}], "]"}], ",", "parm1"}], "]"}]}], "->", 
      RowBox[{
       RowBox[{"op2_", "[", 
        RowBox[{
         RowBox[{"op1_", "[", 
          RowBox[{"arg2", ",", "parm1"}], "]"}], ",", "parm2"}], "]"}], " ", 
       "*", "3", "Oct2014"}]}]}], "*)"}], 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"SwitchOps", "[", 
       RowBox[{"op1_", ",", "op2_"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"op1", "===", "IntegralOp"}], " ", "&&", 
           RowBox[{"op2", "===", "IntegralOp"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{
             RowBox[{"IntegralOp", "[", 
              RowBox[{"a1_", ",", 
               RowBox[{"IntegralOp", "[", 
                RowBox[{"a2_", ",", "b_"}], "]"}]}], "]"}], "->", 
             RowBox[{"IntegralOp", "[", 
              RowBox[{"a2", ",", 
               RowBox[{"IntegralOp", "[", 
                RowBox[{"a1", ",", "b"}], "]"}]}], "]"}]}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"op1", "===", "IntegralOp"}], ",", "\[IndentingNewLine]", 
             RowBox[{"tmp", "=", 
              RowBox[{"tmp", "/.", 
               RowBox[{
                RowBox[{"IntegralOp", "[", 
                 RowBox[{"intvars_", ",", 
                  RowBox[{"op2", "[", 
                   RowBox[{"arg2_", ",", "parms2___"}], "]"}]}], "]"}], "->", 
                
                RowBox[{"op2", "[", 
                 RowBox[{
                  RowBox[{"IntegralOp", "[", 
                   RowBox[{"intvars", ",", "arg2"}], "]"}], ",", "parms2"}], 
                 "]"}]}]}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"op2", "===", "IntegralOp"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"tmp", "=", 
                RowBox[{"tmp", "/.", 
                 RowBox[{
                  RowBox[{"op1", "[", 
                   RowBox[{
                    RowBox[{"op2", "[", 
                    RowBox[{"intvars_", ",", "arg_"}], "]"}], ",", 
                    "parms1___"}], "]"}], "->", 
                  RowBox[{"op2", "[", 
                   RowBox[{"intvars", ",", 
                    RowBox[{"op1", "[", 
                    RowBox[{"arg", ",", "parms1"}], "]"}]}], "]"}]}]}]}]}], 
              "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"tmp", "=", 
              RowBox[{"tmp", "/.", 
               RowBox[{
                RowBox[{"op1", "[", 
                 RowBox[{
                  RowBox[{"op2", "[", 
                   RowBox[{"arg2_", ",", "parms2___"}], "]"}], ",", 
                  "parms1___"}], "]"}], "->", 
                RowBox[{"op2", "[", 
                 RowBox[{
                  RowBox[{"op1", "[", 
                   RowBox[{"arg2", ",", "parms1"}], "]"}], ",", "parms2"}], 
                 "]"}]}]}]}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSwitchDerivOpsIntegralOp", "::", "usage"}], "=", 
     "\"\<tuSwitchDerivOpsIntegralOp Rule for moving DerivOps into \
xIntegral|IntegralOp *16Jan2017*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuSwitchDerivOpsIntegralOp", ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dop", ":", "DerivOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{"IntegralOp", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ",", "c_"}], "]"}], "->", 
        RowBox[{"IntegralOp", "[", 
         RowBox[{"a", ",", 
          RowBox[{"dop", "[", 
           RowBox[{"b", ",", "c"}], "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dop", ":", "DerivOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{"xIntegral", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ",", "c_"}], "]"}], "\[Rule]", 
        RowBox[{"xIntegral", "[", 
         RowBox[{
          RowBox[{"dop", "[", 
           RowBox[{"a", ",", "c"}], "]"}], ",", "b"}], "]"}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DerivOpsInIntegralOp", ":=", "tuSwitchDerivOpsIntegralOp"}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"switchDerivOpsIntegralOp", ":=", "tuSwitchDerivOpsIntegralOp"}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"IntegralOp", " ", "to", " ", "Integrate", " ", 
     RowBox[{"Rules", "."}], "  ", "*", "18", "Sep2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subxIntegrate", ":=", 
     RowBox[{
      RowBox[{"IntegralOp", "[", 
       RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
      RowBox[{"xIntegral", "[", 
       RowBox[{"b", ",", 
        RowBox[{"Apply", "[", 
         RowBox[{"Sequence", ",", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "3"}], ",", 
               "#", ",", 
               RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}], ",", "a"}], 
           "]"}]}], "]"}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subxIntegrateOne", ":=", 
     RowBox[{
      RowBox[{"IntegralOp", "[", 
       RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"Most", "[", "a", "]"}], ",", 
        RowBox[{"xIntegral", "[", 
         RowBox[{"b", ",", 
          RowBox[{"Last", "[", "a", "]"}]}], "]"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subIntegralOp", ":=", 
     RowBox[{
      RowBox[{"xIntegral", "[", 
       RowBox[{"a_", ",", "b__"}], "]"}], "\[RuleDelayed]", 
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"{", "b", "}"}], ",", "a"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subIntegrate", ":=", 
     RowBox[{
      RowBox[{"xIntegral", "[", 
       RowBox[{"a_", ",", "b__"}], "]"}], ":>", 
      RowBox[{"Integrate", "[", 
       RowBox[{"a", ",", "b"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"addAssumptions", "[", "assume_", "]"}], ":=", 
     RowBox[{
      RowBox[{"xIntegral", "[", 
       RowBox[{"a_", ",", "b__"}], "]"}], "->", 
      RowBox[{"xIntegral", "[", 
       RowBox[{"a", ",", "b", ",", 
        RowBox[{"Assumptions", "->", "assume"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"subIntegrateAssume", "[", "assume_", "]"}], ":=", 
     RowBox[{
      RowBox[{"xIntegral", "[", 
       RowBox[{"a_", ",", "b__"}], "]"}], "->", 
      RowBox[{"Integrate", "[", 
       RowBox[{"a", ",", "b", ",", 
        RowBox[{"Assumptions", "->", "assume"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"toIntegralOp", "=", 
     RowBox[{
      RowBox[{"Integrate", "[", 
       RowBox[{"a_", ",", "b__"}], "]"}], "->", 
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Depth", "[", 
            RowBox[{"{", "b", "}"}], "]"}], "<", "3"}], ",", 
          RowBox[{"{", 
           RowBox[{"{", "b", "}"}], "}"}], ",", 
          RowBox[{"{", "b", "}"}]}], "]"}], ",", "a"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegralAssumptions", "::", "usage"}], "=", 
     "\"\<tuIntegralAssumptions[assume_] Rule to add Assumptions->assume_ to \
xIntegral terms *2May2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegralAssumptions", "[", "assume_", "]"}], ":=", 
     RowBox[{
      RowBox[{"xIntegral", "[", 
       RowBox[{"a_", ",", "b__"}], "]"}], "\[Rule]", 
      RowBox[{"xIntegral", "[", 
       RowBox[{"a", ",", "b", ",", 
        RowBox[{"Assumptions", "->", "assume"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegrate", "::", "usage"}], "=", 
     "\"\<tuIntegrate[assume_][exp_] applies Integrate[] to tuIntegral[] \
terms in exp_.   Assumptions may be introduced by setting assume_ \
*21Feb2015\>\""}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIntegrate", "[", 
       RowBox[{"assume_:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "xIntegral"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"tuIntegral", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"xIntegral", "[", 
            RowBox[{"b", ",", 
             RowBox[{"Apply", "[", 
              RowBox[{"Sequence", ",", 
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "3"}], ",",
                     "#", ",", 
                    RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}], ",", 
                 "a"}], "]"}]}], "]"}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "assume", "]"}], ">", "0"}], ",", 
          RowBox[{"$", "=", 
           RowBox[{"$", "/.", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"xIntegral", "[", 
              RowBox[{"a_", ",", "b__"}], "]"}], "->", 
             RowBox[{"xIntegral", "[", 
              RowBox[{"a", ",", "b", ",", 
               RowBox[{"Assumptions", "->", "assume"}]}], "]"}]}]}]}]}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{"xIntegral", "\[Rule]", "Integrate"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"ExchangexPartialDSum", "[", "exp_", "]"}], " ", "switches", 
      " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"dop", ":", "DerivOps"}], ")"}], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "sum"}], ")"}], "[", 
         RowBox[{"a_", ",", "c__"}], "]"}], ",", "b_"}], "]"}]}], 
     "\[RuleDelayed]", 
     RowBox[{
      RowBox[{"op", "[", 
       RowBox[{
        RowBox[{"dop", "[", 
         RowBox[{"a", ",", "b"}], "]"}], ",", "c"}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{"added", " ", "DerivOps"}], ")"}], " ", "*", "20", 
      "Oct2013"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ExchangexPartialDSum", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", 
         RowBox[{"sum", "=", 
          RowBox[{"Sum", "|", "xSum"}]}], ",", 
         RowBox[{"DEBUG", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<ExchangePartialDSum: \>\"", ",", "tmp"}], "]"}]}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Partiald", " ", "does", " ", "not", " ", "substitute"}], 
          ",", " ", 
          RowBox[{"change", " ", "to", " ", "xPartialD"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", "distributePartialD"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"dop", ":", "DerivOps"}], ")"}], "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"op", ":", "sum"}], ")"}], "[", 
              RowBox[{"a_", ",", "c__"}], "]"}], ",", "b_"}], "]"}], 
           "\[RuleDelayed]", 
           RowBox[{"op", "[", 
            RowBox[{
             RowBox[{"dop", "[", 
              RowBox[{"a", ",", "b"}], "]"}], ",", "c"}], "]"}]}]}]}], ";", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "/.", 
            RowBox[{
             RowBox[{"xPartialD", "[", 
              RowBox[{
               RowBox[{"xSum", "[", 
                RowBox[{"a_", ",", "c__"}], "]"}], ",", "b_"}], "]"}], 
             "\[RuleDelayed]", 
             RowBox[{"xSum", "[", 
              RowBox[{
               RowBox[{"xPartialD", "[", 
                RowBox[{"a", ",", "b"}], "]"}], ",", "c"}], "]"}]}]}]}], 
          ";"}], "*)"}], "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Contracts", " ", 
     RowBox[{"xDiscreteDelta", "[", 
      RowBox[{"n_", ",", "m_"}], "]"}], " ", "in", " ", 
     RowBox[{"xSum", ".", "  ", "Eliminates"}], " ", "on", " ", 
     RowBox[{
      RowBox[{"xSum", "[", "]"}], ".", " ", "\[IndentingNewLine]", "3.1"}], 
     ".2010"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SumDiscreteDelta", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"tmp1", "=", "Null"}], ",", "pos", ",", "arg", ",", "index", 
         ",", "sumvar", ",", "xsum", ",", "xdelta", ",", "posd", ",", "n", 
         ",", "m", ",", 
         RowBox[{"repl", "=", 
          RowBox[{"{", "}"}]}], ",", "sub", ",", "i", ",", 
         RowBox[{"DEBUG", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "//", "DistributeSum"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp1"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"DEBUG", ">", "0"}], ",", 
             RowBox[{"Print", "[", 
              RowBox[{"\"\<SumDiscreteDelta: \>\"", ",", "tmp"}], "]"}]}], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"pos", "=", 
            RowBox[{"Position", "[", 
             RowBox[{"tmp", ",", 
              RowBox[{"xSum", "[", "__", "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", "=", "1"}], ",", 
             RowBox[{"i", "<=", 
              RowBox[{"Length", "[", "pos", "]"}]}], ",", 
             RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"xsum", "=", 
               RowBox[{"Extract", "[", 
                RowBox[{"tmp", ",", 
                 RowBox[{"pos", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"arg", ",", "index"}], "}"}], "=", 
               RowBox[{"Apply", "[", 
                RowBox[{"List", ",", "xsum"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Head", "[", "index", "]"}], "===", "List"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"sumvar", "=", 
                 RowBox[{"First", "[", "index", "]"}]}], ",", 
                RowBox[{"sumvar", "=", "index"}]}], "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"DEBUG", ">", "0"}], ",", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<SumDiscreteDelta{arg,index}: \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"arg", ",", "index"}], "}"}]}], "]"}]}], "]"}], 
              ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"xdelta", "=", 
               RowBox[{
                RowBox[{"Extract", "[", 
                 RowBox[{"arg", ",", 
                  RowBox[{"posd", "=", 
                   RowBox[{"Position", "[", 
                    RowBox[{"arg", ",", 
                    RowBox[{"xDiscreteDelta", "[", "__", "]"}]}], "]"}]}]}], 
                 "]"}], "//", "First"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"sub", "=", "Null"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"!", 
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"xdelta", ",", "sumvar"}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "xdelta", "]"}], "==", "2"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"sub", "=", 
                    RowBox[{
                    RowBox[{"Solve", "[", 
                    RowBox[{
                    RowBox[{"Apply", "[", 
                    RowBox[{"Equal", ",", "xdelta"}], "]"}], ",", "sumvar"}], 
                    "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "xdelta", "]"}], "==", "1"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"sub", "=", 
                    RowBox[{
                    RowBox[{"Solve", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"First", "[", "xdelta", "]"}], "==", "0"}], ",", 
                    "sumvar"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"DEBUG", ">", "0"}], ",", 
                RowBox[{"Print", "[", 
                 RowBox[{
                 "\"\<SumDiscreteDelta{Length[xdelta],xdelta,sub}: \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Length", "[", "xdelta", "]"}], ",", "xdelta", 
                    ",", "sub"}], "}"}]}], "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"DEBUG", ">", "0"}], ",", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<SumDiscreteDelta{sub,arg}: \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"sub", ",", "arg"}], "}"}]}], "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"sub", "=!=", "Null"}], ",", 
                RowBox[{
                 RowBox[{"arg", "=", 
                  RowBox[{
                   RowBox[{"arg", "/.", "sub"}], "/.", 
                   RowBox[{
                    RowBox[{"xDiscreteDelta", "[", "__", "]"}], "->", 
                    "1"}]}]}], ";", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"repl", ",", 
                   RowBox[{
                    RowBox[{"pos", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "->", "arg"}]}], 
                  "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"DEBUG", ">", "0"}], ",", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<SumDiscreteDelta{index,sub,repl}: \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"index", ",", "sub", ",", "repl"}], "}"}]}], 
                 "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"tmp", ",", "repl"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuExtractIntegrand", "::", "usage"}], "=", 
     "\"\<tuExtractIntegrand[exp_] returns position\[Rule]integrand Rule of \
first IntegralOp[a_,b_]|tuIntegral[a_,b_]|xIntegral[a_,b__] found in exp_. \
Adjustment is made for the arguement postion of the integral arguement list. \
*8Nov2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuExtractIntegrand", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "tmp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"tuExtractPositionPattern", "[", 
            RowBox[{
             RowBox[{"IntegralOp", "[", 
              RowBox[{"a_", ",", "b_"}], "]"}], "|", 
             RowBox[{"tuIntegral", "[", 
              RowBox[{"a_", ",", "b_"}], "]"}], "|", 
             RowBox[{"xIntegral", "[", 
              RowBox[{"a_", ",", "b__"}], "]"}]}], "]"}], "[", "exp", "]"}], "//",
           "First"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"FreeQ", "[", 
            RowBox[{"tmp", ",", "Integrate"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", "   ", 
            RowBox[{
             RowBox[{"Append", "[", 
              RowBox[{
               RowBox[{"First", "[", "tmp", "]"}], ",", "2"}], "]"}], 
             "\[Rule]", 
             RowBox[{"tmp", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}]}], " ", "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", "   ", 
            RowBox[{
             RowBox[{"Append", "[", 
              RowBox[{
               RowBox[{"First", "[", "tmp", "]"}], ",", "1"}], "]"}], 
             "\[Rule]", 
             RowBox[{"tmp", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}], " ", "}"}]}], 
          "\[IndentingNewLine]", "]"}], "//", "First"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ExtractIntegrandP", ":=", "tuExtractIntegrand"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], 
   RowBox[{"Clear", "[", "tuIntegralSimplify", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegralSimplify", "::", "usage"}], "=", 
     "\"\<tuIntegralSimplify[keep_:{},nokeep_:{}][exp_] applies \
tuIntegralSimplify0[,] to all xIntegral's in exp_ which removes from \
integrand_ of xIntegral[] terms that are not functions of the integration \
variables. {keep_,nokeeep_}  is an optional list of variables to {keep \
inside, remove from} the integral.  EG: exp//tuIntegralSimplify[{},{}]  \
*8Mar2016*1Apr2019*\>\""}], " ", ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIntegralSimplify", "[", 
       RowBox[{
        RowBox[{"keep_:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"nokeep_:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", " ", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuOpSimplifyFirst", "[", 
           RowBox[{"xIntegral", ",", "nokeep"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", "tmp", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"xIntegral", "[", 
            RowBox[{"0", ",", "b__"}], "]"}], "->", "0"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"xIntegral", "[", 
            RowBox[{"a_", ",", "b__"}], "]"}], ":>", 
           RowBox[{"tuIntegralSimplify0", "[", 
            RowBox[{"a", ",", "b", ",", "keep"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{"xIntegral", "[", 
            RowBox[{
             RowBox[{"-", "a_"}], ",", "b__"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"-", 
            RowBox[{"xIntegral", "[", 
             RowBox[{"a", ",", "b"}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"xIntegral", "[", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "b__"}], "]"}], "->", 
           RowBox[{"-", 
            RowBox[{"xIntegral", "[", 
             RowBox[{"1", ",", "b"}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "//", 
            RowBox[{"tuOpSimplifyFirst", "[", "xIntegral", "]"}]}]}], ";"}], 
         "*)"}], "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"tuIntegralSimplify0", "//", "Clear"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegralSimplify0", "[", 
      RowBox[{"integrand_", ",", "vars0__", ",", 
       RowBox[{"extra_:", 
        RowBox[{"{", "}"}]}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "vars", ",", "terms", ",", "$", ",", "pick", ",", "keep", ",", "out", 
         ",", "ret", ",", "$head", ",", "xfnc", ",", "one", ",", "sign", ",", 
         "xsign", ",", "d", ",", "dvars0", ",", "$const"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Make", " ", "list", " ", "of", " ", "integration", " ", "variables", 
         " ", "where", " ", "vars", " ", "is", " ", "List", " ", "of", " ", 
         RowBox[{"Lists", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"vars", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
              RowBox[{"First", "[", "#", "]"}], ",", "#"}], "]"}], "&"}], ",", 
           RowBox[{"{", "vars0", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Integrand", " ", "must", " ", "be", " ", "a", " ", "Product", " ", 
          "of", " ", "terms", " ", "to", " ", "be", " ", 
          RowBox[{"factorable", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$", "=", "integrand"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$head", "=", 
         RowBox[{"Head", "[", "$", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "add", " ", "one", " ", "for", " ", "routine", " ", "to", " ", 
          "work"}], "*)"}], 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"xPrint", "[", 
           RowBox[{
           "$", ",", "\"\<::\>\"", ",", "vars", ",", "\"\<::\>\"", ",", 
            "$head"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"tuHasAnyQ", "[", 
            RowBox[{"$head", ",", 
             RowBox[{"{", "productOps", "}"}]}], "]"}], ",", "$", " ", ",", 
           RowBox[{"one", " ", "$"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Remove", " ", "Numbers", " ", "from", " ", "vars0_.", " ", "NEEDS", 
          " ", "extension", " ", "for", " ", "multiple", " ", "integration", 
          " ", "variables"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"dvars0", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", " ", "vars"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$const", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"dvars0", ",", "NumberQ"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dvars0", "=", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"dvars0", ",", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"NumberQ", "[", "#", "]"}]}], "&"}]}], "]"}], "//", 
          "First"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "$const", "]"}], ">", "0"}], ",", 
          RowBox[{"$", "=", 
           RowBox[{"$", " ", 
            RowBox[{"$const", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}]}], " ", "]"}], ";", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"xPrint", "[", 
           RowBox[{"{", 
            RowBox[{"dvars0", ",", "vars0", ",", "$const", ",", " ", "$"}], 
            "}"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "DOES", " ", "NOT", " ", "RETAIN", " ", "ORDER", " ", "OF", " ", 
           "TERMS"}], ",", " ", 
          RowBox[{"NEEDS", " ", "left"}], ",", 
          RowBox[{"right", " ", "keep"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ret", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"tuHasAnyQ", "[", 
            RowBox[{"$head", ",", 
             RowBox[{"{", "productOps", "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"terms", "=", 
             RowBox[{"Apply", "[", 
              RowBox[{"List", ",", "$"}], "]"}]}], ";", 
            RowBox[{"(*", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"xPrint", "[", "terms", "]"}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"pick", "=", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"tuFreeQ", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"{", 
                    RowBox[{"vars", ",", "extra", ",", "one"}], "}"}], 
                   "]"}]}], "]"}], "&"}], ",", "terms"}], "]"}]}], ";", 
            RowBox[{"(*", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"xPrint", "[", "pick", "]"}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"keep", "=", 
             RowBox[{"Apply", "[", 
              RowBox[{"$head", ",", 
               RowBox[{"Pick", "[", 
                RowBox[{"terms", ",", "pick", ",", "False"}], "]"}]}], 
              "]"}]}], ";", 
            RowBox[{"(*", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"xPrint", "[", "keep", "]"}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"out", "=", 
             RowBox[{"Apply", "[", 
              RowBox[{"$head", ",", 
               RowBox[{"Pick", "[", 
                RowBox[{"terms", ",", "pick"}], "]"}]}], "]"}]}], ";", 
            RowBox[{"(*", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"xPrint", "[", 
               RowBox[{"dvars0", ",", "vars0", ",", "vars"}], "]"}], ";"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "Get", " ", "original", " ", "Integrate", " ", "limits"}], 
             "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"dvars0", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{
                 RowBox[{"{", "vars0", "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"#", ",", "_", ",", "_"}], "}"}]}], "]"}], "&"}], "/@",
               "vars"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"tuHasNoneQ", "[", 
                 RowBox[{"dvars0", ",", "#"}], "]"}], ",", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"dvars0", ",", "#"}], "]"}]}], "]"}], "&"}], "/@", 
             "vars"}], ";", 
            RowBox[{"(*", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "vars", ",", "\"\<:\>\"", ",", "vars0", ",", "\"\<:\>\"", ",", 
                "dvars0"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"$", "=", 
             RowBox[{"$head", "[", 
              RowBox[{"out", ",", " ", 
               RowBox[{"xIntegral", "[", 
                RowBox[{"keep", ",", 
                 RowBox[{"Apply", "[", 
                  RowBox[{"Sequence", ",", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"dvars0", ",", "1"}], "]"}]}], "]"}]}], "]"}]}], 
              "]"}]}], ";", "\[IndentingNewLine]", "$"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"xIntegral", "[", 
            RowBox[{"$", ",", "dvars0"}], "]"}]}], 
          RowBox[{"(*", 
           RowBox[{"No", " ", "Change", " ", "return"}], "*)"}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ret", "=", 
         RowBox[{
          RowBox[{"ret", "/.", 
           RowBox[{"one", "\[Rule]", "1"}]}], "/.", 
          RowBox[{
           RowBox[{"xfnc", "[", "ff_", "]"}], "\[Rule]", "ff"}]}]}], ";", 
        "\[IndentingNewLine]", "ret"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"TEST", "\[IndentingNewLine]", 
       RowBox[{"xIntegral", "[", 
        RowBox[{
         RowBox[{"iP", " ", 
          SuperscriptBox["p", "2"]}], ",", "\[Sigma]"}], "]"}], 
       "\[IndentingNewLine]", "%"}], "//", 
      RowBox[{"tuIntegralSimplify", "[", 
       RowBox[{"{", 
        RowBox[{"iP", ",", "iX"}], "}"}], "]"}]}], ";"}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpMerge", "::", "usage"}], "=", 
     "\"\<tuOpMerge[op_:xIntegral] Rule for merge nested operator into one \
*8Mar2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOpMerge", "[", 
      RowBox[{"op_:", "xIntegral"}], "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"op", "[", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{"a_", ",", "b__"}], "]"}], ",", "c__"}], "]"}], "\[Rule]", 
       RowBox[{"op", "[", 
        RowBox[{"a", ",", "c", ",", "b"}], "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"simpleIntegralOp", "[", 
       RowBox[{"vars0_List", ",", "integrand_"}], "]"}], " ", "removes", " ", 
      "from", " ", "integrand_", " ", "of", " ", 
      RowBox[{"IntegralOp", "[", "]"}], " ", "terms", " ", "that", " ", "are",
       " ", "not", " ", "functions", " ", "of", " ", "the", " ", 
      "integration", " ", 
      RowBox[{"variables", ".", " ", "\[IndentingNewLine]", 
       RowBox[{"Usage", ":", " ", "exp"}]}]}], "//.", 
     RowBox[{"IntegralOp", "->", 
      RowBox[{"simpleIntegralOp", "  ", "*", "2", "Oct2014"}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simpleIntegralOp", "[", 
      RowBox[{"vars0_List", ",", "integrand_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "vars", ",", "terms", ",", "pick", ",", "keep", ",", "out", ",", 
         "ret"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Make", " ", "list", " ", "of", " ", "integration", " ", "variables", 
         " ", "where", " ", "vars", " ", "is", " ", "List", " ", "of", " ", 
         RowBox[{"Lists", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"vars", "=", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "}"}], "&"}], ",", "vars0"}], 
           "]"}], "//", "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Integrand", " ", "must", " ", "be", " ", "a", " ", "Product", " ", 
          "of", " ", "terms", " ", "to", " ", "be", " ", 
          RowBox[{"factorable", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ret", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "integrand", "]"}], "===", "Times"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"terms", "=", 
             RowBox[{"Apply", "[", 
              RowBox[{"List", ",", "integrand"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"pick", "=", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"ListFreeQ", "[", 
                 RowBox[{"#", ",", "vars"}], "]"}], "&"}], ",", "terms"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"keep", "=", 
             RowBox[{"Apply", "[", 
              RowBox[{"Times", ",", 
               RowBox[{"Pick", "[", 
                RowBox[{"terms", ",", "pick", ",", "False"}], "]"}]}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"out", "=", 
             RowBox[{"Apply", "[", 
              RowBox[{"Times", ",", 
               RowBox[{"Pick", "[", 
                RowBox[{"terms", ",", "pick"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"out", " ", 
             RowBox[{"IntegralOp", "[", 
              RowBox[{"vars0", ",", "keep"}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"IntegralOp", "[", 
            RowBox[{"vars0", ",", "integrand"}], "]"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ret", "/.", 
         RowBox[{
          RowBox[{"IntegralOp", "[", 
           RowBox[{"_", ",", "0"}], "]"}], "\[Rule]", "0"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSimpleIntegralOp", "::", "usage"}], "=", 
     "\"\<tuSimpleIntegralOp[exp_] applies simpleIntegralOp to all \
IntegralOp's in exp_ which removes from integrand_ of IntegralOp[] terms that \
are not functions of the integration variables. EG: exp//tuSimpleIntegralOp  \
*7Jan2015\>\""}], " ", ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSimpleIntegralOp", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", " ", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "/.", 
         RowBox[{"IntegralOp", "->", "simpleIntegralOp"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSimpleIntegralOp", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", " ", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"IntegralOp", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tuIntegralSimplify", "[", 
              RowBox[{"b", ",", 
               RowBox[{"Apply", "[", 
                RowBox[{"Sequence", "[", "a", "]"}], "]"}]}], "]"}], "/.", 
             RowBox[{
              RowBox[{"xIntegral", "[", 
               RowBox[{"ii_", ",", "vv__"}], "]"}], "\[Rule]", 
              RowBox[{"IntegralOp", "[", 
               RowBox[{
                RowBox[{"{", "vv", "}"}], ",", "ii"}], "]"}]}]}], ")"}]}]}]}],
         ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   RowBox[{"(*", "UNTESTED", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"IntegrandKeep", "[", "vars_List", "]"}], "[", "exp_", "]"}], 
     " ", "simplifies", " ", 
     RowBox[{"IntegralOp", "'"}], "s", " ", "by", " ", "moving", " ", 
     "integrand", " ", "terms", " ", "not", " ", "containing", " ", "any", 
     " ", "vars_List", " ", 
     RowBox[{"(", 
      RowBox[{"Patterns", " ", "OK"}], ")"}], " ", "outside", " ", "of", " ", 
     "IntegralOp", " ", 
     RowBox[{"expression", "."}], " ", "*", "13", "Jun2013"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"IntegrandKeep", "[", "vars_List", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "pos", ",", "ipos", ",", "args", ",", "intg", ",", 
         "vars0", ",", "integrand", ",", "terms", ",", "pick", ",", "keep", 
         ",", "out"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"First", " ", "IntegralOp", " ", "Times", " ", "terms"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pos", "=", 
         RowBox[{"exp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"IntegralOp", "[", 
            RowBox[{"_", ",", "_"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"vars0", ",", "integrand"}], "}"}], "=", 
            RowBox[{"Apply", "[", 
             RowBox[{"List", ",", 
              RowBox[{"pos", "[", 
               RowBox[{"[", 
                RowBox[{"ipos", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"{", 
             RowBox[{"vars0", ",", "integrand"}], "}"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Integrand", " ", "must", " ", "be", " ", "a", " ", "Product", 
             " ", "of", " ", 
             RowBox[{"terms", "."}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", "integrand", "]"}], "==", "Times"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"terms", "=", 
               RowBox[{"Apply", "[", 
                RowBox[{"List", ",", "integrand"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"pick", "=", 
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ListFreeQ", "[", 
                   RowBox[{"#", ",", "vars"}], "]"}], "&"}], ",", "terms"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"keep", "=", 
               RowBox[{"Apply", "[", 
                RowBox[{"Times", ",", 
                 RowBox[{"Pick", "[", 
                  RowBox[{"terms", ",", "pick", ",", "False"}], "]"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"out", "=", 
               RowBox[{"Apply", "[", 
                RowBox[{"Times", ",", 
                 RowBox[{"Pick", "[", 
                  RowBox[{"terms", ",", "pick", ",", "True"}], "]"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"pos", "[", 
                RowBox[{"[", 
                 RowBox[{"ipos", ",", "2"}], "]"}], "]"}], "=", 
               RowBox[{"out", " ", 
                RowBox[{"IntegralOp", "[", 
                 RowBox[{"vars0", ",", "keep"}], "]"}]}]}]}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"{", 
             RowBox[{"vars0", ",", 
              RowBox[{"pos", "[", 
               RowBox[{"[", 
                RowBox[{"ipos", ",", "2"}], "]"}], "]"}]}], "}"}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"ipos", ",", 
            RowBox[{"Length", "[", "pos", "]"}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"exp", ",", "pos"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"IntegrandWithout", "[", "vars_List", "]"}], " ", "simplifies", 
     " ", 
     RowBox[{"IntegralOp", "'"}], "s", " ", "by", " ", "moving", " ", 
     "integrand", " ", "terms", " ", "containing", " ", "any", " ", 
     "vars_List", " ", 
     RowBox[{"(", 
      RowBox[{"Patterns", " ", "OK"}], ")"}], " ", "to", " ", "outside", " ", 
     "of", " ", "IntegralOp", " ", 
     RowBox[{"expression", ".", " ", "Moves"}], " ", 
     RowBox[{"NumericQ", "[", "]"}], " ", "terms", " ", "outside", " ", 
     RowBox[{"IntegralOp", "."}], "  ", "*", "13", "Jun2013"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"IntegrandWithout", "[", "vars_List", "]"}], "[", "exp_", "]"}],
      ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "pos", ",", "ipos", ",", "args", ",", "intg", ",", 
         "vars0", ",", "integrand", ",", "terms", ",", "pick", ",", "keep", 
         ",", "out"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"First", " ", "IntegralOp", " ", "Times", " ", "terms"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pos", "=", 
         RowBox[{"exp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"IntegralOp", "[", 
            RowBox[{"_", ",", "_"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Only", " ", "applies", " ", "to", " ", "first", " ", "IntegralOp", 
           " ", 
           RowBox[{"encountered", "."}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"vars0", ",", "integrand"}], "}"}], "=", 
            RowBox[{"Apply", "[", 
             RowBox[{"List", ",", 
              RowBox[{"pos", "[", 
               RowBox[{"[", 
                RowBox[{"ipos", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Integrand", " ", "must", " ", "be", " ", "a", " ", "Product", 
             " ", "of", " ", 
             RowBox[{"terms", "."}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", "integrand", "]"}], "==", "Times"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"terms", "=", 
               RowBox[{"Apply", "[", 
                RowBox[{"List", ",", "integrand"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"pick", "=", 
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"ListFreeQ", "[", 
                    RowBox[{"#", ",", "vars"}], "]"}], "&&", 
                   RowBox[{"!", 
                    RowBox[{"NumericQ", "[", "#", "]"}]}]}], "&"}], ",", 
                 "terms"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"keep", "=", 
               RowBox[{"Apply", "[", 
                RowBox[{"Times", ",", 
                 RowBox[{"Pick", "[", 
                  RowBox[{"terms", ",", "pick", ",", "True"}], "]"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"out", "=", 
               RowBox[{"Apply", "[", 
                RowBox[{"Times", ",", 
                 RowBox[{"Pick", "[", 
                  RowBox[{"terms", ",", "pick", ",", "False"}], "]"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"pos", "[", 
                RowBox[{"[", 
                 RowBox[{"ipos", ",", "2"}], "]"}], "]"}], "=", 
               RowBox[{"out", " ", 
                RowBox[{"IntegralOp", "[", 
                 RowBox[{"vars0", ",", "keep"}], "]"}]}]}]}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"{", 
             RowBox[{"vars0", ",", 
              RowBox[{"pos", "[", 
               RowBox[{"[", 
                RowBox[{"ipos", ",", "2"}], "]"}], "]"}]}], "}"}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"ipos", ",", 
            RowBox[{"Length", "[", "pos", "]"}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"exp", ",", "pos"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegralSwitchVar", "::", "usage"}], "=", 
     "\"\<tuIntegralSwitchVar[rule_Rule][exp_]\[IndentingNewLine]switches \
integration variables specified by rule_Rule (systax::newvar->exp[old var]) \
in all xIntegral terms in exp_ so \
xIntegral[integrand,currentVar]->xIntegral[jacobian integrand,newVar] Only \
good with Integrals with single variables *7Mar2016**18Nov2017*\>\""}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIntegralSwitchVar", "[", "rule_Rule", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"$", "/.", " ", 
        RowBox[{
         RowBox[{"ii", ":", 
          RowBox[{"xIntegral", "[", 
           RowBox[{"_", ",", "_"}], "]"}]}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"tuOpIndependentVarActivate", "[", "]"}], "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Inactive", "[", "tuIntegralSwitchVar0", "]"}], "[", 
            "rule", "]"}], "[", "ii", "]"}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegralSwitchVar0", "::", "usage"}], "=", 
     "\"\<tuIntegralSwitchVar0[rule_Rule][exp_xIntegral]\[IndentingNewLine]\
switches integration variables in exp_ specified by rule_Rule \
(systax::newvar->exp[old var]) so \
xIntegral[integrand,currentVar]->xIntegral[jacobian integrand,newVar] Only \
works with Integrals with single variables *18Nov2017*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIntegralSwitchVar0", "[", "rule_Rule", "]"}], "[", 
      "exp_xIntegral", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$int", ",", "$newvar", ",", 
         "$sivar", ",", "$ivar", ",", "$ivar0", ",", "dd"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$int", "=", "exp"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$ivar0", "=", 
         RowBox[{"$ivar", "=", 
          RowBox[{"$int", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$ivar", "=", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "$ivar", "}"}], "]"}], "//", "First"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{
         "$ivar0", ",", "\"\< \>\"", ",", "$ivar", ",", "\"\<::\>\"", ",", 
          "$int", ",", "\"\<::\>\"", ",", "rule"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"tuHasNoneQ", "[", 
           RowBox[{"rule", ",", "$ivar"}], "]"}], ",", 
          RowBox[{"Return", "[", "exp", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"switch", " ", "to", " ", "new", " ", "variable"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$newvar", "=", 
         RowBox[{"rule", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$sivar", "=", 
         RowBox[{
          RowBox[{"tuRuleSolve", "[", 
           RowBox[{"rule", ",", "$ivar"}], "]"}], "//", "Last"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$jacob", "=", "$sivar"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$jacob", "=", 
         RowBox[{
          RowBox[{"tuRuleSolve", "[", 
           RowBox[{"$jacob", ",", "$ivar"}], "]"}], "//", "First"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$jacob", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"dd", "[", "#", "]"}], "&"}], "/@", "$sivar"}], "//", 
          RowBox[{"tuDExpandF", "[", "dd", "]"}]}]}], ";", 
        RowBox[{"xPrint", "[", "$jacob", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$jacob", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"$jacob", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "/.", 
           RowBox[{
            RowBox[{"dd", "[", "$newvar", "]"}], "\[Rule]", "1"}]}], "/.", 
          RowBox[{
           RowBox[{"dd", "[", "_", "]"}], "\[Rule]", "0"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"add", " ", "jacobian", " ", "to", " ", "integrand"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$int", "=", 
         RowBox[{"$int", "//", 
          RowBox[{"tuRuleApply", "[", "$sivar", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"$int", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{"$int", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "$jacob"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"$int", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "=", "$newvar"}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"$jacob", ",", "\"\< \>\"", ",", "$int"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "$ivar0", "]"}], "===", "List"}], ",", 
          RowBox[{"(*", 
           RowBox[{"adjust", " ", "limits"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"$ivar0", "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;", "3"}], "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"$ivar", "\[Rule]", "#"}], "&"}], "/@", 
               RowBox[{"$ivar0", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], ")"}], "/.", 
             "$sivar"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$ivar0", "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;", "3"}], "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"tuRuleSolve", "[", 
                    RowBox[{
                    RowBox[{"{", "#", "}"}], ",", "$newvar"}], "]"}], "&"}], "/@", 
                  RowBox[{"$ivar0", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], "//", 
                 "Flatten"}], ")"}]}], "}"}], "//", "Flatten"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$ivar0", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "=", "$newvar"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$int", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "=", "$ivar0"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "$int"}]}],
       "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"EG", ":", " ", 
     RowBox[{
      RowBox[{"tuIntegralSwitchVar0", "[", 
       RowBox[{"z", "\[Rule]", 
        RowBox[{"Exp", "[", "x", "]"}]}], "]"}], "[", 
      RowBox[{"xIntegral", "[", 
       RowBox[{
        RowBox[{"a", " ", "x"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "2", ",", "3"}], "}"}]}], "]"}], "]"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"EG", ":", " ", 
     RowBox[{
      RowBox[{"tuIntegralSwitchVar", "[", 
       RowBox[{"z", "\[Rule]", 
        RowBox[{"Exp", "[", "x", "]"}]}], "]"}], "[", 
      RowBox[{"AA", " ", 
       RowBox[{"xIntegral", "[", 
        RowBox[{
         RowBox[{"a", " ", "x"}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "2", ",", "3"}], "}"}]}], "]"}]}], "]"}]}], 
    "*)"}], "\n", 
   RowBox[{"(*", 
    RowBox[{"EG", ":", " ", 
     RowBox[{
      RowBox[{"tuIntegralSwitchVar", "[", 
       RowBox[{"y", "\[Rule]", 
        RowBox[{
         SubscriptBox["x", "+"], 
         RowBox[{"fn", "[", "x", "]"}]}]}], "]"}], "[", 
      RowBox[{"xIntegral", "[", 
       RowBox[{
        RowBox[{"a", " ", "x", " ", 
         SubscriptBox["x", "w"]}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "A", ",", "B"}], "}"}]}], "]"}], "]"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"switchIntegralOpVariable", "[", "dRule_Rule", "]"}], "[", 
       "exp_IntegralOp", "]"}], " ", "switches", " ", "integration", " ", 
      "variables", " ", "specified", " ", "by", " ", "dRule_Rule", " ", 
      RowBox[{"(", " ", 
       RowBox[{
        RowBox[{"systax", ":", " ", 
         RowBox[{"d", "[", "currentVar", "]"}]}], "->", 
        RowBox[{"jacobian", " ", 
         RowBox[{"d", "[", "newVar", "]"}]}]}], " ", ")"}], " ", "so", " ", 
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", "currentVar", "}"}], "}"}], ",", "integrand"}], "]"}]}],
      "->", 
     RowBox[{
      RowBox[{
       RowBox[{"IntegralOp", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", "newVar", "}"}], "}"}], ",", 
         RowBox[{"jacobian", " ", "integrand"}]}], "]"}], " ", "Requires", 
       " ", "varlist"}], "->", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "x", "}"}], ",", 
         RowBox[{"{", "y", "}"}], ",", "..."}], "}"}], "  ", "*", "20", 
       "Nov2013"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"switchIntegralOpVariable", "[", "dRule_Rule", "]"}], "[", 
      "exp_IntegralOp", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "tmp1", ",", "varlist", ",", "var1", ",", "var2", ",", 
         "jacob"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ";", "\[IndentingNewLine]", 
        RowBox[{"var1", "=", 
         RowBox[{"dRule", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", 
         RowBox[{
          RowBox[{"dRule", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "//", 
          RowBox[{"tuExtractPositionPattern", "[", " ", 
           RowBox[{"d", "[", "_", "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"var2", "=", 
         RowBox[{"tmp1", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2", ",", "1"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"jacob", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{
           RowBox[{"dRule", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"tmp1", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"IntegralOp", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"a0___", ",", "a_", ",", "a1___"}], "}"}], ",", "b_"}], 
            "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"IntegralOp", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"a0", ",", 
                RowBox[{"{", "var2", "}"}], ",", "a1"}], "}"}], ",", 
              RowBox[{"b", " ", "jacob"}]}], "]"}], "/;", 
            RowBox[{"a", "===", 
             RowBox[{"{", "var1", "}"}]}]}]}]}]}], ";", "\[IndentingNewLine]",
         "tmp"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIntegrateOne", "::", "usage"}], "=", 
     "\"\<tuIntegrateOne[$parm_,$options_:{}][$exp_] applies Integrate[]s \
parm_ of xIntegral[] in exp_. Integrate $options_ are optional. \
*4Jan2015*3Feb2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIntegrateOne", "[", 
       RowBox[{"$parm_", ",", 
        RowBox[{"$options_:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "$exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "$exp"}], ",", "$s"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"$s", "=", 
          RowBox[{
           RowBox[{"xIntegral", "[", 
            RowBox[{"a_", ",", "b__"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"Fold", "[", 
            RowBox[{"xIntegral", ",", "a", ",", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{"Sort", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{
                   RowBox[{"{", "b", "}"}], ",", "0"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", "#1", "}"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "===", "$parm"}], "&"}]}],
                 "]"}], ",", "0"}], "]"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"$", "=", 
          RowBox[{"$", "/.", "$s"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"$s", "=", 
          RowBox[{
           RowBox[{"$", "//", 
            RowBox[{"tuExtractPositionPattern", "[", 
             RowBox[{"xIntegral", "[", 
              RowBox[{"_", ",", "_"}], "]"}], "]"}]}], "//", "First"}]}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "$options", "]"}], ">", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"$s", "=", 
            RowBox[{"$s", "/.", 
             RowBox[{
              RowBox[{"xIntegral", "[", 
               RowBox[{"a_", ",", "b_"}], "]"}], "->", 
              RowBox[{"xIntegral", "[", 
               RowBox[{"a", ",", "b", ",", 
                RowBox[{"Assumptions", "->", "$options"}]}], "]"}]}]}]}]}], 
          "\[IndentingNewLine]", "]"}], ";", 
         RowBox[{"xPrint", "[", "$s", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"tuHasAnyQ", "[", 
            RowBox[{
             RowBox[{"$s", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", "$parm"}], "]"}], 
           ",", 
           RowBox[{"$s", "=", 
            RowBox[{"$s", "//", "Activate"}]}]}], "]"}], ";"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"$", ",", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"{", "$s", "}"}], ",", "0"}], "]"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IntegrateOne", "[", 
      RowBox[{"parm_", ",", "exp_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIntegrateOne", "[", "parm", "]"}], "[", "exp", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"addIntegralOpVar", "[", "var_List", "]"}], " ", "adds", " ", 
     "var_List", " ", "to", " ", 
     RowBox[{"IntegralOp", "[", 
      RowBox[{"vars", ",", "_"}], "]"}], " ", "var_List", " ", "must", " ", 
     "be", " ", "a", " ", "List", " ", "of", " ", 
     RowBox[{"Lists", "."}], " ", "*", "28", "Nov2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"addIntegralOpVar", "[", "var_List", "]"}], ":=", 
     RowBox[{
      RowBox[{"IntegralOp", "[", 
       RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"a", ",", "var"}], "]"}], ",", "b"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"simpleIntegralOpVar", "[", 
        RowBox[{"var_", ",", "vRule_"}], "]"}], "[", "exp_IntegralOp", "]"}], 
      " ", "simplifies", " ", "the", " ", "integration", " ", "variables"}], 
     ",", " ", 
     RowBox[{
      RowBox[{"vars_", " ", "in", " ", 
       RowBox[{"IntegralOp", "[", 
        RowBox[{"vars", ",", "integrand"}], "]"}], " ", "when", " ", "vars_", 
       " ", "have", " ", "coefficients", " ", 
       RowBox[{"attached", ".", "  ", "The"}], " ", "integrand", " ", "is", 
       " ", "compensated", " ", "for", " ", "coefficients", " ", "of", " ", 
       RowBox[{"var", ".", " ", "The"}], " ", "optional", " ", "vRule_", " ", 
       "is", " ", "to", " ", "change", " ", "the", " ", "limits", " ", "of", 
       " ", "the", " ", "integration", " ", "in", " ", "case", " ", "it", " ",
        "is", " ", "a", " ", "function", " ", "of", " ", "another", " ", 
       RowBox[{"variable", ".", "\[IndentingNewLine]", 
        RowBox[{"Usage", ":", " ", "tmp"}]}]}], "/.", 
      RowBox[{
       RowBox[{"int", ":", 
        RowBox[{"IntegralOp", "[", 
         RowBox[{"a_", ",", "b_"}], "]"}]}], ":>", 
       RowBox[{
        RowBox[{
         RowBox[{"simpleIntegralOpVar", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"ku1", "[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2"}], "}"}], "]"}], ",", 
             RowBox[{"ku1", "[", 
              RowBox[{"{", 
               RowBox[{"3", ",", "4"}], "}"}], "]"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"tp", "->", "t"}]}], " ", "]"}], "[", " ", "int", " ", 
         "]"}], "  ", "/;", 
        RowBox[{"!", 
         RowBox[{
          RowBox[{"FreeQ", "[", 
           RowBox[{"a", ",", 
            RowBox[{"ku1", "[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "2"}], "}"}], "]"}]}], "]"}], "   ", "*", 
          "26", "Apr2014"}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simpleIntegralOpVar", "[", 
      RowBox[{"var_", ",", 
       RowBox[{"vRule_:", 
        RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_IntegralOp", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ",", "intvars", ",", "newv", ",", 
        "integrand", ",", "apply", ",", "vfact"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"intvars", ",", "integrand"}], "}"}], "=", 
        RowBox[{"Apply", "[", 
         RowBox[{"List", ",", "exp"}], "]"}]}], ";", 
       RowBox[{"xPrint", "[", 
        RowBox[{"{", 
         RowBox[{"intvars", ",", "integrand"}], "}"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"apply", "[", "v_", "]"}], ":=", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"intvars", "=", 
           RowBox[{"Map", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"FreeQ", "[", 
                 RowBox[{"#", ",", "v"}], "]"}], ",", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{"Do", " ", "nothing"}], "*)"}], 
                "\[IndentingNewLine]", "#", ",", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"factor", " ", "intgrand"}], ",", " ", 
                  RowBox[{"adjust", " ", "limits"}]}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"integrand", " ", "=", 
                  RowBox[{"integrand", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "/.", 
                    RowBox[{"v", "->", "1"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"newv", "=", "#"}], ";", 
                 RowBox[{"vfact", "=", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "/.", 
                    RowBox[{"v", "->", "1"}]}], ")"}]}], ";", 
                 RowBox[{"newv", "=", 
                  RowBox[{"Map", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "/", "vfact"}], "&"}], ",", "newv"}], 
                   "]"}]}], ";", 
                 RowBox[{
                  RowBox[{"newv", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ";;", "3"}], "]"}], "]"}], "=", 
                  RowBox[{
                   RowBox[{"newv", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ";;", "3"}], "]"}], "]"}], "/.", "vRule"}]}],
                  ";", "\[IndentingNewLine]", 
                 RowBox[{"xPrint", "[", 
                  RowBox[{
                  "#", ",", "\"\<:\>\"", ",", "v", ",", "\"\<:\>\"", ",", 
                   "vfact", ",", "\"\<:\>\"", ",", "newv"}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"{", "newv", "}"}]}]}], "]"}], "&"}], ",", 
             "intvars"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"apply", "[", "#", "]"}], "&"}], ",", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "var", "}"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"IntegralOp", "[", 
         RowBox[{"intvars", ",", "integrand"}], "]"}], "/.", 
        "formIntegralOpVar"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "formIntegralOpVar", " ", "is", " ", "a", " ", "Rule", " ", "that", " ", 
     "correctly", " ", "formats", " ", "the", " ", "vars_", " ", "in", " ", 
     RowBox[{"IntegralOp", "."}], " ", "*", "29", "May2014"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"formIntegralOpVar", ":=", 
    RowBox[{
     RowBox[{"IntegralOp", "[", 
      RowBox[{"var_List", ",", "grand_"}], "]"}], ":>", 
     RowBox[{"IntegralOp", "[", 
      RowBox[{
       RowBox[{"Sort", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "#", "}"}], "]"}], "&"}], "/@", "var"}], "]"}], ",", 
       "grand"}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"TotalDiffByParts", "[", 
       RowBox[{"productexp_", ",", " ", "derivative_"}], "]"}], " ", 
      "generates", " ", "a", " ", "expression", " ", "generated", " ", "by", 
      " ", "differentiating", " ", "by", " ", "parts", " ", "where", " ", 
      "productexp_", " ", "is", " ", "the", " ", "expression", " ", "to", " ",
       "be", " ", "converted", " ", "into", " ", "a", " ", "sum", " ", "of", 
      " ", "two", " ", "expressions"}], " ", "\[Rule]", " ", 
     RowBox[{
      RowBox[{"TotalDerivative", " ", "-", " ", 
       RowBox[{
        RowBox[{"Derivative", "[", 
         RowBox[{"term", "-", "derivative_"}], "]"}], " ", "derivative_.", 
        " ", "\[IndentingNewLine]", "derivative_", " ", "defines", " ", "the",
         " ", "differential", " ", "used", " ", "for", " ", 
        RowBox[{"conversion", ".", "  ", "Handles"}], " ", "Times"}]}], "|", 
      "Dot", "|", 
      RowBox[{"xDot", " ", 
       RowBox[{"productexp_", "'"}], 
       RowBox[{"s", "."}], " ", "*", "15", "Jul2014"}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTotalDiffByParts", "::", "usage"}], "=", 
     "\"\<tuTotalDiffByParts[productexp_,derivative_] generates a expression \
generated by differentiating productexp_ by parts. productexp_ is converted \
into a sum of two expressions: DD[TotalDerivative] - \
Derivative[productexp_[without derivative_]] derivative_.  The differential \
operator in derivative_ is used for the resulting expression.  Handles \
Times|Dot|xDot|CenterDot productexp_'s. EG: tuTotalDiffByParts[a \
tuDPartial[b,x], tuDPartial[,x]] \[LongRightArrow] DD[tuDPartial[a b, x]] - b \
tuDPartial[a,x].  *15Jul2014*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTotalDiffByParts", "[", 
      RowBox[{"productexp_", ",", " ", "derivative_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "productexp"}], ",", "var", ",", "f1", ",", 
         "tmp2", ",", "tmp3", ",", 
         RowBox[{"dHead", "=", 
          RowBox[{"Head", "[", "derivative", "]"}]}], ",", 
         RowBox[{"OP", "=", 
          RowBox[{"Times", "|", "Dot", "|", "xDot", "|", "CenterDot"}]}], ",",
          "xOP", ",", "$s", ",", "$placeholder"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"f1", ",", "var"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "derivative"}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"break", " ", "out", " ", "derivative", " ", "arguements"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"op", ":", "OP"}], "->", 
           RowBox[{"xOP", "[", "op", "]"}]}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"Freeze", " ", "OPs", " ", "ordering"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{"derivative", "\[Rule]", "f1"}], "/.", 
          RowBox[{
           RowBox[{"op", ":", "OP"}], "->", 
           RowBox[{"xOP", "[", "op", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"tmp2", "=", 
         RowBox[{"tmp", "/.", "$s"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{"derivative", "\[Rule]", "$placeholder"}], "/.", 
          RowBox[{
           RowBox[{"op", ":", "OP"}], "->", 
           RowBox[{"xOP", "[", "op", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"tmp3", "=", 
         RowBox[{"tmp", "/.", "$s"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp3", "=", 
         RowBox[{
          RowBox[{"dHead", "[", 
           RowBox[{"tmp3", ",", "var"}], "]"}], "//.", 
          RowBox[{
           RowBox[{"xOP", "[", "op_", "]"}], "->", "op"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp3", "=", 
         RowBox[{"tmp3", "//", 
          RowBox[{"tuDerivativeExpand", "[", 
           RowBox[{"{", "$placeholder", "}"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp3", "=", 
         RowBox[{"tmp3", "/.", 
          RowBox[{"$placeholder", "->", "f1"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp2", "=", 
         RowBox[{
          RowBox[{"dHead", "[", 
           RowBox[{"tmp2", ",", "var"}], "]"}], "//.", 
          RowBox[{
           RowBox[{"xOP", "[", "op_", "]"}], "->", "op"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"Replace", " ", "OPs"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{
          RowBox[{"DD", "[", "tmp2", "]"}], "-", " ", "tmp3"}], "]"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTotalDiffByPartsConvert", "::", "usage"}], "=", 
     "\"\<tuTotalDiffByPartsConvert[productexp_, derivative_] converts a \
product expression productexp_ by tuTotalDiffByParts[] applied to derivative_ \
term within productexp_.  Returns Rule[] productexp_ \[Rule] (equivalent \
expression where DD[] identifies the total derivative term). \
*22Feb2019*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTotalDiffByPartsConvert", "[", 
      RowBox[{"productexp_", ",", " ", "derivative_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "$", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"productexp", "/.", 
          RowBox[{"derivative", "->", 
           RowBox[{"derivative", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"tuTotalDiffByParts", "[", 
           RowBox[{"$", ",", "derivative"}], "]"}], "\[Rule]", "0"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tuRuleSolve", "[", 
         RowBox[{"$", ",", "productexp"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTotalDiffByParts0", "::", "usage"}], "=", 
     "\"\<tuTotalDiffByParts[productexp_,derivative_] generates an equivalent \
expression for productexp_ which is generated by differentiating by parts. \
productexp_ is the expression to be converted into a sum of two expressions: \
{TotalDerivative-Derivative[coefficient of derivative_] derivative_}. \
\[IndentingNewLine]derivative_ defines the differential used for conversion.  \
Handles Times|Dot|xDot|CenterDot productexp_'s. Power[derivative_,_] \
expressions result in xDot[] expressions. The DD[] term is the total \
derivative.  *23Dec2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTotalDiffByParts0", "[", 
      RowBox[{"productexp_", ",", " ", "derivative_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "productexp"}], ",", "var", ",", "f1", ",", 
         "tmp2", ",", "tmp3", ",", 
         RowBox[{"dHead", "=", 
          RowBox[{"Head", "[", "derivative", "]"}]}], ",", 
         RowBox[{"OP", "=", 
          RowBox[{"Times", "|", "Dot", "|", "xDot", "|", "CenterDot"}]}], ",",
          "xOP", ",", "$s", ",", "$p", ",", "$p0", ",", "totD"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"f1", ",", "var"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "derivative"}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"break", " ", "out", " ", "derivative", " ", "arguements"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"op", ":", "OP"}], "->", 
           RowBox[{"xOP", "[", "op", "]"}]}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"Freeze", " ", "OPs", " ", "ordering"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "factor", " ", "one", " ", "derivative", " ", "in", " ", "Power", 
          " ", 
          RowBox[{"expression", ".", " ", "Connect"}], " ", "with", " ", 
          "xDot", " ", "to", " ", "be", " ", "dealt", " ", "with", " ", 
          "later"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"tmp", "/.", 
           RowBox[{"Power", "\[Rule]", "xPower"}]}], "/.", 
          RowBox[{
           RowBox[{"xPower", "[", 
            RowBox[{
             RowBox[{"dd", ":", "derivative"}], ",", "n_"}], "]"}], 
           "\[RuleDelayed]", 
           RowBox[{"xDot", "[", 
            RowBox[{"dd", ",", 
             RowBox[{"xPower", "[", 
              RowBox[{"dd", ",", 
               RowBox[{"n", "-", "1"}]}], "]"}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$p", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", "derivative", "]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{"derivative", "\[Rule]", "f1"}], "/.", 
          RowBox[{
           RowBox[{"op", ":", "OP"}], "->", 
           RowBox[{"xOP", "[", "op", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"$p0", "=", 
         RowBox[{
          RowBox[{"$p", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"$p", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "/.", "$s"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"$p0", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "=", "1"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "replace", " ", "only", " ", "first", " ", "occurance", " ", "of", 
          " ", "derivative"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp2", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"tmp", ",", "$p"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp3", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"tmp", ",", 
           RowBox[{"{", "$p0", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp3", "=", 
         RowBox[{"f1", " ", 
          RowBox[{"dHead", "[", 
           RowBox[{"tmp3", ",", "var"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"totD", "=", 
         RowBox[{
          RowBox[{"dHead", "[", 
           RowBox[{"tmp2", ",", "var"}], "]"}], "/.", 
          RowBox[{
           RowBox[{"xOP", "[", "op_", "]"}], "->", "op"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp3", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"DD", "[", "totD", "]"}], "-", "tmp3"}], "/.", 
           RowBox[{
            RowBox[{"xOP", "[", "op_", "]"}], "->", "op"}]}], "/.", 
          RowBox[{"xPower", "\[Rule]", "Power"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"TotalDiffByParts1", "[", 
       RowBox[{"productexp_", ",", " ", "derivative_"}], "]"}], " ", 
      "generates", " ", "a", " ", "expression", " ", "generated", " ", "by", 
      " ", "differentiating", " ", "by", " ", "parts", " ", "where", " ", 
      "productexp_", " ", "is", " ", "the", " ", "expression", " ", "to", " ",
       "be", " ", "converted", " ", "into", " ", "a", " ", "sum", " ", "of", 
      " ", "two", " ", "expressions"}], "\[Rule]", 
     RowBox[{
      RowBox[{"total", " ", "derivative"}], " ", "+", " ", 
      RowBox[{
      "term", " ", "with", " ", "double", " ", "derivative_.", " ", 
       "\[IndentingNewLine]", "derivative_", " ", "is", " ", "the", " ", 
       "differential", " ", "used", " ", "for", " ", 
       RowBox[{"conversion", ".", " ", "Corrected"}], " ", "to", " ", 
       "include", " ", "proper", " ", "handling", " ", "of", " ", 
       RowBox[{"OP", "'"}], "s", " ", 
       RowBox[{"terms", ".", " ", "Terms"}], " ", "with", " ", 
       RowBox[{"Dot", "[", "]"}], " ", "are", " ", "treated", " ", 
       RowBox[{"simply", "."}], "  ", "*", "22", "Mar2014"}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"TotalDiffByParts1", "[", 
       RowBox[{"productexp_", ",", " ", "derivative_"}], "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"tmp", "=", "productexp"}], ",", "var", ",", "f1", ",", 
          "tmp1", ",", "tmp2", ",", "tmp3", ",", 
          RowBox[{"dHead", "=", 
           RowBox[{"Head", "[", "derivative", "]"}]}], ",", "xderiv", ",", 
          "dLocCheck", ",", 
          RowBox[{"OP", "=", 
           RowBox[{"Times", "|", "Dot", "|", "xDot"}]}], ",", "xOP", ",", 
          "head", ",", "terms", ",", "with", ",", "without", ",", "g", ",", 
          "f", ",", "gdf", ",", "dfg", ",", 
          RowBox[{"DEBUG", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f1", ",", "var"}], "}"}], "=", 
          RowBox[{"Apply", "[", 
           RowBox[{"List", ",", "derivative"}], "]"}]}], ";", 
         RowBox[{"(*", 
          RowBox[{"break", " ", "out", " ", "derivative", " ", "arguements"}],
           "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"in", " ", "case", " ", 
           RowBox[{"\[Exists]", " ", 
            RowBox[{
            "power", " ", "of", " ", "derivative", " ", "use", " ", "only", 
             " ", "one"}]}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"tmp2", "=", 
          RowBox[{"tmp", "/.", 
           RowBox[{"derivative", "\[Rule]", "f1"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"for", " ", "more", " ", "complex", " ", "derivatives"}], 
           ",", " ", 
           RowBox[{"but", " ", "not", " ", "mixed", " ", 
            RowBox[{"operations", ":", " ", "Times"}]}], ",", " ", "Dot"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"head", "=", 
          RowBox[{"Head", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"terms", "=", 
          RowBox[{"Apply", "[", 
           RowBox[{"List", ",", "tmp"}], "]"}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"with", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"Apply", "[", 
             RowBox[{"head", ",", 
              RowBox[{"Select", "[", 
               RowBox[{"terms", ",", 
                RowBox[{
                 RowBox[{"!", 
                  RowBox[{"FreeQ", "[", 
                   RowBox[{"#", ",", "f1"}], "]"}]}], "&"}]}], "]"}]}], "]"}],
             "/.", 
            RowBox[{"f1", "->", 
             RowBox[{"f1", "[", "var", "]"}]}]}], "/.", 
           RowBox[{"xPartialD", "->", "D"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"f", "=", 
          RowBox[{"Apply", "[", 
           RowBox[{"head", ",", 
            RowBox[{"Select", "[", 
             RowBox[{"terms", ",", 
              RowBox[{
               RowBox[{"FreeQ", "[", 
                RowBox[{"#", ",", "f1"}], "]"}], "&"}]}], "]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"g", "=", 
          RowBox[{"Integrate", "[", 
           RowBox[{"with", ",", "var"}], "]"}]}], " ", ";", 
         RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"gdf", "=", 
          RowBox[{"head", "[", 
           RowBox[{"g", ",", 
            RowBox[{
             RowBox[{"Head", "[", "derivative", "]"}], "[", 
             RowBox[{"f", ",", "var"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dfg", "=", 
          RowBox[{
           RowBox[{"Head", "[", "derivative", "]"}], "[", 
           RowBox[{
            RowBox[{"head", "[", 
             RowBox[{"f", ",", "g"}], "]"}], ",", "var"}], "]"}]}], ";", 
         RowBox[{"(*", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<tmp: \>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"FreeQ", "[", 
            RowBox[{"tmp", ",", 
             RowBox[{"Dot", "|", "xDot"}]}], "]"}], "\[IndentingNewLine]", 
           ",", 
           RowBox[{"tmp", "=", 
            RowBox[{"dfg", "-", "gdf"}]}], " ", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "This", " ", "is", " ", "result", " ", "if", " ", "no", " ", 
              "Dot"}], "|", 
             RowBox[{
             "xDot", " ", "is", " ", "not", " ", "involved", " ", "in", " ", 
              RowBox[{"IBP", "."}]}]}], "*)"}], "\[IndentingNewLine]", ",", 
           RowBox[{"(*", 
            RowBox[{
            "The", " ", "following", " ", "is", " ", "simplistic", " ", "IBP",
              " ", "for", " ", "Dotted", " ", 
             RowBox[{"expressions", "."}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"tmp", "=", 
             RowBox[{"tmp", "/.", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"a", ":", "derivative"}], ")"}], "^", "n_"}], 
               "\[RuleDelayed]", 
               RowBox[{"a", " ", 
                RowBox[{"xderiv", "^", 
                 RowBox[{"(", 
                  RowBox[{"n", "-", "1"}], ")"}]}]}]}]}]}], ";", 
            RowBox[{"(*", "CHECK", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"tmp1", "=", 
             RowBox[{"tmp", "/.", 
              RowBox[{"derivative", "\[Rule]", "dLocCheck"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"xPrint", "[", 
             RowBox[{
             "\"\<>>\>\"", ",", "tmp", ",", "\"\<:\>\"", ",", "derivative", 
              ",", "\"\<:\>\"", ",", "dHead", ",", "\"\<:\>\"", ",", "tmp1"}],
              "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"FreeQ", "[", 
                RowBox[{"tmp1", ",", "dLocCheck"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "find", " ", "immediate", " ", "operator", " ", "for", " ", 
                "dLocCheck"}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"tmp3", "=", 
                RowBox[{"tmp1", "/.", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"op", ":", "OP"}], ")"}], "[", 
                   RowBox[{"a___", ",", "dLocCheck", ",", "b___"}], "]"}], "->", 
                  RowBox[{"xOP", "[", "op", "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"tmp3", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ExtractPattern", "[", 
                   RowBox[{"xOP", "[", "_", "]"}], "]"}], "[", "tmp3", "]"}], 
                 "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ";", 
               RowBox[{"xPrint", "[", 
                RowBox[{
                "\"\<tmp3: \>\"", ",", "\"\<  >>\>\"", ",", "tmp3", ",", 
                 "\"\<<< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"tmp3", "=", 
                RowBox[{
                 RowBox[{"tmp3", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"dHead", "[", 
                  RowBox[{"tmp1", ",", "var"}], "]"}], "]"}]}], ";", 
               RowBox[{"xPrint", "[", 
                RowBox[{
                "\"\<tmp3: \>\"", ",", "\"\<  >>\>\"", ",", "tmp3", ",", 
                 "\"\<<< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"tmp3", "=", 
                RowBox[{"tmp3", "//", 
                 RowBox[{"tuDerivativeExpand", "[", 
                  RowBox[{"{", "dLocCheck", "}"}], "]"}]}]}], ";", 
               RowBox[{"xPrint", "[", 
                RowBox[{
                "\"\<tmp3: \>\"", ",", "\"\<  >>\>\"", ",", "tmp3", ",", 
                 "\"\<<< \>\""}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"tmp3", "=", 
                RowBox[{"tmp3", "/.", 
                 RowBox[{"dLocCheck", "->", "f1"}]}]}], ";", 
               RowBox[{"xPrint", "[", 
                RowBox[{
                "\"\<tmp3: \>\"", ",", "f1", ",", "\"\< : \>\"", ",", "tmp1", 
                 ",", "\"\<  >>\>\"", ",", "tmp3", ",", "\"\<<< \>\""}], 
                "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"tmp", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"dHead", "[", 
                   RowBox[{"tmp2", ",", "var"}], "]"}], "-", "tmp3"}], "//", 
                 RowBox[{"simpleDot3", "[", 
                  RowBox[{"{", "}"}], "]"}]}]}], ";", 
               RowBox[{"(*", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"DEBUG", ">", "0"}], ",", 
                   RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<>>f1 \>\"", ",", "tmp", ",", "\"\<:\>\"", ",", 
                    "tmp1", ",", "\"\<:\>\"", ",", "tmp2", ",", "\"\<:\>\"", 
                    ",", "f1"}], "]"}]}], "]"}], ";"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"tmp", "=", 
                RowBox[{"tmp", "/.", 
                 RowBox[{"xderiv", "\[Rule]", "derivative"}]}]}], ";"}], 
              RowBox[{"(*", "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<TotalDiffByParts1: \>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{
                  "derivative", ",", "tmp", ",", "f1", ",", "var", ",", 
                   "tmp1", ",", "tmp2"}], "}"}]}], "]"}], "*)"}], 
              "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
              RowBox[{"tmp", "=", "productexp"}]}], "\[IndentingNewLine]", 
             "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
     ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Generates", " ", "a", " ", "list", " ", "from", " ", "pure", " ", 
     "product", " ", "of", " ", "terms", " ", "including", " ", "Power", " ", 
     "terms", " ", "with", " ", "defined", " ", 
     RowBox[{"power", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Product2List", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FreeQ", "[", 
          RowBox[{"exp", ",", "Plus"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"exp", "/.", 
            RowBox[{
             RowBox[{"Power", "[", 
              RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
             RowBox[{"DotPower", "[", 
              RowBox[{"a", ",", "b"}], "]"}]}]}], "/.", 
           RowBox[{"Times", "->", "Dot"}]}], "/.", 
          RowBox[{"Dot", "->", "List"}]}], ",", "\[IndentingNewLine]", 
         "exp"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "gatherDerivOp", " ", "is", " ", "a", " ", "Rule", " ", "that", " ", 
      "gathers", " ", "DerivOps", " ", "into", " ", "one", " ", 
      RowBox[{"DerivOp", ".", "  ", 
       RowBox[{"Usage", ":", " ", "exp_"}]}]}], "//.", 
     RowBox[{
      RowBox[{"gatherDerivOp", ".", "\[IndentingNewLine]", "Eg", ".", " ", 
       RowBox[{"-", "\[ImaginaryI]"}]}], " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         InterpretationBox[
          RowBox[{
           SubscriptBox[
            UnderscriptBox["\"\<\[PartialD]\>\"", "_"], "t"], "[", 
           RowBox[{
            SuperscriptBox["J", "-"], "[", "t", "]"}], "]"}],
          $CellContext`xPartialD[
           SuperMinus[$CellContext`J][$CellContext`t], $CellContext`t],
          Editable->False,
          SyntaxForm->Automatic], "-", 
         InterpretationBox[
          RowBox[{
           SubscriptBox[
            UnderscriptBox["\"\<\[PartialD]\>\"", "_"], "t"], "[", 
           RowBox[{
            SuperscriptBox["J", "+"], "[", "t", "]"}], "]"}],
          $CellContext`xPartialD[
           SuperPlus[$CellContext`J][$CellContext`t], $CellContext`t],
          Editable->False,
          SyntaxForm->Automatic]}], ")"}], "\[LongRightArrow]", 
       RowBox[{
        SubscriptBox[
         UnderscriptBox["\"\<\[PartialD]\>\"", "_"], "t"], "[", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SuperscriptBox["J", "-"], "[", "t", "]"}], "-", 
           RowBox[{
            SuperscriptBox["J", "+"], "[", "t", "]"}]}], ")"}]}], "]"}]}], 
      "  ", "*", "10", "Jul2014"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gatherDerivOp", ":=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"a_", " ", 
         RowBox[{
          RowBox[{"(", " ", 
           RowBox[{"dd", ":", "DerivOps"}], ")"}], "[", 
          RowBox[{"b_", ",", "c_"}], "]"}]}], "->", 
        RowBox[{"dd", "[", 
         RowBox[{
          RowBox[{"a", " ", "b"}], ",", "c"}], "]"}]}], ",", 
       "\[IndentingNewLine]", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", " ", 
           RowBox[{"dd", ":", "DerivOps"}], ")"}], "[", 
          RowBox[{"b_", ",", "a_"}], "]"}], "+", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"dd", ":", "DerivOps"}], ")"}], "[", 
          RowBox[{"c_", ",", "a_"}], "]"}]}], "->", 
        RowBox[{"dd", "[", " ", 
         RowBox[{
          RowBox[{"c", "+", " ", "b"}], ",", "a"}], "]"}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Expansion", " ", "Rules", " ", "for", " ", "various", " ", 
     "Differentials", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"xD", "[", "_", "]"}], ",", "xPartialD", ",", "xCovariantD"}], 
      "}"}], " ", 
     RowBox[{"etc", "."}], " ", "*", "5", "Aug2012"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"xPartialDExpand", "[", "constants_List", "]"}], ":=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tuPartialD", ",", "tuPartialDu", ",", 
        RowBox[{"DifExpand", "[", 
         RowBox[{
          RowBox[{"xPartialD", "|", "xPartialDu"}], ",", "constants"}], 
         "]"}]}], "}"}], "//", "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xCovariantDExpand", "[", "constants_List", "]"}], ":=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"DifExpand", "[", 
       RowBox[{
        RowBox[{"xCovariantD", "|", "xCovariantDu"}], ",", "constants"}], 
       "]"}], "}"}], "//", "Flatten"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xLieDExpand", "[", "constants_List", "]"}], ":=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"DifExpand", "[", 
        RowBox[{"xLieD", ",", "constants"}], "]"}], "}"}], "//", 
      "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xD\[Delta]Expand", "[", "constants_List", "]"}], ":=", 
     RowBox[{
      RowBox[{"DifExpand", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"xD", "[", "_", "]"}], "|", 
         RowBox[{"xDu", "[", "_", "]"}]}], ",", "constants"}], "]"}], "//", 
      "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"Multiple", " ", "differential", " ", "expansion", " ", "Rule"}], 
    "  ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ExpandDerivDvar", ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"head", ":", "tuDExpand"}], ")"}], "[", 
         RowBox[{"a_", ",", "b_List"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"head", "[", 
          RowBox[{
           RowBox[{"head", "[", 
            RowBox[{"a", ",", 
             RowBox[{"First", "[", "b", "]"}]}], "]"}], ",", 
           RowBox[{"Rest", "[", "b", "]"}]}], "]"}], "/;", 
         RowBox[{
          RowBox[{"Length", "[", "b", "]"}], ">", "1"}]}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"head", ":", "DerivOps"}], ")"}], "[", 
         RowBox[{"a_", ",", "b_List"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"head", "[", 
          RowBox[{"a", ",", 
           RowBox[{"b", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "/;", 
         RowBox[{
          RowBox[{"Length", "[", "b", "]"}], "==", "1"}]}]}]}], "}"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tudExpand", "::", "usage"}], "=", 
     "\"\<tudExpand[\[Delta]1_,constants_List:{}][exp_] expands differential \
operator \[Delta]1_ using basic Liebnitz Rule[]s. \
*29Nov2012*12Nov2017*3Sep2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tudExpand", "[", 
       RowBox[{"\[Delta]1_", ",", 
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "sub", ",", "name", ",", "tmp0", 
         ",", "$dum", ",", "n$", ",", 
         RowBox[{"ProductOp", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{
           "BraKet", "|", "Times", "|", "dotOps", "|", "Wedge", "|", "xWedge",
             "|", "CircleTimes"}], "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sub", "=", 
         RowBox[{
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", "a_", "]"}], ":>", 
             RowBox[{"0", "/;", 
              RowBox[{"NumericQ", "[", "a", "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", "a_", "]"}], ":>", 
             RowBox[{"0", "/;", 
              RowBox[{"ListMemberQ", "[", 
               RowBox[{"a", ",", "constants"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{"a_", "^", "n_"}], "]"}], ":>", 
             RowBox[{"0", "/;", 
              RowBox[{
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "constants"}], "]"}], "&&", 
               RowBox[{"NumericQ", "[", "n", "]"}]}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{"1", "/", "a_"}], "]"}], ":>", 
             RowBox[{"0", "/;", 
              RowBox[{"ListMemberQ", "[", 
               RowBox[{"a", ",", "constants"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{"1", "/", 
               RowBox[{"a_", "^", "n_"}]}], "]"}], ":>", 
             RowBox[{"0", "/;", 
              RowBox[{
               RowBox[{"ListMemberQ", "[", 
                RowBox[{"a", ",", "constants"}], "]"}], "&&", 
               RowBox[{"NumericQ", "[", "n", "]"}]}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{"Conjugate", "[", "a_", "]"}], "]"}], ":>", 
             RowBox[{"Conjugate", "[", 
              RowBox[{"name", "[", "a", "]"}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{"ConjugateTranspose", "[", "a_", "]"}], "]"}], ":>", 
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{"name", "[", "a", "]"}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{"Transpose", "[", "a_", "]"}], "]"}], ":>", 
             RowBox[{"Transpose", "[", 
              RowBox[{"name", "[", "a", "]"}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{"Tr", "[", "a_", "]"}], "]"}], "\[RuleDelayed]", 
             RowBox[{"Tr", "[", 
              RowBox[{"name", "[", "a", "]"}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", "a__", "]"}], ":>", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"name", "[", "a", "]"}], "]"}], "/;", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Head", "[", "a", "]"}], "==", "List"}], ")"}]}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"OP", ":", "DerivOps"}], ")"}], "[", 
               RowBox[{"T_", ",", "i___"}], "]"}], "]"}], "\[Rule]", 
             RowBox[{"OP", "[", 
              RowBox[{
               RowBox[{"name", "[", "T", "]"}], ",", "i"}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{"Exp", "[", "a_", "]"}], "]"}], "->", 
             RowBox[{
              RowBox[{"Exp", "[", "a", "]"}], " ", 
              RowBox[{"name", "[", "a", "]"}]}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{"Log", "[", "a_", "]"}], "]"}], "->", " ", 
             RowBox[{
              RowBox[{"name", "[", "a", "]"}], "/", "a"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{"a_", "^", "n_"}], "]"}], "\[RuleDelayed]", 
             RowBox[{"n", " ", 
              RowBox[{"name", "[", "a", "]"}], 
              RowBox[{"a", "^", 
               RowBox[{"(", 
                RowBox[{"n", "-", "1"}], ")"}]}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"tt", ":", 
                 RowBox[{"Apply", "[", 
                  RowBox[{"Alternatives", ",", "tuTrigFunc"}], "]"}]}], ")"}],
                "[", "t_", "]"}], "]"}], "\[RuleDelayed]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"D", "[", 
                 RowBox[{
                  RowBox[{"tt", "[", "$dum", "]"}], ",", "$dum"}], "]"}], 
                RowBox[{"name", "[", "t", "]"}]}], "/.", 
               RowBox[{"$dum", "\[Rule]", "t"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"0", "&"}], "->", "0"}], ")"}], " ", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
               RowBox[{"in", " ", "case", " ", "\[Delta]1", " ", "is", " ", 
                RowBox[{"Derivative", "[", "1", "]"}], " ", "which", " ", 
                "produces", " ", "0"}], "&"}], " ", "for", " ", 
              RowBox[{"NumberQ", "."}]}], " ", "*)"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"ww", ":", 
                 RowBox[{"Wedge", "|", "xWedge"}]}], ")"}], "[", 
               RowBox[{"a_", ",", "b__"}], "]"}], "]"}], "\[Rule]", 
             RowBox[{
              RowBox[{"ww", "[", 
               RowBox[{
                RowBox[{"name", "[", "a", "]"}], ",", "b"}], "]"}], "+", 
              RowBox[{"ww", "[", 
               RowBox[{"a", ",", 
                RowBox[{"ww", "[", "b", "]"}]}], "]"}]}]}]}], 
           "\[IndentingNewLine]", "}"}], "//", "Flatten"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
               RowBox[{"a_", " ", "+", "  ", "b_"}], "]"}], "\[Rule]", 
              RowBox[{
               RowBox[{"name", "[", "a", "]"}], "+", " ", 
               RowBox[{"name", "[", "b", "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"name", ":", "\[Delta]1"}], ")"}], "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"oo", ":", "ProductOp"}], ")"}], "[", 
                RowBox[{"a_", "  ", ",", "b__"}], "]"}], "]"}], ":>", 
              RowBox[{
               RowBox[{"oo", "[", 
                RowBox[{
                 RowBox[{"name", "[", "a", "]"}], ",", "b"}], "]"}], "+", 
               RowBox[{"oo", "[", 
                RowBox[{"a", " ", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "b", "}"}], "]"}], ">", "1"}], ",", 
                   RowBox[{"name", "[", 
                    RowBox[{"oo", "[", "b", "]"}], "]"}], ",", 
                   RowBox[{"name", "[", "b", "]"}]}], "]"}]}], "]"}]}]}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", "sub"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Use", " ", "Mathematica", " ", "Dt", " ", "function"}], 
             " ", "\[Implies]", " ", 
             RowBox[{"some", " ", "Rules", " ", 
              RowBox[{"obsolete", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "Cludge", " ", "code", " ", "to", " ", "handle", " ", "the", " ",
               "hidden", " ", "variables", " ", "properly", " ", "with", " ", 
              "Dt"}], ",", " ", 
             RowBox[{"i", ".", "e", "."}], ",", " ", 
             RowBox[{
              RowBox[{"Dt", "[", 
               RowBox[{"f", "[", "1", "]"}], "]"}], "\[Rule]", "0"}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<0:\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dname", ":", "\[Delta]1"}], ")"}], "[", "a_", "]"}], 
              "\[RuleDelayed]", " ", 
              RowBox[{"dname", "[", 
               RowBox[{"a", "/.", " ", 
                RowBox[{
                 RowBox[{"h_", "[", 
                  RowBox[{"n_", "?", "NumberQ"}], "]"}], "\[Rule]", 
                 RowBox[{"h", "[", 
                  RowBox[{"n", ",", "n$"}], "]"}]}]}], "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tmp", "/.", " ", 
              RowBox[{"\[Delta]1", "\[Rule]", "Dt"}]}], "/.", 
             RowBox[{"Dt", "\[Rule]", "$Dt"}]}]}], ";", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<1:\>\"", ",", 
               RowBox[{"$tmp", "=", "tmp"}]}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"$Dt", "[", "n$", "]"}], 
                RowBox[{
                 RowBox[{
                  RowBox[{"Derivative", "[", 
                   RowBox[{"0", ",", "1"}], "]"}], "[", "z_", "]"}], "[", 
                 RowBox[{
                  RowBox[{"m_", "?", "NumberQ"}], ",", "n$"}], "]"}]}], ")"}],
               ":>", 
              RowBox[{"\[Delta]1", "[", 
               RowBox[{"z", "[", "m", "]"}], "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"$Dt", "[", "n$", "]"}], 
                 RowBox[{"n_:", "1"}]], 
                SuperscriptBox[
                 RowBox[{
                  RowBox[{
                   RowBox[{"Derivative", "[", 
                    RowBox[{"0", ",", "1"}], "]"}], "[", "z_", "]"}], "[", 
                  RowBox[{
                   RowBox[{"m_", "?", "NumberQ"}], ",", "n$"}], "]"}], 
                 RowBox[{"nn_:", "1"}]]}], ")"}], ":>", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"\[Delta]1", "[", 
                 RowBox[{"z", "[", "m", "]"}], "]"}], "nn"], 
               SuperscriptBox[
                RowBox[{"$Dt", "[", "n$", "]"}], 
                RowBox[{"n", "-", "nn"}]]}]}]}]}], ";", "\[IndentingNewLine]",
            "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"fn_", "[", 
                 SuperscriptBox[
                  RowBox[{"$Dt", "[", "n$", "]"}], 
                  RowBox[{"n_:", "1"}]], "]"}], 
                RowBox[{"fn_", "[", 
                 SuperscriptBox[
                  RowBox[{
                   RowBox[{
                    RowBox[{"Derivative", "[", 
                    RowBox[{"0", ",", "1"}], "]"}], "[", "z_", "]"}], "[", 
                   RowBox[{
                    RowBox[{"m_", "?", "NumberQ"}], ",", "n$"}], "]"}], 
                  RowBox[{"nn_:", "1"}]], "]"}]}], ")"}], "\[RuleDelayed]", 
              RowBox[{"fn", "[", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"\[Delta]1", "[", 
                  RowBox[{"z", "[", "m", "]"}], "]"}], "nn"], 
                SuperscriptBox[
                 RowBox[{"$Dt", "[", "n$", "]"}], 
                 RowBox[{"n", "-", "nn"}]]}], "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<2:\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tmp", "//.", 
              RowBox[{
               RowBox[{"z_", "[", 
                RowBox[{
                 RowBox[{"n_", "?", "NumberQ"}], ",", "n$"}], "]"}], ":>", 
               RowBox[{"z", "[", "n", "]"}]}]}], "/.", 
             RowBox[{"$Dt", "\[Rule]", "\[Delta]1"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<3:\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Derivative", "[", "__", "]"}], "[", "dForm", "]"}], 
               "[", "__", "]"}], "\[Rule]", "0"}]}]}]}]}], 
         RowBox[{"(*", 
          RowBox[{"special", " ", "for", " ", "dForm"}], "*)"}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tudExpandvI", "::", "usage"}], "=", 
     "\"\<tudExpandvI[ops_,constants_List:{}] wrapper for tudExpand[]. Calls  \
tuOpIndependentVar[tudExpand,op$[ops,constants][exp]].  NOTE: does not handle \
IndependentVars in constants_List. *13Nov2018*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tudExpandvI", "[", 
       RowBox[{"ops_", ",", 
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"tuOpIndependentVar", "[", 
        RowBox[{"tudExpand", ",", 
         RowBox[{
          RowBox[{"op$", "[", 
           RowBox[{"ops", ",", "constants"}], "]"}], "[", "exp", "]"}]}], 
        "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tudFnc", "::", "usage"}], "=", 
     "\"\<tudFnc[var_,dOp_:d,constants_:{}][exp_] apply dOp_ via \
tuDExpandF[dOp,constants] and then does d[exp_]->D[exp_,var] dOp_[var]. var_ \
can be a List of var's. Applies tuD2tuDOp[tuDPartial] to result.  \
*22Aug2014*13Dec2017*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tudFnc", "[", 
       RowBox[{"var_", ",", 
        RowBox[{"dOp_:", "d"}], ",", 
        RowBox[{"constants_:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", 
         RowBox[{"vars", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "var", "}"}], "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{
           RowBox[{"tuOpIndependentVar", "[", 
            RowBox[{"tuDExpandF", ",", 
             RowBox[{
              RowBox[{"op$", "[", 
               RowBox[{"dOp", ",", "constants"}], "]"}], "[", "#", "]"}]}], 
            "]"}], "&"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"dOp", "[", "fn_", "]"}], "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{"Apply", "[", 
             RowBox[{"Plus", ",", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"D", "[", 
                   RowBox[{
                    RowBox[{"fn", "[", "#", "]"}], ",", "#"}], "]"}], 
                  RowBox[{"dOp", "[", "#", "]"}]}], "&"}], ",", "vars"}], 
               "]"}]}], "]"}], ")"}]}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"add", " ", 
          RowBox[{"dOp", "[", "var", "]"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "//", 
         RowBox[{"tuD2tuDOp", "[", "tuDPartial", "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"dFnc", "[", 
       RowBox[{"var_", ",", 
        RowBox[{"dOp_:", "d"}], ",", 
        RowBox[{"constants_:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tudFnc", "[", 
       RowBox[{"var", ",", "dOp", ",", "constants"}], "]"}], "[", "exp", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tudFncRule", "::", "usage"}], "=", 
     "\"\<tudFncRule[var_,dOp_:d,constants_:{}] creates Rule for applying \
tudFnc[].  Expands d[ exp_[var_] ] using D[,] operator. Generate D[exp_,var] \
d[var] dOp_ via \[Delta]Exapnd[dOp,constants] and then does \
d[exp_]->D[exp_,var] dOp_[var].  var_ can be a List of var's. NEED TO HIDE \
tuRuleIndependentVarPattern. *22Aug2014*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tudFncRule", "[", 
      RowBox[{"var_", ",", 
       RowBox[{"dOp_:", "d"}], ",", 
       RowBox[{"constants_:", 
        RowBox[{"{", "}"}]}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{"dOp", "[", "exp_", "]"}], "\[RuleDelayed]", 
      RowBox[{
       RowBox[{"tudFnc", "[", 
        RowBox[{"var", ",", "dOp", ",", "constants"}], "]"}], "[", 
       RowBox[{"dOp", "[", "exp", "]"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dFncRule", "[", 
      RowBox[{"var_", ",", 
       RowBox[{"dOp_:", "d"}], ",", 
       RowBox[{"constants_:", 
        RowBox[{"{", "}"}]}]}], "]"}], ":=", 
     RowBox[{"tudFncRule", "[", 
      RowBox[{"var", ",", "dOp", ",", "constants"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"dFncfn", "[", 
       RowBox[{"fn_", ",", 
        RowBox[{"dOp_:", "d"}], ",", 
        RowBox[{"constants_:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], " ", "expands", 
     " ", "exp_", " ", "containing", " ", "term", " ", 
     RowBox[{"d", "[", 
      RowBox[{"fn_", "[", "]"}], "]"}], " ", "and", " ", "expanding", " ", 
     "it", " ", "by", " ", "taking", " ", "derivatives", " ", "of", " ", 
     RowBox[{"fn_", "[", "arg__", "]"}], " ", "for", " ", "each", " ", 
     RowBox[{"arg", ".", " ", "Works"}], " ", "like", " ", "dFnc", " ", "but",
      " ", "by", " ", "function", " ", "name", " ", "fn_.", " ", "*", "29", 
     "Sep2014"}], "*)"}], 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"dFncfn", "[", 
       RowBox[{"fn_", ",", 
        RowBox[{"dOp_:", "d"}], ",", 
        RowBox[{"constants_:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "vars", ",", "narg"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"tmp", "//", 
           RowBox[{
            RowBox[{"Inactive", "[", "tuDExpandF", "]"}], "[", 
            RowBox[{"dOp", ",", "constants"}], "]"}]}], "//", 
          RowBox[{"tuOpIndependentVarActivate", "[", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"vars", "=", 
         RowBox[{
          RowBox[{"tmp", "//", 
           RowBox[{"ExtractPattern", "[", 
            RowBox[{"dOp", "[", 
             RowBox[{"fn", "[", "a__", "]"}], "]"}], "]"}]}], "//", 
          "First"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"vars", "=", 
         RowBox[{
          RowBox[{"vars", "/.", 
           RowBox[{
            RowBox[{"dOp", "[", 
             RowBox[{"fn", "[", "a__", "]"}], "]"}], "\[RuleDelayed]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "a", "}"}], "]"}], ",", "a"}], "}"}]}]}], "//", 
          "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"narg", "=", 
         RowBox[{"Array", "[", 
          RowBox[{"$arg", ",", 
           RowBox[{"vars", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"dOp", "[", 
            RowBox[{"fn", "[", "a__", "]"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"dOp", "[", 
            RowBox[{"fn", "[", 
             RowBox[{"Apply", "[", 
              RowBox[{"Sequence", ",", "narg"}], "]"}], "]"}], "]"}]}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"dOp", "[", 
            RowBox[{"fn", "[", "a__", "]"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"Apply", "[", 
            RowBox[{"Plus", ",", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"D", "[", 
                  RowBox[{
                   RowBox[{"fn", "[", "a", "]"}], ",", "#"}], "]"}], 
                 RowBox[{"dOp", "[", "#", "]"}]}], "&"}], ",", "narg"}], 
              "]"}]}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"narg", "=", 
         RowBox[{
          RowBox[{"narg", "\[Rule]", 
           RowBox[{"Rest", "[", "vars", "]"}]}], "//", "Thread"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "/.", "narg"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuDArgSwitch", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDArgSwitch", "::", "usage"}], "=", 
     "\"\<tuDArgSwitch[derIn_List,derOut_List][exp_] switches order of \
derivative between variables {derIn_,derOut_} in exp_.  The pair of \
derivatives must be adjacent pairs with no other variables in between. i.e., \
tuDPartial[tuDPartialu[A,i],j].  *14Nov2014*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDArgSwitch", "[", 
       RowBox[{"derIn_List", ",", "derOut_List"}], "]"}], "[", "exp_", "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "sub", ",", "XXX"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{"\[Delta]", "[", "a_", "]"}], "\[Rule]", 
           RowBox[{
            RowBox[{"xD", "[", "XXX", "]"}], "[", 
            RowBox[{"a", ",", "XXX"}], "]"}]}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "include", " ", "\[Delta]", " ", "make", " ", "uniform", " ", 
          "arguements"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"IntersectingQ", "[", 
            RowBox[{"derIn", ",", "derOut"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"sub", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"OP1", ":", "DerivOps"}], ")"}], "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"OP2", ":", "DerivOps"}], ")"}], "[", 
                RowBox[{"c_", ",", "d_"}], "]"}], ",", "e_"}], "]"}], 
             "\[RuleDelayed]", 
             RowBox[{
              RowBox[{"OP2", "[", 
               RowBox[{
                RowBox[{"OP1", "[", 
                 RowBox[{"c", ",", "e"}], "]"}], ",", "d"}], "]"}], "/;", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{"derIn", ",", "d"}], "]"}], "&&", 
                RowBox[{"MemberQ", "[", 
                 RowBox[{"derOut", ",", "e"}], "]"}]}], ")"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", "sub", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", "sub"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{"SwitchDerivERROR", "[", 
             RowBox[{"derIn", ",", "derOut"}], "]"}], "[", "tmp", "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"xD", "[", "XXX", "]"}], "[", 
            RowBox[{"a_", ",", "XXX"}], "]"}], "\[Rule]", 
           RowBox[{"\[Delta]", "[", "a", "]"}]}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"SwitchDeriv", "[", 
       RowBox[{"derIn_List", ",", "derOut_List"}], "]"}], "[", "exp_", "]"}], 
     ":=", 
     RowBox[{
      RowBox[{"tuDArgSwitch", "[", 
       RowBox[{"derOut", ",", "derIn"}], "]"}], "[", "exp", "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "Integration", " ", "by", " ", "parts", " ", "assume", " ", "total", " ",
       "derivative"}], "->", 
     RowBox[{"0", " ", 
      RowBox[{"example", ":", " ", "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"xPartialDu", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], "c_"}], ":>", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             RowBox[{"xPartialDu", "[", 
              RowBox[{"c", ",", "b"}], "]"}]}], "a"}], "/;", 
           RowBox[{"!", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"FreeQ", "[", 
               RowBox[{"a", ",", 
                RowBox[{"T", "[", 
                 RowBox[{"\[CurlyEpsilon]", ",", "\"\<u\>\"", ",", "_"}], 
                 "]"}]}], "]"}], "&&", 
              RowBox[{"FreeQ", "[", 
               RowBox[{"a", ",", 
                RowBox[{"T", "[", 
                 RowBox[{"\[CurlyEpsilon]", ",", "\"\<d\>\"", ",", "_"}], 
                 "]"}]}], "]"}]}], ")"}]}]}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"xPartialD", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], "c_"}], ":>", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             RowBox[{"xPartialD", "[", 
              RowBox[{"c", ",", "b"}], "]"}]}], "a"}], "/;", 
           RowBox[{"!", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"FreeQ", "[", 
               RowBox[{"a", ",", 
                RowBox[{"T", "[", 
                 RowBox[{"\[CurlyEpsilon]", ",", "\"\<u\>\"", ",", "_"}], 
                 "]"}]}], "]"}], "&&", 
              RowBox[{"FreeQ", "[", 
               RowBox[{"a", ",", 
                RowBox[{"T", "[", 
                 RowBox[{"\[CurlyEpsilon]", ",", "\"\<d\>\"", ",", "_"}], 
                 "]"}]}], "]"}]}], ")"}]}]}]}]}], "\[IndentingNewLine]", 
        "}"}]}]}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"IncludeConstantxPartial", "[", "constant_List", "]"}], "[", 
      "exp_", "]"}], " ", "will", " ", "include", " ", "into", " ", 
     RowBox[{"xPartialD", "'"}], "s", " ", "the", " ", "terms", " ", "in", 
     " ", "constant_List", " ", "if", " ", "they", " ", "are", " ", 
     "connected", " ", "by", " ", "simple", " ", 
     RowBox[{"Times", ".", "  ", "Changes"}], " ", "the", " ", "Attributes", 
     " ", "of", " ", 
     RowBox[{"xTimes", "."}], "  ", "*", "17", "Sep2013"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"IncludeConstantxPartial", "[", "constant_List", "]"}], "[", 
      "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"ops", "=", "xTimes"}], ",", 
         RowBox[{"xP", "=", 
          RowBox[{"xPartialD", "|", "xPartialDu"}]}], ",", "pat", ",", 
         RowBox[{"newpat", "=", 
          RowBox[{"{", "}"}]}], ",", "cpat", ",", "i"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SetAttributes", "[", 
         RowBox[{"xTimes", ",", 
          RowBox[{"{", 
           RowBox[{
           "Flat", ",", "Listable", ",", "OneIdentity", ",", "Orderless", ",",
             "Protected"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"cpat", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"Alternatives", ",", "constant"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"cp", ":", "cpat"}], ")"}], 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"xp", ":", " ", "xP"}], ")"}], "[", 
             RowBox[{"a_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
           RowBox[{"xp", "[", 
            RowBox[{
             RowBox[{"xTimes", "[", 
              RowBox[{"cp", ",", " ", "a"}], "]"}], ",", "b"}], "]"}]}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"pat", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"xTimes", "[", "__", "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", 
           RowBox[{"Length", "[", "pat", "]"}]}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"FreeQ", "[", 
              RowBox[{
               RowBox[{"Apply", "[", 
                RowBox[{"List", ",", 
                 RowBox[{"pat", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "]"}], ",", 
               "ops"}], "]"}], ",", 
             RowBox[{"(*", 
              RowBox[{"simple", " ", "ops", " ", "only"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"xPrint", "[", 
               RowBox[{"pat", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"pat", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"pat", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "/.", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"op", ":", "ops"}], ")"}], "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"cp", ":", "cpat"}], ")"}], ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"xp", ":", "xP"}], ")"}], "[", 
                    RowBox[{"a_", ",", "b_"}], "]"}]}], "]"}], "\[Rule]", 
                 RowBox[{"xp", "[", 
                  RowBox[{
                   RowBox[{"op", "[", 
                    RowBox[{"cp", ",", " ", "a"}], "]"}], ",", "b"}], 
                  "]"}]}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"newpat", ",", 
                RowBox[{"pat", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"SetAttributes", "[", 
         RowBox[{"xTimes", ",", 
          RowBox[{"{", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"tmp", ",", "newpat"}], "]"}], "/.", 
         RowBox[{"xTimes", "\[Rule]", "Times"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuDotOpsNest", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDotOpsNest", "::", "usage"}], ":=", 
     "\"\<tuDotOpsNest[dotOp_:Dot][exp_] reforms a dotOps operator into \
nested functional form, e.g., tuDotOpsNest[][ \
(\!\(\*SubscriptBox[\(\[Delta]\), \(1\)]\).\!\(\*SubscriptBox[\(\[Delta]\), \
\(2\)]\)-\!\(\*SubscriptBox[\(\[Delta]\), \(2\)]\).\!\(\*SubscriptBox[\(\
\[Delta]\), \(1\)]\))[fn,f2] ]\[Rule]\!\(\*SubscriptBox[\(\[Delta]\), \
\(1\)]\)[\!\(\*SubscriptBox[\(\[Delta]\), \
\(2\)]\)[fn,f2]]-\!\(\*SubscriptBox[\(\[Delta]\), \
\(2\)]\)[\!\(\*SubscriptBox[\(\[Delta]\), \(1\)]\)[fn,f2]].  dotOp_ defines \
the dot operator forming the dot expression. tuDotOpsNest does nothing if the \
Head[exp_] does not contain dotOp_.\n*20Feb2019*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuDotOpsNest", "[", 
       RowBox[{"dotOp_:", "Dot"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$0", "=", "exp"}], ",", "$1", ",", "$", ",", "$argn", ",", 
         "$Arg", ",", "$head", ",", "xBlank", ",", "$right"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"Head", "[", "$0", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"FreeQ", "[", 
           RowBox[{"$", ",", "dotOp"}], "]"}], ",", 
          RowBox[{"Return", "[", "exp", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"$", "=", 
          RowBox[{"dotOp", " ", "[", 
           RowBox[{"$", " ", ",", " ", 
            RowBox[{"Apply", "[", 
             RowBox[{"$Arg", ",", "$0"}], "]"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"$", "=", 
          RowBox[{"$", "//", 
           RowBox[{"tuRepeat", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"tuOpDistribute", "[", "dotOps", "]"}], ",", 
               RowBox[{"tuOpSimplify", "[", "dotOps", "]"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
                 RowBox[{"a___", ",", "b_", ",", 
                  RowBox[{"aa", ":", "c_"}]}], "]"}], ":>", 
                RowBox[{
                 RowBox[{"dd", "[", 
                  RowBox[{"a", ",", 
                   RowBox[{"b", "[", "aa", "]"}]}], "]"}], "/;", 
                 RowBox[{"!", 
                  RowBox[{"FreeQ", "[", 
                   RowBox[{"aa", ",", "$Arg"}], "]"}]}]}]}]}], "}"}], ",", 
             RowBox[{"{", "}"}], ",", "5"}], "]"}]}]}], "\[IndentingNewLine]",
          "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"$Arg", "[", "a__", "]"}], ":>", 
           RowBox[{"Sequence", "[", "a", "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[Delta]", "1"], ".", 
          SubscriptBox["\[Delta]", "2"]}], "-", 
         RowBox[{
          SubscriptBox["\[Delta]", "2"], ".", 
          SubscriptBox["\[Delta]", "1"]}]}], ")"}], "[", 
       RowBox[{"fn", ",", "f2"}], "]"}], "\[IndentingNewLine]", "%"}], "//", 
     RowBox[{"tuDotOpsNest", "[", "]"}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuOperatorDot2Nest", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOperatorDot2Nest", "::", "usage"}], "=", 
     "\"\<tuOperatorDot2Nest[exp_] replaces Dot|xDot operator expressions in \
exp_ with nested expression, i.e.,  \
xDot[op1[_],op2[_],op3[_]]\[Rule]op1[op2[op3[_]]].  The arguement of each \
operator is expressed as Blank[].  *13Nov2015*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOperatorDot2Nest", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$0", "=", "exp"}], ",", "$1", ",", "$argn", ",", "$Arg", 
         ",", "$head", ",", "xBlank", ",", "$right"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"MatchQ", "[", 
            RowBox[{
             RowBox[{"$head", "=", 
              RowBox[{"Head", "[", "$0", "]"}]}], ",", "dotOps"}], "]"}]}], 
          ",", 
          RowBox[{"Return", "[", "$0", "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"Only", " ", "dotOps", " ", "allowed"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$0", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"$0", "//.", 
            RowBox[{"tuOpSimplify", "[", "dotOps", "]"}]}], "/.", 
           RowBox[{"Blank", "\[Rule]", "$Arg"}]}], "/.", 
          RowBox[{"$head", "\[Rule]", "xDot"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "Operator", " ", "arguements", " ", "specified", " ", "by", " ", 
          RowBox[{
           RowBox[{"Blank", "[", "]"}], ".", " ", "Dot"}], " ", "causes", " ", 
          RowBox[{"problems", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$1", "=", 
         RowBox[{"$0", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"$Arg", "[", "]"}], "]"}]}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<MM:\>\"", ",", "$1"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "$1", "]"}], ">", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$argn", "=", 
            RowBox[{"$1", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"-", "1"}], ",", "1", ",", "1"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$right", "=", 
            RowBox[{
             RowBox[{"$0", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"$argn", "+", "1"}], ";;", 
                RowBox[{"-", "1"}]}], "]"}], "]"}], "/.", 
             RowBox[{"xDot", "\[Rule]", "xBlank"}]}]}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<PP \>\"", ",", "$argn", ",", "\"\<:\>\"", ",", 
             RowBox[{
              RowBox[{"$1", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "2"}], "]"}], "]"}], "=", 
              "$right"}], ",", "\"\< : \>\"", ",", "$0"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$0", "=", 
            RowBox[{"Drop", "[", 
             RowBox[{
              RowBox[{"tuReplacePart", "[", 
               RowBox[{"$0", ",", 
                RowBox[{"{", 
                 RowBox[{"$1", "[", 
                  RowBox[{"[", 
                   RowBox[{"-", "1"}], "]"}], "]"}], "}"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"$argn", "+", "1"}], ",", 
                RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$1", "=", 
            RowBox[{"Delete", "[", 
             RowBox[{"$1", ",", 
              RowBox[{"-", "1"}]}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}],
         ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"$0", "/.", 
           RowBox[{
            RowBox[{"xBlank", "[", "]"}], "\[Rule]", 
            RowBox[{"Blank", "[", "]"}]}]}], "//.", 
          RowBox[{"xBlank", "\[Rule]", "xDot"}]}], "/.", 
         RowBox[{"xDot", "\[Rule]", "$head"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"evalDifferentialOps", "[", "opdef_", "]"}], "[", "exp_", 
       "]"}], " ", "evaluates", " ", "nested", " ", "Ops"}], ",", 
     RowBox[{"eg", "."}], ",", " ", 
     RowBox[{
      RowBox[{"op1", "[", 
       RowBox[{"op2", "[", 
        RowBox[{"op3", "[", "arg", "]"}], "]"}], "]"}], " ", "expressed", " ",
       "as", " ", 
      RowBox[{"xDot", "[", 
       RowBox[{"op1", ",", "op2", ",", "op3"}], "]"}], " ", "where", " ", 
      "opdef_", " ", "is", " ", "name", " ", "of", " ", "DelayedRules", " ", 
      "the", " ", "discribes", " ", "the", " ", 
      RowBox[{"op", "'"}], "s"}], ",", " ", "eg", ",", " ", 
     RowBox[{
      RowBox[{"opdef_", "[", "arg_", "]"}], ":=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"a", "\[Rule]", 
          RowBox[{"a", "[", "arg", "]"}]}], ",", 
         RowBox[{"b", "\[Rule]", 
          RowBox[{"b", "[", "arg", "]"}]}], ",", 
         RowBox[{
          RowBox[{"c", "[", "yy_", "]"}], "\[Rule]", 
          RowBox[{"xPartialD", "[", 
           RowBox[{"arg", ",", "yy"}], "]"}]}]}], "}"}], " ", "The", " ", 
       "label", " ", "arg", " ", "must", " ", "be", " ", "used", " ", "to", 
       " ", "specify", " ", "the", " ", "position", " ", "the", " ", 
       RowBox[{"arguement", ".", " ", "Even"}], " ", "multiplicative", " ", 
       "operation", " ", "must", " ", "be", " ", "specified", " ", "in", " ", 
       "opdef_"}]}], " ", ",", 
     RowBox[{"eg", "."}], ",", " ", 
     RowBox[{"x", " ", 
      RowBox[{
       RowBox[{"xPartialD", "[", "]"}], " ", "."}], " ", "*", "17", 
      "Aug2014"}]}], "*)"}], 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"evalDifferentialOps", "[", "opdef_", "]"}], "[", "exp_", "]"}],
      ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "op"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"dd", ":", 
            RowBox[{"xDot", "[", "a__", "]"}]}], ":>", 
           RowBox[{"Fold", "[", 
            RowBox[{"op", ",", "arg", ",", 
             RowBox[{"Reverse", "[", "dd", "]"}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
         RowBox[{"(", 
          RowBox[{"b", "/.", 
           RowBox[{"opdef", "[", "a", "]"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"$sa", "[", "arg_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"a", "\[Rule]", 
          RowBox[{"a", "[", "arg", "]"}]}], ",", 
         RowBox[{"b", "\[Rule]", 
          RowBox[{"b", "[", "arg", "]"}]}], ",", 
         RowBox[{
          RowBox[{"c", "[", "yy_", "]"}], "\[Rule]", 
          RowBox[{"xPartialD", "[", 
           RowBox[{"arg", ",", "yy"}], "]"}]}]}], "}"}], 
       "\[IndentingNewLine]", 
       RowBox[{"xDot", "[", 
        RowBox[{"a", ",", 
         RowBox[{"c", "[", "Y", "]"}], ",", "b"}], "]"}], 
       "\[IndentingNewLine]", "%"}], "//", 
      RowBox[{"evalDifferentialOps", "[", "$sa", "]"}]}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"derivativeSummedIndices", "[", 
       RowBox[{"varPat_", ",", "var_", ",", "index_", ",", "constants_List"}],
        "]"}], "[", "exp_", "]"}], " ", "differentiates", " ", "exp_", " ", 
     "by", " ", "varPat_", " ", "with", " ", "target", " ", "variable", " ", 
     "var_", " ", "with", " ", "implicit", " ", "summed", " ", "index_.", "  ",
      "Replaces", " ", "varPat_", " ", "index", " ", "with", " ", "index_", 
     " ", "in", " ", "exp_.", "  ", "Returns", " ", "exp_", " ", "with", " ", 
     "the", " ", 
     RowBox[{"xPartialD", "[", 
      RowBox[{"varPat_", ",", "var_"}], "]"}], " ", "replaced", " ", "by", 
     " ", 
     RowBox[{
      RowBox[{"\[Delta]", "[", "]"}], "."}], "  ", "*", "18", "Sep2014"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"derivativeSummedIndices", "[", 
       RowBox[{
       "var_", ",", "index_", ",", "dummy_List", ",", "constants_List"}], 
       "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"varPat", ",", "tmp", ",", "ipos"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"UniqueDummyIndices", "[", "dummy", "]"}], "[", "exp", 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"xPartialD", "[", 
          RowBox[{"tmp", ",", "var"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuDerivativeExpand", "[", "constants", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ipos", "=", 
         RowBox[{"var", "//", 
          RowBox[{"tuExtractPositionPattern", "[", "index", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ipos", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}], "=", "vv__"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"varPat", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"var", ",", "ipos"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"tmp", "/.", 
            RowBox[{
             RowBox[{"pp", ":", 
              RowBox[{"xPartialD", "[", 
               RowBox[{"varPat", ",", "var"}], "]"}]}], "\[RuleDelayed]", 
             RowBox[{"DD", "[", 
              RowBox[{
               RowBox[{"derivativeToDelta", "[", "index", "]"}], "[", "pp", 
               "]"}], "]"}]}]}], "//", "Expand"}], "//", 
          RowBox[{"simpleDot3", "[", 
           RowBox[{"{", 
            RowBox[{"DD", "[", "_", "]"}], "}"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<KK\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"b__", "  ", 
            RowBox[{"DD", "[", "a_", "]"}]}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"ContractUpDn", "[", 
             RowBox[{"\[Delta]", ",", 
              RowBox[{"{", 
               RowBox[{"a", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "1"}], "]"}], "]"}], "}"}]}], "]"}], "[", 
            RowBox[{"b", " ", 
             RowBox[{"a", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "CHECK", " ", "only", " ", "product", " ", "of", " ", "Tensor"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "tmp", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"TEST", ":", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"T", "[", 
         RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
        RowBox[{"i", ",", "j"}], "]"}], 
       RowBox[{
        RowBox[{"T", "[", 
         RowBox[{"x", ",", "\"\<d\>\""}], "]"}], "[", "i", "]"}], 
       RowBox[{
        RowBox[{"T", "[", 
         RowBox[{"x", ",", "\"\<d\>\""}], "]"}], "[", "j", "]"}]}]}], "//", 
     RowBox[{"derivativeSummedIndices", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"T", "[", 
         RowBox[{"x", ",", "\"\<d\>\""}], "]"}], "[", "k", "]"}], ",", "k", 
       ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
         RowBox[{"_", ",", "_"}], "]"}], "}"}]}], "]"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"derivativeToDelta", "[", "index_", "]"}], "[", "exp_", "]"}], 
      " ", "converts", " ", "exp_"}], " ", "==", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"xPartialD", "[", 
        RowBox[{
         SuperscriptBox["x", 
          RowBox[{"i", " ", "K"}]], ",", 
         SuperscriptBox["x", 
          RowBox[{"j", " ", "L"}]]}], "]"}], " ", "into", " ", 
       SuperscriptBox["\[Delta]", 
        RowBox[{"i", " ", "j"}]], " ", "where", " ", 
       RowBox[{"x", "'"}], "s", " ", "are", " ", "Tensors", " ", "with", " ", 
       "up"}], "-", 
      RowBox[{"down", " ", 
       RowBox[{"indices", ".", " ", 
        RowBox[{"Return", "[", "0", "]"}]}], " ", "if", " ", "Tensors", " ", 
       "are", " ", "not", " ", "the", " ", "same", " ", "shape", " ", "or", 
       " ", 
       RowBox[{"name", ".", " ", "Returns"}], " ", 
       RowBox[{"{", "i", "}"}], " ", "the", " ", "index", " ", "that", " ", 
       "is", " ", "not", " ", "referenced", " ", "by", " ", "derivative", " ", 
       RowBox[{"index", "."}], " ", "*", "18", "Sep2014"}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"derivativeToDelta", "[", "index_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "ipos", ",", "ud", ",", 
         "lengths"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "tmp"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"tmp", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "=!=", 
           RowBox[{"tmp", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"not", " ", "same", " ", "variable", " ", "name"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tuIndexParser", "/@", "tmp"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Last", "[", "#", "]"}], "&"}], "/@", "tmp"}], ")"}], "=!=", 
           RowBox[{"(", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", "}"}], ",", 
              RowBox[{"{", "}"}]}], "}"}], ")"}]}], " ", ",", " ", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{"FreeQ", "[", 
           RowBox[{
            RowBox[{"tmp", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", "index"}], "]"}], 
          " ", ",", 
          RowBox[{"Return", "[", "0", "]"}]}], " ", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "tmp"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"up", "-", 
          RowBox[{"down", " ", "indices"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"lengths", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "/@", "#"}], "&"}], "/@", "tmp"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"lengths", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "=!=", 
           RowBox[{"lengths", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"different", " ", "up"}], "-", 
          RowBox[{"down", " ", "structure"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ipos", "=", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"tmp", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "index"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Extract", "[", 
          RowBox[{
           RowBox[{"tmp", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "ipos"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"tmp", ",", "index"}], "}"}], "//", "Flatten"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ud", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ipos", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], "===", "1"}], ",", 
           "\"\<ud\>\"", ",", "\"\<du\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"\[Delta]", ",", "ud"}], "]"}], "[", 
            RowBox[{"Apply", "[", 
             RowBox[{"Sequence", ",", "tmp"}], "]"}], "]"}], ",", "tmp"}], 
          "}"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"derivativeToDelta", "::", "1"}], "=", 
      "\"\<general index error\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"derivativeToDelta", "::", "2"}], "=", 
      "\"\<no index found\>\""}], ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"xPartialD", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"x", ",", "\"\<uu\>\""}], "]"}], "[", 
         RowBox[{"i", ",", "k"}], "]"}], ",", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"x", ",", "\"\<uu\>\""}], "]"}], "[", 
         RowBox[{"j", ",", "L"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
      "%"}], "//", 
     RowBox[{"derivativeToDelta", "[", "j", "]"}]}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuTrigFunc", "=", 
     RowBox[{"{", 
      RowBox[{
      "Cos", ",", "Sin", ",", "Tan", ",", "Tanh", ",", "Cot", ",", "Coth", 
       ",", "Sinh", ",", "Cosh", ",", "Sec", ",", "Sech", ",", "Csc", ",", 
       "Csch"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuTrigFunc", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"tuTrigFunc", ",", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"\"\<Arc\>\"", "<>", 
            RowBox[{"ToString", "[", "#", "]"}]}], "]"}], "&"}], ",", 
         "tuTrigFunc"}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTrigDerivativeExpand", "::", "usage"}], "=", 
     "\"\<tuTrigDerivativeExpand[constants_List:{}][exp_] expands DerivOps of \
Trig functions by applying Rule[] DerivOps->D. addArg_:{} is optional list of \
arguement to add to arguements of Trig function so that D[] will process \
properly. If addArg!={} then the tuDerivOps will be returned as the \
derivative operator, Else the D[] operator is return (assumes that the input \
is formed properly.)\nTODO: determine if constants_List is necessary since \
arguements of functions are explicit. *17Jan2015*20Apr20*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuTrigDerivativeExpand", "[", 
       RowBox[{
        RowBox[{"constants_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"addArg_:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "xD"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "addArg", "]"}], ">", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"op", ":", "tuDerivOps"}], ")"}], "[", 
               RowBox[{
                RowBox[{"a_", "[", "aa_", "]"}], ",", "b_"}], "]"}], 
              "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"op", "[", 
                 RowBox[{
                  RowBox[{"a", "[", 
                   RowBox[{
                    RowBox[{"tuArgAdd", "[", 
                    RowBox[{"aa", ",", "addArg"}], "]"}], "[", "aa", "]"}], 
                   "]"}], ",", "b"}], "]"}], "/;", 
                RowBox[{"tuMemberQ", "[", 
                 RowBox[{"a", ",", "tuTrigFunc"}], "]"}]}], ")"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"op", ":", "tuDerivOps"}], ")"}], "[", 
               RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{
                RowBox[{"xop", "[", "op", "]"}], "[", 
                RowBox[{"D", "[", 
                 RowBox[{"a", ",", "b"}], "]"}], "]"}], "/;", 
               RowBox[{"tuHasAnyQ", "[", 
                RowBox[{"a", ",", "tuTrigFunc"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"xop", "[", "op_", "]"}], "[", "a_", "]"}], 
              "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{"a", "//", 
                RowBox[{"tuD2tuDOp", "[", "op", "]"}]}], ")"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"a_", "[", 
               RowBox[{"Apply", "[", 
                RowBox[{"Sequence", ",", "addArg"}], "]"}], "]"}], "\[Rule]", 
              "a"}]}]}], ";"}], "\[IndentingNewLine]", ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"op", ":", "tuDerivOps"}], ")"}], "[", 
               RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{"a", ",", "b"}], "]"}], "/;", 
               RowBox[{"tuHasAnyQ", "[", 
                RowBox[{"a", ",", "tuTrigFunc"}], "]"}]}]}]}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", " ", 
          RowBox[{
           RowBox[{"HoldPattern", "[", 
            RowBox[{"D", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"0", "/;", 
            RowBox[{"MemberQ", "[", 
             RowBox[{"constants", ",", "a"}], "]"}]}]}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOrderDerivativeArguements", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", 
         RowBox[{"derivOp", "=", 
          RowBox[{"xPartialD", "|", "xPartialDu", "|", 
           RowBox[{"xD", "[", "_", "]"}], "|", 
           RowBox[{"xDu", "[", "_", "]"}]}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"dd1", ":", "tuDerivOps"}], ")"}], "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"dd2", ":", "tuDerivOps"}], ")"}], "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], ",", "c_"}], "]"}], 
          "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"dd2", "[", 
            RowBox[{
             RowBox[{"dd1", "[", 
              RowBox[{"a", ",", "c"}], "]"}], ",", "b"}], "]"}], "/;", 
           RowBox[{"OrderedQ", "[", 
            RowBox[{"{", 
             RowBox[{"b", ",", "c"}], "}"}], "]"}]}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.476642763862289*^9, 3.476642777525859*^9}, {
   3.476642811903961*^9, 3.476642911421946*^9}, 3.47664303789678*^9, 
   3.476643179165001*^9, {3.476643317075169*^9, 3.476643317936386*^9}, {
   3.476643402208899*^9, 3.4766434066830482`*^9}, {3.476643508211241*^9, 
   3.476643528519712*^9}, {3.476643562641294*^9, 3.4766436872674627`*^9}, {
   3.4766437628197317`*^9, 3.476643810538529*^9}, {3.476643938782834*^9, 
   3.476644005425108*^9}, {3.476644044434292*^9, 3.476644048809173*^9}, {
   3.476644120358526*^9, 3.476644167339213*^9}, {3.476644265665845*^9, 
   3.4766442958845*^9}, {3.476644328741139*^9, 3.476644404295808*^9}, {
   3.476644470998148*^9, 3.4766445398778048`*^9}, {3.476644750055437*^9, 
   3.476644861070799*^9}, 3.47664490044123*^9, {3.4766449535535727`*^9, 
   3.476644954367799*^9}, {3.476645016197184*^9, 3.476645033843459*^9}, {
   3.4766450969968243`*^9, 3.476645192595934*^9}, {3.4766699573515463`*^9, 
   3.4766700670649853`*^9}, {3.476672402720327*^9, 3.4766724049316196`*^9}, {
   3.4767542956697083`*^9, 3.4767543321489563`*^9}, {3.477178380157247*^9, 
   3.477178394343453*^9}, 3.477178518806591*^9, {3.4828503312341843`*^9, 
   3.482850358698378*^9}, {3.482850819237262*^9, 3.482850877150062*^9}, {
   3.482850910635704*^9, 3.482850913420699*^9}, {3.482850968642322*^9, 
   3.482850989821405*^9}, {3.483991989261016*^9, 3.4839920016509457`*^9}, {
   3.483992052929388*^9, 3.483992272737475*^9}, {3.483993222956908*^9, 
   3.48399332804101*^9}, 3.4839933709871397`*^9, 3.484058548100608*^9, {
   3.484058662604569*^9, 3.484058665450782*^9}, {3.484073095571376*^9, 
   3.484073111109579*^9}, {3.4841379161427402`*^9, 3.4841379633889837`*^9}, {
   3.484138097347961*^9, 3.484138107268364*^9}, {3.484141109394953*^9, 
   3.484141186807035*^9}, {3.485195501960164*^9, 3.485195519322579*^9}, {
   3.485626961186953*^9, 3.485626986682448*^9}, {3.485627048751285*^9, 
   3.485627058376111*^9}, 3.485627142134439*^9, {3.4856274966986513`*^9, 
   3.4856275238609877`*^9}, {3.48570130659975*^9, 3.485701330767749*^9}, {
   3.485701373487636*^9, 3.4857014160442*^9}, {3.485701468918556*^9, 
   3.485701485901005*^9}, {3.4857015715166388`*^9, 3.4857016541429033`*^9}, {
   3.485797376683008*^9, 3.485797401923904*^9}, {3.486489960822443*^9, 
   3.486490014015448*^9}, {3.486987332239148*^9, 3.4869873727309103`*^9}, {
   3.4871293507544737`*^9, 3.4871293517243347`*^9}, {3.4871300022098083`*^9, 
   3.487130063610505*^9}, {3.4871330829518223`*^9, 3.487133084938933*^9}, {
   3.487153147228982*^9, 3.4871531479793777`*^9}, {3.488220529021661*^9, 
   3.4882205422067823`*^9}, {3.488888169336214*^9, 3.488888185104648*^9}, {
   3.488888325687928*^9, 3.488888363875738*^9}, {3.488888495049947*^9, 
   3.488888515868672*^9}, {3.489161225061614*^9, 3.489161227475399*^9}, {
   3.49070036988326*^9, 3.490700400221613*^9}, {3.490700474382697*^9, 
   3.490700476612949*^9}, {3.4915905506497583`*^9, 3.491590555645852*^9}, 
   3.491590713183634*^9, {3.494102329129106*^9, 3.494102337466547*^9}, {
   3.4941024160518837`*^9, 3.4941024400636797`*^9}, {3.5082952524895687`*^9, 
   3.508295276019346*^9}, {3.508295589121359*^9, 3.508295595792159*^9}, {
   3.508297503974258*^9, 3.508297613547318*^9}, 3.5147290600480537`*^9, 
   3.521119841651842*^9, {3.521120114762586*^9, 3.521120157192663*^9}, {
   3.521120208602108*^9, 3.521120211102107*^9}, {3.521120339889695*^9, 
   3.521120346504696*^9}, {3.521120407286174*^9, 3.521120442932687*^9}, {
   3.521120609386323*^9, 3.521120624775743*^9}, {3.521120747878087*^9, 
   3.521120749158062*^9}, {3.521120830515046*^9, 3.521120833721381*^9}, {
   3.5211208767098513`*^9, 3.521120884655032*^9}, 3.521121082904139*^9, {
   3.52112111574216*^9, 3.521121133768067*^9}, {3.52112119210323*^9, 
   3.521121192931135*^9}, 3.521122000581759*^9, {3.521122293335088*^9, 
   3.521122294619671*^9}, 3.524789497239822*^9, 3.527340438984069*^9, {
   3.527340480625701*^9, 3.527340551548275*^9}, 3.527356399630188*^9, {
   3.527360714738388*^9, 3.527360715431793*^9}, {3.527385040372264*^9, 
   3.5273850916269903`*^9}, {3.5273851345176487`*^9, 3.527385317612133*^9}, {
   3.527385405774118*^9, 3.527385448835446*^9}, {3.527417758637363*^9, 
   3.527417814500292*^9}, {3.5274178911427193`*^9, 3.527417905038609*^9}, 
   3.52741989066042*^9, {3.527419923377001*^9, 3.527419946786434*^9}, {
   3.527424126906603*^9, 3.527424178646565*^9}, {3.52742421661795*^9, 
   3.527424275229167*^9}, {3.529770007220236*^9, 3.529770050078761*^9}, {
   3.529770084702052*^9, 3.529770118287924*^9}, {3.540232328064604*^9, 
   3.540232437872596*^9}, {3.5427289412337437`*^9, 3.542728949859419*^9}, {
   3.542729853057007*^9, 3.542729853765092*^9}, {3.542729892992072*^9, 
   3.542729961812655*^9}, {3.542730026089923*^9, 3.542730135359694*^9}, 
   3.542730167280415*^9, {3.542735844103541*^9, 3.542736003691204*^9}, {
   3.542736038762649*^9, 3.542736050793544*^9}, {3.54274084082145*^9, 
   3.54274088346202*^9}, {3.543256782319055*^9, 3.543256797833157*^9}, {
   3.5444130173122463`*^9, 3.544413041631049*^9}, {3.544440113446398*^9, 
   3.544440115670208*^9}, 3.544972049901931*^9, {3.546613483243095*^9, 
   3.546613487407197*^9}, {3.548731253610033*^9, 3.548731319632332*^9}, 
   3.550953376631815*^9, {3.5509741798520927`*^9, 3.5509742238986197`*^9}, {
   3.55097427434593*^9, 3.550974348226534*^9}, {3.551452119346302*^9, 
   3.551452120396806*^9}, {3.55161519682051*^9, 3.5516152740115232`*^9}, {
   3.551801022282295*^9, 3.551801055016912*^9}, {3.55231041704801*^9, 
   3.552310419468711*^9}, {3.552406515284412*^9, 3.552406583287632*^9}, 
   3.552410541396326*^9, 3.552410602847992*^9, {3.552410657908695*^9, 
   3.5524106787389793`*^9}, {3.552411078383691*^9, 3.552411159304549*^9}, {
   3.552656422533188*^9, 3.552656476258966*^9}, {3.552656588777381*^9, 
   3.5526566271576014`*^9}, {3.552665640116604*^9, 3.5526656640619287`*^9}, {
   3.552665703589682*^9, 3.552665725578513*^9}, {3.552665763704235*^9, 
   3.552665769428926*^9}, {3.55266873850278*^9, 3.552668744768313*^9}, 
   3.553179792050248*^9, {3.553180383435586*^9, 3.5531803873549957`*^9}, {
   3.5531804176833143`*^9, 3.5531805168399773`*^9}, {3.553180572783497*^9, 
   3.553180583150202*^9}, {3.55318075112577*^9, 3.553180764243829*^9}, {
   3.553185627451735*^9, 3.553185654438818*^9}, {3.5531860516590347`*^9, 
   3.553186052523711*^9}, {3.553254535147232*^9, 3.553254542242077*^9}, {
   3.55325458562869*^9, 3.5532548354094763`*^9}, {3.553254913574018*^9, 
   3.5532549156263647`*^9}, {3.5541238023331137`*^9, 3.554123826636455*^9}, 
   3.554123972320139*^9, 3.554124034749736*^9, {3.5541240756326227`*^9, 
   3.55412408735061*^9}, {3.554124158896132*^9, 3.554124169922113*^9}, {
   3.55412442497622*^9, 3.5541244960317993`*^9}, {3.554126742263818*^9, 
   3.554126757808648*^9}, {3.5541271314856157`*^9, 3.554127141359816*^9}, 
   3.554127437982482*^9, {3.5541274907673197`*^9, 3.55412757147015*^9}, {
   3.5541279447157288`*^9, 3.5541279490230293`*^9}, {3.554128044376225*^9, 
   3.554128228011826*^9}, {3.554139702009678*^9, 3.554139710024548*^9}, {
   3.554218962024835*^9, 3.55421903409997*^9}, 3.554732859407666*^9, 
   3.5547329547314987`*^9, {3.554733021190584*^9, 3.554733172136085*^9}, {
   3.554744687696748*^9, 3.554744725938121*^9}, {3.556121694698585*^9, 
   3.556121835073937*^9}, 3.556122219575511*^9, {3.5567198339124126`*^9, 
   3.5567200980920153`*^9}, {3.55690467604274*^9, 3.556904681372377*^9}, 
   3.5569047147816067`*^9, {3.55697459038756*^9, 3.5569746492672*^9}, {
   3.5569747529113703`*^9, 3.556974796281458*^9}, 3.556974864171406*^9, {
   3.556974956806395*^9, 3.556974958019424*^9}, 3.556975339262542*^9, {
   3.560083851885087*^9, 3.5600838540456057`*^9}, {3.560085872149419*^9, 
   3.56008587503757*^9}, {3.561558054282168*^9, 3.5615583305256023`*^9}, {
   3.56155838331945*^9, 3.561558384685663*^9}, {3.561558838692567*^9, 
   3.5615589115451183`*^9}, {3.563023104222748*^9, 3.563023145936326*^9}, {
   3.5631269921319113`*^9, 3.56312701033484*^9}, {3.5631270640440073`*^9, 
   3.563127140011961*^9}, {3.5631969034071617`*^9, 3.5631969234381723`*^9}, {
   3.5636324139369583`*^9, 3.5636324250801487`*^9}, {3.56363270572209*^9, 
   3.5636328995359488`*^9}, {3.563857011129059*^9, 3.563857017467387*^9}, {
   3.563891205834263*^9, 3.5638912575937233`*^9}, {3.5638913033794947`*^9, 
   3.563891369919919*^9}, {3.56423962178229*^9, 3.564239622710126*^9}, {
   3.567787205160659*^9, 3.567787213245894*^9}, 3.5677879514728727`*^9, {
   3.567789475966411*^9, 3.567789495669612*^9}, {3.568729246507015*^9, 
   3.5687292549639874`*^9}, {3.568729323196487*^9, 3.568729325579645*^9}, {
   3.5688201060118237`*^9, 3.568820166896522*^9}, {3.568820210968956*^9, 
   3.56882021310909*^9}, {3.571362239377412*^9, 3.571362320414823*^9}, {
   3.576604406186769*^9, 3.5766044720006533`*^9}, {3.576604507795775*^9, 
   3.576604796020853*^9}, {3.576605472258304*^9, 3.576605522952001*^9}, 
   3.576606321847495*^9, {3.5801307087412024`*^9, 3.5801307232798777`*^9}, {
   3.580131680969153*^9, 3.5801317262966213`*^9}, {3.580132346214353*^9, 
   3.580132358624651*^9}, {3.580132572172707*^9, 3.5801326762139273`*^9}, {
   3.580132715669585*^9, 3.5801327581710243`*^9}, {3.58013301334156*^9, 
   3.580133029013029*^9}, {3.5801493665667753`*^9, 3.580149374075672*^9}, {
   3.580150406821096*^9, 3.5801504226499367`*^9}, {3.580150452961842*^9, 
   3.580150479004447*^9}, {3.5801505116298933`*^9, 3.5801505128687572`*^9}, {
   3.580151419727126*^9, 3.580151435010599*^9}, {3.580212519256529*^9, 
   3.580212591755793*^9}, {3.580212971790515*^9, 3.580212986491354*^9}, 
   3.58021319976259*^9, {3.582884244820822*^9, 3.5828842674318523`*^9}, 
   3.582885902084428*^9, 3.5829806929481688`*^9, 3.582982899745145*^9, {
   3.582986256289062*^9, 3.582986341250613*^9}, {3.583579719239874*^9, 
   3.583579737491951*^9}, {3.588447252035767*^9, 3.588447270672923*^9}, 
   3.5884475330213623`*^9, {3.590715695739684*^9, 3.590715716450667*^9}, {
   3.590715774536828*^9, 3.5907158717315187`*^9}, {3.590715956482544*^9, 
   3.590716024826396*^9}, {3.591184066582644*^9, 3.591184190853347*^9}, 
   3.5936411095319366`*^9, 3.593963753292207*^9, {3.5939641890726624`*^9, 
   3.593964207426374*^9}, {3.593964958080508*^9, 3.5939650793494673`*^9}, {
   3.595864127230446*^9, 3.59586413925345*^9}, {3.5982796358465967`*^9, 
   3.598279658032419*^9}, {3.600109547279004*^9, 3.600109604306012*^9}, {
   3.6001098142861*^9, 3.600109821361326*^9}, {3.600618188459344*^9, 
   3.600618238536737*^9}, {3.600618388783318*^9, 3.60061843503065*^9}, {
   3.600619009144208*^9, 3.600619035123658*^9}, {3.603381251274897*^9, 
   3.603381369718895*^9}, {3.603381433727376*^9, 3.6033814478722143`*^9}, {
   3.603382545907381*^9, 3.6033825478017693`*^9}, {3.603562560818026*^9, 
   3.603562591569578*^9}, {3.6041525853623238`*^9, 3.604152601024845*^9}, {
   3.6046834381681013`*^9, 3.604683556309268*^9}, {3.604692460351466*^9, 
   3.604692538796241*^9}, 3.604759466526692*^9, {3.6077025272267237`*^9, 
   3.607702565030362*^9}, {3.6077025994309807`*^9, 3.60770286032928*^9}, {
   3.607703383110198*^9, 3.607703486292028*^9}, {3.607966490592874*^9, 
   3.607966492328216*^9}, {3.607967046132049*^9, 3.607967054160255*^9}, {
   3.6082191132354307`*^9, 3.60821912167905*^9}, 3.608255519386745*^9, {
   3.608298946528636*^9, 3.6082989638143473`*^9}, {3.608298997182328*^9, 
   3.6082990314939337`*^9}, {3.608299216540049*^9, 3.608299295936596*^9}, {
   3.608300402136393*^9, 3.608300413018265*^9}, {3.608994804753777*^9, 
   3.608994860624043*^9}, {3.6089948922983227`*^9, 3.6089949450589123`*^9}, {
   3.608995264531583*^9, 3.608995268094549*^9}, 3.609010537998848*^9, {
   3.6090105818155947`*^9, 3.609010651277995*^9}, {3.6090131941396*^9, 
   3.6090132134424257`*^9}, {3.609704638004559*^9, 3.609704669187813*^9}, {
   3.610372842030923*^9, 3.610372858513857*^9}, {3.610372981060141*^9, 
   3.61037321126495*^9}, {3.61046798411325*^9, 3.6104680527935667`*^9}, 
   3.610469105749976*^9, {3.611408710982709*^9, 3.611408745476965*^9}, {
   3.612788557260335*^9, 3.612788558451819*^9}, {3.6127892655747347`*^9, 
   3.612789274893724*^9}, 3.612789314610692*^9, {3.612794004665914*^9, 
   3.612794012266622*^9}, {3.6128047127237377`*^9, 3.612804712904015*^9}, {
   3.6128396128542128`*^9, 3.61283961984641*^9}, {3.6140220313354807`*^9, 
   3.6140220314848843`*^9}, {3.6143527905372477`*^9, 3.614352802226548*^9}, 
   3.614392776032984*^9, {3.6144306719223537`*^9, 3.614430913747486*^9}, 
   3.614430955435562*^9, {3.614432425934609*^9, 3.614432463205278*^9}, {
   3.614436960625371*^9, 3.614436985997601*^9}, {3.614515513954921*^9, 
   3.6145155149343987`*^9}, {3.615474051079591*^9, 3.6154740540869617`*^9}, 
   3.615479251209083*^9, {3.615480738834866*^9, 3.6154807478899927`*^9}, {
   3.6156447455250607`*^9, 3.615644748202592*^9}, {3.617202278953806*^9, 
   3.617202389831801*^9}, {3.617202524778144*^9, 3.6172028371907682`*^9}, {
   3.617203530782523*^9, 3.617203533292244*^9}, {3.617204546868239*^9, 
   3.6172046348110113`*^9}, {3.617723329846489*^9, 3.617723415981566*^9}, {
   3.617731451007842*^9, 3.6177316434539347`*^9}, 3.617732184080976*^9, 
   3.61779198680941*^9, {3.6177925444880342`*^9, 3.6177925454606323`*^9}, {
   3.6177934683982153`*^9, 3.617793469401042*^9}, {3.617793743725587*^9, 
   3.617793747528841*^9}, {3.6177993396463327`*^9, 3.617799366134816*^9}, 
   3.617803879777326*^9, 3.61780391975672*^9, {3.620084231466364*^9, 
   3.620084232814258*^9}, {3.620136096634872*^9, 3.62013612147228*^9}, {
   3.62013702942323*^9, 3.620137045985635*^9}, {3.620139617039764*^9, 
   3.620139620586384*^9}, {3.620139894511263*^9, 3.620139897464312*^9}, {
   3.620140037917334*^9, 3.6201400449039507`*^9}, {3.6201444579134398`*^9, 
   3.6201444780165653`*^9}, {3.620146491905389*^9, 3.620146547126975*^9}, {
   3.6201466171672707`*^9, 3.620146678037835*^9}, {3.620146717634922*^9, 
   3.6201467478098907`*^9}, 3.620254445550043*^9, {3.620397874276963*^9, 
   3.6203978850646143`*^9}, {3.6203993413120947`*^9, 3.620399348256098*^9}, {
   3.620399406895485*^9, 3.620399410159665*^9}, {3.620399506776675*^9, 
   3.620399519953318*^9}, {3.620399625205907*^9, 3.620399631516584*^9}, 
   3.620399783564805*^9, 3.620399842881106*^9, {3.620400018426557*^9, 
   3.6204000514873343`*^9}, {3.620400091569725*^9, 3.620400099873138*^9}, 
   3.620400161265809*^9, 3.6204386357925262`*^9, 3.620560616684588*^9, {
   3.620568611185616*^9, 3.620568613274448*^9}, 3.620568647965172*^9, {
   3.620569342940028*^9, 3.620569377741865*^9}, {3.620913840358938*^9, 
   3.620913848307173*^9}, {3.620999564933035*^9, 3.620999738454211*^9}, {
   3.620999795623786*^9, 3.620999860876225*^9}, {3.621000035031204*^9, 
   3.62100008158469*^9}, {3.621255925632723*^9, 3.6212559420595293`*^9}, {
   3.621342715765769*^9, 3.621342757945147*^9}, {3.621342801311528*^9, 
   3.621342803425208*^9}, {3.6213432298761578`*^9, 3.621343233255053*^9}, {
   3.6214322978285913`*^9, 3.6214323963272247`*^9}, {3.621709087308301*^9, 
   3.621709092031464*^9}, {3.621709268430409*^9, 3.621709296418941*^9}, {
   3.625506559177002*^9, 3.625506605796487*^9}, {3.625511773275503*^9, 
   3.625511865752746*^9}, {3.625535334066763*^9, 3.6255353354836063`*^9}, {
   3.628867120438588*^9, 3.62886712767655*^9}, {3.62886716884092*^9, 
   3.6288671956671753`*^9}, 3.628867346499082*^9, 3.628867416331134*^9, {
   3.629394295383535*^9, 3.629394295521975*^9}, {3.6293944531720533`*^9, 
   3.6293944764847403`*^9}, {3.629394509779935*^9, 3.629394511596613*^9}, {
   3.62939454739878*^9, 3.629394563024165*^9}, {3.6294306572287483`*^9, 
   3.629430706504534*^9}, {3.6294670560295677`*^9, 3.629467069100596*^9}, {
   3.629467105236436*^9, 3.629467141411745*^9}, 3.629563568357449*^9, 
   3.629648770046626*^9, {3.62981482513095*^9, 3.629814832681707*^9}, 
   3.629994155972968*^9, {3.630449989195792*^9, 3.6304500793883963`*^9}, {
   3.630450110949724*^9, 3.630450133709793*^9}, {3.630450934393827*^9, 
   3.630450936041828*^9}, {3.630460718103383*^9, 3.6304607199164886`*^9}, {
   3.630499601639357*^9, 3.630499663438203*^9}, 3.631454028145669*^9, {
   3.6318916765967093`*^9, 3.631892052921795*^9}, {3.631892127567824*^9, 
   3.631892139829715*^9}, 3.631892170993725*^9, {3.632060976292267*^9, 
   3.6320609786366177`*^9}, {3.6320610128164673`*^9, 3.632061014998006*^9}, {
   3.6320618693293943`*^9, 3.632061870940496*^9}, {3.6322442773763733`*^9, 
   3.632244292085331*^9}, {3.632244947126152*^9, 3.632244984652934*^9}, 
   3.632340912782949*^9, {3.6335327527532587`*^9, 3.633532753482546*^9}, {
   3.633534691152898*^9, 3.633534730643196*^9}, {3.63430462306044*^9, 
   3.634304626482853*^9}, {3.634304673942788*^9, 3.634304674793652*^9}, {
   3.634309203438266*^9, 3.634309203896921*^9}, {3.634310353300949*^9, 
   3.6343103551879187`*^9}, {3.6343106452114162`*^9, 3.634310655072918*^9}, {
   3.6356061984111147`*^9, 3.635606199851878*^9}, {3.638272449968054*^9, 
   3.6382724499949493`*^9}, {3.647967564172822*^9, 3.64796756590143*^9}, {
   3.647967606837517*^9, 3.647967608018339*^9}, 3.647967793701539*^9, {
   3.65076495597964*^9, 3.650764986775769*^9}, {3.650900715673297*^9, 
   3.650900957465199*^9}, {3.6509028083754797`*^9, 3.650902810020578*^9}, 
   3.654439870141843*^9, {3.655083551722576*^9, 3.655083615550303*^9}, {
   3.655992550886303*^9, 3.655992664987054*^9}, {3.655992726166765*^9, 
   3.655992747905211*^9}, {3.655993898533011*^9, 3.655993901891541*^9}, 
   3.656034715899769*^9, {3.656463915156271*^9, 3.65646394303843*^9}, {
   3.6564685042137136`*^9, 3.6564685149598*^9}, 3.656516772760129*^9, 
   3.656516855149478*^9, {3.656518261159835*^9, 3.656518261176097*^9}, {
   3.656518807948859*^9, 3.6565189009871607`*^9}, 3.656597830787258*^9, 
   3.6585766751897306`*^9, {3.661103623742478*^9, 3.661103628333313*^9}, {
   3.6618667746641207`*^9, 3.6618667778038177`*^9}, {3.6618668734702997`*^9, 
   3.661866918309206*^9}, {3.661914002963181*^9, 3.6619140035230923`*^9}, 
   3.661914348521739*^9, {3.66352344784759*^9, 3.663523462278916*^9}, {
   3.666378412227092*^9, 3.666378436170248*^9}, {3.6663787743946447`*^9, 
   3.6663787758809147`*^9}, {3.666378808675261*^9, 3.666378816418095*^9}, {
   3.666466937085257*^9, 3.666467032349897*^9}, {3.666577067358745*^9, 
   3.6665770878038073`*^9}, {3.6666608266977253`*^9, 3.66666082804541*^9}, {
   3.666660862356543*^9, 3.666660958891302*^9}, {3.666662533034425*^9, 
   3.666662589413291*^9}, {3.666715297171664*^9, 3.66671529769308*^9}, {
   3.684671699326331*^9, 3.684671699586163*^9}, {3.689689887945178*^9, 
   3.68968989081887*^9}, {3.691605353200289*^9, 3.691605396889206*^9}, {
   3.6916054400918818`*^9, 3.691605574568925*^9}, {3.6916168968647137`*^9, 
   3.6916169264912987`*^9}, {3.6916169599418097`*^9, 
   3.6916169719063883`*^9}, {3.691617003051118*^9, 3.6916170082131147`*^9}, {
   3.6916170632632637`*^9, 3.691617101311933*^9}, 3.691717592550419*^9, {
   3.6951388292579947`*^9, 3.695138845095158*^9}, {3.695138876687972*^9, 
   3.695138905980554*^9}, {3.695672167614841*^9, 3.69567232104193*^9}, {
   3.697732750520673*^9, 3.697732750717355*^9}, {3.697732804778493*^9, 
   3.697732903346899*^9}, {3.6978205834547787`*^9, 3.69782062882367*^9}, {
   3.69782080724345*^9, 3.697820834899284*^9}, 3.711468191227428*^9, 
   3.7114695704021397`*^9, {3.711469618414605*^9, 3.711469667978743*^9}, 
   3.71146971116891*^9, {3.711470199584877*^9, 3.711470241352901*^9}, {
   3.7141430734366713`*^9, 3.7141431014690247`*^9}, {3.714998755598881*^9, 
   3.714998780660891*^9}, {3.71535504559514*^9, 3.715355085704463*^9}, {
   3.7153553819199553`*^9, 3.715355387662554*^9}, {3.719712762928508*^9, 
   3.71971278774146*^9}, {3.720066716819353*^9, 3.720066828484685*^9}, {
   3.720145036835663*^9, 3.720145075877832*^9}, {3.7201452429891663`*^9, 
   3.72014526609578*^9}, 3.720145837298252*^9, {3.720189744537936*^9, 
   3.720189785500552*^9}, {3.720799149663331*^9, 3.7207991498927813`*^9}, 
   3.7207996208033333`*^9, {3.7222826654173203`*^9, 3.722282700416169*^9}, {
   3.722282776463463*^9, 3.722282798365795*^9}, {3.722282836309065*^9, 
   3.722282875506312*^9}, {3.722601972385853*^9, 3.722602007550902*^9}, {
   3.7226077491658382`*^9, 3.7226077935847483`*^9}, 3.722608344935157*^9, {
   3.722608377373239*^9, 3.7226084439789248`*^9}, {3.722688073223838*^9, 
   3.7226881049732513`*^9}, {3.7271039520174723`*^9, 3.727104052847042*^9}, 
   3.7271041720127277`*^9, {3.727104266429305*^9, 3.7271043111000443`*^9}, {
   3.727104429683399*^9, 3.727104432794375*^9}, 3.727789171991661*^9, {
   3.729091060134276*^9, 3.729091067289391*^9}, 3.729091136634458*^9, {
   3.7290911722534113`*^9, 3.7290912377885523`*^9}, {3.729091302769442*^9, 
   3.729091324006529*^9}, {3.729091377817868*^9, 3.729091395993618*^9}, {
   3.729091444092939*^9, 3.729091605971744*^9}, {3.729091723935116*^9, 
   3.729091804261451*^9}, {3.7300322863402557`*^9, 3.730032311774857*^9}, 
   3.73158893648071*^9, {3.731593666043498*^9, 3.7315937208839693`*^9}, {
   3.731593754259531*^9, 3.73159377463064*^9}, {3.7318127401762447`*^9, 
   3.731812743459422*^9}, {3.731813104769552*^9, 3.73181311271734*^9}, {
   3.731844688853443*^9, 3.731844693635145*^9}, {3.731844736397743*^9, 
   3.731844736610849*^9}, {3.734266083917788*^9, 3.73426617651159*^9}, {
   3.7342667031082497`*^9, 3.734266740303743*^9}, {3.7348111377269087`*^9, 
   3.734811159834401*^9}, 3.734811197730698*^9, {3.744549618606387*^9, 
   3.744549641390853*^9}, 3.744972901622822*^9, {3.74497307372187*^9, 
   3.7449730798908854`*^9}, {3.744977621166894*^9, 3.74497763405333*^9}, {
   3.746402374431889*^9, 3.746402375431698*^9}, 3.750952225611424*^9, {
   3.751132915822219*^9, 3.751132929052327*^9}, {3.756048434205515*^9, 
   3.756048512692367*^9}, {3.7596763157985888`*^9, 3.759676317611559*^9}, {
   3.7596764325150127`*^9, 3.759676445847994*^9}, {3.759760120025305*^9, 
   3.75976012370245*^9}, {3.7598437704767017`*^9, 3.759843792600569*^9}, {
   3.759843836576374*^9, 3.759843849810236*^9}, {3.760014963481963*^9, 
   3.760014963609871*^9}, {3.760015029368877*^9, 3.76001503125421*^9}, 
   3.760047949524866*^9, {3.760049183310687*^9, 3.760049186914229*^9}, {
   3.7600492802481813`*^9, 3.7600494012756577`*^9}, 3.7600495792274733`*^9, 
   3.760113739153512*^9, 3.760113894294313*^9, {3.760883398874414*^9, 
   3.760883398999322*^9}, {3.761323972159629*^9, 3.761324039904641*^9}, {
   3.761326143688493*^9, 3.761326153167594*^9}, {3.7627027220684357`*^9, 
   3.762702734404025*^9}, 3.7627027660797377`*^9, 3.762704172576971*^9, 
   3.762705282682328*^9, {3.763128337079651*^9, 3.7631283547444468`*^9}, {
   3.7631287720657587`*^9, 3.76312878268373*^9}, {3.763230674948629*^9, 
   3.763230709932444*^9}, {3.763298788573433*^9, 3.7632987966903343`*^9}, {
   3.763305989767064*^9, 3.76330600671143*^9}, 3.7633063193212976`*^9, 
   3.7633074836233892`*^9, {3.763336255068391*^9, 3.763336258144706*^9}, {
   3.7633365126424713`*^9, 3.763336514645677*^9}, {3.765196457670403*^9, 
   3.7651964699088717`*^9}, {3.765543110041217*^9, 3.76554311953708*^9}, {
   3.766163621701033*^9, 3.766163624779188*^9}, 3.7673611780444*^9, {
   3.767794584507457*^9, 3.7677945848491993`*^9}, {3.767794712681039*^9, 
   3.76779471701136*^9}, {3.782155284053347*^9, 3.782155286898913*^9}, {
   3.7821553659165487`*^9, 3.782155371419887*^9}, 3.79285801553616*^9, {
   3.792858121671669*^9, 3.792858245440946*^9}, {3.792858376378161*^9, 
   3.792858381366398*^9}, {3.793021658226982*^9, 3.793021661199217*^9}, 
   3.793021996153846*^9, {3.796393019774847*^9, 3.7963930289625387`*^9}, {
   3.7963931100153427`*^9, 3.796393435341324*^9}, {3.79646988690553*^9, 
   3.796469908640148*^9}, {3.796469957105459*^9, 3.796469977442441*^9}, 
   3.7971743396124773`*^9, {3.79768271565606*^9, 3.797682826879341*^9}, {
   3.797682937696763*^9, 
   3.7976829452468357`*^9}},ExpressionUUID->"a4aac333-28c8-45c5-95de-\
46a1c66b075e"],

Cell[TextData[{
 "Index ",
 StyleBox["routines",
  InitializationCell->True]
}], "Text",
 CellChangeTimes->{{3.477347537208624*^9, 
  3.4773475425983887`*^9}},ExpressionUUID->"5a18b0df-c814-424b-8ee5-\
256e918ba3a9"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"tuTensorQ", "::", "usage"}], "=", 
     "\"\<tuTensorQ[exp_] returns True if exp_ is Tensor or tuDerivOps \
*11Sep2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTensorQ", "[", "exp_", "]"}], ":=", 
     RowBox[{"tuMemberQ", "[", 
      RowBox[{
       RowBox[{"Head", "[", "exp", "]"}], ",", 
       RowBox[{"List", "@@", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Tensor", "|", "tuDerivOps"}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Adds", "/", "modifies"}], " ", "index", " ", "to", " ", 
     "existing", " ", 
     RowBox[{"indices", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AddBaseIndex", "[", "index_List", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mname", "=", "\"\<AddBaseIndex\>\""}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "index", "}"}], ",", "\"\<in\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"CompleteBaseIndices", ",", "index"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<tmp\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"tmp", "/.", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"index", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "a_"}], "}"}], "\[Rule]", 
            "index"}]}], "//", "DeleteDuplicates"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<tmp\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"DeclareBaseIndices", "[", 
         RowBox[{"Apply", "[", 
          RowBox[{"Sequence", ",", "tmp"}], "]"}], "]"}], ";", 
        "\[IndentingNewLine]", "CompleteBaseIndices"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "CheckIndices", " ", "applies", " ", "ParseTermIndices", " ", "to", " ", 
     "eech", " ", "level", " ", "2", " ", "term", " ", "in", " ", "exp_.", 
     " ", "4", "Jul2012"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CheckIndices", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ParseTermIndices", "[", "#", "]"}], "&"}], ",", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "tmp"}], "]"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"SwitchLabel", "[", 
       RowBox[{"exp_", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}]}], "]"}], " ", "switches", " ", 
      "label", " ", "a"}], ",", 
     RowBox[{"b", " ", "in", " ", "exp_"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SwitchLabel", "[", 
      RowBox[{"exp_", ",", "mn_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "XXXX"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"tmp", "/.", 
           RowBox[{
            RowBox[{"First", "[", "mn", "]"}], "->", "XXXX"}]}], "/.", 
          RowBox[{
           RowBox[{"Last", "[", "mn", "]"}], "->", 
           RowBox[{"First", "[", "mn", "]"}]}]}], "/.", 
         RowBox[{"XXXX", "->", 
          RowBox[{"Last", "[", "mn", "]"}]}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"SwitchLabel", "[", 
       RowBox[{"exp_", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}]}], "]"}], " ", "switches", " ", 
      "label", " ", "a"}], ",", 
     RowBox[{"b", " ", "in", " ", "exp_"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"SwitchLabel", "[", "mn_List", "]"}], "[", "exp_", "]"}], ":=", 
     
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "XXXX"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"tmp", "/.", 
           RowBox[{
            RowBox[{"First", "[", "mn", "]"}], "->", "XXXX"}]}], "/.", 
          RowBox[{
           RowBox[{"Last", "[", "mn", "]"}], "->", 
           RowBox[{"First", "[", "mn", "]"}]}]}], "/.", 
         RowBox[{"XXXX", "->", 
          RowBox[{"Last", "[", "mn", "]"}]}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexSymmetrize", "::", "usage"}], "=", 
     "\"\<tuIndexSymmetrize[indexPair_List][exp_] symmetrizes exp_ over \
indexPair_. eg: tuIndexSymmetrize[{i,j}][\!\(\*SubscriptBox[\(A\), \
\(ij\)]\)]->(\!\(\*SubscriptBox[\(A\), \(ij\)]\)+\!\(\*SubscriptBox[\(A\), \
\(ji\)]\))/2 . *7Aug2012*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexSymmetrize", "[", "indexPair_List", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp1", ",", "tmp2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"exp", "+", 
          RowBox[{
           RowBox[{"tuIndexSwap", "[", "indexPair", "]"}], "[", "exp", 
           "]"}]}], ")"}], "/", "2"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Symmetrize2", "[", "indexPair_List", "]"}], "[", "exp_", "]"}],
      ":=", 
     RowBox[{
      RowBox[{"tuIndexSymmetrize", "[", "indexPair", "]"}], "[", "exp", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexAntiSymmetrize", "::", "usage"}], "=", 
     "\"\<tuIndexAntiSymmetrize[indexPair_List][exp_] antisymmetrizes exp_ \
over indexPair_. eg: tuIndexAntiSymmetrize[{i,j}][\!\(\*SubscriptBox[\(A\), \
\(ij\)]\)]->(\!\(\*SubscriptBox[\(A\), \(ij\)]\)-\!\(\*SubscriptBox[\(A\), \
\(ji\)]\))/2 . *7Aug2012*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexAntiSymmetrize", "[", "indexPair_List", "]"}], "[", 
      "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp1", ",", "tmp2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"exp", "-", 
          RowBox[{
           RowBox[{"tuIndexSwap", "[", "indexPair", "]"}], "[", "exp", 
           "]"}]}], ")"}], "/", "2"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AntiSymmetrize2", "[", "indexPair_List", "]"}], "[", "exp_", 
     "]"}], ":=", 
    RowBox[{
     RowBox[{"tuIndexAntiSymmetrize", "[", "indexPair", "]"}], "[", "exp", 
     "]"}]}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"Symmetrize", "[", "tensorindex_List", "]"}], "[", "exp_", 
      "]"}], " ", "applies", " ", "a", " ", "list", " ", "of", " ", 
     RowBox[{"{", 
      RowBox[{"tensorindex", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"tensorName", ",", "order", ",", "index_List"}], "}"}], " ",
          "to", " ", "exp_.", "  ", "If", " ", "order"}], " ", "<", " ", 
        RowBox[{
        "0", " ", "then", " ", "index_List", " ", "specify", " ", 
         "AntiSymmetric", " ", 
         RowBox[{"relationship", ".", "  ", "Uses"}], " ", "Tensorial", " ", 
         RowBox[{"routines", ".", " ", "Name"}], " ", "changed", " ", "to", 
         " ", "SymmetrizeTU", " ", "to", " ", "eliminate", " ", "conflicts", 
         " ", "with", " ", "V", 
         RowBox[{".9", "."}], "  ", "*", "3", "Jan2013"}]}]}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"SymmetrizeTU", "[", "tensorindex_", "]"}], "[", "exp_", "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", "tmp2", ",", "up0", 
         ",", "dn0", ",", "up1", ",", "dn1", ",", "order", ",", 
         "Symmetrize1"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Symmetrize1", "[", "tensorindex1_List", "]"}], "[", 
          "exp1_", "]"}], ":=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"tensorindex1", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ">", "0"}], ",", 
           RowBox[{
            RowBox[{"SymmetrizeSlots", "[", 
             RowBox[{
              RowBox[{"tensorindex1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"tensorindex1", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"Symmetric", "[", 
               RowBox[{"Apply", "[", 
                RowBox[{"Sequence", ",", 
                 RowBox[{"tensorindex1", "[", 
                  RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "]"}]}], "]"}], 
            "[", "exp1", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"SymmetrizeSlots", "[", 
             RowBox[{
              RowBox[{"tensorindex1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"-", 
               RowBox[{"tensorindex1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"AntiSymmetric", "[", 
               RowBox[{"Apply", "[", 
                RowBox[{"Sequence", ",", 
                 RowBox[{"tensorindex1", "[", 
                  RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "]"}]}], "]"}], 
            "[", "exp1", "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Fold", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Symmetrize1", "[", "#2", "]"}], "[", "#1", "]"}], "&"}], 
          ",", "tmp", ",", "tensorindex"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"symmetrize", "[", "vars_List", "]"}], "[", "exp_", "]"}], " ", 
     "symmetrizes", " ", "exp_", " ", "wrt", " ", "vars_List", " ", "by", " ",
      "summing", " ", "permutations", " ", "over", " ", 
     RowBox[{"vars_List", ".", "  ", 
      RowBox[{"NOTE", ":", " ", 
       RowBox[{"check", " ", "for", " ", "unusual", " ", 
        RowBox[{"results", "!!"}], " ", "*", "16", "Dec2013"}]}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"symmetrize", "[", "vars_List", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Distribute", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", "tuSymmetrizeSymbol", "]"}], "[", 
            RowBox[{"1", ",", "vars"}], "]"}], "[", "tmp", "]"}], "]"}]}], 
        ";", 
        RowBox[{"(*", 
         RowBox[{
         "Hold", " ", "to", " ", "stop", " ", "evaluation", " ", "before", 
          " ", 
          RowBox[{"Distribute", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "//", "ReleaseHold"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"antisymmetrize", "[", "vars_List", "]"}], "[", "exp_", "]"}], 
     " ", "antisymmetrizes", " ", "exp_", " ", "wrt", " ", "vars_List", " ", 
     "by", " ", "summing", " ", "permutations", " ", "over", " ", 
     RowBox[{"vars_List", "."}], "  ", "*", "16", "Dec2013"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"antisymmetrize", "[", "vars_List", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Distribute", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", "tuSymmetrizeSymbol", "]"}], "[", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "vars"}], "]"}], "[", "tmp", "]"}], 
          "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "Hold", " ", "to", " ", "stop", " ", "evaluation", " ", "before", 
          " ", 
          RowBox[{"Distribute", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "//", "ReleaseHold"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuPermuteSymbol", "::", "usage"}], "=", 
     "\"\<tuPermuteSymbol[sign_,vars_List][exp_] (anti)permutes vars_ in exp_ \
with sign_ used as factor for antisymmetric(-1) or symmetric(1) operation. \
The result is divided by the number of resulting terms.  Suggested use: \
\[IndentingNewLine]%//tuTermApplyEach[{Tensor},{},{},{tuPermuteSymbol[1,{a,b}]\
},1] *9Sep2019*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuPermuteSymbol", "[", 
       RowBox[{"sign_", ",", "vars_List"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", 
         RowBox[{"sum", "=", "0"}], ",", "pos", ",", "posp", ",", "is", ",", 
         "vs", ",", "cycle", ",", "perms", ",", "nperm", ",", "perm"}], "}"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<vars,tmp : \>\"", ",", "vars", ",", "tmp"}], "]"}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", "vars", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"is", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", "pos"}], "]"}]}], 
        ";", " ", "\[IndentingNewLine]", 
        RowBox[{"vs", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "&"}], ",", "pos"}], "]"}]}], 
        ";", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "vs", "]"}], "===", "0"}], ",", 
          RowBox[{"Return", "[", "exp", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"perms", "=", 
         RowBox[{"Permutations", "[", "vs", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"nperm", "=", 
         RowBox[{"Length", "[", "perms", "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"xPrint", "[", 
         RowBox[{"pos", ",", "\"\<,\>\"", ",", "perms"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"posp", "=", 
            RowBox[{"Thread", "[", 
             RowBox[{"Rule", "[", 
              RowBox[{"is", ",", 
               RowBox[{"perms", "[", 
                RowBox[{"[", "$$i", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", "posp", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"sum", "=", 
            RowBox[{"sum", "+", 
             RowBox[{
              RowBox[{
               RowBox[{"(", "sign", ")"}], "^", 
               RowBox[{"(", 
                RowBox[{"$$i", "-", "1"}], ")"}]}], 
              RowBox[{"tuReplacePart", "[", 
               RowBox[{"tmp", ",", "posp"}], "]"}]}]}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"$$i", ",", "nperm"}], "}"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", " ", 
         RowBox[{"sum", "/", "nperm"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"TEST", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"A", ",", "\"\<dd\>\"", ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "b"}], "}"}]}], "]"}], "\[CenterDot]", 
          RowBox[{"T", "[", 
           RowBox[{"B", ",", "\"\<dd\>\"", ",", 
            RowBox[{"{", 
             RowBox[{"c", ",", "d"}], "}"}]}], "]"}], "\[CenterDot]", 
          RowBox[{"T", "[", 
           RowBox[{"C", ",", "\"\<dd\>\"", ",", 
            RowBox[{"{", 
             RowBox[{"e", ",", "f"}], "}"}]}], "]"}]}], "\[IndentingNewLine]",
          "%"}], "//", 
        RowBox[{
         RowBox[{"tuTermApplyEach", "[", 
          RowBox[{
           RowBox[{"{", "Tensor", "}"}], ",", 
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"tuPermuteSymbol", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"a", ",", "b"}], "}"}]}], "]"}], "}"}], ",", "1"}], 
          "]"}], "\[IndentingNewLine]", "%"}]}], "//", 
       RowBox[{
        RowBox[{"tuTermApplyEach", "[", 
         RowBox[{
          RowBox[{"{", "Tensor", "}"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"tuPermuteSymbol", "[", 
            RowBox[{
             RowBox[{"-", "1"}], ",", 
             RowBox[{"{", 
              RowBox[{"c", ",", "d"}], "}"}]}], "]"}], "}"}], ",", "1"}], 
         "]"}], "\[IndentingNewLine]", "%"}]}], "//", 
      RowBox[{"tuTermApplyEach", "[", 
       RowBox[{
        RowBox[{"{", "Tensor", "}"}], ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"tuPermuteSymbol", "[", 
          RowBox[{
           RowBox[{"-", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"A", ",", "B"}], "}"}]}], "]"}], "}"}], ",", "1"}], 
       "]"}]}], "//", "Simplify"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuSymmetrizeSymbol", ":=", "tuPermuteSymbol"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"OrderSymmetricTensor", "[", "tensor_Tensor", "]"}], " ", 
     "Canonical", " ", "orders", " ", "all", " ", "slots", " ", "of", " ", 
     RowBox[{"tensor_Tensor", ".", "  ", "May"}], " ", "be", " ", "useful", 
     " ", "in", " ", "simplifying", " ", "Tensor", " ", 
     RowBox[{"expressions", "."}]}], " ", "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OrderSymmetricTensor", "[", "tensor_Tensor", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "name", ",", "ups", ",", "dns", ",", "indices"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"name", ",", "ups", ",", "dns"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "tensor"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"indices", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"i", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "ups", "]"}]}], "}"}]}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"25", "Apr2012", " ", "untested"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"OrderSymmetricTensor", "[", 
         RowBox[{"tensor", ",", "indices"}], "]"}]}]}], "\[IndentingNewLine]",
       "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"OrderSymmetricTensor", "[", 
      RowBox[{"tensor_Tensor", ",", "indices_List"}], "]"}], " ", "Canonical",
      " ", "orders", " ", "slots", " ", "indices_List", " ", 
     RowBox[{"(", "Integers", ")"}], " ", "of", " ", "tensor_Tensor"}], " ", 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OrderSymmetricTensor", "[", 
      RowBox[{"tensor_Tensor", ",", "indices_List"}], 
      RowBox[{"(*", "Integer", "*)"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "tmps", ",", "tmp0", ",", "sub", ",", "name", ",", "ups", 
         ",", "dns", ",", "nosym", ",", "cases"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"name", ",", "ups", ",", "dns"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "tensor"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"cases", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", "#", "}"}], "&"}], ",", "indices"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"nosym", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", "i", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "ups", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"nosym", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"nosym", ",", "cases"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp0", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"List", "[", 
           RowBox[{"ups", ",", "dns"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmps", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"tmp0", ",", "nosym"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"MapIndexed", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"DeleteCases", "[", 
              RowBox[{"#", ",", "Void"}], "]"}], "[", "#", "]"}], "&"}], ",", 
           "tmps"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", "Sort"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "/.", 
             RowBox[{
              RowBox[{"f_", "[", "a_", "]"}], "->", "a"}]}], "&"}], ",", 
           "tmp"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"sub", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"cases", ",", "tmp"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"ReplacePart", "[", 
           RowBox[{"tmp0", ",", "sub"}], "]"}], "//", "Transpose"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Tensor", "[", 
         RowBox[{"name", ",", 
          RowBox[{"tmp", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"tmp", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]",
       "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTensorAntiSymmetricOrdered", "::", "usage"}], "=", 
     "\"\<tuTensorAntiSymmetricOrdered[tensor_Tensor,indices_List(*Integer*)] \
 Canonically order indices_List Slots of tensor_Tensor multiplied by \
(-1)^Signature[indices] *22May2015*)\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTensorAntiSymmetricOrdered", "[", 
      RowBox[{"tensor_Tensor", ",", "indices_List"}], 
      RowBox[{"(*", "Integer", "*)"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "tmps", ",", "tmp0", ",", "sub", ",", "name", ",", "ups", 
         ",", "dns", ",", "nosym", ",", "cases", ",", "signature"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"name", ",", "ups", ",", "dns"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "tensor"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"cases", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", "#", "}"}], "&"}], ",", "indices"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"nosym", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", "i", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "ups", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"nosym", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"nosym", ",", "cases"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp0", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"List", "[", 
           RowBox[{"ups", ",", "dns"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmps", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"tmp0", ",", "nosym"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"MapIndexed", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"DeleteCases", "[", 
              RowBox[{"#", ",", "Void"}], "]"}], "[", "#", "]"}], "&"}], ",", 
           "tmps"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"signature", "=", 
         RowBox[{"Signature", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", "Sort"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "/.", 
             RowBox[{
              RowBox[{"f_", "[", "a_", "]"}], "->", "a"}]}], "&"}], ",", 
           "tmp"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"sub", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"cases", ",", "tmp"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"ReplacePart", "[", 
           RowBox[{"tmp0", ",", "sub"}], "]"}], "//", "Transpose"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"signature", " ", 
         RowBox[{"Tensor", "[", 
          RowBox[{"name", ",", 
           RowBox[{"tmp", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"tmp", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OrderAntiSymmetricTensor", "[", 
      RowBox[{"tensor_Tensor", ",", "indices_List"}], "]"}], ":=", 
     RowBox[{"tuTensorAntiSymmetricOrdered", "[", 
      RowBox[{"tensor", ",", "indices"}], "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"OrderAntiSymmetricTensor", "[", "tensor_Tensor", "]"}], " ", 
      "Canonical", " ", "orders", " ", "all", " ", "slots", " ", "of", " ", 
      "anti"}], "-", 
     RowBox[{"symmetric", " ", 
      RowBox[{"tensor_Tensor", ".", "  ", "May"}], " ", "be", " ", "useful", 
      " ", "in", " ", "simplifying", " ", "Tensor", " ", 
      RowBox[{"expressions", "."}]}]}], " ", "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OrderAntiSymmetricTensor", "[", "tensor_Tensor", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "name", ",", "ups", ",", "dns", ",", "indices"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"name", ",", "ups", ",", "dns"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "tensor"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"indices", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"i", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "ups", "]"}]}], "}"}]}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"25", "Apr2012", " ", "untested"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"OrderAntiSymmetricTensor", "[", 
         RowBox[{"tensor", ",", "indices"}], "]"}]}]}], "\[IndentingNewLine]",
       "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOrderRiemann", "::", "usage"}], "=", 
     "\"\<tuOrderRiemann[exp_] canonically orders the indices of a 4-indexed \
Riemann tensor ((\!\(\*SuperscriptBox[\(R\), \
\(i\)]\)\!\(\*SubscriptBox[\()\), \(jkl\)]\)] *24Jan2015* \>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuOrderRiemann", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "pos"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", "exp"}], ";", "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Tensor", "[", 
            RowBox[{"R", ",", "_", ",", "_"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"pos", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"R", ",", "\"\<uddd\>\""}], "]"}], "[", 
            RowBox[{"i_", ",", "j_", ",", "k_", ",", "l_"}], "]"}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"R", ",", "\"\<uddd\>\""}], "]"}], "[", 
              RowBox[{"i", ",", "j", ",", "l", ",", "k"}], "]"}]}], "/;", 
            RowBox[{"OrderedQ", "[", 
             RowBox[{"{", 
              RowBox[{"l", ",", "k"}], "}"}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"pos", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"R", ",", "\"\<uddd\>\""}], "]"}], "[", 
            RowBox[{"i_", ",", "j_", ",", "k_", ",", "l_"}], "]"}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"R", ",", "\"\<uddd\>\""}], "]"}], "[", 
              RowBox[{"j", ",", "i", ",", "k", ",", "l"}], "]"}]}], "/;", 
            RowBox[{"OrderedQ", "[", 
             RowBox[{"{", 
              RowBox[{"j", ",", "i"}], "}"}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"tmp", ",", "pos"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSwap", "::", "usage"}], "=", 
     "\"\<tuSwap[this_,that_][exp_] swaps the symbols this_ for that_ in \
exp_. *16Feb2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuSwap", "[", 
       RowBox[{"this_", ",", "that_"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", 
         RowBox[{"pair", "=", 
          RowBox[{"{", 
           RowBox[{"this", ",", "that"}], "}"}]}], ",", "XXXX", ",", "YYYY"}],
         "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"this", "=!=", "that"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pair", "=", 
            RowBox[{"SortBy", "[", 
             RowBox[{"pair", ",", "Length"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"tmp", "//.", 
                RowBox[{
                 RowBox[{"pair", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "\[Rule]", "XXXX"}]}], "//.", 
               RowBox[{
                RowBox[{"pair", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", "YYYY"}]}], "//.", 
              RowBox[{"XXXX", "\[Rule]", 
               RowBox[{"pair", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "//.", 
             RowBox[{"YYYY", "\[Rule]", 
              RowBox[{"pair", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Swap", "[", "pair_List", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuSwap", "[", 
       RowBox[{
        RowBox[{"pair", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"pair", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "[", "exp", "]"}]}], ";"}], 
   
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Swaps", " ", "sequential", " ", "pairs", " ", "of", " ", "anything", " ",
      "in", " ", 
     RowBox[{"expressions", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Swaps", "[", "pairs_List", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mName", "=", "\"\<Swaps\>\""}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mName", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"tmp", ",", "pairs", ",", 
            RowBox[{"Depth", "[", "pairs", "]"}]}], "}"}], ",", 
          "\"\<tmp,pairs\>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", " ", 
         RowBox[{"Fold", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Swap", "[", "#2", "]"}], "[", "#1", "]"}], "&"}], ",", 
           "exp", ",", "pairs"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "tmp"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"SwapVarFromAtoB", "[", 
      RowBox[{"var_", ",", "A_List", ",", "B_List"}], "]"}], " ", "Swap", " ",
      "var_", " ", "in", " ", "A_", " ", "for", " ", "the", " ", 
     "corresponding", " ", "one", " ", "in", " ", "B_.", "  ", "Returns", " ", 
     RowBox[{"{", 
      RowBox[{"A_List", ",", "B_List"}], "}"}], " ", "with", " ", "var_", " ", 
     RowBox[{"Swapped", "."}], "   ", "*", "8", "May2013"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SwapVarFromAtoB", "[", 
      RowBox[{"var_", ",", "A_List", ",", "B_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "pos", ",", "xpos", ",", "i", ",", "len", ",", 
         RowBox[{"xA", "=", "A"}], ",", 
         RowBox[{"xB", "=", "B"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "xA", "]"}], "==", 
           RowBox[{"Length", "[", "xB", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pos", "=", 
            RowBox[{
             RowBox[{"Position", "[", 
              RowBox[{"xA", ",", "var", ",", "1"}], "]"}], "//", 
             "Flatten"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"len", "=", 
            RowBox[{"Length", "[", "pos", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"len", ">", "0"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"For", "[", 
               RowBox[{
                RowBox[{"i", "=", "1"}], ",", 
                RowBox[{"i", "\[LessEqual]", "len"}], ",", 
                RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"xpos", "=", 
                  RowBox[{"pos", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"tmp", "=", 
                  RowBox[{"xB", "[", 
                   RowBox[{"[", "xpos", "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"xB", "[", 
                   RowBox[{"[", "xpos", "]"}], "]"}], "=", 
                  RowBox[{"xA", "[", 
                   RowBox[{"[", "xpos", "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"xA", "[", 
                   RowBox[{"[", "xpos", "]"}], "]"}], "=", "tmp"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"xA", ",", "xB"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Returns", " ", "list", " ", "of", " ", "positions", " ", "in", " ", 
     "list_", " ", "of", " ", "form_", " ", "or", " ", 
     RowBox[{"{", "}"}], " ", "if", " ", "none", " ", 
     RowBox[{"found", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IndicesQ", "[", 
      RowBox[{"list_List", ",", "form_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"pos", "=", 
          RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "0"}], ",", 
          RowBox[{"i", "\[LessEqual]", 
           RowBox[{"Length", "[", "list", "]"}]}], ",", 
          RowBox[{"i", "++"}], ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"list", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "===", "form"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"pos", ",", "i"}], "]"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "pos"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ContractMetric", "[", "\[Delta]_", "]"}], "[", "term_Times", 
       "]"}], " ", "Einstein", " ", "like", " ", "contraction", " ", 
      RowBox[{"(", 
       RowBox[{"up", "/", "dn"}], ")"}], " ", "of", " ", "term_Times", " ", 
      "using", " ", "\[Delta]_", " ", "as", " ", "metric", " ", 
      RowBox[{"variable", ".", " ", "The"}], " ", "choice", " ", "of", " ", 
      "contraction", " ", "indices", " ", "is", " ", "not", " ", "controlled",
       " ", "and", " ", "does", " ", "not", " ", "check", " ", "for", " ", 
      "proper", " ", 
      RowBox[{"up", "/", "dn"}], " ", "relationship", " ", "in", " ", 
      "term_Times"}], ",", " ", 
     RowBox[{
      RowBox[{
      "only", " ", "the", " ", "presence", " ", "of", " ", "\[Delta]", " ", 
       "indices", " ", "as", " ", "symbol", " ", "in", " ", 
       RowBox[{"term_Times", ".", "  ", "Assumes"}], " ", "properly", " ", 
       "formed", " ", "index", " ", "relationships", " ", "in", " ", 
       RowBox[{"term_Times", ".", "  ", "Works"}], " ", "only", " ", "for", 
       " ", "2"}], "-", 
      RowBox[{"component", " ", "\[Delta]_", " ", "metric", " ", 
       RowBox[{"functions", ".", "  ", "Operates"}], " ", "on", " ", 
       "numerator", " ", 
       RowBox[{"only", ".", " ", "Leaves"}], " ", 
       RowBox[{"Tr", "[", "\[Delta]_", "]"}], " ", "to", " ", "be", " ", 
       "computed", " ", "outside", " ", "of", " ", "this", " ", 
       RowBox[{"routine", "."}], "  ", "*", "28", 
       RowBox[{"Jul2013", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ContractMetric", "[", "\[Delta]_", "]"}], "[", "term_", "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"Numerator", "[", "term", "]"}]}], ",", 
         RowBox[{"denom", "=", 
          RowBox[{"Denominator", "[", "term", "]"}]}], ",", "test", ",", 
         "pos", ",", "i", ",", "contractindex", ",", "dummy", ",", "gindex", 
         ",", "flatgindex"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "term", "]"}], "=!=", 
            RowBox[{"(", 
             RowBox[{"Times", "|", "xTimes"}], ")"}]}], "&&", 
           RowBox[{"FreeQ", "[", 
            RowBox[{"term", ",", 
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Delta]", ",", "_", ",", "_"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"Return", "[", "term", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "test"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"test", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"dummy", "=", 
            RowBox[{
             RowBox[{"tuIndexParser", "[", "tmp", "]"}], " ", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<test: \>\"", ",", "test", ",", "dummy"}], "]"}], 
             ";"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"pos", "=", 
            RowBox[{"tmp", "//", 
             RowBox[{"tuExtractPositionPattern", "[", 
              RowBox[{"Tensor", "[", 
               RowBox[{"\[Delta]", ",", "_", ",", "_"}], "]"}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", "=", "1"}], ",", 
             RowBox[{"i", "<=", 
              RowBox[{"Length", "[", "pos", "]"}]}], ",", 
             RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"gindex", "=", 
               RowBox[{
                RowBox[{"tuIndexParser", "[", 
                 RowBox[{"pos", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}], " ", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ";", 
              RowBox[{"(*", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<gindex:\>\"", ",", "gindex"}], "]"}], ";"}], 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"gindex", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "===", 
                 RowBox[{"gindex", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                RowBox[{"(*", 
                 RowBox[{"Self", " ", 
                  RowBox[{"contraction", "?"}]}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"tmp", "=", 
                   RowBox[{"tuReplacePart", "[", 
                    RowBox[{"tmp", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"pos", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "->", "NDim"}], 
                    "}"}]}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"Leave", " ", 
                   RowBox[{"Tr", "[", "g", "]"}], " ", "to", " ", "be", " ", 
                   "determined"}], "<", 
                  RowBox[{
                   RowBox[{"-", "depends"}], " ", "on", " ", 
                   RowBox[{"dimension", "."}]}]}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"Break", "[", "]"}], "\[IndentingNewLine]", ",", 
                RowBox[{"(*", "else", "*)"}], "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"flatgindex", "=", 
                  RowBox[{"Flatten", "[", "gindex", "]"}]}], ";", 
                 RowBox[{"(*", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Print", "[", 
                    RowBox[{"\"\<g: \>\"", ",", 
                    RowBox[{"pos", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "]"}], ";"}], 
                  "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"contractindex", "=", 
                    RowBox[{"Intersection", "[", 
                    RowBox[{"flatgindex", ",", "dummy"}], "]"}]}], ")"}], "=!=", 
                    RowBox[{"{", "}"}]}], ",", 
                   RowBox[{"(*", 
                    RowBox[{"contract", "?"}], "*)"}], "\[IndentingNewLine]", 
                   
                   RowBox[{
                    RowBox[{"tmp", "=", 
                    RowBox[{"Delete", "[", 
                    RowBox[{"tmp", ",", 
                    RowBox[{"pos", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
                    RowBox[{"(*", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<g1: \>\"", ",", 
                    RowBox[{"pos", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", "\"\< : \>\"",
                     ",", "tmp"}], "]"}], ";"}], "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"dummy", ",", 
                    RowBox[{"flatgindex", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ",", 
                    RowBox[{"(*", 
                    RowBox[{"contraction", " ", 
                    RowBox[{"direction", "?"}]}], "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"flatgindex", "=", 
                    RowBox[{"Reverse", "[", "flatgindex", "]"}]}]}], "]"}], 
                    ";", 
                    RowBox[{"(*", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<>>\>\"", ",", "contractindex", ",", "\"\<:\>\"", ",",
                     "flatgindex"}], "]"}], ";"}], "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"gindex", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "==", 
                    RowBox[{"{", "}"}]}], "||", 
                    RowBox[{
                    RowBox[{"gindex", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "==", 
                    RowBox[{"{", "}"}]}]}], ",", 
                    RowBox[{"(*", 
                    RowBox[{"UpDn", " ", "adjust"}], "*)"}], 
                    RowBox[{"tmp", "=", 
                    RowBox[{
                    RowBox[{"UpDownIndexSwap", "[", 
                    RowBox[{"flatgindex", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", "tmp", 
                    "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"tmp", "=", 
                    RowBox[{
                    RowBox[{"ReplaceIndexTU", "[", 
                    RowBox[{"Apply", "[", 
                    RowBox[{"Sequence", ",", "flatgindex"}], "]"}], "]"}], 
                    "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"Break", "[", "]"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Continue", "[", "]"}]}]}], "\[IndentingNewLine]", 
               "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "/", "denom"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ContractUpDn", "[", "\[Delta]_", "]"}], "[", "exp_", "]"}], 
      " ", "Einstein", " ", "like", " ", "contraction", " ", 
      RowBox[{"(", 
       RowBox[{"up", "/", "dn"}], ")"}], " ", "of", " ", "terms", " ", "in", 
      " ", "exp_", " ", "using", " ", "\[Delta]_", " ", "as", " ", "metric", 
      " ", "variable", " ", "contained", " ", "in", " ", "each", " ", "term", 
      " ", "of", " ", "exp_.", " ", "The", " ", "choice", " ", "of", " ", 
      "contraction", " ", "indices", " ", "is", " ", "not", " ", "controlled",
       " ", "and", " ", "does", " ", "not", " ", "check", " ", "for", " ", 
      "proper", " ", 
      RowBox[{"up", "/", "dn"}], " ", "relationship", " ", "in", " ", 
      "exp_"}], ",", " ", 
     RowBox[{
      RowBox[{
      "only", " ", "the", " ", "presence", " ", "of", " ", "\[Delta]", " ", 
       "indices", " ", "as", " ", "symbol", " ", "in", " ", "exp_.", " ", 
       "Assumes", " ", "properly", " ", "formed", " ", "index", " ", 
       "relationships", " ", "in", " ", "exp_.", " ", "Works", " ", "only", 
       " ", "for", " ", "2"}], "-", 
      RowBox[{"component", " ", "\[Delta]_", " ", 
       RowBox[{"functions", ".", " ", "\[IndentingNewLine]", "Replaced"}], 
       " ", "*", "1", 
       RowBox[{"Mar2013", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ContractUpDn", "[", "\[Delta]_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], 
         RowBox[{"(*", 
          RowBox[{"Do", " ", "ExpandAll", " ", "to", " ", "Reduce", " ", 
           RowBox[{"complexity", ".", " ", "But"}], " ", "may", " ", 
           "generate", " ", "inconsistent", " ", "dummy", " ", 
           RowBox[{"indices", "."}]}], "*)"}], ",", "pos", ",", "tmp1", ",", 
         "indices", ",", "sub", ",", "up", ",", "dn", ",", "test", ",", 
         "dummy", ",", "contract", ",", "i", ",", "gindex", ",", 
         "contractindex"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Extract", " ", 
         RowBox[{"Times", "[", 
          RowBox[{"\[Delta]", ",", "..."}], "]"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pos", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Delta]", ",", "a_", ",", "b_"}], "]"}], " ", "c_"}], 
           "]"}]}]}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{
         "BUG", " ", "does", " ", "not", " ", "find", " ", "straight", " ", 
          "Times", " ", "term"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "->", 
             RowBox[{
              RowBox[{"ContractMetric", "[", "\[Delta]", "]"}], "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "&"}], ",", "pos"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"tmp", ",", "pos"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"[", 
        RowBox[{"\[Delta]_", ",", "index_List"}], "]"}], "[", "exp_", "]"}], 
      " ", "Einstein", " ", "like", " ", "contraction", " ", 
      RowBox[{"(", 
       RowBox[{"up", "/", "dn"}], ")"}], " ", "of", " ", "terms", " ", "in", 
      " ", "exp_", " ", "using", " ", "\[Delta]_", " ", "as", " ", "metric", 
      " ", 
      RowBox[{"variable", ".", " ", "The"}], " ", "contraction", " ", "uses", 
      " ", "indices", " ", "ONLY", " ", "in", " ", 
      RowBox[{"index_List", ".", "  ", "Does"}], " ", "nothing", " ", "if", 
      " ", "exp_", " ", "indices", " ", "in", " ", "error"}], ",", " ", 
     RowBox[{
     "only", " ", "the", " ", "presence", " ", "of", " ", "\[Delta]", " ", 
      "indices", " ", "as", " ", "symbol", " ", "in", " ", "exp_.", " ", 
      "\[IndentingNewLine]", "\[Delta]_", " ", "is", " ", "Tensor", " ", "of",
       " ", "rank", " ", "2.", "  ", "Expanded", " ", "to", " ", "handle", 
      " ", "ops", " ", "at", " ", "Level", " ", "1.", "  ", "*", "19", 
      RowBox[{"Sep2014", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ContractUpDn", "[", 
       RowBox[{"\[Delta]_", ",", "index_List"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"ExpandAll", "[", "exp", "]"}]}], 
         RowBox[{"(*", 
          RowBox[{"Minimize", " ", "complex", " ", "expressions"}], "*)"}], 
         ",", "sub", ",", "test", ",", 
         RowBox[{"ops", "=", 
          RowBox[{"Times", "|", "Dot", "|", "xDot"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"simpleDot3", "[", 
           RowBox[{"{", 
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Delta]", ",", "up_List", ",", "dn_List"}], "]"}], 
            "}"}], "]"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"Assume", " ", "\[Delta]_", " ", "is", " ", "scalar"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"op", ":", 
            RowBox[{"ops", "[", " ", "A__", "]"}]}], ":>", 
           RowBox[{"tuIndexContractUpDn", "[", 
            RowBox[{"op", ",", "\[Delta]", ",", "index"}], "]"}]}]}]}]}]}], 
      RowBox[{"(*", 
       RowBox[{"Only", " ", "level", " ", "1", " ", "product", " ", 
        RowBox[{"terms", "."}]}], "*)"}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuIndexEliminateEta", "]"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexEliminateEta", "::", "usage"}], "=", 
     "\"\<tuIndexEliminateEta[exp_,noEta_,eta_,ups_List,dns_List,index_List] \
applies Einstein summing in exp_ over Tensor[eta_,ups_,dns_] containing \
indices index_. noEta_ contains exp_ without the eta_ Tensor. \
*11Nov2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexEliminateEta", "[", 
      RowBox[{
      "exp_", ",", "noEta_", ",", "eta_", ",", "ups_List", ",", "dns_List", 
       ",", "index_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "up", ",", "dn", ",", "upi", ",", "dni", ",", "noEtadummies", ",", 
         "noEtaup", ",", "noEtadn", ",", "noEtabad"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"up", "=", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"ups", ",", "Void"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dn", "=", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"dns", ",", "Void"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{
         "\"\<tuIndexEliminateEta:\>\"", ",", "noEta", ",", "\"\<,\>\"", ",", 
          "eta", ",", "\"\<,\>\"", ",", "up", ",", "dn", ",", "index"}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"upi", "=", 
         RowBox[{"Intersection", "[", 
          RowBox[{"up", ",", "index"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dni", "=", 
         RowBox[{"Intersection", "[", 
          RowBox[{"dn", ",", "index"}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<upi,dni:\>\"", ",", "upi", ",", "dni", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"upi", ",", "dni"}], "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"noEtadummies", ",", 
           RowBox[{"{", 
            RowBox[{"noEtaup", ",", "noEtadn"}], "}"}], ",", "noEtabad"}], 
          "}"}], "=", 
         RowBox[{"tuIndexParser", "[", "noEta", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"{", 
          RowBox[{"noEtadummies", ",", 
           RowBox[{"{", 
            RowBox[{"noEtaup", ",", "noEtadn"}], "}"}], ",", "noEtabad"}], 
          "}"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"tuFreeQ", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"up", ",", "dn"}], "]"}], ",", "index"}], "]"}], "||", 
           RowBox[{"up", "===", "dn"}], "||", 
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"upi", ",", "dni"}], "]"}], "]"}], "<", "1"}], "||", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Union", "[", 
             RowBox[{
              RowBox[{"Intersection", "[", 
               RowBox[{"up", ",", "noEtadn"}], "]"}], ",", 
              RowBox[{"Intersection", "[", 
               RowBox[{"dn", ",", "noEtaup"}], "]"}]}], "]"}], "\[Equal]", 
            RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", ",", 
          RowBox[{"Return", "[", "exp", "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "eta", " ", "has", " ", "no", " ", "sum", " ", "index", " ", "or", 
          " ", "same", " ", "indices"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{
         "\"\<BB:\>\"", ",", "up", ",", "dn", ",", "index", ",", "upi", ",", 
          "dni"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "up", "]"}], "==", "1"}], "&&", 
           RowBox[{
            RowBox[{"Length", "[", "dn", "]"}], "==", "1"}]}], ",", 
          RowBox[{"(*", 
           RowBox[{"updn", " ", "situation"}], "*)"}], "\[IndentingNewLine]", 
          
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"tuMemberQ", "[", 
              RowBox[{"upi", ",", "index"}], "]"}], "&&", 
             RowBox[{
              RowBox[{"Intersection", "[", 
               RowBox[{"upi", ",", "noEtadn"}], "]"}], "\[NotEqual]", 
              RowBox[{"{", "}"}]}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tuIndexReplace", "[", 
              RowBox[{
               RowBox[{"upi", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"dn", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", "noEta", "]"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tuIndexReplace", "[", 
              RowBox[{
               RowBox[{"dni", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"up", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", "noEta", 
             "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "up", "]"}], "==", "2"}], ",", 
            RowBox[{"(*", 
             RowBox[{"upup", " ", "situation"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"MemberQ", "[", 
                RowBox[{"index", ",", 
                 RowBox[{"up", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&&", 
               RowBox[{
                RowBox[{"Intersection", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"up", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", "noEtadn"}], 
                 "]"}], "\[NotEqual]", 
                RowBox[{"{", "}"}]}]}], ",", 
              RowBox[{
               RowBox[{"xPrint", "[", 
                RowBox[{"\"\<UU \>\"", ",", 
                 RowBox[{"up", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<:\>\"", ",", 
                 RowBox[{"up", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<:\>\"", ",", 
                 "noEta", ",", "\"\<:\>\"", ",", "exp"}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"tuIndicesRaise", "[", 
                 RowBox[{
                  RowBox[{"up", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"up", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "[", "noEta", 
                "]"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"tuIndicesRaise", "[", 
                RowBox[{
                 RowBox[{"up", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", 
                 RowBox[{"up", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", "noEta", 
               "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"MemberQ", "[", 
                RowBox[{"index", ",", 
                 RowBox[{"dn", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&&", 
               RowBox[{
                RowBox[{"Intersection", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"dn", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", "noEtaup"}], 
                 "]"}], "\[NotEqual]", 
                RowBox[{"{", "}"}]}]}], ",", 
              RowBox[{"(*", 
               RowBox[{"dndn", " ", "situation"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"tuIndicesLower", "[", 
                RowBox[{
                 RowBox[{"dn", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", 
                 RowBox[{"dn", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "[", "noEta", 
               "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"tuIndicesLower", "[", 
                RowBox[{
                 RowBox[{"dn", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", 
                 RowBox[{"dn", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", "noEta", 
               "]"}]}], "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]",
            "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuIndexContractUpDn", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexContractUpDn", "::", "usage"}], "=", 
     "\"\<tuIndexContractUpDn[\[Delta]_,index_List] [exp_] Einstein contracts \
over index_List for Tensor[\[Delta]_,_,_] contained in exp_(a contractable \
term: {Times, dotOps}). Only works on expressions with valid index \
combinations. e.g., exp/. pp: \
productOps[a_,b__]\[RuleDelayed]tuIndexContractUpDn[g,{d}][pp] \
*11Nov2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexContractUpDn", "[", 
       RowBox[{"\[Delta]_", ",", "index_List"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "doIt", ",", "$test", ",", "dummy", 
         ",", "error", ",", "updn", ",", "tensors", ",", "$deltas", ",", 
         "$pos", ",", "$a"}], "}"}], ",", 
       RowBox[{"(*", 
        RowBox[{
        "terms", " ", "are", " ", "product", " ", "of", " ", "these", " ", 
         "operators"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"dummy", ",", "updn", ",", "error"}], "}"}], "=", 
         RowBox[{"tuIndexParser", "[", "$", "]"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<00: \>\"", ",", "$", ",", "\"\<:\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"dummy", ",", "updn", ",", "error"}], "}"}], ",", 
          "\"\<:\>\"", ",", "index"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Intersection", "[", 
             RowBox[{"dummy", ",", "index"}], "]"}], "==", 
            RowBox[{"{", "}"}]}], "||", 
           RowBox[{"error", "!=", 
            RowBox[{"{", "}"}]}]}], ",", 
          RowBox[{"Return", "[", "$", "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"No", " ", "proper", " ", "dummy", " ", "index"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"**", "**"}], "******)"}], "\[IndentingNewLine]", 
        RowBox[{"$deltas", "=", 
         RowBox[{"$", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Delta]", ",", "_", ",", "_"}], "]"}], "]"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"List", " ", "of", " ", "possible", " ", "deltas"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{
         "\"\<$deltas: \>\"", ",", "$deltas", ",", "\"\<:\>\"", ",", "$"}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"$pos", "=", 
            RowBox[{"$deltas", "[", 
             RowBox[{"[", "ipos", "]"}], "]"}]}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<$pos: \>\"", ",", "$pos"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"tuHasNoneQ", "[", 
              RowBox[{
               RowBox[{"$pos", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "index"}], "]"}], ",", 
             RowBox[{"Continue", "[", "]"}]}], " ", "]"}], ";", 
           RowBox[{"(*", 
            RowBox[{"No", " ", "index"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"$pos", "=", 
            RowBox[{"$", "//", 
             RowBox[{"tuExtractPositionPattern", "[", "  ", 
              RowBox[{"$pos", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "  ", "]"}]}]}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<>>> \>\"", ",", "$pos"}], "]"}], ";", 
           RowBox[{"(*", 
            RowBox[{"Get", " ", "$", " ", "position"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"$pos", "\[Equal]", 
              RowBox[{"{", "}"}]}], ",", 
             RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
           RowBox[{"(*", 
            RowBox[{"Not", " ", "found"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{
            "\"\<>>\>\"", ",", "$", ",", "\"\<:\>\"", ",", "\[Delta]", ",", 
             "\"\<:\>\"", ",", 
             RowBox[{"$pos", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<:\>\"", ",", 
             RowBox[{"$pos", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"$pos", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2", ",", "3"}], "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$a", "=", 
            RowBox[{"Delete", "[", 
             RowBox[{"$", ",", 
              RowBox[{"$pos", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", " ", 
           RowBox[{"xPrint", "[", 
            RowBox[{
            "\"\<$a: \>\"", ",", "$", ",", "\"\<:\>\"", ",", "$a", ",", 
             "\"\<:\>\"", ",", "\[Delta]", ",", "\"\<:\>\"", ",", 
             RowBox[{"$pos", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"$pos", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2", ",", "3"}], "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"tuIndexEliminateEta", "[", 
             RowBox[{"$", ",", "$a", ",", "\[Delta]", ",", 
              RowBox[{"$pos", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2", ",", "2"}], "]"}], "]"}], ",", 
              RowBox[{"$pos", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2", ",", "3"}], "]"}], "]"}], ",", 
              "index"}], "]"}]}]}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"ipos", ",", 
            RowBox[{"Length", "[", "$deltas", "]"}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "$"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexContractUpDn", "[", 
      RowBox[{"exp_", ",", "\[Delta]_", ",", "index_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexContractUpDn", "[", 
       RowBox[{"\[Delta]", ",", "index"}], "]"}], "[", "exp", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"subContractUpDn", "[", 
      RowBox[{"exp_", ",", "\[Delta]_", ",", "index_List"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexContractUpDn", "[", 
       RowBox[{"\[Delta]", ",", "index"}], "]"}], "[", "exp", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexContractAll", "::", "usage"}], "=", 
     "\"\<tuIndexContractAll[\[Delta]_] [exp_] Einstein contracts dummy \
indices in productOps terms containing Tensor[\[Delta]_,_,_] of exp_. \
*5Mar2020*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexContractAll", "[", "g_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", ",", "$dummy"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"Expand", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$1", "=", 
         RowBox[{"$", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"productOps", "[", "__", "]"}], "]"}]}]}], ";", 
        RowBox[{"xPrint", "[", "$1", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$1", "=", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"$1", ",", 
           RowBox[{
            RowBox[{"{", "}"}], "\[Rule]", "_"}]}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", "$1", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$1", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"$dummy", "=", 
               RowBox[{
                RowBox[{"tuIndexParser", "[", "#", "]"}], "//", "First"}]}], 
              RowBox[{"(*", 
               RowBox[{"dummy", " ", "indices"}], "*)"}], ";", 
              RowBox[{
               RowBox[{"tuIndexContractUpDn", "[", 
                RowBox[{"g", ",", "$dummy"}], "]"}], "[", "#", "]"}]}], ")"}],
             "&"}], ",", "$1"}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", "$1", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"$", ",", "$1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ContractUpDnNot", "[", 
        RowBox[{"\[Delta]_", ",", "index_List"}], "]"}], "[", "exp_", "]"}], 
      " ", "Einstein", " ", "like", " ", "contraction", " ", 
      RowBox[{"(", 
       RowBox[{"up", "/", "dn"}], ")"}], " ", "of", " ", "terms", " ", "in", 
      " ", "exp_", " ", "using", " ", "\[Delta]_", " ", "as", " ", "metric", 
      " ", 
      RowBox[{"variable", ".", " ", "The"}], " ", "contraction", " ", "does", 
      " ", "NOT", " ", "use", " ", "indices", " ", "in", " ", "index_List"}], 
     ",", " ", 
     RowBox[{
     "but", " ", "the", " ", "use", " ", "of", " ", "other", " ", "indices", 
      " ", "is", " ", "not", " ", 
      RowBox[{"controlled", ".", "  ", "Does"}], " ", "not", " ", "check", 
      " ", "for", " ", "proper", " ", 
      RowBox[{"up", "/", "dn"}], " ", "relationship", " ", "in", " ", 
      "exp_"}], ",", " ", 
     RowBox[{
     "only", " ", "the", " ", "presence", " ", "of", " ", "\[Delta]", " ", 
      "indices", " ", "as", " ", "symbol", " ", "in", " ", "exp_.", " ", 
      "Assumes", " ", "properly", " ", "formed", " ", "index", " ", 
      "relationships", " ", "in", " ", "exp_.", "\[IndentingNewLine]", 
      "CHECK", " ", "WITH", " ", "NEW", " ", "VERSION", " ", "of", " ", 
      "ContractUpDn", "\[IndentingNewLine]", "Repaired", "*", "11", 
      RowBox[{"Dec2012", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ContractUpDnNot", "[", 
      RowBox[{"\[Delta]_", ",", "index_List"}], "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"ExpandAll", "[", "exp", "]"}]}], 
        RowBox[{"(*", 
         RowBox[{"Minimize", " ", "complex", " ", "expressions"}], "*)"}], 
        ",", "sub", ",", "up", ",", "dn", ",", "test", ",", "dummy"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"test", "[", 
         RowBox[{"A_", ",", "from_", ",", "to_"}], "]"}], ":=", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"A", ",", "from"}], "]"}]}], "&&", 
         RowBox[{"!", 
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"from", ",", "to"}], "}"}], ",", "Void"}], "]"}]}], "&&", 
         RowBox[{"ListFreeQ", "[", 
          RowBox[{"from", ",", "index"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sub", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Delta]", ",", 
              RowBox[{"{", 
               RowBox[{"up1_", ",", "up2_"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"dn1_", ",", "dn2_"}], "}"}]}], "]"}], "A_"}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{
             RowBox[{"tuIndicesLower", "[", 
              RowBox[{"dn1", ",", "dn2"}], "]"}], "[", "A", "]"}], "/;", 
            RowBox[{"test", "[", 
             RowBox[{"A", ",", "dn1", ",", "dn2"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Delta]", ",", 
              RowBox[{"{", 
               RowBox[{"up1_", ",", "up2_"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"dn1_", ",", "dn2_"}], "}"}]}], "]"}], "A_"}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{
             RowBox[{"tuIndicesLower", "[", 
              RowBox[{"dn2", ",", "dn1"}], "]"}], "[", "A", "]"}], "/;", 
            RowBox[{"test", "[", 
             RowBox[{"A", ",", "dn2", ",", "dn1"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Delta]", ",", 
              RowBox[{"{", 
               RowBox[{"up1_", ",", "up2_"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"dn1_", ",", "dn2_"}], "}"}]}], "]"}], "A_"}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{
             RowBox[{"tuIndicesLower", "[", 
              RowBox[{"up1", ",", "up2"}], "]"}], "[", "A", "]"}], "/;", 
            RowBox[{"test", "[", 
             RowBox[{"A", ",", "up1", ",", "up2"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Delta]", ",", 
              RowBox[{"{", 
               RowBox[{"up1_", ",", "up2_"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"dn1_", ",", "dn2_"}], "}"}]}], "]"}], "A_"}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{
             RowBox[{"tuIndicesLower", "[", 
              RowBox[{"up2", ",", "up1"}], "]"}], "[", "A", "]"}], "/;", 
            RowBox[{"test", "[", 
             RowBox[{"A", ",", "up2", ",", "up1"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"term", ":", 
            RowBox[{
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Delta]", ",", "ups_", ",", "dns_"}], "]"}], "A_"}]}],
            "\[RuleDelayed]", 
           RowBox[{"If", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"up", "=", 
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{"ups", ",", "Void"}], "]"}]}], "]"}], "==", "1"}], "&&",
               "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"dn", "=", 
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{"dns", ",", "Void"}], "]"}]}], "]"}], "==", "1"}], "&&",
               "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"dummy", "=", 
                 RowBox[{
                  RowBox[{"tuIndexParser", "[", 
                   RowBox[{
                    RowBox[{"Tensor", "[", 
                    RowBox[{"\[Delta]", ",", "ups", ",", "dns"}], "]"}], 
                    "A"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "=!=", 
               RowBox[{"{", "}"}]}]}], ",", 
             RowBox[{"(*", 
              RowBox[{"expect", " ", "only", " ", "1", " ", "index"}], "*)"}],
              "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"xPrint", "[", 
               RowBox[{"dummy", ",", "dn", ",", "up"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{"dn", ",", 
                  RowBox[{"dummy", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                RowBox[{
                 RowBox[{"ReplaceIndexTU", "[", 
                  RowBox[{
                   RowBox[{"dummy", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"up", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", "A", "]"}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"up", ",", 
                    RowBox[{"dummy", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"ReplaceIndexTU", "[", 
                    RowBox[{
                    RowBox[{"dummy", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"dn", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", "A", 
                   "]"}]}], "]"}]}], "  ", "]"}]}], "\[IndentingNewLine]", 
             ",", "\[IndentingNewLine]", "term"}], "\[IndentingNewLine]", 
            "]"}]}]}], "\[IndentingNewLine]", "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", "sub"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Contract", "[", "\[Delta]_", "]"}], "[", "exp_", "]"}], " ", 
      "does", " ", "Kronecker", " ", "like", " ", "contraction", " ", "on", 
      " ", "exp_", " ", "containing", " ", 
      SubscriptBox["\[Delta]", 
       RowBox[{"i", ",", "j", " "}]], "over", " ", "all", " ", "i"}], ",", 
     RowBox[{"j", " ", 
      RowBox[{"indices", ".", " ", "No"}], " ", "control", " ", "over", " ", 
      "which", " ", "index", " ", "is", " ", 
      RowBox[{"used", ".", "  ", "Ignores"}], " ", 
      RowBox[{"up", "/", "dn"}], " ", "positions", " ", "of", " ", 
      RowBox[{"indices", "."}], " ", "\[IndentingNewLine]", "*", "16", 
      RowBox[{"Oct2014", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Contract", "[", "\[Delta]_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$tmp", "=", 
          RowBox[{"ExpandAll", "[", "exp", "]"}]}], 
         RowBox[{"(*", 
          RowBox[{"Minimize", " ", "complex", " ", "expressions"}], "*)"}], 
         ",", "contract", ",", "$XX"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"contract", "[", 
          RowBox[{"term_", ",", "updn0_List", ",", "A_"}], "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"updn", ",", 
             RowBox[{"ret", "=", "term"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"updn", "=", 
             RowBox[{"DeleteCases", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", "updn0", "]"}], ",", "Void"}], "]"}]}],
             ";", 
            RowBox[{"xPrint", "[", "updn", "]"}], ";", "\[IndentingNewLine]", 
            
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "updn", "]"}], "\[Equal]", "2"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"updn", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "===", 
                 RowBox[{"updn", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                RowBox[{"ret", "=", "A"}], ",", 
                RowBox[{
                 RowBox[{"xPrint", "[", "Xupdn", "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"!", 
                    RowBox[{"ListFreeQ", "[", 
                    RowBox[{"A", ",", "updn"}], "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"xPrint", "[", "xupdn", "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"ret", "=", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"A", ",", 
                    RowBox[{"updn", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"A", "/.", 
                    RowBox[{"Rule", "[", 
                    RowBox[{
                    RowBox[{"updn", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"updn", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"A", "/.", 
                    RowBox[{"Rule", "[", 
                    RowBox[{
                    RowBox[{"updn", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"updn", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], "]"}]}]}], 
                   ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"xPrint", "[", "A", "]"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}]}], ",", "\[IndentingNewLine]", 
                
                RowBox[{
                 RowBox[{"Print", "[", "ret", "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], 
            ";", "\[IndentingNewLine]", "ret"}]}], "\[IndentingNewLine]", 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"$tmp", "//.", 
          RowBox[{
           RowBox[{"dd", ":", 
            RowBox[{
             RowBox[{"Tensor", "[", 
              RowBox[{"\[Delta]", ",", "ups_", ",", "dns_"}], "]"}], "A_"}]}],
            "\[RuleDelayed]", 
           RowBox[{"contract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{
                RowBox[{"$XX", "[", "\[Delta]", "]"}], ",", "ups", ",", 
                "dns"}], "]"}], "A"}], ",", 
             RowBox[{"{", 
              RowBox[{"ups", ",", "dns"}], "}"}], ",", "A"}], "]"}]}]}], "/.", 
         RowBox[{
          RowBox[{"$XX", "[", "a_", "]"}], "\[Rule]", "a"}]}]}]}], " ", 
      RowBox[{"(*", 
       RowBox[{
       "The", " ", "$XX", " ", "helps", " ", "cover", " ", "multiple", " ", 
        RowBox[{"\[Delta]", "'"}], 
        RowBox[{"s", "."}]}], " ", "*)"}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuKroneckerDeltaEliminate", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuKroneckerDeltaEliminate", "::", "usage"}], "=", 
     "\"\<tuKroneckerDeltaEliminate[\[Delta]_,index_List][exp_] eliminates \
KroneckerDelta \[Delta] indices specified by index_List of productOps terms \
found in exp_. Leaves 1 in place of \[Delta][] in exp_. *6Oct2016*\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuKroneckerDeltaEliminate", "[", 
       RowBox[{"\[Delta]_", ",", "index_List"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$p"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$p", "=", 
         RowBox[{"$", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"productOps", "[", "__", "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$p", "=", 
         RowBox[{"$p", "//", "tuPositionNestDelete"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$p", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"MapAt", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Fold", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"tuKroneckerDeltaEliminate1", "[", 
                    RowBox[{"\[Delta]", ",", 
                    RowBox[{"{", "#2", "}"}]}], "]"}], "[", "#1", "]"}], 
                  "&"}], ",", "#", ",", "index"}], "]"}], "&"}], ",", "#", 
              ",", "2"}], "]"}], "&"}], ",", "$p"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"$", ",", "$p"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuKroneckerDeltaEliminate1", "[", 
       RowBox[{"\[Delta]_", ",", "index_List"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$1", ",", "$s"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"MatchQ", "[", 
            RowBox[{
             RowBox[{"Head", "[", "exp", "]"}], ",", "productOps"}], "]"}]}], 
          ",", 
          RowBox[{"Return", "[", "exp", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$1", "=", 
         RowBox[{"$", "//", 
          RowBox[{"tuExtractPattern", "[", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Delta]", ",", "_", ",", "_"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$1", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"$1", ",", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"tuFreeQ", "[", 
              RowBox[{"#", ",", "index"}], "]"}]}], "&"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$1", "=", 
         RowBox[{"{", 
          RowBox[{"$1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "}"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "Only", " ", "contract", " ", "on", " ", "First", " ", "\[Delta]"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"tuIndexParser", "[", "$1", "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}], "//", "Flatten"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{"$s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", 
          RowBox[{"$s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"tuRuleSolve", "[", 
          RowBox[{"$s", ",", "index"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"$", "/.", "$s"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Delta]", ",", "\"\<dd\>\""}], "]"}], "[", 
              RowBox[{"a_", ",", "a_"}], "]"}], "\[Rule]", "1"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Delta]", ",", "\"\<uu\>\""}], "]"}], "[", 
              RowBox[{"a_", ",", "a_"}], "]"}], "\[Rule]", "1"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Delta]", ",", "\"\<ud\>\""}], "]"}], "[", 
              RowBox[{"a_", ",", "a_"}], "]"}], "\[Rule]", "1"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Delta]", ",", "\"\<du\>\""}], "]"}], "[", 
              RowBox[{"a_", ",", "a_"}], "]"}], "\[Rule]", "1"}]}], "}"}]}]}],
         ";", "\[IndentingNewLine]", "$"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"Contract", "[", 
       RowBox[{"\[Delta]_", ",", "index_List"}], "]"}], "[", "exp_", "]"}], 
     " ", "does", " ", "Kronecker", " ", "contraction", " ", "on", " ", 
     "terms", " ", "in", " ", "exp_", " ", "containing", " ", "\[Delta]", " ",
      "over", " ", "ONLY", " ", "indices", " ", "contained", " ", "in", " ", 
     RowBox[{"index_List", ".", "  ", "Ignores"}], " ", 
     RowBox[{"up", "/", "dn"}], " ", "positions", " ", "of", " ", 
     RowBox[{"indices", ".", " ", "\[IndentingNewLine]", "26"}], 
     RowBox[{"Apr2012", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Contract", "[", 
       RowBox[{"\[Delta]_", ",", "index_List"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"ExpandAll", "[", "exp", "]"}]}], 
         RowBox[{"(*", 
          RowBox[{"Minimize", " ", "complex", " ", "expressions"}], "*)"}], 
         ",", "sub", ",", "updn"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sub", "=", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Delta]", ",", "ups_", ",", "dns_"}], "]"}], "A_"}], 
           "\[RuleDelayed]", 
           RowBox[{"If", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"(", 
                 RowBox[{"updn", "=", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"ups", ",", "Void"}], "]"}], ",", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"dns", ",", "Void"}], "]"}]}], "}"}], "]"}]}], 
                 ")"}], "]"}], "==", "2"}], "&&", 
              RowBox[{"!", " ", 
               RowBox[{"ListFreeQ", "[", 
                RowBox[{"A", ",", "updn"}], "]"}]}], "&&", 
              RowBox[{"!", 
               RowBox[{"ListFreeQ", "[", 
                RowBox[{"updn", ",", "index"}], "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"A", "/.", 
                RowBox[{
                 RowBox[{"updn", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ":>", 
                 RowBox[{
                  RowBox[{"updn", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "/;", 
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"index", ",", 
                    RowBox[{"updn", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "/.", 
               RowBox[{
                RowBox[{"updn", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ":>", 
                RowBox[{
                 RowBox[{"updn", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "/;", 
                 RowBox[{"MemberQ", "[", 
                  RowBox[{"index", ",", 
                   RowBox[{"updn", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], ")"}], ",",
              "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"\[Delta]", ",", "ups", ",", "dns"}], "]"}], "A"}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", "sub"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"ContractNot", "[", 
       RowBox[{"\[Delta]_", ",", "index_List"}], "]"}], "[", "exp_", "]"}], 
     " ", "does", " ", "Kronecker", " ", "contraction", " ", "on", " ", 
     "terms", " ", "in", " ", "exp_", " ", "containing", " ", "\[Delta]", " ",
      "over", " ", "all", " ", "indices", " ", "EXCEPT", " ", "ones", " ", 
     "in", " ", 
     RowBox[{"index_List", ".", "  ", "Ignores"}], " ", 
     RowBox[{"up", "/", "dn"}], " ", "positions", " ", "of", " ", 
     RowBox[{"indices", ".", " ", "\[IndentingNewLine]", "26"}], 
     RowBox[{"Apr2012", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ContractNot", "[", 
       RowBox[{"\[Delta]_", ",", "index_List"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"ExpandAll", "[", "exp", "]"}]}], 
         RowBox[{"(*", 
          RowBox[{"Minimize", " ", "complex", " ", "expressions"}], "*)"}], 
         ",", "sub", ",", "updn"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sub", "=", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Delta]", ",", "ups_", ",", "dns_"}], "]"}], "A_"}], 
           "\[RuleDelayed]", 
           RowBox[{"If", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"(", 
                 RowBox[{"updn", "=", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"ups", ",", "Void"}], "]"}], ",", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"dns", ",", "Void"}], "]"}]}], "}"}], "]"}]}], 
                 ")"}], "]"}], "==", "2"}], "&&", 
              RowBox[{"!", " ", 
               RowBox[{"ListFreeQ", "[", 
                RowBox[{"A", ",", "updn"}], "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"A", "/.", 
                RowBox[{
                 RowBox[{"updn", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ":>", 
                 RowBox[{
                  RowBox[{"updn", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "/;", 
                  RowBox[{"!", 
                   RowBox[{"MemberQ", "[", 
                    RowBox[{"index", ",", 
                    RowBox[{"updn", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}]}], "/.", 
               RowBox[{
                RowBox[{"updn", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ":>", 
                RowBox[{
                 RowBox[{"updn", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "/;", 
                 RowBox[{"!", 
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"index", ",", 
                    RowBox[{"updn", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}]}], ")"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"\[Delta]", ",", "ups", ",", "dns"}], "]"}], "A"}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", "sub"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"SwapListsN", "[", 
      RowBox[{"a1_List", ",", "b1_List", ",", "i_Integer"}], "]"}], " ", 
     "swaps", " ", "element", " ", "i_Integer", " ", "between", " ", 
     "a1_List", " ", "and", " ", 
     RowBox[{"b1_List", "."}], " ", "*", "13", "Sep2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SwapListsN", "[", 
      RowBox[{"a1_List", ",", "b1_List", ",", "i_Integer"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$h", ",", 
         RowBox[{"a", "=", "a1"}], ",", 
         RowBox[{"b", "=", "b1"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$h", "=", 
         RowBox[{"a", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ";", "  ", 
        RowBox[{
         RowBox[{"a", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{"b", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ";", "  ", 
        RowBox[{
         RowBox[{"b", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", "$h"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndicesLower", "::", "usage"}], "=", 
     "\"\<tuIndicesLower[from_,to_:{}][exp_] lowers from_ indices to to_ \
indices. from_ and to_ may be lists of indices then the lowering is performed \
pairwise.  If to_ is omitted or not equal in Length then to_ = from_.  \
*29May2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndicesLower", "[", 
       RowBox[{"from_", ",", 
        RowBox[{"to_:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$s", ",", 
         RowBox[{"$f", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "from", "}"}], "]"}]}], ",", 
         RowBox[{"$t", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "to", "}"}], "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "$f", "]"}], "!=", 
           RowBox[{"Length", "[", "$t", "]"}]}], ",", 
          RowBox[{"$t", "=", "$f"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"tuIndexLowerAll", "[", 
           RowBox[{"$f", ",", "$t"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Fold", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#2", "[", "#1", "]"}], "&"}], ",", "$", ",", "$s"}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexLowerAll", "::", "usage"}], "=", 
     "\"\<tuIndexLowerAll[from_,to_][exp_] lowers one index from_ to to_ \
found in exp_.  Handles indices in DerivOpsD to DerivOpsU *20Jun2015*\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexLowerAll", "[", 
       RowBox[{"from_", ",", "to_"}], "]"}], "[", "exp_", "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "upD", ",", "dnD", ",", "opD", ",", "subd", ",", "ipos", ",", "ip", 
         ",", "xexp", ",", "xfrom", ",", "xto", ",", "$Pattern"}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"opD", "=", "DerivOpsU"}], ";", "\[IndentingNewLine]", 
        RowBox[{"upD", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "opD"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dnD", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "DerivOpsD"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"subd", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"upD", ",", 
            RowBox[{"RemovePatterns", "[", "dnD", "]"}]}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"subd", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "/.", 
                RowBox[{"a_", "\[RuleDelayed]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Head", "[", "a", "]"}], "===", "Symbol"}], ",", 
                   "a", ",", 
                   RowBox[{"Head", "[", "a", "]"}]}], "]"}]}]}], "&"}], ",", 
              "#"}], "]"}], "&"}], ",", "subd"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"xexp", ",", "xfrom", ",", "xto"}], "}"}], "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "//.", 
             RowBox[{"Pattern", "\[Rule]", "$Pattern"}]}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"exp", ",", "from", ",", "to"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xexp", "=", 
         RowBox[{"xexp", "//.", 
          RowBox[{
           RowBox[{"t$", ":", 
            RowBox[{"Tensor", "[", 
             RowBox[{"A_", ",", "u_List", ",", "d_List"}], "]"}]}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"tuIndexLower", "[", 
             RowBox[{"xfrom", ",", "xto"}], "]"}], "[", "t$", "]"}]}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"xexp", "=", 
         RowBox[{"xexp", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"OP", ":", "opD"}], ")"}], "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"OP", "//.", "subd"}], ")"}], "[", 
             RowBox[{"a", ",", "xto"}], "]"}], "/;", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"b", "//.", 
               RowBox[{"Pattern", "\[Rule]", "$Pattern"}]}], ")"}], 
             "\[Equal]", "xfrom"}]}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xexp", "//.", 
         RowBox[{"$Pattern", "\[Rule]", "Pattern"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuIndexRaiseAll", "::", "usage"}], "=", 
    "\"\<tuIndexRaiseAll[from_,to_][exp_] raises one index from_ to to_ found \
in exp_.  Handles indices in DerivOpsD to DerivOpsU *20Jun2015*\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexRaiseAll", "[", 
       RowBox[{"from_", ",", "to_"}], "]"}], "[", "exp_", "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "upD", ",", "dnD", ",", "opD", ",", "subd", ",", "ipos", ",", "ip", 
         ",", "xexp", ",", "xfrom", ",", "xto", ",", "$Pattern"}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"opD", "=", "DerivOpsD"}], ";", "\[IndentingNewLine]", 
        RowBox[{"dnD", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "opD"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"upD", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "DerivOpsU"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"subd", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"dnD", ",", 
            RowBox[{"RemovePatterns", "[", "upD", "]"}]}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"subd", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "/.", 
                RowBox[{"a_", "\[RuleDelayed]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Head", "[", "a", "]"}], "===", "Symbol"}], ",", 
                   "a", ",", 
                   RowBox[{"Head", "[", "a", "]"}]}], "]"}]}]}], "&"}], ",", 
              "#"}], "]"}], "&"}], ",", "subd"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"xexp", ",", "xfrom", ",", "xto"}], "}"}], "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "//.", 
             RowBox[{"Pattern", "\[Rule]", "$Pattern"}]}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"exp", ",", "from", ",", "to"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xexp", "=", 
         RowBox[{"xexp", "//.", 
          RowBox[{
           RowBox[{"t$", ":", 
            RowBox[{"Tensor", "[", 
             RowBox[{"A_", ",", "u_List", ",", "d_List"}], "]"}]}], 
           "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"tuIndexRaise", "[", 
             RowBox[{"xfrom", ",", "xto"}], "]"}], "[", "t$", "]"}]}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"xexp", "=", 
         RowBox[{"xexp", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"OP", ":", "opD"}], ")"}], "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"OP", "/.", "subd"}], ")"}], "[", 
             RowBox[{"a", ",", "xto"}], "]"}], "/;", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"b", "//.", 
               RowBox[{"Pattern", "\[Rule]", "$Pattern"}]}], ")"}], 
             "\[Equal]", "xfrom"}]}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xexp", "//.", 
         RowBox[{"$Pattern", "\[Rule]", "Pattern"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndicesRaise", "::", "usage"}], "=", 
     "\"\<tuIndicesRaise[from_,to_:{}][exp_] raises from_ indices to to_ \
indices. from_ and to_ may be lists of indices then the raising is performed \
pairwise.  If to_ is omitted or not equal in Length then to_ = from_.  \
*29May2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndicesRaise", "[", 
       RowBox[{"from_", ",", 
        RowBox[{"to_:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$s", ",", 
         RowBox[{"$f", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "from", "}"}], "]"}]}], ",", 
         RowBox[{"$t", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "to", "}"}], "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "$f", "]"}], "!=", 
           RowBox[{"Length", "[", "$t", "]"}]}], ",", 
          RowBox[{"$t", "=", "$f"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"tuIndexRaiseAll", "[", 
           RowBox[{"$f", ",", "$t"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Fold", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#2", "[", "#1", "]"}], "&"}], ",", "$", ",", "$s"}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], " ", ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexRaise", "::", "usage"}], "=", 
     "\"\<tuIndexRaise[var1_,var2_][A_Tensor] raises index var1_ to var2_ in \
A_Tensor. eg: $exp/. \
tt:Tensor[\[Gamma],{_},{ii:_}]\[RuleDelayed]tuIndexRaise[ii,ii][tt] \
*23Apr2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexRaise", "[", 
       RowBox[{"var1_", ",", "var2_"}], "]"}], "[", "A_Tensor", "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Name$", ",", "u$", ",", "d$", ",", "$swap"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Name$", ",", "u$", ",", "d$"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "A"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"d$", ",", "u$"}], "}"}], "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"d$", ",", "var1"}], "]"}], ",", 
           RowBox[{
            RowBox[{"d$", "=", 
             RowBox[{"d$", "//.", 
              RowBox[{"var1", "\[Rule]", "$swap"}]}]}], ";", 
            RowBox[{"SwapVarFromAtoB", "[", 
             RowBox[{"$swap", ",", "d$", ",", "u$"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"d$", ",", "u$"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"d$", ",", "u$"}], "}"}], "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"d$", ",", "u$"}], "}"}], "//.", 
          RowBox[{"$swap", "\[Rule]", "var2"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Tensor", "[", 
         RowBox[{"Name$", ",", "u$", ",", "d$"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RaiseTensorIndex", "[", 
      RowBox[{"A_Tensor", ",", "var1_", ",", "var2_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexRaise", "[", 
       RowBox[{"var1", ",", "var2"}], "]"}], "[", "A", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexLower", "::", "usage"}], "=", 
     "\"\<tuIndexLower[var1_,var2_][A_Tensor] lowers index var1_ to var2_ in \
A_Tensor. eg: $exp/. \
tt:Tensor[\[Gamma],{ii:_},{_}]\[RuleDelayed]tuIndexLower[ii,ii][tt] \
*23Apr2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexLower", "[", 
       RowBox[{"var1_", ",", "var2_"}], "]"}], "[", "A_Tensor", "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Name$", ",", "u$", ",", "d$", ",", "$swap"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Name$", ",", "u$", ",", "d$"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "A"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"u$", ",", "d$"}], "}"}], "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"u$", ",", "var1"}], "]"}], ",", 
           RowBox[{
            RowBox[{"u$", "=", 
             RowBox[{"u$", "//.", 
              RowBox[{"var1", "\[Rule]", "$swap"}]}]}], ";", 
            RowBox[{"SwapVarFromAtoB", "[", 
             RowBox[{"$swap", ",", "u$", ",", "d$"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"u$", ",", "d$"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"d$", ",", "u$"}], "}"}], "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"d$", ",", "u$"}], "}"}], "//.", 
          RowBox[{"$swap", "\[Rule]", "var2"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Tensor", "[", 
         RowBox[{"Name$", ",", "u$", ",", "d$"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"LowerTensorIndex", "[", 
      RowBox[{"A_Tensor", ",", "var1_", ",", "var2_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexLower", "[", 
       RowBox[{"var1", ",", "var2"}], "]"}], "[", "A", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuIndexReplace", "::", "usage"}], "=", 
    "\"\<tuIndexReplace[from_,to_][exp_] replaces all indices in exp_ from \
from_ to to_. *16Sep2015\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexReplace", "[", 
       RowBox[{"from_", ",", "to_"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
        "upD", ",", "dnD", ",", "subd", ",", "\[IndentingNewLine]", "ipos", 
         ",", "xexp", ",", "xfrom", ",", "xto", ",", "ip", ",", "$Pattern"}], 
        "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"upD", "=", "DerivOpsU"}], ";", "\[IndentingNewLine]", 
        RowBox[{"dnD", "=", "DerivOpsD"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"xexp", ",", "xfrom", ",", "xto"}], "}"}], "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "//.", 
             RowBox[{"Pattern", "\[Rule]", "$Pattern"}]}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"exp", ",", "from", ",", "to"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xexp", "=", 
         RowBox[{"xexp", "//.", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"A_", ",", "u_", ",", "d_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"A", ",", 
              RowBox[{"ReplacePart", "[", 
               RowBox[{"u", ",", 
                RowBox[{"ip", "\[Rule]", "xto"}]}], "]"}], ",", "d"}], "]"}], 
            "/;", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "u", "]"}], ">", "0"}], "&&", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"ipos", "=", 
                RowBox[{"Position", "[", 
                 RowBox[{"u", ",", "xfrom", ",", "1"}], "]"}]}], ")"}], "=!=", 
              RowBox[{"{", "}"}]}], "&&", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"ip", "=", 
                RowBox[{"ipos", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ")"}], ">", 
              "0"}]}]}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xexp", "=", 
         RowBox[{"xexp", "//.", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"A_", ",", "u_", ",", "d_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"A", ",", "u", ",", 
              RowBox[{"ReplacePart", "[", 
               RowBox[{"d", ",", 
                RowBox[{"ip", "\[Rule]", "xto"}]}], "]"}]}], "]"}], "/;", 
            "\[IndentingNewLine]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "d", "]"}], ">", "0"}], "&&", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"ipos", "=", 
                 RowBox[{"Position", "[", 
                  RowBox[{"d", ",", "xfrom", ",", "1"}], "]"}]}], ")"}], "=!=", 
               RowBox[{"{", "}"}]}], "&&", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"ip", "=", 
                 RowBox[{"ipos", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ")"}], ">", 
               "0"}]}], ")"}]}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xexp", "=", 
         RowBox[{"xexp", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"OP", ":", 
              RowBox[{"Apply", "[", 
               RowBox[{"Alternatives", ",", 
                RowBox[{"Join", "[", 
                 RowBox[{"upD", ",", "dnD"}], "]"}]}], "]"}]}], ")"}], "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"OP", "[", 
             RowBox[{"a", ",", "xto"}], "]"}], "/;", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"b", "//.", 
               RowBox[{"Pattern", "\[Rule]", "$Pattern"}]}], ")"}], 
             "\[Equal]", "xfrom"}]}]}]}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<ReplaceIndexTU:\>\"", ",", "xexp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xexp", "//.", 
         RowBox[{"$Pattern", "\[Rule]", "Pattern"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ReplaceIndexTU", "[", 
       RowBox[{"from_", ",", "to_"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexReplace", "[", 
       RowBox[{"from", ",", "to"}], "]"}], "[", "exp", "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTensorIndexSwap", "::", "usage"}], "=", 
     "\"\<tuTensorIndexSwap[slot1_Integer,slot2_Integer][tensor_Tensor] swaps \
slot1_ and slot2_ indices of tensor_  *22May2015*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuTensorIndexSwap", "[", 
       RowBox[{"slot1_Integer", ",", "slot2_Integer"}], "]"}], "[", 
      "tensor_Tensor", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$n", ",", "$u", ",", "$d", ",", "$"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"$n", ",", "$u", ",", "$d"}], "}"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "tensor"}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"{", 
          RowBox[{"$n", ",", "$u", ",", "$d"}], "}"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "$u", "]"}], "<", 
           RowBox[{"Max", "[", 
            RowBox[{"slot1", ",", "slot2"}], "]"}]}], ",", 
          RowBox[{"Return", "[", "tensor", "]"}]}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{"Input", " ", 
          RowBox[{"Error", ".", " ", "Do"}], " ", 
          RowBox[{"nothing", "."}]}], "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"$u", "[", 
             RowBox[{"[", "slot1", "]"}], "]"}], "=!=", "Void"}], "&&", 
           RowBox[{
            RowBox[{"$u", "[", 
             RowBox[{"[", "slot2", "]"}], "]"}], "=!=", "Void"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$", "=", 
            RowBox[{"$u", "[", 
             RowBox[{"[", "slot1", "]"}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"$u", "[", 
             RowBox[{"[", "slot1", "]"}], "]"}], "=", 
            RowBox[{"$u", "[", 
             RowBox[{"[", "slot2", "]"}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"$u", "[", 
             RowBox[{"[", "slot2", "]"}], "]"}], "=", "$"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"$d", "[", 
               RowBox[{"[", "slot1", "]"}], "]"}], "=!=", "Void"}], "&&", 
             RowBox[{
              RowBox[{"$d", "[", 
               RowBox[{"[", "slot2", "]"}], "]"}], "=!=", "Void"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"$", "=", 
              RowBox[{"$d", "[", 
               RowBox[{"[", "slot1", "]"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{"$d", "[", 
               RowBox[{"[", "slot1", "]"}], "]"}], "=", 
              RowBox[{"$d", "[", 
               RowBox[{"[", "slot2", "]"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{"$d", "[", 
               RowBox[{"[", "slot2", "]"}], "]"}], "=", "$"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"$d", "[", 
                 RowBox[{"[", "slot1", "]"}], "]"}], "=!=", "Void"}], "&&", 
               RowBox[{
                RowBox[{"$u", "[", 
                 RowBox[{"[", "slot2", "]"}], "]"}], "=!=", "Void"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"$", "=", 
                RowBox[{"$d", "[", 
                 RowBox[{"[", "slot1", "]"}], "]"}]}], ";", 
               RowBox[{
                RowBox[{"$d", "[", 
                 RowBox[{"[", "slot1", "]"}], "]"}], "=", 
                RowBox[{"$u", "[", 
                 RowBox[{"[", "slot2", "]"}], "]"}]}], ";", 
               RowBox[{
                RowBox[{"$u", "[", 
                 RowBox[{"[", "slot2", "]"}], "]"}], "=", "$"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"$u", "[", 
                   RowBox[{"[", "slot1", "]"}], "]"}], "=!=", "Void"}], "&&", 
                 
                 RowBox[{
                  RowBox[{"$d", "[", 
                   RowBox[{"[", "slot2", "]"}], "]"}], "=!=", "Void"}]}], ",",
                 "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"$", "=", 
                  RowBox[{"$u", "[", 
                   RowBox[{"[", "slot1", "]"}], "]"}]}], ";", 
                 RowBox[{
                  RowBox[{"$u", "[", 
                   RowBox[{"[", "slot1", "]"}], "]"}], "=", 
                  RowBox[{"$d", "[", 
                   RowBox[{"[", "slot2", "]"}], "]"}]}], ";", 
                 RowBox[{
                  RowBox[{"$d", "[", 
                   RowBox[{"[", "slot2", "]"}], "]"}], "=", "$"}]}]}], 
               "\[IndentingNewLine]", "]"}]}], "]"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Apply", "[", 
         RowBox[{"Tensor", ",", 
          RowBox[{"{", 
           RowBox[{"$n", ",", "$u", ",", "$d"}], "}"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexSwap", "::", "usage"}], "=", 
     "\"\<tuIndexSwap[index1_,index2_][exp_] swaps indexPair of Tensor's in \
exp_. EG: tuIndexSwap[i,j][\!\(\*SubscriptBox[\(A\), \
\(ikj\)]\)]->\!\(\*SubscriptBox[\(A\), \(jki\)]\) .  [index1_,index2_] can be \
input as [{index1_,index2_}].  *4Nov2014*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexSwap", "[", 
       RowBox[{"index1_", ",", 
        RowBox[{"index2_", "|", 
         RowBox[{"PatternSequence", "[", "]"}]}]}], "]"}], "[", "exp_", "]"}],
      ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "ind1", ",", "ind2", ",", "$ii", 
         ",", "subi", ",", "CX"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ind1", ",", "ind2"}], "}"}], "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"index1", ",", "index2"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"subi", "[", "i_List", "]"}], ":=", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"SameQ", "[", 
              RowBox[{"#", ",", "ind2"}], "]"}], ",", 
             RowBox[{"CX", "[", "ind1", "]"}], ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"SameQ", "[", 
                RowBox[{"#", ",", "ind1"}], "]"}], ",", 
               RowBox[{"CX", "[", "ind2", "]"}], ",", "#"}], "]"}]}], "]"}], 
           "&"}], "/@", "i"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", " ", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"A_", ",", "u_", ",", "d_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"xTensor", "[", 
            RowBox[{"A", ",", 
             RowBox[{"subi", "[", "u", "]"}], ",", 
             RowBox[{"subi", "[", "d", "]"}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"dd", ":", "DerivOps"}], ")"}], "[", 
            RowBox[{"A_", ",", "i_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{
             RowBox[{"CX", "[", "dd", "]"}], "[", 
             RowBox[{"A", ",", "ind2"}], "]"}], "/;", 
            RowBox[{"SameQ", "[", 
             RowBox[{"i", ",", "ind1"}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"dd", ":", "DerivOps"}], ")"}], "[", 
            RowBox[{"A_", ",", "i_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{
             RowBox[{"CX", "[", "dd", "]"}], "[", 
             RowBox[{"A", ",", "ind1"}], "]"}], "/;", 
            RowBox[{"SameQ", "[", 
             RowBox[{"i", ",", "ind2"}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{"CX", "[", "a_", "]"}], "\[Rule]", "a"}]}], "//.", 
          RowBox[{"xTensor", "\[Rule]", "Tensor"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"IndexSwap", ":=", "tuIndexSwap"}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexSwapUpDown", "::", "usage"}], "=", 
     "\"\<tuIndexSwapUpDown[index_][exp_] swaps UpDn position of index_ in \
exp_. index_ may be List in which case the indices are Fold[]d over List. \
*22Oct2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexSwapUpDown", "[", "index_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "XXXX", ",", "YYYY"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "index", "]"}], "=!=", "List"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", 
             RowBox[{"tuIndicesLower", "[", 
              RowBox[{"index", ",", "XXXX"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//", 
             RowBox[{"tuIndicesRaise", "[", 
              RowBox[{"index", ",", "YYYY"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tmp", "/.", 
              RowBox[{"XXXX", "\[Rule]", "index"}]}], "/.", 
             RowBox[{"YYYY", "\[Rule]", "index"}]}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"Fold", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"tuIndexSwapUpDown", "[", "#2", "]"}], "[", "#1", 
               "]"}], "&"}], ",", "exp", ",", "index"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"UpDownIndexSwap", "[", "index_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexSwapUpDown", "[", "index", "]"}], "[", "exp", "]"}]}], 
    ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"UpDownIndexSwap", "[", 
       RowBox[{"upos_Integer", ",", "dpos_Integer"}], "]"}], "[", 
      "tensor_Tensor", "]"}], " ", "swaps", " ", "indices", " ", "of", " ", 
     "tensor_Tensor", " ", "by", " ", 
     RowBox[{"position", " ", "[", 
      RowBox[{"upos_Integer", ",", "dpos_Integer"}], "]"}], " ", "There", " ",
      "are", " ", "NoChecks", " ", "on", " ", 
     RowBox[{"inputs", "."}], " ", "*", "23", "July2012"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"UpDownIndexSwap", "[", 
       RowBox[{"upos_Integer", ",", "dpos_Integer"}], "]"}], "[", 
      "tensor_Tensor", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "tensor"}], ",", "$d", ",", "$u", ",", "xtmp"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xtmp", "=", 
         RowBox[{"tmp", "=", 
          RowBox[{"Apply", "[", 
           RowBox[{"List", ",", "tmp"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$u", "=", 
         RowBox[{"tmp", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$d", "=", 
         RowBox[{"tmp", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmp", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"$u", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"dpos", "\[Rule]", 
              RowBox[{"$d", "[", 
               RowBox[{"[", "dpos", "]"}], "]"}]}], ",", 
             RowBox[{"upos", "\[Rule]", 
              RowBox[{"$d", "[", 
               RowBox[{"[", "upos", "]"}], "]"}]}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmp", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"$d", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"upos", "\[Rule]", 
              RowBox[{"$u", "[", 
               RowBox[{"[", "upos", "]"}], "]"}]}], ",", 
             RowBox[{"dpos", "\[Rule]", 
              RowBox[{"$u", "[", 
               RowBox[{"[", "dpos", "]"}], "]"}]}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Apply", "[", 
         RowBox[{"Tensor", ",", "tmp"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "Eliminates", " ", "index", " ", "m_", " ", "from", " ", "exp_", " ", 
      "containing", " ", 
      RowBox[{
       RowBox[{"\[Delta]uu", "[", 
        RowBox[{"m_", ",", "n"}], "]"}], ".", "  ", "NEEDS"}], " ", 
      "expanding", " ", "to", " ", "\[Delta]ud"}], ",", " ", "\[Delta]du", 
     ",", " ", 
     RowBox[{
      RowBox[{"\[Delta]dd", ".", "  ", "A"}], " ", "strick", " ", "version", 
      " ", "would", " ", "check", " ", "for", " ", "proper", " ", "up", " ", 
      "and", " ", "down", " ", 
      RowBox[{"indices", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Simplify\[Delta]uu", "[", 
      RowBox[{"exp_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", 
         RowBox[{"ind", "=", "m"}], ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mname", "=", "\"\<Simplify\[Delta]uu\>\""}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp1", "=!=", "tmp"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"a_", " ", 
                 RowBox[{"\[Delta]", "@", 
                  RowBox[{"uu", "[", 
                   RowBox[{"m", ",", "b_"}], "]"}]}]}], ":>", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"a", "/.", 
                   RowBox[{"m", "->", "b"}]}], ")"}], "/;", 
                 RowBox[{
                  RowBox[{"!", 
                   RowBox[{"FreeQ", "[", 
                    RowBox[{
                    RowBox[{"{", "a", "}"}], ",", "m"}], "]"}]}], "&&", 
                  RowBox[{"m", "=!=", "b"}]}]}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"a_", " ", 
                 RowBox[{"\[Delta]", "@", 
                  RowBox[{"uu", "[", 
                   RowBox[{"b_", ",", "m"}], "]"}]}]}], ":>", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"a", "/.", 
                   RowBox[{"m", "->", "b"}]}], ")"}], "/;", 
                 RowBox[{
                  RowBox[{"!", 
                   RowBox[{"FreeQ", "[", 
                    RowBox[{
                    RowBox[{"{", "a", "}"}], ",", "m"}], "]"}]}], "&&", 
                  RowBox[{"m", "=!=", "b"}]}]}]}]}], "\[IndentingNewLine]", 
              "}"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"IfDEBUG", "[", 
            RowBox[{"mname", ",", 
             RowBox[{"DEBUG", ">", "0"}], ",", 
             RowBox[{"{", 
              RowBox[{"m", ",", "tmp"}], "}"}], ",", "\"\<{m,tmp}\>\""}], 
            "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Simple", " ", "index", " ", "swapping", " ", "routine", " ", "across", 
      " ", 
      RowBox[{"xPartialD", ".", "  ", 
       SuperscriptBox["A", "m"]}], " ", 
      RowBox[{"xPartialD", "[", 
       RowBox[{
        SubscriptBox["A", "m"], ",", "n"}], "]"}]}], "->", " ", 
     RowBox[{
      SubscriptBox["A", "m"], " ", 
      RowBox[{
       RowBox[{"xPartialD", "[", 
        RowBox[{
         SuperscriptBox["A", "m"], ",", "n"}], "]"}], ".", "  ", "WARNING"}], 
      " ", "there", " ", "are", " ", "no", " ", 
      RowBox[{"checks", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RaiseIndexInxPartialD", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mName", "=", "\"\<RaiseIndexInxPartialD\>\""}]}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mName", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "exp", "}"}], ",", "\"\<input\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "/.", 
          RowBox[{
           RowBox[{"c_", " ", 
            RowBox[{"xPartialD", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
           RowBox[{"SwapIndexPartialD", "[", 
            RowBox[{"{", 
             RowBox[{"c", ",", "a", ",", "b"}], "}"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "/.", 
          RowBox[{
           RowBox[{"c_", " ", 
            RowBox[{"xCovariantD", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}]}], "\[RuleDelayed]", 
           RowBox[{"SwapIndexPartialD", "[", 
            RowBox[{"{", 
             RowBox[{"c", ",", "a", ",", "b"}], "}"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mName", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<tmp\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Swaps", " ", "indices", " ", "in", " ", "list", " ", 
      RowBox[{"{", 
       RowBox[{
        SuperscriptBox["A", "m"], ",", 
        SubscriptBox["A", "m"], ",", "mu"}], "}"}]}], "->", " ", 
     RowBox[{
      RowBox[{
       SubscriptBox["A", "m"], 
       RowBox[{
        RowBox[{"xPartialD", "[", 
         RowBox[{
          SuperscriptBox["A", "m"], ",", "mu"}], "]"}], ".", "  ", "Only"}], 
       " ", "one", " ", "way"}], "->", "\[IndentingNewLine]", " ", 
      RowBox[{
       RowBox[{"NEEDS", " ", "two"}], "-", 
       RowBox[{"way", " ", "swap"}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SwapIndexPartialD", "[", "list_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"indexdown", ",", 
         RowBox[{"tmp1", "=", "list"}], ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mName", "=", "\"\<SwapIndexPartialD\>\""}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"indexdown", "=", 
         RowBox[{
          RowBox[{"ParseTermIndices", "[", 
           RowBox[{"tmp1", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mName", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"tmp1", ",", "indexdown"}], "}"}], ",", 
          "\"\<tmp1,indexdown\>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"indexdown", "=!=", 
           RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"indexdown", "=", 
            RowBox[{"First", "[", "indexdown", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"tmp1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"tmp1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "//", 
             RowBox[{"LowerIndex", "[", 
              RowBox[{"indexdown", ",", "indexdown"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"tmp1", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"tmp1", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "//", 
             RowBox[{"RaiseIndex", "[", 
              RowBox[{"indexdown", ",", "indexdown"}], "]"}]}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mName", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp1", "}"}], ",", "\"\<tmp1\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmp1", "[", 
          RowBox[{"[", "1", "]"}], "]"}], 
         RowBox[{"xPartialD", "[", 
          RowBox[{
           RowBox[{"tmp1", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"tmp1", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xPartialDuLower", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", 
       RowBox[{
        RowBox[{"MetricContractG", "[", 
         RowBox[{"exp", "/.", 
          RowBox[{
           RowBox[{"xPartialDu", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], "\[Rule]", 
           RowBox[{
            RowBox[{"xPartialD", "[", 
             RowBox[{"a", ",", 
              RowBox[{"dum", "[", "b", "]"}]}], "]"}], 
            RowBox[{"g", "@", 
             RowBox[{"uu", "[", 
              RowBox[{
               RowBox[{"dum", "[", "b", "]"}], ",", "b"}], "]"}]}]}]}]}], 
         "]"}], "/.", 
        RowBox[{
         RowBox[{"dum", "[", "a_", "]"}], "\[Rule]", "a"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuMetricProperTime", "::", "usage"}], ":=", 
    "\"\<tuMetricProperTime[exp_] produces a list of metric elements from an \
expression representing the proper time, d[s\!\(\*SuperscriptBox[\(]\), \
\(2\)]\)->f[x,x]d[x]d[x]+f[x,y]d[x]dy]. The list contains both up,up and \
down,down forms of the Tensor[g,_,_].  Only non-zero enters are output. Index \
labels are taken from the d[]'s in exp_.  The output also contains \
detg\[Rule]Det[T[g,dd,{_,_}]], gvars\[Rule]indices of Tensor[g,_,_],   \
gmatrixdd\[Rule]full Matrix of T[g,dd,{_,_}], gmatrixuu\[Rule]full Matrix of \
T[g,uu,{_,_}],  NOTE: Only produces symmetric Tensor[g].  The Det[g] that is \
often seen Det[-g] is the Det[] of the T[g,dd,{_,_}] metric tensor. \
*17Feb2017*2Feb2018*22Feb2018*\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuMetricProperTime", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$ds2", "=", "exp"}], ",", "$", ",", "$dvars", ",", "$vars", 
         ",", "$gmatrix", ",", "$gmatrixI", ",", "$gdd", ",", "$guu", ",", 
         "$detg"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$ds2", "=", 
         RowBox[{"$ds2", "/.", " ", 
          RowBox[{
           RowBox[{"Rule", "[", 
            RowBox[{"ds_", ",", "a_"}], "]"}], "\[Rule]", "a"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"remove", " ", 
           SuperscriptBox[
            RowBox[{"d", "[", "s", "]"}], "2"]}], "\[Rule]"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$dvars", "=", 
         RowBox[{
          RowBox[{"$ds2", "//", 
           RowBox[{"tuExtractPattern", "[", 
            RowBox[{"d", "[", "_", "]"}], "]"}]}], "//", 
          "DeleteDuplicates"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$vars", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "$dvars"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$gmatrix", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"CoefficientArrays", "[", 
             RowBox[{"$ds2", ",", "$dvars"}], "]"}], "//", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"#", ",", "3"}], "]"}], "&"}]}], "//", 
           RowBox[{
            RowBox[{"Symmetrize", "[", 
             RowBox[{"#", ",", 
              RowBox[{"Symmetric", "[", "All", "]"}]}], "]"}], "&"}]}], "//", 
          "Normal"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$gdd", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"g", ",", "\"\<dd\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "j"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "$vars"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "$vars"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$guu", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"g", ",", "\"\<uu\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "j"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "$vars"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "$vars"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$gdd", "=", 
         RowBox[{"{", 
          RowBox[{"$gdd", ",", "$gmatrix"}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$gdd", "=", 
         RowBox[{"MapThread", "[", 
          RowBox[{"Rule", ",", "$gdd", ",", "2"}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", "$gdd", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$guu", "=", 
         RowBox[{"{", 
          RowBox[{"$guu", ",", 
           RowBox[{"$gmatrixI", "=", 
            RowBox[{"Inverse", "[", "$gmatrix", "]"}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$guu", "=", 
         RowBox[{"MapThread", "[", 
          RowBox[{"Rule", ",", "$guu", ",", "2"}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", "$guu", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$detg", "=", 
         RowBox[{
          RowBox[{"Det", "[", "$gmatrix", "]"}], "//", "Simplify"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"gvars", "\[Rule]", "$vars"}], ",", "$gdd", ",", "$guu", 
           ",", 
           RowBox[{"detg", "\[Rule]", "$detg"}], ",", 
           RowBox[{"gmatrixdd", "\[Rule]", "$gmatrix"}], ",", 
           RowBox[{"gmatrixuu", "\[Rule]", "$gmatrixI"}]}], "}"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"d", "[", "x", "]"}], 
       RowBox[{"d", "[", "y", "]"}], 
       RowBox[{"f", "[", 
        RowBox[{"x", ",", "y"}], "]"}]}], "+", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"d", "[", "x", "]"}], "2"], 
       RowBox[{"f", "[", "xx", "]"}]}], "-", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"d", "[", "y", "]"}], "2"], 
       RowBox[{"f", "[", "yy", "]"}]}], "-", 
      RowBox[{
       RowBox[{"d", "[", "y", "]"}], 
       RowBox[{"d", "[", "z", "]"}], 
       RowBox[{"f", "[", 
        RowBox[{"y", ",", "z"}], "]"}], "\[IndentingNewLine]", 
       RowBox[{"tuMetricProperTime", "[", "%", "]"}]}]}], "//", 
     "ColumnForms"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Contracts", " ", "metric", " ", "tensor"}], ",", " ", "g_", ",",
      " ", 
     RowBox[{"in", " ", "exp_", " ", "where", " ", 
      RowBox[{"possible", ".", "  ", "DOES"}], " ", "NOT", " ", "RECOGNIZE", 
      " ", "g_."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Does", " ", "not", " ", "handle", " ", 
     RowBox[{"g", "[", 
      RowBox[{"i", ",", "j"}], "]"}], 
     RowBox[{"fn", "[", 
      RowBox[{
       RowBox[{"a", "[", "i", "]"}], "+", 
       RowBox[{"b", "[", "i", "]"}]}], "]"}], " ", "like", " ", "expressions",
      " ", "Replaced", " ", 
     RowBox[{"MatricContract", "[", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"MetricContractGexp", "[", "g_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"exp1", "=", "exp"}], ",", "tmp", ",", "tmp1", ",", "tmp2", 
         ",", "pos", ",", "ipos", ",", "tmpp", ",", "tmpp1", ",", "posg", ",",
          "iposg", ",", "indexg", ",", "post", ",", "ipost", ",", "gUsed"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "First", " ", "do", " ", "simple", " ", "g", " ", "contractions"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"exp1", "=", 
         RowBox[{
          RowBox[{"Expand", "[", "exp1", "]"}], "//", "MetricContractG"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "extract", " ", "g_", " ", "products", " ", "assuming", " ", 
          RowBox[{"g", "'"}], "s", " ", "are", " ", "not", " ", 
          RowBox[{"embedded", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"exp1", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Times", "[", 
            RowBox[{"a___", ",", 
             RowBox[{"Tensor", "[", 
              RowBox[{"g", ",", "_", ",", "_"}], "]"}], ",", "b___"}], "]"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"ipos", "=", "1"}], ",", 
          RowBox[{"ipos", "\[LessEqual]", 
           RowBox[{"Length", "[", "pos", "]"}]}], ",", 
          RowBox[{"ipos", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmpp1", "=", 
            RowBox[{"tmpp", "=", 
             RowBox[{"pos", "[", 
              RowBox[{"[", 
               RowBox[{"ipos", ",", "2"}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"posg", "=", 
            RowBox[{"tmpp", "//", 
             RowBox[{"tuExtractPositionPattern", "[", 
              RowBox[{"Tensor", "[", 
               RowBox[{"g", ",", "_", ",", "_"}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Go", " ", "through", " ", "and", " ", "contract", " ", "each", 
             " ", "g", " ", "Tensor", " ", "in", " ", "product", " ", 
             "tmpp"}], "  ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"iposg", "=", "1"}], ",", 
             RowBox[{"iposg", "\[LessEqual]", 
              RowBox[{"Length", "[", "posg", "]"}]}], ",", 
             RowBox[{"iposg", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "eliminate", " ", "one", " ", "g", " ", "and", " ", "test", " ",
                "for", " ", "possible", " ", "summing", " ", "Tensors", 
               RowBox[{"(", 
                RowBox[{"may", " ", "include", " ", "other", " ", 
                 RowBox[{"g", "'"}], "s"}], ")"}]}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"tmpp1", "=", 
               RowBox[{"tmpp1", "/.", 
                RowBox[{
                 RowBox[{"Last", "[", " ", 
                  RowBox[{"posg", "[", 
                   RowBox[{"[", "iposg", "]"}], "]"}], " ", "]"}], "\[Rule]", 
                 "1"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Examine", " ", "remaining", " ", "Tensors", 
                RowBox[{"(", 
                 RowBox[{"possibly", " ", "imbedded"}], ")"}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"post", "=", 
               RowBox[{"tmpp1", "//", 
                RowBox[{"tuExtractPositionPattern", "[", 
                 RowBox[{"Tensor", "[", 
                  RowBox[{"_", ",", "_", ",", "_"}], "]"}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"List", "[", 
               RowBox[{"\"\<post:\>\"", ",", "post"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"gUsed", "=", "posg"}], ";", "\[IndentingNewLine]", 
              RowBox[{"For", "[", 
               RowBox[{
                RowBox[{"ipost", "=", "1"}], ",", 
                RowBox[{"ipost", "\[LessEqual]", 
                 RowBox[{"Length", "[", "post", "]"}]}], ",", 
                RowBox[{"ipost", "++"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"tmp", "=", 
                  RowBox[{
                   RowBox[{"post", "[", 
                    RowBox[{"[", 
                    RowBox[{"ipost", ",", "2"}], "]"}], "]"}], 
                   RowBox[{"posg", "[", 
                    RowBox[{"[", 
                    RowBox[{"iposg", ",", "2"}], "]"}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"tmp1", "=", 
                  RowBox[{"tmp", "//", "MetricContractG"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"tmp", "=!=", "tmp1"}], ",", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"If", " ", "contracted"}], ",", " ", 
                    RowBox[{
                    "store", " ", "new", " ", "and", " ", "do", " ", "not", 
                    " ", "use", " ", "g", " ", "again"}]}], "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"post", "[", 
                    RowBox[{"[", 
                    RowBox[{"ipost", ",", "2"}], "]"}], "]"}], "=", "tmp1"}], 
                    ";", 
                    RowBox[{
                    RowBox[{"gUsed", "[", 
                    RowBox[{"[", 
                    RowBox[{"iposg", ",", "2"}], "]"}], "]"}], "=", "1"}], 
                    ";", 
                    RowBox[{
                    RowBox[{"posg", "[", 
                    RowBox[{"[", 
                    RowBox[{"iposg", ",", "2"}], "]"}], "]"}], "=", "1"}], 
                    ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"tmpp1", "=", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"tmpp1", ",", "post"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"Apply", "[", 
             RowBox[{"Times", ",", 
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", "gUsed"}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"ipos", ",", "2"}], "]"}], "]"}], "=", 
            RowBox[{"tmp", " ", "tmpp1"}]}], ";"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"exp1", "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"exp1", ",", "pos"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuMetricContract", "::", "usage"}], "=", 
     "\"\<tuMetricContract[g_][exp_Times] Contracts (alla Einstein) exp_Times \
(Times expression) over metric g_. Changed to T[g,uu,{_,_}] Tensor notation. \
* 12Jul2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuMetricContract", "[", "g_", "]"}], "[", "exp_Times", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "gterm", ",", "$u0", ",", "$d", ",", "$u", ",", "$d0", ",", "$c", ",", 
         RowBox[{"tmp", "=", "exp"}], ",", "tmp1", ",", "tmp2", ",", "gpos", 
         ",", "gpos1", ",", "ipos", ",", "pos", ",", "gvar", ",", "Igvar", 
         ",", "Itmp2", ",", 
         RowBox[{"gpat", "=", 
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"g", ",", "\"\<uu\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"a_", ",", "b_"}], "}"}]}], "]"}], "|", 
           RowBox[{"T", "[", 
            RowBox[{"g", ",", "\"\<dd\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"a_", ",", "b_"}], "}"}]}], "]"}], "|", 
           RowBox[{"T", "[", 
            RowBox[{"g", ",", "\"\<ud\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"a_", ",", "b_"}], "}"}]}], "]"}], "|", 
           RowBox[{"T", "[", 
            RowBox[{"g", ",", "\"\<du\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"a_", ",", "b_"}], "}"}]}], "]"}]}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"gpos1", "=", 
         RowBox[{"gpos", "=", 
          RowBox[{"tmp", "//", 
           RowBox[{"tuExtractPositionPattern", "[", "gpat", "]"}]}]}]}], ";", 
        
        RowBox[{"xPrint", "[", "gpos1", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp1"}], ",", 
          RowBox[{
           RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"gpos1", "=", 
            RowBox[{"gpos", "=", 
             RowBox[{"tmp", "//", 
              RowBox[{"tuExtractPositionPattern", "[", "gpat", "]"}]}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"ipos", "=", "1"}], ",", 
             RowBox[{
              RowBox[{"ipos", "\[LessEqual]", 
               RowBox[{"Length", "[", "gpos", "]"}]}], "&&", 
              RowBox[{"tmp", "\[Equal]", "tmp1"}]}], ",", 
             RowBox[{"ipos", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"pos", "=", 
               RowBox[{"gpos1", "[", 
                RowBox[{"[", 
                 RowBox[{"ipos", ",", "1"}], "]"}], "]"}]}], ";", 
              RowBox[{"gvar", "=", 
               RowBox[{"gpos1", "[", 
                RowBox[{"[", 
                 RowBox[{"ipos", ",", "2"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tmp2", "=", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"tmp", ",", 
                 RowBox[{
                  RowBox[{"{", "pos", "}"}], "\[Rule]", "1"}]}], "]"}]}], ";",
               "\[IndentingNewLine]", 
              RowBox[{"Igvar", "=", 
               RowBox[{"tuIndexParser", "[", "gvar", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Itmp2", "=", 
               RowBox[{"tuIndexParser", "[", "tmp2", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"xPrint", "[", 
               RowBox[{"\"\<tmp2:\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"tmp2", ",", "Itmp2"}], "}"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tmp", "=", 
               RowBox[{"Which", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"$u0", "=", 
                    RowBox[{"Intersection", "[", " ", 
                    RowBox[{
                    RowBox[{"Itmp2", " ", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"$d", "=", 
                    RowBox[{"Igvar", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], "]"}]}], ")"}],
                    "=!=", 
                   RowBox[{"{", "}"}]}], "&&", 
                  RowBox[{
                   RowBox[{"Length", "[", "$d", "]"}], "==", "2"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"tuIndicesLower", "[", 
                   RowBox[{
                    RowBox[{"$u0", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"$c", "=", 
                    RowBox[{
                    RowBox[{"Complement", "[", 
                    RowBox[{"$d", ",", 
                    RowBox[{"{", 
                    RowBox[{"$u0", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "}"}]}], " ", "]"}], "  ",
                     "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], "[", "tmp2", 
                  "]"}], " ", ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"$d0", "=", 
                    RowBox[{"Intersection", "[", " ", 
                    RowBox[{
                    RowBox[{"Itmp2", " ", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
                    RowBox[{"$u", "=", 
                    RowBox[{"Igvar", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}]}], "]"}]}], ")"}],
                    "=!=", 
                   RowBox[{"{", "}"}]}], "&&", 
                  RowBox[{
                   RowBox[{"Length", "[", "$u", "]"}], "==", "2"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"tuIndicesLower", "[", 
                   RowBox[{
                    RowBox[{"$d0", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"$c", "=", 
                    RowBox[{
                    RowBox[{"Complement", "[", 
                    RowBox[{"$u", ",", 
                    RowBox[{"{", 
                    RowBox[{"$d0", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "}"}]}], " ", "]"}], "  ",
                     "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], "[", "tmp2", 
                  "]"}], " ", ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"$u0", "=", 
                    RowBox[{"Intersection", "[", " ", 
                    RowBox[{
                    RowBox[{"Itmp2", " ", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"$d", "=", 
                    RowBox[{"Igvar", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], "]"}]}], ")"}],
                    "=!=", 
                   RowBox[{"{", "}"}]}], "&&", 
                  RowBox[{
                   RowBox[{"Length", "[", "$d", "]"}], "==", "1"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"ReplaceIndexTU", "[", 
                   RowBox[{
                    RowBox[{"$u0", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"$c", "=", " ", 
                    RowBox[{
                    RowBox[{"Igvar", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], " ", "]"}], " ", "[", 
                  "tmp2", "]"}], " ", ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"$d0", "=", 
                    RowBox[{"Intersection", "[", " ", 
                    RowBox[{
                    RowBox[{"Itmp2", " ", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
                    RowBox[{"$u", "=", 
                    RowBox[{"Igvar", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}]}], "]"}]}], ")"}],
                    "=!=", 
                   RowBox[{"{", "}"}]}], "&&", 
                  RowBox[{
                   RowBox[{"Length", "[", "$u", "]"}], "==", "1"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"ReplaceIndexTU", "[", 
                   RowBox[{
                    RowBox[{"$d0", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"$c", "=", 
                    RowBox[{
                    RowBox[{"Igvar", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "  ", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], "[", "tmp2", 
                  "]"}], "  ", ",", "\[IndentingNewLine]", "True", ",", 
                 "\[IndentingNewLine]", "tmp"}], "\[IndentingNewLine]", 
                "]"}]}], ";"}]}], 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"xPrint", "[", 
               RowBox[{"Imply", ",", 
                RowBox[{
                 RowBox[{"gvar", "[", 
                  RowBox[{
                   RowBox[{"$u0", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "$c"}], "]"}], 
                 "\[Rule]", 
                 RowBox[{"{", "tmp", "}"}]}]}], "]"}], ";"}], "*)"}], 
            "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"MetricContract", "[", "g_", "]"}], "[", "exp_Times", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuMetricContract", "[", "g", "]"}], "[", "exp", "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuMetricContractAll", "::", "usage"}], "=", 
     "\"\<tuMetricContractAll[g_][exp_] applies tuMetricContract[g][term] \
over all Times[] terms in exp_. \>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuMetricContractAll", "[", "g_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"Expand", "[", "exp", "]"}], "/.", 
         RowBox[{
          RowBox[{"term", ":", 
           RowBox[{"HoldPattern", "[", 
            RowBox[{"Times", "[", "a__", "]"}], "]"}]}], "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"tuMetricContract", "[", "g", "]"}], "[", "term", 
           "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"MetricContractAll", "[", "g_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuMetricContractAll", "[", "g", "]"}], "[", "exp", "]"}]}], 
    ";"}], "\n", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Adds", " ", 
      RowBox[{"contraction", ":", " ", 
       RowBox[{
        RowBox[{"gud", "[", 
         RowBox[{"a_", ",", "a_"}], "]"}], " ", "|", " ", 
        RowBox[{"gdu", "[", 
         RowBox[{"a_", ",", "a_"}], "]"}]}]}]}], "->", " ", 
     RowBox[{
      RowBox[{"dimension", " ", "**", "May"}], " ", "want", " ", "to", " ", 
      "separate", " ", "this", " ", 
      RowBox[{"function", "**", " ", "27"}], "Mar2012"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"MetricContract", "[", 
       RowBox[{"g_", ",", "trace\[Eta]_"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", 
         RowBox[{"Expand", "[", "exp", "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuMetricContract", "[", "g", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"g", ",", "\"\<ud\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"a_", ",", "a_"}], "}"}]}], "]"}], "\[Rule]", 
             "trace\[Eta]"}], ",", 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"g", ",", "\"\<du\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"a_", ",", "a_"}], "}"}]}], "]"}], "\[Rule]", 
             "trace\[Eta]"}]}], "}"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"MetricContractAll", "[", 
       RowBox[{"g_", ",", "trace\[Eta]_"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"Expand", "[", "exp", "]"}], "/.", 
         RowBox[{
          RowBox[{"term", ":", 
           RowBox[{"HoldPattern", "[", 
            RowBox[{"Times", "[", "a__", "]"}], "]"}]}], ":>", 
          RowBox[{
           RowBox[{"MetricContract", "[", 
            RowBox[{"g", ",", "trace\[Eta]"}], "]"}], "[", "term", 
           "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Wick", " ", "rotation", " ", "of", " ", "Vector", " ", "contractions"}], 
    " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"VectorContractWickSub", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Tensor", "[", 
          RowBox[{"a_", ",", 
           RowBox[{"{", "\[Mu]_", "}"}], ",", 
           RowBox[{"{", "Void", "}"}]}], "]"}], 
         RowBox[{"Tensor", "[", 
          RowBox[{"b_", ",", 
           RowBox[{"{", "Void", "}"}], ",", 
           RowBox[{"{", "\[Mu]_", "}"}]}], "]"}]}], ":>", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Tensor", "[", 
            RowBox[{"a", ",", 
             RowBox[{"{", 
              RowBox[{"space", "@", "\[Mu]"}], "}"}], ",", 
             RowBox[{"{", "Void", "}"}]}], "]"}]}], 
          RowBox[{"Tensor", "[", 
           RowBox[{"b", ",", 
            RowBox[{"{", "Void", "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"space", "@", "\[Mu]"}], "}"}]}], "]"}]}], "/;", 
         RowBox[{"FreeQ", "[", 
          RowBox[{"\[Mu]", ",", "space"}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Tensor", "[", 
           RowBox[{"a_", ",", 
            RowBox[{"{", "\[Mu]_", "}"}], ",", 
            RowBox[{"{", "Void", "}"}]}], "]"}], "[", "c_", "]"}], 
         RowBox[{"Tensor", "[", 
          RowBox[{"b_", ",", 
           RowBox[{"{", "Void", "}"}], ",", 
           RowBox[{"{", "\[Mu]_", "}"}]}], "]"}]}], ":>", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"a", ",", 
              RowBox[{"{", 
               RowBox[{"space", "@", "\[Mu]"}], "}"}], ",", 
              RowBox[{"{", "Void", "}"}]}], "]"}], "[", "TUc", "]"}]}], 
          RowBox[{"Tensor", "[", 
           RowBox[{"b", ",", 
            RowBox[{"{", "Void", "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"space", "@", "\[Mu]"}], "}"}]}], "]"}]}], "/;", 
         RowBox[{"FreeQ", "[", 
          RowBox[{"\[Mu]", ",", "space"}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Tensor", "[", 
          RowBox[{"a_", ",", 
           RowBox[{"{", "\[Mu]_", "}"}], ",", 
           RowBox[{"{", "Void", "}"}]}], "]"}], 
         RowBox[{
          RowBox[{"Tensor", "[", 
           RowBox[{"b_", ",", 
            RowBox[{"{", "Void", "}"}], ",", 
            RowBox[{"{", "\[Mu]_", "}"}]}], "]"}], "[", "c_", "]"}]}], ":>", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Tensor", "[", 
            RowBox[{"a", ",", 
             RowBox[{"{", 
              RowBox[{"space", "@", "\[Mu]"}], "}"}], ",", 
             RowBox[{"{", "Void", "}"}]}], "]"}]}], 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"b", ",", 
             RowBox[{"{", "Void", "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"space", "@", "\[Mu]"}], "}"}]}], "]"}], "[", "c", 
           "]"}]}], "/;", 
         RowBox[{"FreeQ", "[", 
          RowBox[{"\[Mu]", ",", "space"}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Tensor", "[", 
           RowBox[{"a_", ",", 
            RowBox[{"{", "\[Mu]_", "}"}], ",", 
            RowBox[{"{", "Void", "}"}]}], "]"}], "[", "c_", "]"}], 
         RowBox[{
          RowBox[{"Tensor", "[", 
           RowBox[{"b_", ",", 
            RowBox[{"{", "Void", "}"}], ",", 
            RowBox[{"{", "\[Mu]_", "}"}]}], "]"}], "[", "d_", "]"}]}], ":>", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"a", ",", 
              RowBox[{"{", 
               RowBox[{"space", "@", "\[Mu]"}], "}"}], ",", 
              RowBox[{"{", "Void", "}"}]}], "]"}], "[", "c", "]"}]}], 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"b", ",", 
             RowBox[{"{", "Void", "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"space", "@", "\[Mu]"}], "}"}]}], "]"}], "[", "d", 
           "]"}]}], "/;", 
         RowBox[{"FreeQ", "[", 
          RowBox[{"\[Mu]", ",", "space"}], "]"}]}]}]}], "\[IndentingNewLine]",
       "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "ExpandSpaceTimeIndex", " ", "Einstein", " ", "expands", " ", "exp_", 
      " ", "each", " ", "index_List", " ", "over", " ", 
      RowBox[{
       RowBox[{"timespace", "@", "index_List"}], ".", "  ", "This"}], " ", 
      "routine", " ", "is", " ", "to", " ", "facilitate", " ", "time", " ", 
      "and", " ", "spatial", " ", "vector", " ", 
      RowBox[{"notation", ".", "  ", "Note"}], " ", "the", " ", "index", " ", 
      "arguement", " ", "does", " ", "not", " ", "need", " ", "timespace", 
      " ", 
      RowBox[{"flavor", ".", " ", "Added"}], " ", "\[Delta]"}], "-", 
     RowBox[{"functionexpansion", ".", "  ", 
      RowBox[{"BUG", ":", " ", 
       RowBox[{
       "does", " ", "not", " ", "accept", " ", "indices", " ", "in", " ", 
        "functional", " ", 
        RowBox[{"form", ".", " ", "NOTE"}]}], ":", " ", 
       RowBox[{"Use", " ", 
        RowBox[{"EinsteinSum", "[", "]"}], " ", 
        RowBox[{"instead", "!!"}], " ", "DO", " ", "NOT", " ", "USE", " ", 
        "PROBLEMS", " ", "*", "14", "Dec2012"}]}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ExpandSpaceTimeIndex", "[", "index_List", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "indexST", ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mname", "=", "\"\<ExpandSpaceTimeIndex\>\""}]}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"indexST", "=", 
         RowBox[{"timespace", "/@", "index"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"indexST", ",", "exp"}], "}"}], ",", 
          "\"\<{indexST,exp}\>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"\[Delta]", "-", 
           RowBox[{"function", " ", "need", " ", "special", " ", 
            RowBox[{"treatment", ".", "  ", "Only"}], " ", "for", " ", 
            RowBox[{"Length", "[", "index_List", "]"}]}]}], "==", 
          RowBox[{"1.", " ", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"tmp", "/.", " ", 
              RowBox[{
               RowBox[{"ddd", ":", 
                RowBox[{"\[Delta]", "[", "a_", "]"}]}], ":>", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"!", 
                  RowBox[{"FreeQ", "[", 
                   RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"ExpressionIndices", "[", "a", "]"}], "]"}], ",", 
                    "#"}], "]"}]}], " ", ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"IndexSwap", "[", 
                    RowBox[{"{", 
                    RowBox[{"#", ",", 
                    RowBox[{"timespace", "@", "0"}]}], "}"}], "]"}], "[", 
                   RowBox[{"\[Delta]", "[", "a", "]"}], "]"}], 
                  RowBox[{
                   RowBox[{"IndexSwap", "[", 
                    RowBox[{"{", 
                    RowBox[{"#", ",", 
                    RowBox[{"timespace", "@", "1"}]}], "}"}], "]"}], "[", 
                   RowBox[{"\[Delta]", "[", "a", "]"}], "]"}]}], "  ", ",", 
                 "\[IndentingNewLine]", "ddd"}], "]"}]}]}], "&"}], ",", 
            "index"}], "]"}], "  ", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<{tmp\[Delta]}\>\""}], "]"}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"IndexSwap", "[", 
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{"timespace", "@", "#"}]}], "}"}], "]"}], "[", "tmp", 
             "]"}], "&"}], "/@", "index"}], "//", "First"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{"timespace", "@", 
            RowBox[{"timespace", "@", "i_"}]}], "->", 
           RowBox[{"timespace", "@", "i"}]}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"Eliminate", " ", "doubles"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<{tmp}\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "tmp", "]"}], "===", "Rule"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"Apply", "[", 
            RowBox[{"Rule", ",", 
             RowBox[{
              RowBox[{"SumExpansion", "[", "indexST", "]"}], "[", 
              RowBox[{"Apply", "[", 
               RowBox[{"List", ",", "tmp"}], "]"}], "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "//", 
            RowBox[{"SumExpansion", "[", "indexST", "]"}]}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"IndexChange", "->", "IndexChangeTU"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"In", " ", "case", " ", "IndexChange", " ", "fails"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", "tmp", "}"}], ",", "\"\<{tmp1}\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"g", "->", "\[Eta]"}]}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"timespaceindex", "[", "index_List", "]"}], "[", "exp_", "]"}],
       " ", "replaces", " ", "all", " ", "indices"}], " ", "\[Element]", " ", 
     
     RowBox[{"index_List", " ", "in", " ", "exp_", " ", "to", " ", 
      RowBox[{
       RowBox[{"timespace", "@", "indices"}], "."}], "  ", "*", "11", 
      "Jul2013"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"timespaceindex", "[", "index_List", "]"}], "[", "exp_", "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"tmp0", "=", "exp"}], ",", "pos", ",", "sub", ",", "UDrules",
          ",", "$i", ",", "$in"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sub", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "\[Rule]", 
             RowBox[{"timespace", "@", "#"}]}], "&"}], ",", 
           RowBox[{"DeleteDuplicates", "[", "index", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"tmp0", "//", 
          RowBox[{
          "tuExtractPositionPattern", "[", "IndexVarPatterns", "]"}]}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"$i", "=", "1"}], ",", 
          RowBox[{"$i", "\[LessEqual]", 
           RowBox[{"Length", "[", "pos", "]"}]}], ",", 
          RowBox[{"$i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"xPrint", "[", 
            RowBox[{
             RowBox[{"pos", "[", 
              RowBox[{"[", 
               RowBox[{"$i", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"$in", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"tuIndexParser", "[", 
                RowBox[{"pos", "[", 
                 RowBox[{"[", 
                  RowBox[{"$i", ",", "2"}], "]"}], "]"}], "]"}], "]"}]}]}], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"ListMemberQ", "[", 
              RowBox[{"$in", ",", "index"}], "]"}], ",", 
             RowBox[{
              RowBox[{"pos", "[", 
               RowBox[{"[", 
                RowBox[{"$i", ",", "2"}], "]"}], "]"}], "=", " ", 
              RowBox[{
               RowBox[{"pos", "[", 
                RowBox[{"[", 
                 RowBox[{"$i", ",", "2"}], "]"}], "]"}], "/.", "sub"}]}]}], 
            "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", "pos", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"tmp0", ",", "pos"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"GroupTimeSpaceProducts", "[", "exp_", "]"}], " ", "expands", 
     " ", "dummy", " ", "indices", " ", "into", " ", 
     RowBox[{"timespace", "@", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}]}], " ", "grouping", " ", "the", " ", 
     "paired", " ", "result", " ", "in", " ", 
     RowBox[{"xDot", "[", "]"}], " ", "*", "12", "Oct2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"GroupTimeSpaceProducts", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "ExpandDummies", ",", "subgroup"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"subgroup", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"A", ":", 
             RowBox[{"Tensor", "[", "a__", "]"}]}], ")"}], 
           RowBox[{"(", 
            RowBox[{"B", ":", 
             RowBox[{"Tensor", "[", " ", "b__", "]"}]}], ")"}]}], 
          "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"xDot", "[", 
            RowBox[{"A", ",", "B"}], "]"}], "/;", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"FreeQ", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"tuIndexParser", "[", 
                 RowBox[{"A", " ", "B"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "timespace"}], "]"}]}], "&&", 
            RowBox[{"FreeQ", "[", 
             RowBox[{
              RowBox[{"A", " ", "B"}], ",", "xDot"}], "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ExpandDummies", "[", "prod_", "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"dummies", ",", 
             RowBox[{"tmp1", "=", "prod"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"dummies", "=", 
             RowBox[{
              RowBox[{"tuIndexParser", "[", "prod", "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"tmp1", "=", 
             RowBox[{"Fold", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ExpandSpaceTimeIndex", "[", 
                    RowBox[{"{", "#2", "}"}], "]"}], "[", "#1", "]"}], "/.", 
                  "subgroup"}], ")"}], "&"}], ",", "tmp1", ",", "dummies"}], 
              "]"}]}], ";", "\[IndentingNewLine]", "tmp1"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "//", "Expand"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"HoldPattern", "[", 
            RowBox[{"Times", "[", "a__", "]"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"ExpandDummies", "[", 
            RowBox[{"Times", "[", "a", "]"}], "]"}]}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "UpDn2Cos", " ", "is", " ", "Rule", " ", "for", " ", "taking", " ", 
     "Einstein", " ", "UpDn", " ", "timespace", " ", "indices", " ", "of", 
     " ", "products", " ", "and", " ", "raising", " ", "them", " ", "to", " ",
      "contravariant", " ", "indices", " ", "and", " ", "applying", " ", 
     RowBox[{"Cos", "[", "]"}], " ", "to", " ", 
     RowBox[{"timespace", "@", "1"}], " ", 
     RowBox[{"components", "."}], "   ", "*", "30", "Nov2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"UpDn2Cos", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{
           SubscriptBox["k_", "i_"], ",", "\"\<d\>\""}], "]"}], "[", 
         RowBox[{"timespace", "@", "1"}], "]"}], 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{
           SubscriptBox["k_", "j_"], ",", "\"\<u\>\""}], "]"}], "[", 
         RowBox[{"timespace", "@", "1"}], "]"}]}], ":>", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{
          RowBox[{"T", "[", " ", 
           RowBox[{
            SubscriptBox["k", "i"], ",", "\"\<u\>\""}], "]"}], "[", 
          RowBox[{"timespace", "@", "1"}], "]"}]}], 
        RowBox[{
         RowBox[{"T", "[", " ", 
          RowBox[{
           SubscriptBox["k", "j"], ",", "\"\<u\>\""}], "]"}], "[", 
         RowBox[{"timespace", "@", "1"}], "]"}], " ", 
        RowBox[{"Cos", "[", 
         SubscriptBox["\[Theta]", 
          RowBox[{"Sort", "[", 
           RowBox[{"{", 
            RowBox[{"i", ",", "j"}], "}"}], "]"}]], "]"}]}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{
           SubscriptBox["k_", "i_"], ",", "\"\<d\>\""}], "]"}], "[", 
         RowBox[{"timespace", "@", "0"}], "]"}], 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{
           SubscriptBox["k_", "j_"], ",", "\"\<u\>\""}], "]"}], "[", 
         RowBox[{"timespace", "@", "0"}], "]"}]}], "\[Rule]", 
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{
           SubscriptBox["k", "i"], ",", "\"\<u\>\""}], "]"}], "[", 
         RowBox[{"timespace", "@", "0"}], "]"}], 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{
           SubscriptBox["k", "j"], ",", "\"\<u\>\""}], "]"}], "[", 
         RowBox[{"timespace", "@", "0"}], "]"}]}]}]}], "}"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Sums", " ", "over", " ", "indexRange"}], ",", " ", 
     RowBox[{"e", ".", "g", "."}], ",", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", "3"}], "}"}], " ", "in", " ", "expression",
       " ", "exp_.", "  ", "Preprocesses", " ", "with", " ", "DotExpand", " ",
       "and", " ", 
      RowBox[{"Expand", ".", "  ", "Does"}], " ", "not", " ", "check", " ", 
      "proper", " ", "reference", " ", "to", " ", 
      RowBox[{"index", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"SumIndex", "[", "indexRange_List", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"out", "=", "0"}], ",", 
         RowBox[{"index", "=", 
          RowBox[{"First", "[", "indexRange", "]"}]}], ",", 
         RowBox[{"DEBUG", "=", "0"}], ",", 
         RowBox[{"mname", "=", "\"\<SumIndex\>\""}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"exp", "//.", "DotExpand"}], "//", "Expand"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{"mname", ",", 
          RowBox[{"DEBUG", ">", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"index", ",", "tmp", ",", 
            RowBox[{"Length", "[", "tmp", "]"}]}], "}"}], ",", 
          "\"\<index,tmp,Length[tmp]\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"$i", "=", "1"}], ",", 
          RowBox[{"$i", "<=", 
           RowBox[{"Length", "[", "tmp", "]"}]}], ",", 
          RowBox[{"$i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$t", "=", 
            RowBox[{"tmp", "[", 
             RowBox[{"[", "$i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"IfDEBUG", "[", 
            RowBox[{"mname", ",", 
             RowBox[{"DEBUG", ">", "0"}], ",", 
             RowBox[{"{", 
              RowBox[{"index", ",", "$t"}], "}"}], ",", "\"\<index,t\>\""}], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"FreeQ", "[", 
               RowBox[{"$t", ",", "index"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$t", "=", 
               RowBox[{"Sum", "[", 
                RowBox[{"$t", ",", "indexRange"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"IfDEBUG", "[", 
               RowBox[{"mname", ",", 
                RowBox[{"DEBUG", ">", "0"}], ",", 
                RowBox[{"{", 
                 RowBox[{"$i", ",", "$t"}], "}"}], ",", "\"\<$i,$t\>\""}], 
               "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"out", "+=", "$t"}], ";"}]}], "\[IndentingNewLine]", "]"}],
         ";", "\[IndentingNewLine]", "out"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"ExpandIndex", "[", "indexRange_List", "]"}], "[", "exp_", 
      "]"}], " ", "sums", " ", "exp_", " ", "for", " ", "every", " ", "term", 
     " ", "with", " ", "Head", " ", "in", " ", "ops", "  ", "containing", " ",
      "index", " ", "pair", " ", "over", " ", "range", " ", "specified", " ", 
     "in", " ", "indexRange_.", " ", "*", "2", "Mar2013"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ExpandIndex", "[", "indexRange_List", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"ExpandAll", "[", "exp", "]"}]}], ",", 
         RowBox[{"ops", "=", 
          RowBox[{"Times", "|", "Dot", "|", "Wedge", "|", "xDot"}]}], ",", 
         "$t", ",", "$ind", ",", "head", ",", "term"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$ind", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"indexRange", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", 
           RowBox[{"Range", "[", 
            RowBox[{"Apply", "[", 
             RowBox[{"Sequence", ",", 
              RowBox[{"Rest", "[", "indexRange", "]"}]}], "]"}], "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"tmp", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"OP", ":", "ops"}], ")"}], "[", 
             RowBox[{"a___", ",", "b_Plus", ",", "c___"}], "]"}], 
            "\[RuleDelayed]", 
            RowBox[{"Distribute", "[", 
             RowBox[{"OP", "[", 
              RowBox[{"a", ",", "b", ",", "c"}], "]"}], "]"}]}]}], "//", 
          "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"OP", ":", "ops"}], ")"}], "[", "a__", "]"}], 
           "\[RuleDelayed]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"PairedDummies", "[", 
                RowBox[{"Times", "[", "a", "]"}], "]"}], ",", 
               RowBox[{"First", "[", "indexRange", "]"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Apply", "[", 
              RowBox[{"Plus", ",", 
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"OP", "[", "a", "]"}], "/.", "#"}], "&"}], ",", 
                 "$ind"}], "]"}]}], "]"}], ",", 
             RowBox[{"OP", "[", "a", "]"}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Rotates", " ", "indices", " ", "in", " ", "index_List", " ", "of", " ", 
      "exp_", " ", "n_", " ", 
      RowBox[{"times", ".", " ", "e", ".", "g", "."}]}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"RotateIndex", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", "2"}], "]"}], "[", 
       RowBox[{"A", "[", 
        RowBox[{"i", ",", "j", ",", "k"}], "]"}], "]"}], "->", 
      RowBox[{
       RowBox[{
        RowBox[{"A", "[", 
         RowBox[{"k", ",", "i", ",", "j"}], "]"}], ".", "  ", "n"}], ">", 
       RowBox[{"0", " ", "Rotates", " ", "left"}]}]}], ",", " ", 
     RowBox[{"n", "<", 
      RowBox[{"0", " ", "Rotates", " ", 
       RowBox[{"right", "."}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"RotateIndex", "[", 
       RowBox[{"index_List", ",", "n_Integer"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "cycle", ",", 
         RowBox[{"nindex", "=", "index"}], ",", 
         RowBox[{"nn", "=", 
          RowBox[{"Abs", "[", "n", "]"}]}], ",", "sub"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"cycle", "=", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "index", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"n", ">", "0"}], ",", 
          RowBox[{"cycle", "=", 
           RowBox[{"Reverse", "[", "cycle", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "  ", 
         RowBox[{
          RowBox[{"nindex", "=", 
           RowBox[{"Permute", "[", 
            RowBox[{"nindex", ",", 
             RowBox[{"Cycles", "[", 
              RowBox[{"{", "cycle", "}"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", "nn", "}"}]}], "  ", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"sub", "=", 
         RowBox[{"MapThread", "[", 
          RowBox[{"Rule", ",", 
           RowBox[{"{", 
            RowBox[{"index", ",", "nindex"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", "sub"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexAdd", "::", "usage"}], "=", 
     "\"\<tuIndexAdd[uploc_:Null,upvalue_:Null,dnloc_:Null,dnvalue_:Null][\
tensor_Tensor] adds indices to tensor_Tensor at uploc_ with upvalue_ and at \
dnloc_ with value dnvalue_.  Careful of the dnloc_ after specifying uploc_. \
*8Dec2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexAdd", "[", 
       RowBox[{
        RowBox[{"uploc_:", "Null"}], ",", 
        RowBox[{"upvalue_:", "Null"}], ",", 
        RowBox[{"dnloc_:", "Null"}], ",", 
        RowBox[{"dnvalue_:", "Null"}]}], "]"}], "[", "tensor_Tensor", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"uplist", ",", "dnlist"}], "}"}], ",", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"uplist", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"uploc", "=!=", "Null"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"uplist", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{"uplist", ",", "upvalue", ",", "uploc"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"dnlist", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{"dnlist", ",", "Void", ",", "uploc"}], "]"}]}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dnloc", "=!=", "Null"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"uplist", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{"uplist", ",", "Void", ",", "dnloc"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"dnlist", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{"dnlist", ",", "dnvalue", ",", "dnloc"}], "]"}]}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Tensor", "[", 
         RowBox[{
          RowBox[{"tensor", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "uplist", ",", "dnlist"}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PrependIndex", "[", 
      RowBox[{"t_Tensor", ",", "du_", ",", "val_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"du", "===", "\"\<u\>\""}], ",", 
       RowBox[{
        RowBox[{"tuIndexAdd", "[", 
         RowBox[{"1", ",", "val", ",", "Null", ",", "Null"}], "]"}], "[", "t",
         "]"}], ",", 
       RowBox[{
        RowBox[{"tuIndexAdd", "[", 
         RowBox[{"Null", ",", "Null", ",", "1", ",", "val"}], "]"}], "[", "t",
         "]"}]}], "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"AddUpIndex", "[", 
       RowBox[{"uploc_", ",", "upvalue_"}], "]"}], "[", "tensor_Tensor", 
      "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexAdd", "[", 
       RowBox[{"uploc", ",", "upvalue", ",", "Null", ",", "Null"}], "]"}], 
      "[", "tensor", "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"AddDnIndex", "[", 
       RowBox[{"dnloc_", ",", "dnvalue_"}], "]"}], "[", "tensor_Tensor", 
      "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexAdd", "[", 
       RowBox[{"Null", ",", "Null", ",", "dnloc", ",", "dnvalue"}], "]"}], 
      "[", "tensor", "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Prepends", " ", "index", " ", "val_", " ", "in", " ", "du_", " ", 
     "position", " ", "to", " ", "Tensor", " ", "t_.", "  ", "3", "Apr2012"}],
     " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"PrependIndex", "[", 
       RowBox[{"t_Tensor", ",", "du_", ",", "val_"}], "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"Apply", "[", 
           RowBox[{"List", ",", "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"du", "===", "\"\<d\>\""}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"tmp", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{
               RowBox[{"tmp", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "Void"}], "]"}]}], ";", 
            RowBox[{
             RowBox[{"tmp", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{
               RowBox[{"tmp", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", "val"}], "]"}]}]}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"du", "===", "\"\<u\>\""}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"tmp", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{
               RowBox[{"tmp", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "val"}], " ", "]"}]}], 
            ";", 
            RowBox[{
             RowBox[{"tmp", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{
               RowBox[{"tmp", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", "Void"}], "]"}]}]}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Apply", "[", 
          RowBox[{"Tensor", ",", "tmp"}], "]"}]}]}], "\[IndentingNewLine]", 
       "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"AddUpIndex", "[", 
       RowBox[{"uploc_", ",", "upvalue_"}], "]"}], "[", "tensor_Tensor", 
      "]"}], " ", "add", " ", "up", " ", "index", " ", "in", " ", "tensor_", 
     " ", "at", " ", "location", " ", "uploc_", " ", "with", " ", "value", 
     " ", 
     RowBox[{"upvalue_", " ", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"AddUpIndex", "[", 
        RowBox[{"uploc_", ",", "upvalue_"}], "]"}], "[", "tensor_Tensor", 
       "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"uplist", ",", "dnlist"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"uplist", "=", 
          RowBox[{"tensor", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"dnlist", "=", 
          RowBox[{"tensor", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"uplist", "=", 
          RowBox[{"Insert", "[", 
           RowBox[{"uplist", ",", "upvalue", ",", "uploc"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dnlist", "=", 
          RowBox[{"Insert", "[", 
           RowBox[{"dnlist", ",", "Void", ",", "uploc"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"tensor", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "uplist", ",", "dnlist"}], 
          "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"AddDnIndex", "[", 
       RowBox[{"dnloc_", ",", "dnvalue_"}], "]"}], "[", "tensor_Tensor", 
      "]"}], " ", "add", " ", "down", " ", "index", " ", "in", " ", "tensor_",
      " ", "at", " ", "location", " ", "dnloc_", " ", "with", " ", "value", 
     " ", 
     RowBox[{"dnvalue_", " ", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"AddDnIndex", "[", 
       RowBox[{"dnloc_", ",", "dnvalue_"}], "]"}], "[", "tensor_Tensor", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"uplist", ",", "dnlist"}], "}"}], ",", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"uplist", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"uplist", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{"uplist", ",", "Void", ",", "dnloc"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{"dnlist", ",", "dnvalue", ",", "dnloc"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Tensor", "[", 
         RowBox[{
          RowBox[{"tensor", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "uplist", ",", "dnlist"}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"AddUpDnDum", "[", "tensor_Tensor", "]"}], " ", "adds", " ", 
      "corresponding", " ", "up"}], ",", 
     RowBox[{"dn", " ", "a_", " ", "index", " ", "to", " ", 
      RowBox[{"dum", "[", "a_", "]"}], " ", "indices"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AddUpDnDum", "[", "tensor_Tensor", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "tensor"}], ",", "tmpc"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmpc", "=", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"tmp", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"dum", "[", "_", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{"AddDnIndex", "[", 
             RowBox[{
              RowBox[{"-", "1"}], ",", 
              RowBox[{
               RowBox[{"tmpc", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", "tmp", "]"}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "tmpc", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmpc", "=", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"tmp", "[", 
            RowBox[{"[", "3", "]"}], "]"}], ",", 
           RowBox[{"dum", "[", "_", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{"AddUpIndex", "[", 
             RowBox[{
              RowBox[{"-", "1"}], ",", 
              RowBox[{
               RowBox[{"tmpc", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", "tmp", "]"}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "tmpc", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexDeleteAt", "::", "usage"}], "=", 
     "\"\<tuIndexDeleteAt[loc_Integer][tensor_Tensor] remove index at \
location loc_Integer of tensor_Tensor. *23Jul2015*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexDeleteAt", "[", "loc_Integer", "]"}], "[", 
      "tensor_Tensor", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"uplist", ",", "dnlist"}], "}"}], ",", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"uplist", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"uplist", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"uplist", ",", "loc"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"dnlist", ",", "loc"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Tensor", "[", 
         RowBox[{
          RowBox[{"tensor", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "uplist", ",", "dnlist"}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DeleteIndex", "[", "loc_Integer", "]"}], "[", "tensor_Tensor", 
      "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexDeleteAt", "[", "loc", "]"}], "[", "tensor", "]"}]}], 
    ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexDelete", "::", "usage"}], "=", 
     "\"\<tuIndexDelete[ind_][tensor_Tensor] removes index ind_ of \
tensor_Tensor. *23Jul2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexDelete", "[", "ind_", "]"}], "[", "tensor_Tensor", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "uplist", ",", "dnlist", ",", "uppos", ",", "dnpos", ",", "delete"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"uplist", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"uplist", "=", 
         RowBox[{"Position", "[", 
          RowBox[{"uplist", ",", "ind"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"Position", "[", 
          RowBox[{"dnlist", ",", "ind"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"delete", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"uplist", ",", "dnlist"}], "}"}], "//", "Flatten"}], "//",
           "DeleteDuplicates"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"uplist", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{
           RowBox[{"tensor", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "delete"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{
           RowBox[{"tensor", "[", 
            RowBox[{"[", "3", "]"}], "]"}], ",", "delete"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Tensor", "[", 
         RowBox[{
          RowBox[{"tensor", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "uplist", ",", "dnlist"}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DeleteIndex", "[", "index_", "]"}], "[", "tensor_Tensor", 
      "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexDelete", "[", "index", "]"}], "[", "tensor", "]"}]}], 
    ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexDeleteAll", "::", "usage"}], "=", 
     "\"\<tuIndexDeleteAll[index_][exp_] applies tuIndexDelete on all \
Tensor[]s in exp_ over index_. index_ can be List[]. *17Nov2015*\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexDeleteAll", "[", "index_", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", 
         RowBox[{"$index", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "index", "}"}], "]"}]}], ",", "$s"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$s", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"tt", ":", 
              RowBox[{"Tensor", "[", 
               RowBox[{"_", ",", "_", ",", "_"}], "]"}]}], "\[RuleDelayed]", 
             RowBox[{
              RowBox[{"tuIndexDelete", "[", "#", "]"}], "[", "tt", "]"}]}], 
            "&"}], "/@", "$index"}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", "$s", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"tuRepeat", "[", "$s", "]"}], "[", "$", "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"DeleteIndexExcept", "[", "ind_", "]"}], "[", "tensor_Tensor", 
      "]"}], " ", "deletes", " ", "indices", " ", "of", " ", "tensor_", " ", 
     "that", " ", "match", " ", "ind_"}], " ", "*)"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DeleteIndexExcept", "[", "ind_", "]"}], "[", "tensor_Tensor", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "uplist", ",", "dnlist", ",", "uppos", ",", "dnpos", ",", "delete"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"uplist", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"tensor", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"uplist", "=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"!", 
                 RowBox[{"MemberQ", "[", 
                  RowBox[{
                   RowBox[{"{", "#", "}"}], ",", "ind"}], "]"}]}], "&&", 
                RowBox[{"#", "=!=", "Void"}]}], ",", 
               RowBox[{"delete", "[", "#", "]"}], ",", "#"}], "]"}], "&"}], 
            ",", "uplist"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"uppos", "=", 
         RowBox[{"Position", "[", 
          RowBox[{"uplist", ",", 
           RowBox[{"delete", "[", "_", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"uplist", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"uplist", ",", "uppos"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"dnlist", ",", "uppos"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"!", 
                RowBox[{"MemberQ", "[", 
                 RowBox[{
                  RowBox[{"{", "#", "}"}], ",", "ind"}], "]"}]}], "&&", 
               RowBox[{"#", "=!=", "Void"}]}], ",", 
              RowBox[{"delete", "[", "#", "]"}], ",", "#"}], "]"}], "&"}], 
           ",", "dnlist"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dnpos", "=", 
         RowBox[{"Position", "[", 
          RowBox[{"dnlist", ",", 
           RowBox[{"delete", "[", "_", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"uplist", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"uplist", ",", "dnpos"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dnlist", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"dnlist", ",", "dnpos"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Tensor", "[", 
         RowBox[{
          RowBox[{"tensor", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "uplist", ",", "dnlist"}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"TensorIndex\[Delta]", 
      RowBox[{
       RowBox[{"{", "tensor_List", "}"}], "[", "exp_", "]"}], " ", "changes", 
      " ", "Tensors"}], ",", " ", 
     RowBox[{"e", ".", "g", "."}], ",", " ", 
     RowBox[{"Auu", "[", 
      RowBox[{"i", ",", "j", ",", "k"}], "]"}], ",", " ", 
     RowBox[{"in", " ", "tensor_List"}], ",", " ", 
     RowBox[{"e", ".", "g", "."}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"Auu", "[", 
       RowBox[{"i", ",", "l_", ",", "m_"}], "]"}], "}"}], ",", "  ", 
     RowBox[{"where", " ", "the", " ", "Patterns"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"l_", ",", "m_"}], "}"}], ",", " ", 
     RowBox[{"indicates", " ", "indices", " ", "to", " ", "act", " ", "on"}], 
     ",", " ", 
     RowBox[{"to", " ", "form", " ", 
      RowBox[{
       RowBox[{"Auu", "[", 
        RowBox[{"i", ",", 
         RowBox[{"dum", "[", "j", "]"}], ",", 
         RowBox[{"dum", "[", "k", "]"}]}], "]"}], " ", ".", " ", 
       RowBox[{"\[Delta]du", "[", 
        RowBox[{
         RowBox[{"dum", "[", "j", "]"}], ",", "j"}], "]"}], " ", ".", " ", 
       RowBox[{"\[Delta]du", "[", 
        RowBox[{
         RowBox[{"dum", "[", "k", "]"}], ",", "k"}], "]"}]}], " ", "where", 
      " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dum", "[", "j", "]"}], ",", 
        RowBox[{"dum", "[", "k", "]"}]}], "}"}], " ", "represent", " ", 
      "Einstein", " ", "summed", " ", 
      RowBox[{"indices", ".", "  ", "The"}], " ", "purpose", " ", "of", " ", 
      "this", " ", "function", " ", "is", " ", "to", " ", "transform", " ", 
      "exp_", " ", "to", " ", "a", " ", "form", " ", "that", " ", "allows", 
      " ", "EinsteinSum", " ", "expressions", " ", "to", " ", "be", " ", 
      "functionally", " ", "differentiated", " ", "by", " ", "Mathematica", 
      " ", "properly", " ", "in", " ", "Tensor", " ", 
      RowBox[{"expressions", ".", "  ", "The"}], " ", "action", " ", "of", 
      " ", "\[Delta]", " ", "will", " ", "yield", " ", "proper", " ", 
      RowBox[{"form", "."}]}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Tensor\[Delta]Index", "[", "tensor_List", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", 
         RowBox[{"(*", 
          RowBox[{
          "apply", " ", "on", " ", "each", " ", "Times", " ", "term"}], 
          "*)"}], ",", "\[IndentingNewLine]", "sub", ",", "sub1", ",", "sub0",
          ",", "f1", ",", "dd"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tensor:\>\"", ",", "tensor"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"change", " ", "Tensor"}], "\[Rule]", " ", 
          RowBox[{"\[Delta]", ".", "Tensor"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "/.", 
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], "\[RuleDelayed]", 
              
              RowBox[{
               RowBox[{"Tensor", "[", 
                RowBox[{"\[Delta]", ",", "b", 
                 StyleBox[",",
                  ShowSpecialCharacters->False,
                  ShowStringCharacters->True,
                  NumberMarks->True], 
                 StyleBox["c",
                  ShowSpecialCharacters->False,
                  ShowStringCharacters->True,
                  NumberMarks->True]}], 
                StyleBox["]",
                 ShowSpecialCharacters->False,
                 ShowStringCharacters->True,
                 NumberMarks->True]}], 
               StyleBox[".",
                ShowSpecialCharacters->False,
                ShowStringCharacters->True,
                NumberMarks->True], 
               RowBox[{"Tensor", "[", 
                RowBox[{"a", ",", "b", ",", "c"}], "]"}]}]}]}], "&"}], ",", 
           "tensor"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tmp:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"tmp", "/.", 
           RowBox[{"Pattern", "\[Rule]", "xPattern"}]}], "/.", 
          RowBox[{
           RowBox[{"xPattern", "[", 
            RowBox[{"a_", ",", 
             RowBox[{"Blank", "[", "]"}]}], "]"}], "\[Rule]", 
           RowBox[{"dum", "[", "a", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tmp:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Delta]", ",", "a_", ",", "b_"}], "]"}], 
           "\[RuleDelayed]", " ", 
           RowBox[{
            RowBox[{"SwapUpDownIndices", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Cases", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"dum", "[", "_", "]"}]}], "]"}], ",", 
                RowBox[{"Cases", "[", 
                 RowBox[{"b", ",", 
                  RowBox[{"dum", "[", "_", "]"}]}], "]"}]}], "}"}], "]"}], 
             "]"}], "[", 
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Delta]", ",", "a", ",", "b"}], "]"}], "]"}]}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Delta]", ",", "a_", ",", "b_"}], "]"}], ":>", 
           RowBox[{
            RowBox[{"DeleteIndexExcept", "[", 
             RowBox[{"dum", "[", "_", "]"}], "]"}], "[", 
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Delta]", ",", "a", ",", "b"}], "]"}], "]"}]}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tmp:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Delta]", ",", "a_", ",", "b_"}], "]"}], 
           "\[RuleDelayed]", 
           RowBox[{"AddUpDnDum", "[", 
            RowBox[{"Tensor", "[", 
             RowBox[{"\[Delta]", ",", "a", ",", "b"}], "]"}], "]"}]}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"sub", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"tensor", ",", "tmp"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"exp", "/.", "sub"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Changes", " ", "all", " ", "indices", " ", "of", " ", "tensor_Tensor", 
     " ", "to", " ", 
     RowBox[{"Pattern", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"TensorIndexPattern", "[", "tensor_Tensor", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "up", ",", "dn"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"up", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Head", "[", "#", "]"}], "=!=", "Pattern"}], "&&", 
               RowBox[{"#", "=!=", "Void"}]}], ",", 
              RowBox[{"Pattern", "[", 
               RowBox[{"#", ",", 
                RowBox[{"Blank", "[", "]"}]}], "]"}], ",", "#"}], "]"}], 
            "&"}], ",", 
           RowBox[{"tensor", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dn", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Head", "[", "#", "]"}], "=!=", "Pattern"}], "&&", 
               RowBox[{"#", "=!=", "Void"}]}], ",", 
              RowBox[{"Pattern", "[", 
               RowBox[{"#", ",", 
                RowBox[{"Blank", "[", "]"}]}], "]"}], ",", "#"}], "]"}], 
            "&"}], ",", 
           RowBox[{"tensor", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Tensor", "[", 
         RowBox[{
          RowBox[{"tensor", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "up", ",", "dn"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuD2tuDOp", "::", "usage"}], "=", 
     "\"\<tuD2tuDOp[tuDOp_,arg_List:{}][exp_] converts Derivative[] \
expressions into tuDOps_ expression.  Arguements to functions that are \
objects of Derivative[] can be added via arg_List in which case the \
Derivative is applied to each element in arg_List.  \
tuDOps_\[Rule]{xPartialD|xCovariantD|xD[_]|tuDPartial|tuDCovariant|tuDs[_]|\
tuDDown[_]|xPartialDu|xCovariantDu|xDu[_]|tuDPartialu|tuDCovariantu|tuDsu[_]|\
tuDUp[_]|tuDPartial|tuDCovariant|tuDs[_]|tuDDown[_]|tuDPartialu|tuDCovariantu|\
tuDsu[_]|tuDUp[_]|tuDLie}  *15Aug2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuD2tuDOp", "[", 
       RowBox[{"tuDOp_", ",", 
        RowBox[{"arg_List:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "makeVar"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"makeVar", "[", 
          RowBox[{"ndd_List", ",", "vars_List"}], "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", "out", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"xPrint", "[", 
             RowBox[{
             "\"\<<<\>\"", ",", "ndd", ",", "\"\<:\>\"", ",", "vars"}], "]"}],
             ";", "\[IndentingNewLine]", 
            RowBox[{"out", "=", 
             RowBox[{
              RowBox[{"MapIndexed", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"ConstantArray", "[", 
                  RowBox[{
                   RowBox[{"vars", "[", 
                    RowBox[{"[", 
                    RowBox[{"First", "[", "#2", "]"}], "]"}], "]"}], ",", 
                   "#1"}], "]"}], "&"}], ",", "ndd"}], "]"}], "//", 
              "Flatten"}]}], ";", "\[IndentingNewLine]", "out"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", "nd__", "]"}], "[", "fn_", "]"}], "[",
             "ind__", "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Fold", "[", 
             RowBox[{"tuDOp", ",", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "arg", "]"}], ">", "0"}], ",", 
                RowBox[{"fn", "[", "ind", "]"}], 
                RowBox[{"(*", 
                 RowBox[{"fn", "[", 
                  RowBox[{"Apply", "[", 
                   RowBox[{"Sequence", ",", "arg"}], "]"}], "]"}], "*)"}], 
                ",", 
                RowBox[{"fn", "[", "ind", "]"}]}], "]"}], ",", 
              RowBox[{"makeVar", "[", 
               RowBox[{
                RowBox[{"{", "nd", "}"}], ",", 
                RowBox[{"{", "ind", "}"}]}], "]"}]}], "]"}], "/;", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"{", "ind", "}"}], "]"}], ">", "0"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"Derivative", "[", "nd__", "]"}], "[", "fn_", "]"}], 
           "\[RuleDelayed]", 
           RowBox[{"Fold", "[", 
            RowBox[{"tuDOp", ",", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "arg", "]"}], ">", "0"}], ",", 
               RowBox[{"fn", "[", 
                RowBox[{"Apply", "[", 
                 RowBox[{"Sequence", ",", "arg"}], "]"}], "]"}], ",", 
               RowBox[{"fn", "[", 
                RowBox[{"Apply", "[", 
                 RowBox[{"Sequence", ",", "arg"}], "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"makeVar", "[", 
              RowBox[{
               RowBox[{"{", "nd", "}"}], ",", 
               RowBox[{"{", "arg", "}"}]}], "]"}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "TEST", "*)"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"$", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"tuDPartialu", "[", 
         RowBox[{
          RowBox[{"\[Chi]", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"u", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"\[Beta]", "[", "1", "]"}], "}"}]}], "]"}], "[", 
             "\[Gamma]", "]"}], ",", 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"u", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"\[Beta]", "[", "2", "]"}], "}"}]}], "]"}], "[", 
             "\[Gamma]", "]"}], ",", 
            RowBox[{"tuDPartial", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"u", ",", "\"\<u\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Beta]", "[", "3", "]"}], "}"}]}], "]"}], "[", 
               "\[Gamma]", "]"}], ",", "\[Gamma]"}], "]"}], ",", 
            RowBox[{"tuDPartial", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"u", ",", "\"\<d\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Beta]", "[", "4", "]"}], "}"}]}], "]"}], "[", 
               "\[Gamma]", "]"}], ",", "\[Gamma]"}], "]"}]}], "]"}], ",", 
          "\[Gamma]"}], "]"}], "\[IndentingNewLine]", "$"}], "=", 
       RowBox[{"$", "//", "tuDerivOps2D"}]}]}], ";", 
     RowBox[{
      RowBox[{"$", "//", 
       RowBox[{"ColumnSumExp", "\[IndentingNewLine]", "$"}]}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"$", "//", 
         RowBox[{"tuD2tuDOp", "[", "tuDPartialu", "]"}]}], "//", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#", "/.", 
           RowBox[{
            RowBox[{"\[Chi]", "[", "__", "]"}], "\[Rule]", "\[Chi]"}]}], 
          "&"}], ")"}]}], "//", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "/.", 
          RowBox[{
           RowBox[{"a_", "[", "\[Gamma]", "]"}], "\[Rule]", "a"}]}], "&"}], 
        ")"}]}]}], ";", 
     RowBox[{"$", "//", "ColumnSumExp"}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"D2xPartialD", "[", 
       RowBox[{"arg_List:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuD2tuDOp", "[", 
       RowBox[{"xPartialD", ",", "arg"}], "]"}], "[", "exp", "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuDupdn2tuPartial", "::", "usage"}], "=", 
    "\"\<tuDupdn2tuPartial[exp_] Converts \
D[fn_[\[Mu][up],\[Nu][dn],...],\[Mu][up],\[Nu][dn],...] form to \
tuDPartial[tuDPartialu[fn,\[Mu]],\[Nu]] form.  *1Jan2014*\>\""}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuDupdn2tuPartial", "[", "exp_", "]"}], ":=", 
    RowBox[{"exp", "//.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"HoldPattern", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Derivative", "[", "n__", "]"}], "[", "A_", "]"}], "[", 
         "i__", "]"}], "]"}], "\[RuleDelayed]", 
       RowBox[{"tuDtuDPartialupdown", "[", 
        RowBox[{
         RowBox[{"{", "n", "}"}], ",", "A", ",", 
         RowBox[{"{", "i", "}"}]}], "]"}]}], "}"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDtuDPartialupdown", "[", 
      RowBox[{"dslot_List", ",", "var_", ",", "updn_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "Ds", ",", "updnseq"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xPrint", "[", 
         RowBox[{
          RowBox[{"Length", "[", "dslot", "]"}], ",", "\"\<: \>\"", ",", 
          "var", ",", "\"\<:\>\"", ",", 
          RowBox[{"Length", "[", "updn", "]"}], ",", "\"\<:\>\"", ",", 
          "updn"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"updnseq", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"Sequence", ",", "updn"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "dslot", "]"}], "===", 
           RowBox[{"Length", "[", "updn", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp", "=", 
            RowBox[{"Thread", "[", 
             RowBox[{"List", "[", 
              RowBox[{"dslot", ",", "updn"}], "]"}], "]"}]}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{
            "\"\<dslot \>\"", ",", "dslot", ",", "\"\<:\>\"", ",", "var", 
             ",", "\"\<:\>\"", ",", "updn", ",", "\"\<:\>\"", ",", "tmp"}], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Ds", "=", 
            RowBox[{"DeleteCases", "[", 
             RowBox[{"tmp", ",", 
              RowBox[{"List", "[", 
               RowBox[{"0", ",", "_"}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Ds", "=", 
            RowBox[{
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}], ",", 
               "Ds"}], "]"}], "//", "Flatten"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"no", " ", "derivative"}], "*)"}], 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<Ds \>\"", ",", "var", ",", "\"\<, \>\"", ",", "Ds"}],
             "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"Fold", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"#2", ",", "up"}], "]"}], ",", 
                 RowBox[{"tuDPartial", "[", 
                  RowBox[{"#1", ",", "#2"}], "]"}], ",", 
                 RowBox[{"tuDPartialu", "[", 
                  RowBox[{"#1", ",", "#2"}], "]"}]}], "]"}], "&"}], ",", 
              "var", ",", "Ds"}], "]"}]}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<Folded: \>\"", ",", "tmp"}], "]"}], ";", 
           "\[IndentingNewLine]", "tmp"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Derivative", "[", 
             RowBox[{"Apply", "[", 
              RowBox[{"Sequence", ",", "dslot"}], "]"}], "]"}], "[", "var", 
            "]"}], "[", "updnseq", "]"}]}], "]"}]}]}], 
      RowBox[{"(*", 
       RowBox[{"Do", " ", "nothing", " ", "return"}], "*)"}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuArgRemove", "::", "usage"}], ":=", 
     "\"\<tuArgRemove[var_List][exp_]\neliminates arguements of Head[] \
patterns in var_List, e.g., A[a][b] B[d][e] ]->A[a]B[d] *12Apr2012*\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuArgRemove", "[", "var_List", "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"sub", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"tmp", "=", "exp"}], ",", "XXX"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sub", "=", 
         RowBox[{
          RowBox[{"MapIndexed", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Append", "[", 
              RowBox[{"sub", ",", 
               RowBox[{
                RowBox[{"#1", "[", "arg__", "]"}], "\[Rule]", 
                RowBox[{"XXX", "[", 
                 RowBox[{"#2", ",", 
                  RowBox[{"RemovePatterns", "[", "#1", "]"}]}], "]"}]}]}], 
              "]"}], "&"}], ",", "var"}], "]"}], "//", "Flatten"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "//.", "sub"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{
           RowBox[{"XXX", "[", 
            RowBox[{"n_", ",", "A_"}], "]"}], "\[Rule]", "A"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"EliminateArguments", "[", "var_List", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{
      RowBox[{"tuArgRemove", "[", "var", "]"}], "[", "exp", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuEulerEquation", "::", "usage"}], "=", 
     "\"\<tuEulerEquation[dependent_,independent_][lagrangian_] converts the \
lagrangian_ into an expression that is appropriate for EulerEquations[].  The \
input lagrangian_ expression has dependent variables without arguements which \
are added by specifying dependent_ and independent_.  The tuDerivOps are \
converted to Mathematica derivatives by tuDerivOps2D[]. EulerEquations[] is \
applied and the return value is: {xEulerEquations[]expression, EulerEquation \
output, EulerEquation output after application of tuD2tuDOp[tuDPartial]}. \
*13Sep2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuEulerEquation", "[", 
       RowBox[{"dependent_", ",", "independent_"}], "]"}], "[", "lagrangian_",
       "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$L", "=", "lagrangian"}], ",", 
         RowBox[{"$dependent", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "dependent", "}"}], "]"}]}], ",", 
         RowBox[{"$independent", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "independent", "}"}], "]"}]}], ",", "$dummy", ",", 
         "i", ",", "$", ",", "$s", ",", "$s1", ",", "$xE", ",", "$1", ",", 
         "$2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"make", " ", 
         RowBox[{"dependent", "[", "independent", "]"}], " ", "Rule"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$s1", "=", 
         RowBox[{"Through", "[", 
          RowBox[{"$dependent", "[", 
           RowBox[{"Apply", "[", 
            RowBox[{"Sequence", ",", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", "$independent", "}"}], "]"}]}], "]"}], "]"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{"$dependent", "\[Rule]", "$s1"}], "//", "Thread"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{"lagrangian", "//", 
           RowBox[{"tuRuleApply", "[", "$s", "]"}]}], "//", 
          "tuDerivOps2D"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$xE", "=", 
         RowBox[{"xEulerEquations", "[", 
          RowBox[{"$", ",", "$s1", ",", "$independent"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$1", "=", 
         RowBox[{
          RowBox[{"$xE", "/.", 
           RowBox[{"xEulerEquations", "\[Rule]", "EulerEquations"}]}], "//", 
          "tuRuleRHS0"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$2", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"$1", "//", 
             RowBox[{"tuD2tuDOp", "[", "tuDPartial", "]"}]}], "//", 
            RowBox[{"tuArgRemove", "[", 
             RowBox[{"Apply", "[", 
              RowBox[{"Alternatives", ",", "$dependent"}], "]"}], "]"}]}], "//",
            "Simplify"}], "//", "tuRuleRHS0"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"{", 
         RowBox[{"$xE", ",", 
          RowBox[{
           RowBox[{"{", "$1", "}"}], "[", 
           RowBox[{"CG", "[", 
            RowBox[{
            "\"\<equations of motion\>\"", ",", 
             "\"\<Mathematica D-form\>\""}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"{", "$2", "}"}], "[", 
           RowBox[{"CG", "[", 
            RowBox[{"\"\<equations of motion\>\"", ",", "\"\<tu D-form\>\""}],
             "]"}], "]"}]}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuLagrangianQuantities", "::", "usage"}], "=", 
     "\"\<tuLagrangianQuantities[dependent_,independent_,constants_:{}][\
LAGRANGIAN_] computes various quantities from the LAGRANGIAN_: {momentum of \
dependent_ variables, the results of the tuEulerEquation[] calculations. \
*24Sep2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuLagrangianQuantities", "[", 
       RowBox[{"dependent_", ",", "independent_", ",", 
        RowBox[{"constants_:", 
         RowBox[{"{", "}"}]}]}], "]"}], "[", "LAGRANGIAN_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$dependent", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "dependent", "}"}], "]"}]}], ",", 
         RowBox[{"$independent", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "independent", "}"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"$lagrangian", "=", "LAGRANGIAN"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"$constants", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "constants", "}"}], "]"}]}], ",", 
         "\[IndentingNewLine]", "$", ",", "$1", ",", "XXX", ",", "$s", ",", 
         "$d", ",", 
         RowBox[{"$conserved", "=", 
          RowBox[{"{", "}"}]}], ",", "$eulerequations", ",", 
         RowBox[{"$momemtum", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"$out", "=", 
          RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$eulerequations", "=", 
         RowBox[{
          RowBox[{"tuEulerEquation", "[", 
           RowBox[{"$dependent", ",", "$independent"}], "]"}], "[", 
          "LAGRANGIAN", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$eulerequations", "=", 
         RowBox[{"$eulerequations", "[", 
          RowBox[{"CG", "[", "\"\<eulerequations\>\"", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"$i", "=", "1"}], ",", 
          RowBox[{"$i", "\[LessEqual]", 
           RowBox[{"Length", "[", "$dependent", "]"}]}], ",", 
          RowBox[{"$i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{
              RowBox[{"$", "=", "$lagrangian"}], ",", "\"\< : \>\"", ",", 
              "$dependent", ",", "$independent"}], "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$s", "=", 
            RowBox[{
             RowBox[{"$lagrangian", "//", 
              RowBox[{"tuExtractPattern", "[", 
               RowBox[{"DerivOps", "[", 
                RowBox[{
                 RowBox[{"$dependent", "[", 
                  RowBox[{"[", "$i", "]"}], "]"}], ",", 
                 RowBox[{"$independent", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], "//", 
             "First"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$d", "=", 
            RowBox[{
             RowBox[{"Head", "[", "$s", "]"}], "[", 
             RowBox[{"$lagrangian", ",", "$s"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", "$d", "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"$d", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"$d", "//", 
               RowBox[{"tuDerivativeExpand", "[", "$constants", "]"}]}], "//", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#", "/.", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "[", "$s", "]"}], "[", 
                   RowBox[{"a_", ",", "$s"}], "]"}], "\[RuleDelayed]", 
                  RowBox[{"0", "/;", 
                   RowBox[{"tuHasNoneQ", "[", 
                    RowBox[{"a", ",", "$s"}], "]"}]}]}]}], "&"}], ")"}]}], "//",
              "Expand"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", "$d", "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"$lagrangian", "/.", 
             RowBox[{"$s", "\[Rule]", "XXX"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$1", "=", 
            RowBox[{"(", 
             RowBox[{"$", "//", 
              RowBox[{
               RowBox[{"tuHasAnyQ", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"$dependent", "[", 
                  RowBox[{"[", "$i", "]"}], "]"}]}], "]"}], "&"}]}], ")"}]}], 
           ";", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"$", ",", "\"\<:\>\"", ",", "$s", ",", "\"\<:\>\"", ",", 
               RowBox[{"$dependent", "[", 
                RowBox[{"[", "$i", "]"}], "]"}], ",", "\"\<:\>\"", ",", 
               "$1"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"$d", "=", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["p", 
               RowBox[{"$dependent", "[", 
                RowBox[{"[", "$i", "]"}], "]"}]], "\[Rule]", "$d"}], "}"}]}], 
           ";", 
           RowBox[{"$d", "=", 
            RowBox[{"If", "[", 
             RowBox[{"$1", ",", "$d", ",", 
              RowBox[{"$d", "[", 
               RowBox[{"CG", "[", 
                RowBox[{"\"\<conserved\>\"", ",", 
                 RowBox[{
                  RowBox[{"tuDPartial", "[", 
                   RowBox[{"\[ScriptCapitalL]", ",", 
                    RowBox[{"$dependent", "[", 
                    RowBox[{"[", "$i", "]"}], "]"}]}], "]"}], "\[Rule]", 
                  "0"}]}], "]"}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"$momemtum", ",", "$d"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$momemtum", "=", 
         RowBox[{"$momemtum", "[", 
          RowBox[{"CG", "[", "\"\<momentum\>\"", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$out", "=", 
         RowBox[{"{", 
          RowBox[{"$momemtum", ",", "$eulerequations"}], "}"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", 
      RowBox[{"Get", "[", 
       RowBox[{
       "$InitialDirectory", "<>", 
        "\"\</Mathematica/Gravity/AZee.V.4.out\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"$", "=", 
      RowBox[{"$0", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"e", "[", "6", "]"}], "//", 
         RowBox[{"Last", "\[IndentingNewLine]", "$"}]}], "=", 
        RowBox[{
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"d", "[", "a_", "]"}], "\[Rule]", 
           RowBox[{
            RowBox[{"tuDs", "[", "d", "]"}], "[", 
            RowBox[{"a", ",", "\[Tau]"}], "]"}]}]}], "//", 
         RowBox[{"tuLagrangianQuantities", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[CapitalOmega]", ",", "t", ",", "r"}], "}"}], ",", 
           "\[Tau]", ",", 
           RowBox[{"{", "}"}]}], "]"}]}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ColumnForms", "[", 
         RowBox[{"#1", ",", "4"}], "]"}], "&"}], ")"}], "[", "$", "]"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuHamiltonian", "::", "usage"}], "=", 
     "\"\<tuHamiltonian[lagrangian_,partialD_List,constant_List:{}] returns \
the Hamiltonian associated with the lagrangian_ and partialD_s.  A list of \
constant_s may be specified for tuDerivativeExpand[]. Dot is added to allow \
for vector expressions *22Feb2017*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuHamiltonian", "[", 
      RowBox[{"lagrangian_", ",", "partialD_List", ",", 
       RowBox[{"constant_List:", 
        RowBox[{"{", "}"}]}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"tmpL", "=", "lagrangian"}], ",", "partial", ",", 
         "partialDt", ",", "i", ",", 
         RowBox[{"accum", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", 
           RowBox[{"Length", "[", "partialD", "]"}]}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"partialDt", "=", 
            RowBox[{"partialD", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tuDPartial", "[", 
              RowBox[{"lagrangian", ",", "partialDt"}], "]"}], "//", 
             RowBox[{"tuDerivativeExpand", "[", "constant", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tmp", "/.", 
              RowBox[{
               RowBox[{"tuDPartial", "[", 
                RowBox[{"a_", ",", 
                 RowBox[{"dd", ":", 
                  RowBox[{"tuDPartial", "[", 
                   RowBox[{"b_", ",", "t"}], "]"}]}]}], "]"}], 
               "\[RuleDelayed]", 
               RowBox[{"0", "/;", 
                RowBox[{"FreeQ", "[", 
                 RowBox[{"a", ",", "dd"}], "]"}]}]}]}], "//.", 
             RowBox[{"tuOpSimplify", "[", 
              RowBox[{"dotOps", ",", "constant"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"accum", "+=", 
            RowBox[{"tmp", "  ", ".", "  ", "partialDt"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"accum", "-", "lagrangian"}], "//.", 
          RowBox[{"tuOpSimplify", "[", 
           RowBox[{"dotOps", ",", "constant"}], "]"}]}], "//", 
         "Simplify"}]}]}], 
      RowBox[{"(*", 
       RowBox[{
       "add", " ", "Dot", " ", "for", " ", "possible", " ", "vector", " ", 
        "equation"}], "*)"}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuEulerLagrangeTensor", "::", "usage"}], ":=", 
     "\[IndentingNewLine]", 
     "\"\<tuEulerLagrangeTensor[Lagrangian_,field_List,indexDeriv_List] \
compute Euler-Lagrange(EL) equations for Lagrangian_ for each Tensor field in \
field_List where its participanting index variables are indicated by \
Patterns. Builds arguements for EulerEquations[], but participating field \
indices are lowered for the calculation. (WARNING: The same variable with \
different indices are treated as different variables.  Convert these \
variables to same indices by using metric tensor.  The result has \
participating field indices in the lower position and there are multiples EL \
equations, one for each active index variable.  Need to specify all \
field_List that are functions of indexDeriv_List.  WARNING: This routine is \
not recognized via Initialization.  This block must be executed manually.   \
TODO: Convert these variables to have same index by using metric tensor. \
*2Jan2014*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuEulerLagrangeTensor", "[", 
      RowBox[{"Lagrangian_", ",", "\[IndentingNewLine]", "field_List", ",", 
       RowBox[{"(*", 
        RowBox[{
        "field", " ", "to", " ", "evaluate", " ", "in", " ", "EL", " ", 
         RowBox[{"calculation", ".", " ", "Pattern"}], " ", "for", " ", 
         "indices", " ", "indicates", " ", "indexDeriv_List", " ", 
         RowBox[{"variable", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       "indexDeriv_List"}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "index", " ", "variables", " ", "taking", " ", "part", " ", "in", " ",
          "EL", " ", "calculation"}], ",", " ", 
        RowBox[{
        "includes", " ", "xPartialD", " ", "and", " ", "xPartialDu", " ", 
         RowBox[{"indices", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", 
         RowBox[{"vars", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"fields", "=", 
          RowBox[{"{", "}"}]}], ",", "sub", ",", "subvar", ",", "subLower", 
         ",", 
         RowBox[{"xfield", "=", "field"}], ",", "xfieldLower", ",", 
         "lagrangianLower", ",", "fieldVar", ",", "fieldLag", ",", 
         "indexPattern", ",", "fieldLow", ",", "$s", ",", "$sx0", ",", "$p", 
         ",", "$pvar", ",", "$pvar1"}], "}"}], ",", 
       RowBox[{"(*", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Needs", "[", "\"\<VariationalMethods`\>\"", "]"}], ";"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"modified", " ", "inputs", 
         RowBox[{"(", "indices", ")"}], " ", "to", " ", "be", " ", 
         RowBox[{"compatible", ".", " ", "Field"}], " ", "index_List", " ", 
         "indices", " ", "all", " ", 
         RowBox[{"lower", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xfield", "=", 
         RowBox[{"field", "/.", 
          RowBox[{"Pattern", "\[Rule]", "xPattern"}]}]}], ";", 
        RowBox[{"xPrint", "[", "xfield", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"indexPattern", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"tuExtractPattern", "[", 
            RowBox[{"xPattern", "[", 
             RowBox[{"i_", ",", "_"}], "]"}], "]"}], "[", "xfield", "]"}], "//",
           "DeleteDuplicates"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"fieldLow", "=", 
         RowBox[{"Fold", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"tuIndicesLower", "[", 
              RowBox[{"#2", ",", "#2"}], "]"}], "[", "#1", "]"}], "&"}], ",", 
           "xfield", ",", "indexPattern"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"subLower", "=", 
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"Thread", "[", 
               RowBox[{"xfield", "\[Equal]", "fieldLow"}], "]"}], "}"}], 
             "]"}], ",", "True"}], "]"}], "/.", 
          RowBox[{"Equal", "\[Rule]", "Rule"}]}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"xfield", ",", "fieldLow", ",", "subLower"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"subLower", "=", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"MapAt", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "/.", 
                 RowBox[{
                  RowBox[{"xPattern", "[", 
                   RowBox[{"i_", ",", "_"}], "]"}], "\[Rule]", "i"}]}], "&"}],
                ",", "#", ",", "2"}], "]"}], "&"}], ",", "subLower"}], "]"}], 
          "/.", 
          RowBox[{"xPattern", "\[Rule]", "Pattern"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"fieldLow", "=", 
         RowBox[{"fieldLow", "/.", 
          RowBox[{"xPattern", "\[Rule]", "Pattern"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<NEW subLower:\>\"", ",", "subLower"}], "]"}], ";", 
        RowBox[{"xReturn", "[", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"fieldLag", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"tuExtractPattern", "[", "#", "]"}], "[", 
                "Lagrangian", "]"}], "&"}], ",", "field"}], "]"}], "/.", 
            "subLower"}], "//", "Flatten"}], "//", "DeleteDuplicates"}]}], 
        ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<fieldLag:\>\"", ",", "fieldLag"}], "]"}], ";", 
        RowBox[{"xReturn", "[", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{"build", " ", "variables", " ", "for", " ", 
            RowBox[{"functional", ":", " ", "f"}]}], "\[Rule]", 
           RowBox[{
            RowBox[{"f", "[", "vars", "]"}], ".", " ", "up"}]}], ",", 
          RowBox[{
          "dn", " ", "indices", " ", "are", " ", "treated", " ", "as", " ", 
           "independent", " ", "index", " ", 
           RowBox[{"variables", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"vars", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"#", "[", "up", "]"}], ",", 
               RowBox[{"#", "[", "dn", "]"}]}], "}"}]}], "]"}], "&"}], ",", 
          "indexDeriv"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"vars", "=", 
         RowBox[{"Flatten", "[", "vars", "]"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<vars:\>\"", ",", "vars"}], "]"}], ";", 
        RowBox[{"xReturn", "[", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"add", " ", "vars", " ", "to", " ", "field"}], "\[Rule]", 
          RowBox[{
           RowBox[{"field", "[", "vars", "]"}], " ", 
           RowBox[{"Rule", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"fieldVar", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Apply", "[", 
             RowBox[{
              RowBox[{"tuPatternRemove", "[", "#", "]"}], ",", "vars"}], 
             "]"}], "&"}], ",", "fieldLag"}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<fieldVar:\>\"", ",", "fieldVar"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"subvar", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"fieldLag", ",", "fieldVar"}], "]"}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<subvar:\>\"", ",", "subvar"}], "]"}], ";", 
        RowBox[{"xReturn", "[", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"lagrangianLower", "=", 
         RowBox[{"Lagrangian", "/.", "subLower"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<L: \>\"", ",", "lagrangianLower"}], "]"}], ";", 
        RowBox[{"xReturn", "[", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"lagrangianLower", "//", 
          RowBox[{"xPartialD2Dupdn", "[", 
           RowBox[{"indexDeriv", ",", "fieldLow"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
         "NEED", " ", "to", " ", "account", " ", "for", " ", "raw", " ", 
          "indexDeriv", " ", "variables"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$p", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{
          "tuExtractPositionPattern", "[", "tuRuleIndependentVarPattern", 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$pvar", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "$p"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$pvar1", "=", 
         RowBox[{"MapIndexed", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#1", "\[Rule]", 
             RowBox[{"ToString", "[", 
              RowBox[{"pvar", "[", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "&"}], ",", 
           "$pvar"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$p", "=", 
         RowBox[{"$p", "/.", "$pvar1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"tmp", ",", "$p"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{"stringify", " ", "already", " ", "vars"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"cc", ":", 
              RowBox[{"#", "[", 
               RowBox[{"up", "|", "dn"}], "]"}]}], "\[RuleDelayed]", 
             RowBox[{"$string", "[", 
              RowBox[{"ToString", "[", "cc", "]"}], "]"}]}], "&"}], ",", 
           "indexDeriv"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", "$s"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"cc", ":", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"a_:", "1"}], " ", ")"}], "  ", 
               SuperscriptBox["#", 
                RowBox[{"n_:", "1"}]]}]}], "\[RuleDelayed]", 
             RowBox[{
              RowBox[{"a", " ", 
               SuperscriptBox[
                RowBox[{"#", "[", "dn", "]"}], 
                RowBox[{"n", " "}]]}], "/;", 
              RowBox[{"FreeQ", "[", 
               RowBox[{"cc", ",", 
                RowBox[{"#", "[", 
                 RowBox[{"dn", "|", "up"}], "]"}]}], "]"}]}]}], "&"}], ",", 
           "indexDeriv"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", "$s"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"$string", "[", "cc_", "]"}], "\[RuleDelayed]", 
           RowBox[{"ToExpression", "[", "cc", "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$pvar1", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Reverse", "[", "#", "]"}], "&"}], "/@", 
          RowBox[{"(", "$pvar1", ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", "$pvar1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{"Apply", " ", "EulerEquations"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{
         "\"\<>>\>\"", ",", "tmp", ",", "\"\<;\>\"", ",", "indexDeriv", ",", 
          "\"\<;\>\"", ",", "fieldLow"}], "]"}], ";", 
        RowBox[{"xReturn", "[", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"fieldVar", "=", 
         RowBox[{"DeleteDuplicates", "[", "fieldVar", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{
         "\"\<EulerEquations[\>\"", ",", "tmp", ",", "\"\<,\\n\>\"", ",", 
          "fieldVar", ",", "\"\<,\\n:\>\"", ",", "vars", ",", 
          "\"\<\\n]\>\""}], "]"}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"xReturn", "[", "]"}], ";"}], "*)"}], 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"xEulerEquations", "[", 
           RowBox[{"tmp", ",", "fieldVar", ",", "vars"}], "]"}], ";"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"EulerEquations", "[", 
          RowBox[{"tmp", ",", "fieldVar", ",", "vars"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{
         "\"\<>>\>\"", ",", "tmp", ",", "\"\<\\n:\>\"", ",", "fieldVar", ",", 
          "\"\<\\n:\>\"", ",", "vars"}], "]"}], ";", 
        RowBox[{"xReturn", "[", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Convert", " ", "D", " ", "to", " ", "xPartialD"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", "tuDupdn2tuPartial"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xfield", "=", 
         RowBox[{"xfield", "/.", 
          RowBox[{"xPattern", "->", "Pattern"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"Is", " ", "this", " ", 
          RowBox[{"compatible", "?"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{
         "\"\<xfield\>\"", ",", "xfield", ",", "\"\<, \>\"", ",", "tmp"}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"xEliminateArguments", "[", "xfield", "]"}], "[", "tmp", 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"xEliminateArguments", "->", "tuArgRemove"}]}]}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"EulerLagrangeTensor", "[", 
       RowBox[{
       "Lagrangian_", ",", "\[IndentingNewLine]", "field_List", ",", 
        "\[IndentingNewLine]", "indexDeriv_List"}], "\[IndentingNewLine]", 
       "]"}], ":=", 
      RowBox[{"tuEulerLagrangeTensor", "[", 
       RowBox[{"Lagrangian", ",", "field", ",", "indexDeriv"}], "]"}]}], 
     ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Test", " ", "routine"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"testEulerLagrangeTensor", ":=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "tmp", ",", "tmp0", ",", "var", ",", "$L", ",", "$tensorsymbol", 
           ",", "$var", ",", "$dummy"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"xPrint", "[", "\[IndentingNewLine]", 
           RowBox[{"tmp0", "=", 
            RowBox[{"tmp", "=", 
             RowBox[{"Get", "[", 
              RowBox[{
              "$HomeDirectory", "<>", 
               "\"\</Mathematica/AZee/AZee.VI.1.out\>\""}], "]"}]}]}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{"tmp", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\[Alpha]1", "\[Rule]", "\[Lambda]"}], ",", 
              RowBox[{"\[Alpha]2", "\[Rule]", "\[Nu]"}], ",", 
              RowBox[{"\[Alpha]3", "\[Rule]", "\[Mu]"}]}], "}"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"$L", ",", "$var", ",", "$dummy"}], "}"}], "=", 
           RowBox[{
            RowBox[{"PrepareLagrangian", "[", 
             RowBox[{"{", "a", "}"}], "]"}], "[", "tmp", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"$dummy", ",", "\[Lambda]"}], "]"}], ";", 
          RowBox[{"(*", 
           RowBox[{"does", " ", "not", " ", "find", " ", "\[Lambda]"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<Arg:\>\"", ",", "tmp0", ",", "\"\<\\nvar: \>\"", ",", "$var", 
            ",", "\"\<\\ndummy: \>\"", ",", "$dummy"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"{", 
            RowBox[{"tmp", "\[LongRightArrow]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"tmp0", "=", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"xxtmp", "=", 
                    RowBox[{"tuEulerLagrangeTensor", "[", 
                    RowBox[{"$L", ",", "$var", ",", "$dummy"}], "]"}]}], 
                   ")"}], "//", "Flatten"}]}], ")"}], "//", "Column"}], 
              ")"}]}], "}"}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Rearrange", " ", "indices"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"tmp0", "=", 
           RowBox[{
            RowBox[{"MapAt", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"IndexSwap", "[", 
                 RowBox[{"{", 
                  RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "]"}], "[", "#", 
                "]"}], "&"}], ",", "tmp0", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", "1", "}"}], ",", 
                RowBox[{"{", "3", "}"}]}], "}"}]}], "]"}], "//", "Expand"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"tmp0", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"!", 
                   RowBox[{"FreeQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"T", "[", 
                    RowBox[{"a", ",", "\"\<u\>\""}], "]"}], "[", "_", "]"}]}],
                     "]"}]}], ",", 
                  RowBox[{"#", "/.", 
                   RowBox[{
                    RowBox[{"tt", ":", 
                    RowBox[{
                    RowBox[{"b_", " ", 
                    RowBox[{"f_", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"T", "[", 
                    RowBox[{"a", ",", "\"\<u\>\""}], "]"}], "[", "i_", "]"}], 
                    ",", "d_"}], "]"}]}], "|", 
                    RowBox[{"b_", " ", 
                    RowBox[{"g_", " ", "[", 
                    RowBox[{
                    RowBox[{"f_", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"T", "[", 
                    RowBox[{"a", ",", "\"\<u\>\""}], "]"}], "[", "i_", "]"}], 
                    ",", "d_"}], "]"}], ",", "e_"}], "]"}]}]}]}], ":>", 
                    RowBox[{
                    RowBox[{"UpDownIndexSwap", "[", "i", "]"}], "[", "tt", 
                    "]"}]}]}]}], "]"}], "&"}], ",", "tmp0"}], "]"}], "/.", 
             RowBox[{"orderxPartialD", "[", 
              RowBox[{"{", 
               RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "]"}]}], "//", 
            RowBox[{"tuIndicesLower", "[", 
             RowBox[{"\[Nu]", ",", "\[Nu]"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<Added together: \>\"", ",", 
            RowBox[{"Framed", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"tmp0", "/.", "OrderAll\[Epsilon]"}], "//", 
               "AddRules"}], "//", "Expand"}], "]"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"**", "**", "**", "**", "**", "**", "**", "**"}], "*****)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "tmp", ",", "tmp0", ",", "p0", ",", "var", ",", "$L", ",", 
           "$tensorsymbol", ",", "$var", ",", "$dummy"}], "}"}], ",", 
         RowBox[{
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"xPartialD", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"x", ",", "\"\<d\>\""}], "]"}], "[", "k", "]"}], ",",
                "t"}], "]"}], 
             RowBox[{
              RowBox[{"xPartialDu", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"x", ",", "\"\<u\>\""}], "]"}], "[", "k", "]"}], 
                ",", "t"}], "]"}], "/", "2"}]}], "-", 
            RowBox[{"g", " ", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"x", ",", "\"\<d\>\""}], "]"}], "[", "k", "]"}]}]}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"$L", ",", "$var", ",", "$dummy"}], "}"}], "=", 
           RowBox[{
            RowBox[{"PrepareLagrangian", "[", 
             RowBox[{"{", "x", "}"}], "]"}], "[", "tmp", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<Arg:\>\"", ",", "tmp", ",", "\"\<\\nvar: \>\"", ",", "$var", 
            ",", "\"\<\\ndummy: \>\"", ",", 
            RowBox[{"$dummy", "=", 
             RowBox[{"{", "t", "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"{", 
            RowBox[{"tmp", "\[LongRightArrow]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"tmp0", "=", 
                 RowBox[{
                  RowBox[{"tuEulerLagrangeTensor", "[", 
                   RowBox[{"$L", ",", "$var", ",", 
                    RowBox[{"{", "t", "}"}]}], "]"}], "//", "Flatten"}]}], 
                ")"}], "//", "Column"}], ")"}]}], "}"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<Added together: \>\"", ",", 
            RowBox[{"Framed", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"tmp0", "//", "AddRules"}], "//", "Expand"}], "//", 
              RowBox[{"tuIndicesRaise", "[", 
               RowBox[{"k", ",", "k"}], "]"}]}], "]"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", "}"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuLagrangianPrepare", "]"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"tuLagrangianPrepare", "::", "usage"}], "=", 
     "\"\<tuLagrangianPrepare[tensorsymbol_List][lagrangian_] symmetrizes \
UpDn indices for Tensors with tensorsymbol_'s in lagrangian_.  Returns: \
{lagrangian[symmetrized], Tensor_variables, Tensor_indices, \
Derivative_variables}.  These results can be used as inputs to \
tuEulerLagrangeTensor.  One may need to modify Tensor_indices, \
Derivative_variables based upon particular needs.  The results of \
tuEulerLagrangeTensor[] will contains redundant solutions due to the \
symmetrization of the indices. *8Mar2019*\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuLagrangianPrepare", "[", "tensorsymbol_List", "]"}], "[", 
      "lagrangian_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$L", "=", "lagrangian"}], ",", 
         RowBox[{"$tensorsymbol", "=", "tensorsymbol"}], ",", "$var", ",", 
         "$tensorIndex", ",", "i", ",", "$pdvar"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$L", "=", 
         RowBox[{"$L", "/.", 
          RowBox[{
           RowBox[{"Rule", "[", 
            RowBox[{"a_", ",", "b_"}], "]"}], "\[Rule]", "b"}]}]}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"change", " ", "\[ScriptCapitalL]"}], "\[Rule]", 
          RowBox[{
          "expression", " ", "\[LongRightArrow]", " ", "expression"}]}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$var", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"tuExtractPattern", "[", 
                  RowBox[{"Tensor", "[", 
                   RowBox[{"#", ",", "_", ",", "_"}], "]"}], "]"}], "[", "$L",
                  "]"}], "}"}], "&"}], ",", "$tensorsymbol"}], "]"}], "//", 
            "Flatten"}], "//", "DeleteDuplicates"}], "//", "Sort"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$tensorIndex", "=", 
         RowBox[{
          RowBox[{"$var", "//", "tuIndexParser"}], "//", "First"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$pdvar", "=", 
         RowBox[{"$L", "//", 
          RowBox[{"tuExtractPattern", "[", 
           RowBox[{
            RowBox[{"tuDPartial", "[", 
             RowBox[{"_", ",", "a_"}], "]"}], "|", 
            RowBox[{"tuDPartialu", "[", 
             RowBox[{"_", ",", "a_"}], "]"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$pdvar", "=", 
         RowBox[{
          RowBox[{"$pdvar", "/.", 
           RowBox[{
            RowBox[{
             RowBox[{"tuDPartial", "[", 
              RowBox[{"_", ",", "a_"}], "]"}], "|", 
             RowBox[{"tuDPartialu", "[", 
              RowBox[{"_", ",", "a_"}], "]"}]}], "\[Rule]", "a"}]}], "//", 
          "DeleteDuplicates"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"symmetrize", " ", "UpDn", " ", "indices"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"$L", "=", 
            RowBox[{"Expand", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"$L", "+", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"tuIndexSwapUpDown", "[", 
                   RowBox[{"$tensorIndex", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], "[", "$L", "]"}], 
                 ")"}]}], ")"}], "/", "2"}], "]"}]}], ";", 
           RowBox[{"xPrint", "[", "$L", "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "$tensorIndex", "]"}]}], "}"}]}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"$L", ",", "$var", ",", "$tensorIndex", ",", "$pdvar"}], 
         "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"PrepareLagrangian", "[", "tensorsymbol_List", "]"}], "[", 
      "lagrangian_", "]"}], ":=", 
     RowBox[{
      RowBox[{"tuLagrangianPrepare", "[", "tensorsymbol", "]"}], "[", 
      "lagrangian", "]"}]}], ";"}], 
   RowBox[{"(*", " ", "compatibility", " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "testEulerLagrangeTensor", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"LowerTensorIndexByG", "[", 
        RowBox[{"tensor_List", ",", "G_"}], "]"}], "[", "exp_", "]"}], " ", 
      "lower", " ", "indices", " ", "of", " ", "Tensor", " ", "variables", 
      " ", "in", " ", "exp_", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"by", " ", "assuming", " ", "the", " ", "metric"}], ",", " ", 
        "G_", ",", " ", 
        RowBox[{"lowers", " ", "indices"}]}], ")"}], " ", "specified", " ", 
      "in", " ", "tensor_List", " ", "of", " ", "only", " ", "the", " ", 
      "indices", " ", "specified", " ", "as", " ", 
      RowBox[{"patterns", ".", " ", "The"}], " ", "result", " ", "is", " ", 
      "the", " ", "tensor_List", " ", "variables", " ", "Dotted", " ", "with",
       " ", "the", " ", "metric"}], ",", " ", "G_", ",", " ", 
     RowBox[{"and", " ", "the", " ", "specified", " ", "indices", " ", 
      RowBox[{"lowered", ".", "  ", "The"}], " ", "summed", " ", "indices", 
      " ", "are", " ", "specified", " ", "by", " ", 
      RowBox[{"dum", "[", "]"}], " ", 
      RowBox[{"indices", ".", "  ", "The"}], " ", "purpose", " ", "of", " ", 
      "this", " ", "routine", " ", "is", " ", "allow", " ", "for", " ", "the",
       " ", "differential", " ", "of", " ", "expressions", " ", "that", " ", 
      "have", " ", "variables", " ", "that", " ", "differ", " ", "by", " ", 
      "a", " ", "metric", " ", "index", " ", 
      RowBox[{"change", ".", "  ", "eg", "."}]}], ",", " ", 
     RowBox[{
     "the", " ", "TEST", " ", "below", " ", "generates", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        InterpretationBox[
         SubsuperscriptBox["A", 
          RowBox[{
           StyleBox["a",
            StripOnInput->False,
            ShowContents->False], "\[Mu]_"}], 
          RowBox[{"a", 
           StyleBox["\[Mu]_",
            StripOnInput->False,
            ShowContents->False]}]],
         TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, {$CellContext`a, 
           TensorCalculus4V6`Tensorial`Void}, {
          TensorCalculus4V6`Tensorial`Void, 
           Pattern[$CellContext`\[Mu], 
            Blank[]]}],
         BaseStyle->{AutoMultiplicationSymbol -> False},
         Editable->False], ",", 
        InterpretationBox[
         SubsuperscriptBox["B", 
          StyleBox[
           RowBox[{"f", "g_", "h_"}],
           StripOnInput->False,
           ShowContents->False], 
          RowBox[{"f", "g_", "h_"}]],
         TensorCalculus4V6`Tensorial`Tensor[$CellContext`B, {$CellContext`f, 
           Pattern[$CellContext`g, 
            Blank[]], 
           Pattern[$CellContext`h, 
            Blank[]]}, {
          TensorCalculus4V6`Tensorial`Void, TensorCalculus4V6`Tensorial`Void, 
           TensorCalculus4V6`Tensorial`Void}],
         BaseStyle->{AutoMultiplicationSymbol -> False},
         Editable->False]}], "}"}], "\n", 
      InterpretationBox[
       RowBox[{
        SubscriptBox[
         UnderscriptBox["\"\<\[PartialD]\>\"", "_"], "e"], "[", 
        InterpretationBox[
         RowBox[{
          TemplateBox[{UnderscriptBox["\"\[PartialD]\"", "_"],"e"},
           "Superscript"], "[", 
          RowBox[{
           InterpretationBox[
            SubsuperscriptBox["A", 
             RowBox[{
              StyleBox["a",
               StripOnInput->False,
               ShowContents->False], "b"}], 
             RowBox[{"a", 
              StyleBox["b",
               StripOnInput->False,
               ShowContents->False]}]],
            
            TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`a, TensorCalculus4V6`Tensorial`Void}, {
             TensorCalculus4V6`Tensorial`Void, $CellContext`b}],
            BaseStyle->{AutoMultiplicationSymbol -> False},
            Editable->False], " ", 
           InterpretationBox[
            SubsuperscriptBox["A", 
             StyleBox[
              RowBox[{"c", "d"}],
              StripOnInput->False,
              ShowContents->False], 
             RowBox[{"c", "d"}]],
            
            TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`c, $CellContext`d}, {
             TensorCalculus4V6`Tensorial`Void, 
              TensorCalculus4V6`Tensorial`Void}],
            BaseStyle->{AutoMultiplicationSymbol -> False},
            Editable->False], " ", 
           InterpretationBox[
            SubsuperscriptBox["B", 
             StyleBox[
              RowBox[{"f", "g", "h"}],
              StripOnInput->False,
              ShowContents->False], 
             RowBox[{"f", "g", "h"}]],
            
            TensorCalculus4V6`Tensorial`Tensor[$CellContext`B, \
{$CellContext`f, $CellContext`g, $CellContext`h}, {
             TensorCalculus4V6`Tensorial`Void, 
              TensorCalculus4V6`Tensorial`Void, 
              TensorCalculus4V6`Tensorial`Void}],
            BaseStyle->{AutoMultiplicationSymbol -> False},
            Editable->False]}], "]"}],
         $CellContext`xPartialDu[(
           TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, {$CellContext`a,
               TensorCalculus4V6`Tensorial`Void}, {
             TensorCalculus4V6`Tensorial`Void, $CellContext`b}] 
           TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`c, $CellContext`d}, {
             TensorCalculus4V6`Tensorial`Void, 
              TensorCalculus4V6`Tensorial`Void}]) 
          TensorCalculus4V6`Tensorial`Tensor[$CellContext`B, {$CellContext`f, \
$CellContext`g, $CellContext`h}, {
            TensorCalculus4V6`Tensorial`Void, 
             TensorCalculus4V6`Tensorial`Void, 
             TensorCalculus4V6`Tensorial`Void}], $CellContext`e],
         Editable->False,
         SyntaxForm->Automatic], "]"}],
       $CellContext`xPartialD[
        $CellContext`xPartialDu[(
          TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, {$CellContext`a, 
             TensorCalculus4V6`Tensorial`Void}, {
            TensorCalculus4V6`Tensorial`Void, $CellContext`b}] 
          TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, {$CellContext`c, \
$CellContext`d}, {
            TensorCalculus4V6`Tensorial`Void, 
             TensorCalculus4V6`Tensorial`Void}]) 
         TensorCalculus4V6`Tensorial`Tensor[$CellContext`B, {$CellContext`f, \
$CellContext`g, $CellContext`h}, {
           TensorCalculus4V6`Tensorial`Void, TensorCalculus4V6`Tensorial`Void,
             TensorCalculus4V6`Tensorial`Void}], $CellContext`e], \
$CellContext`e],
       Editable->False,
       SyntaxForm->Automatic], "\n", 
      InterpretationBox[
       RowBox[{
        SubscriptBox[
         UnderscriptBox["\"\<\[PartialD]\>\"", "_"], "e"], "[", 
        InterpretationBox[
         RowBox[{
          TemplateBox[{UnderscriptBox["\"\[PartialD]\"", "_"],"e"},
           "Superscript"], "[", 
          RowBox[{
           RowBox[{
            InterpretationBox[
             SubsuperscriptBox["g", 
              StyleBox[
               RowBox[{"a", 
                RowBox[{"dum", "[", "\[Mu]", "]"}]}],
               StripOnInput->False,
               ShowContents->False], 
              RowBox[{"a", 
               RowBox[{"dum", "[", "\[Mu]", "]"}]}]],
             
             TensorCalculus4V6`Tensorial`Tensor[$CellContext`g, \
{$CellContext`a, 
               $CellContext`dum[$CellContext`\[Mu]]}, {
              TensorCalculus4V6`Tensorial`Void, 
               TensorCalculus4V6`Tensorial`Void}],
             BaseStyle->{AutoMultiplicationSymbol -> False},
             Editable->False], ".", 
            InterpretationBox[
             SubsuperscriptBox["A", 
              RowBox[{
               StyleBox["a",
                StripOnInput->False,
                ShowContents->False], 
               RowBox[{"dum", "[", "\[Mu]", "]"}]}], 
              RowBox[{"a", 
               StyleBox[
                RowBox[{"dum", "[", "\[Mu]", "]"}],
                StripOnInput->False,
                ShowContents->False]}]],
             
             TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`a, TensorCalculus4V6`Tensorial`Void}, {
              TensorCalculus4V6`Tensorial`Void, 
               $CellContext`dum[$CellContext`\[Mu]]}],
             BaseStyle->{AutoMultiplicationSymbol -> False},
             Editable->False]}], " ", 
           RowBox[{
            InterpretationBox[
             SubsuperscriptBox["g", 
              StyleBox[
               RowBox[{"f", 
                RowBox[{"dum", "[", "g", "]"}], 
                RowBox[{"dum", "[", "h", "]"}]}],
               StripOnInput->False,
               ShowContents->False], 
              RowBox[{"f", 
               RowBox[{"dum", "[", "g", "]"}], 
               RowBox[{"dum", "[", "h", "]"}]}]],
             
             TensorCalculus4V6`Tensorial`Tensor[$CellContext`g, \
{$CellContext`f, 
               $CellContext`dum[$CellContext`g], 
               $CellContext`dum[$CellContext`h]}, {
              TensorCalculus4V6`Tensorial`Void, 
               TensorCalculus4V6`Tensorial`Void, 
               TensorCalculus4V6`Tensorial`Void}],
             BaseStyle->{AutoMultiplicationSymbol -> False},
             Editable->False], ".", 
            InterpretationBox[
             SubsuperscriptBox["B", 
              RowBox[{
               StyleBox["f",
                StripOnInput->False,
                ShowContents->False], 
               RowBox[{"dum", "[", "g", "]"}], 
               RowBox[{"dum", "[", "h", "]"}]}], 
              RowBox[{"f", 
               StyleBox[
                RowBox[{"dum", "[", "g", "]"}],
                StripOnInput->False,
                ShowContents->False], 
               StyleBox[
                RowBox[{"dum", "[", "h", "]"}],
                StripOnInput->False,
                ShowContents->False]}]],
             
             TensorCalculus4V6`Tensorial`Tensor[$CellContext`B, \
{$CellContext`f, TensorCalculus4V6`Tensorial`Void, 
               TensorCalculus4V6`Tensorial`Void}, {
              TensorCalculus4V6`Tensorial`Void, 
               $CellContext`dum[$CellContext`g], 
               $CellContext`dum[$CellContext`h]}],
             BaseStyle->{AutoMultiplicationSymbol -> False},
             Editable->False]}], " ", 
           InterpretationBox[
            SubsuperscriptBox["A", 
             StyleBox[
              RowBox[{"c", "d"}],
              StripOnInput->False,
              ShowContents->False], 
             RowBox[{"c", "d"}]],
            
            TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`c, $CellContext`d}, {
             TensorCalculus4V6`Tensorial`Void, 
              TensorCalculus4V6`Tensorial`Void}],
            BaseStyle->{AutoMultiplicationSymbol -> False},
            Editable->False]}], "]"}],
         $CellContext`xPartialDu[(Dot[
             
             TensorCalculus4V6`Tensorial`Tensor[$CellContext`g, \
{$CellContext`a, 
               $CellContext`dum[$CellContext`\[Mu]]}, {
              TensorCalculus4V6`Tensorial`Void, 
               TensorCalculus4V6`Tensorial`Void}], 
             
             TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`a, TensorCalculus4V6`Tensorial`Void}, {
              TensorCalculus4V6`Tensorial`Void, 
               $CellContext`dum[$CellContext`\[Mu]]}]] Dot[
             
             TensorCalculus4V6`Tensorial`Tensor[$CellContext`g, \
{$CellContext`f, 
               $CellContext`dum[$CellContext`g], 
               $CellContext`dum[$CellContext`h]}, {
              TensorCalculus4V6`Tensorial`Void, 
               TensorCalculus4V6`Tensorial`Void, 
               TensorCalculus4V6`Tensorial`Void}], 
             
             TensorCalculus4V6`Tensorial`Tensor[$CellContext`B, \
{$CellContext`f, TensorCalculus4V6`Tensorial`Void, 
               TensorCalculus4V6`Tensorial`Void}, {
              TensorCalculus4V6`Tensorial`Void, 
               $CellContext`dum[$CellContext`g], 
               $CellContext`dum[$CellContext`h]}]]) 
          TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, {$CellContext`c, \
$CellContext`d}, {
            TensorCalculus4V6`Tensorial`Void, 
             TensorCalculus4V6`Tensorial`Void}], $CellContext`e],
         Editable->False,
         SyntaxForm->Automatic], "]"}],
       $CellContext`xPartialD[
        $CellContext`xPartialDu[(Dot[
            
            TensorCalculus4V6`Tensorial`Tensor[$CellContext`g, \
{$CellContext`a, 
              $CellContext`dum[$CellContext`\[Mu]]}, {
             TensorCalculus4V6`Tensorial`Void, 
              TensorCalculus4V6`Tensorial`Void}], 
            
            TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`a, TensorCalculus4V6`Tensorial`Void}, {
             TensorCalculus4V6`Tensorial`Void, 
              $CellContext`dum[$CellContext`\[Mu]]}]] Dot[
            
            TensorCalculus4V6`Tensorial`Tensor[$CellContext`g, \
{$CellContext`f, 
              $CellContext`dum[$CellContext`g], 
              $CellContext`dum[$CellContext`h]}, {
             TensorCalculus4V6`Tensorial`Void, 
              TensorCalculus4V6`Tensorial`Void, 
              TensorCalculus4V6`Tensorial`Void}], 
            
            TensorCalculus4V6`Tensorial`Tensor[$CellContext`B, \
{$CellContext`f, TensorCalculus4V6`Tensorial`Void, 
              TensorCalculus4V6`Tensorial`Void}, {
             TensorCalculus4V6`Tensorial`Void, 
              $CellContext`dum[$CellContext`g], 
              $CellContext`dum[$CellContext`h]}]]) 
         TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, {$CellContext`c, \
$CellContext`d}, {
           TensorCalculus4V6`Tensorial`Void, 
            TensorCalculus4V6`Tensorial`Void}], $CellContext`e], \
$CellContext`e],
       Editable->False,
       SyntaxForm->Automatic]}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"LowerTensorIndexByG", "[", 
       RowBox[{"tensor_List", ",", "G_"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "\[IndentingNewLine]", "sub", ",", "sub1", ",", "sub0", 
         ",", "f1", ",", "dd"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tensor:\>\"", ",", "tensor"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"change", " ", "Tensor"}], "\[Rule]", " ", 
          RowBox[{"\[Delta]", ".", "Tensor"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "/.", 
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], "\[RuleDelayed]", 
              
              RowBox[{
               RowBox[{"Tensor", "[", 
                RowBox[{"G", ",", "b", 
                 StyleBox[",",
                  ShowSpecialCharacters->False,
                  ShowStringCharacters->True,
                  NumberMarks->True], 
                 StyleBox["c",
                  ShowSpecialCharacters->False,
                  ShowStringCharacters->True,
                  NumberMarks->True]}], 
                StyleBox["]",
                 ShowSpecialCharacters->False,
                 ShowStringCharacters->True,
                 NumberMarks->True]}], 
               StyleBox[".",
                ShowSpecialCharacters->False,
                ShowStringCharacters->True,
                NumberMarks->True], 
               RowBox[{"Tensor", "[", 
                RowBox[{"a", ",", "b", ",", "c"}], "]"}]}]}]}], "&"}], ",", 
           "tensor"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tmp:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"tmp", "/.", 
           RowBox[{"Pattern", "\[Rule]", "xPattern"}]}], "/.", 
          RowBox[{
           RowBox[{"xPattern", "[", 
            RowBox[{"a_", ",", 
             RowBox[{"Blank", "[", "]"}]}], "]"}], "\[Rule]", 
           RowBox[{"dum", "[", "a", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"G", ",", "a_", ",", "b_"}], "]"}], ":>", 
           RowBox[{
            RowBox[{"SwapUpDownIndices", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Cases", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"dum", "[", "_", "]"}]}], "]"}], ",", 
                RowBox[{"Cases", "[", 
                 RowBox[{"b", ",", 
                  RowBox[{"dum", "[", "_", "]"}]}], "]"}]}], "}"}], "]"}], 
             "]"}], "[", 
            RowBox[{"Tensor", "[", 
             RowBox[{"G", ",", "a", ",", "b"}], "]"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tmp:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"G", ",", "a_", ",", "b_"}], "]"}], ".", " ", 
            RowBox[{"Tensor", "[", 
             RowBox[{"A_", ",", "c_", ",", "d_"}], "]"}]}], "\[RuleDelayed]", 
           " ", 
           RowBox[{
            RowBox[{"SwapUpDownIndices", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"Cases", "[", 
                RowBox[{"b", ",", 
                 RowBox[{"dum", "[", "_", "]"}]}], "]"}], "}"}], "]"}], "]"}],
             "[", 
            RowBox[{
             RowBox[{"Tensor", "[", 
              RowBox[{"G", ",", "a", ",", "b"}], "]"}], ".", 
             RowBox[{"Tensor", "[", 
              RowBox[{"A", ",", "c", ",", "d"}], "]"}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tmp:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"tensor", ",", "tmp"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tmp:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"exp", "/.", "tmp"}]}]}], 
      RowBox[{"(*", 
       RowBox[{"apply", " ", "on", " ", "each", " ", "Times", " ", "term"}], 
       "*)"}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"TEST", "\[IndentingNewLine]", "tmpf"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"A", "@", 
          RowBox[{"ud", "[", 
           RowBox[{"a", ",", "\[Mu]_"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"B", ",", "\"\<uuu\>\""}], "]"}], "[", 
          RowBox[{"f", ",", " ", "g_", ",", "h_"}], "]"}]}], "}"}], 
       "\[IndentingNewLine]", "tmp"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"xPartialD", "[", 
         RowBox[{
          RowBox[{"xPartialDu", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"A", "@", 
              RowBox[{"ud", "[", 
               RowBox[{"a", ",", "b"}], "]"}]}], " ", 
             RowBox[{"Auu", "[", 
              RowBox[{"c", ",", "d"}], "]"}], 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"B", ",", "\"\<uuu\>\""}], "]"}], "[", 
              RowBox[{"f", ",", " ", "g", ",", "h"}], "]"}]}], ",", "e"}], 
           "]"}], ",", "e"}], "]"}], "\[IndentingNewLine]", "tmp"}], "//", 
       RowBox[{"LowerTensorIndexByG", "[", 
        RowBox[{"tmpf", ",", "g"}], "]"}]}]}]}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Counts", " ", "the", " ", "number", " ", "of", " ", "indices", " ", "in",
      " ", "exp_.", " ", "Result", " ", "is", " ", "in", " ", 
     "ParseTermIndices", " ", 
     RowBox[{"format", "."}], " ", "*", "19", "July2012"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ExpressionIndices", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", 
         RowBox[{"indices", "=", 
          RowBox[{"{", "}"}]}], ",", "tensors", ",", "xtmp"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", "IndexParsingRules"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tensors", "=", 
         RowBox[{
          RowBox[{"tuExtractPattern", "[", 
           RowBox[{"Tensor", "[", 
            RowBox[{"a_", ",", "u_List", ",", "d_List"}], "]"}], "]"}], "[", 
          "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"tuIndexParser", "[", "#", "]"}], "&"}], ",", "tensors"}],
           "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"Apply", "[", 
           RowBox[{"Plus", ",", "tmp"}], "]"}], "/.", 
          RowBox[{"Plus", "\[Rule]", "List"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"MapAt", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", "#", "]"}], "&"}], ",", "tmp", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"2", ",", "1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "returns", " ", "list", " ", "of", " ", "paired", " ", "dummy", " ", 
     RowBox[{"(", 
      RowBox[{"up", ",", "down"}], ")"}], " ", "indices", " ", "in", " ", 
     "exp_.", " ", "*", "19", "July2012"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PairedDummies", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "up", ",", "dn", ",", "xtmp"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"ExpressionIndices", "[", "tmp", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"#", ",", 
              RowBox[{"Times", "[", 
               RowBox[{"n_Integer", ",", "_"}], "]"}]}], "]"}], "&"}], ",", 
           RowBox[{"tmp", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"remove", " ", "non", " ", "singles"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Intersection", "[", 
          RowBox[{
           RowBox[{"tmp", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"tmp", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "returns", " ", "list", " ", "of", " ", "paired", " ", "dummy", " ", 
      RowBox[{"(", 
       RowBox[{"up", ",", "down"}], ")"}], " ", "indices", " ", "between", 
      " ", "term1_"}], ",", 
     RowBox[{
      RowBox[{"term2_", " ", "."}], " ", "*", "19", "July2012"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PairedDummies", "[", 
      RowBox[{"term1_", ",", "term2_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp1", "=", "term1"}], ",", 
         RowBox[{"tmp2", "=", "term2"}], ",", "up", ",", "dn", ",", "xtmp"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp1", "=", 
         RowBox[{"ExpressionIndices", "[", "tmp1", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp1", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"#", ",", 
              RowBox[{"Times", "[", 
               RowBox[{"n_Integer", ",", "_"}], "]"}]}], "]"}], "&"}], ",", 
           RowBox[{"tmp1", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"remove", " ", "non", " ", "singles"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp2", "=", 
         RowBox[{"ExpressionIndices", "[", "tmp2", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp2", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"#", ",", 
              RowBox[{"Times", "[", 
               RowBox[{"n_Integer", ",", "_"}], "]"}]}], "]"}], "&"}], ",", 
           RowBox[{"tmp2", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"remove", " ", "non", " ", "singles"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"xtmp", "=", 
         RowBox[{"Union", "[", 
          RowBox[{
           RowBox[{"Intersection", "[", 
            RowBox[{
             RowBox[{"tmp1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"tmp2", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Intersection", "[", 
            RowBox[{
             RowBox[{"tmp1", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"tmp2", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "xtmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexUniqueDummy", "::", "usage"}], "=", 
     "\"\<tuIndexUniqueDummy[dummy_List][exp_] attempts to assign Unique \
labels to dummy indices (summed) designated by dummy_List to Tensor \
expressions.  *16Jan2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexUniqueDummy", "[", "dummy_List", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", 
          RowBox[{"ExpandAll", "[", "exp", "]"}]}], ",", "dum", ",", "head", 
         ",", "isub", ",", 
         RowBox[{"ops", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Times", "|", "Wedge", "|", "dotOps"}], "]"}]}], ",", 
         "oplist", ",", 
         RowBox[{"distriOps", "=", 
          RowBox[{"{", 
           RowBox[{"Rule", ",", "Equal", ",", "Plus"}], "}"}]}], ",", "sub", 
         ",", "xtmp"}], "  ", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"head", "=", 
         RowBox[{"Head", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"oplist", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "ops"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"oplist", ",", "head"}], "]"}], "\[IndentingNewLine]", "&&", 
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"dum", "=", 
              RowBox[{"Intersection", "[", 
               RowBox[{"dummy", ",", 
                RowBox[{"PairedDummies", "[", "tmp", "]"}]}], "]"}]}], "]"}], 
            ">", "0"}]}], ",", 
          RowBox[{"tmp", "=", 
           RowBox[{"tmp", "//.", 
            RowBox[{"(", 
             RowBox[{"sub", "=", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[Rule]", 
                  RowBox[{"Unique", "[", "#", "]"}]}], "&"}], ",", "dum"}], 
               "]"}]}], ")"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{"distriOps", ",", "oplist"}], "]"}], ",", "head"}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"Apply", "[", 
            RowBox[{"head", ",", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"tuIndexUniqueDummy", "[", "dummy", "]"}], "[", "#", 
                 "]"}], "&"}], ",", 
               RowBox[{"Apply", "[", 
                RowBox[{"List", ",", "tmp"}], "]"}]}], "]"}]}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"UniqueDummyIndices", "[", "dummy_List", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{
      RowBox[{"tuIndexUniqueDummy", "[", "dummy", "]"}], "[", "exp", "]"}]}], 
    ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"removeUnique", "[", "symbol_List", "]"}], " ", "returns", " ", 
     "Rules", " ", "for", " ", "removing", " ", "tuIndexUniqueDummy", " ", 
     RowBox[{"extensions", "."}], " ", "*", "23", "Sep2014"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"removeUnique", "[", "dummy_List", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "sym", "}"}], ",", 
      RowBox[{
       RowBox[{"sym", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<$*\>\""}], 
            "\[Rule]", "#"}], "&"}], "/@", "dummy"}], "//", "Flatten"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"sym", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"MapAt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Names", "[", "#", "]"}], "&"}], ",", "#", ",", "1"}], 
           "]"}], "&"}], "/@", "sym"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"sym", "=", 
        RowBox[{
         RowBox[{"Thread", "/@", "sym"}], "//", "Flatten"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"MapAt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Symbol", "[", "#", "]"}], "&"}], ",", "#", ",", "1"}], 
           "]"}], "&"}], ",", "sym"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexParser", "::", "usage"}], "=", 
     "\"\<tuIndexParser[term_] extends ParseTermIndices in Tensorial handle \
complex Tensor notation. Returns {dummy,{up,down},error} indices. Returns \
indices of only top level Tensors. *11Feb2017\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexParser", "[", "term_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "pos", ",", 
         RowBox[{"up", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"dn", "=", 
          RowBox[{"{", "}"}]}], ",", "updup", ",", "dndup", ",", 
         RowBox[{"dummy", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"bad", "=", 
          RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "term", "]"}], "=!=", "Plus"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp", "=", 
            RowBox[{"term", "//.", "IndexParsingRules"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"pos", "=", 
            RowBox[{
             RowBox[{"tuExtractPositionPattern", "[", 
              RowBox[{"Tensor", "[", 
               RowBox[{"$A_", ",", "$u_", ",", "$d_"}], "]"}], "]"}], "[", 
             "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"pos", "=", 
            RowBox[{"pos", "//", "tuPositionNestDelete"}]}], ";", 
           RowBox[{"(*", 
            RowBox[{"No", " ", "nested", " ", "Tensor", " ", "expressions"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"pos", "=", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "&"}], ",", "pos"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{
            "\"\<pos:\>\"", ",", "pos", ",", "\"\<tmp\>\"", ",", "tmp", ",", 
             "\"\<:\>\""}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"up", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "&"}], ",", "pos"}], "]"}], 
              "//", "Flatten"}], "//", 
             RowBox[{
              RowBox[{"DeleteCases", "[", 
               RowBox[{"#", ",", "Void"}], "]"}], "&"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"dn", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "&"}], ",", "pos"}], "]"}], 
              "//", "Flatten"}], "//", 
             RowBox[{
              RowBox[{"DeleteCases", "[", 
               RowBox[{"#", ",", "Void"}], "]"}], "&"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"updup", "=", 
            RowBox[{"Tally", "[", "up", "]"}]}], ";", "  ", 
           RowBox[{"dndup", "=", 
            RowBox[{"Tally", "[", "dn", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", "up", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"bad", "=", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"Cases", "[", 
                 RowBox[{"updup", ",", 
                  RowBox[{"{", 
                   RowBox[{"_", ",", 
                    RowBox[{"n_", "/;", 
                    RowBox[{"n", ">", "1"}]}]}], "}"}]}], "]"}], ",", 
                RowBox[{"Cases", "[", 
                 RowBox[{"dndup", ",", 
                  RowBox[{"{", 
                   RowBox[{"_", ",", 
                    RowBox[{"n_", "/;", 
                    RowBox[{"n", ">", "1"}]}]}], "}"}]}], "]"}]}], "]"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"dummy", "=", 
            RowBox[{"Intersection", "[", 
             RowBox[{"up", ",", "dn"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"up", "=", 
            RowBox[{"DeleteCases", "[", 
             RowBox[{"up", ",", 
              RowBox[{"Apply", "[", 
               RowBox[{"Alternatives", ",", 
                RowBox[{"Join", "[", 
                 RowBox[{"dummy", ",", "bad"}], "]"}]}], "]"}]}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"dn", "=", 
            RowBox[{"DeleteCases", "[", 
             RowBox[{"dn", ",", 
              RowBox[{"Apply", "[", 
               RowBox[{"Alternatives", ",", 
                RowBox[{"Join", "[", 
                 RowBox[{"dummy", ",", "bad"}], "]"}]}], "]"}]}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"{", 
             RowBox[{"up", ",", "dn"}], "}"}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"dummy", ",", 
          RowBox[{"{", 
           RowBox[{"up", ",", "dn"}], "}"}], ",", "bad"}], "}"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ParseTermIndicesTU", "[", "term_", "]"}], ":=", 
     RowBox[{"tuIndexParser", "[", "term", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ParseTermIndices", "[", "term_", "]"}], ":=", 
     RowBox[{"tuIndexParser", "[", "term", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuIndexOrderPairs", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexOrderPairs", "::", "usage"}], "=", 
     "\"\<tuIndexOrderPairs is Rule for canonically ordering two dotOps[]d  \
identical Tensor[]s which may have different indices. *17May2016*\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuIndexOrderPairs", ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
       RowBox[{"a___", ",", 
        RowBox[{"t1", ":", 
         RowBox[{"Tensor", "[", 
          RowBox[{"B_", ",", "_", ",", "_"}], "]"}]}], " ", ",", " ", 
        RowBox[{"t2", ":", 
         RowBox[{"Tensor", "[", 
          RowBox[{"B_", ",", "_", ",", "_"}], "]"}]}], ",", "b___"}], "]"}], 
      "\[RuleDelayed]", 
      RowBox[{
       RowBox[{"op", "[", 
        RowBox[{"a", ",", "t2", ",", "t1", ",", "b"}], "]"}], "/;", 
       RowBox[{"OrderedQ", "[", 
        RowBox[{"{", 
         RowBox[{"t2", ",", "t1"}], "}"}], "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"tuIndexUpDnOrder", "//", "Clear"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexUpDnOrder", "::", "usage"}], "=", 
     "\"\<tuIndexUpDnOrder[indices_:{}][exp_] orders Dummy indices in exp_.  \
Only indices specified by indices_ are ordered if specified and if not \
specified then all dummy indices are used. NOTE: this routine is designed to \
operate on exp_ that have unique UpDn dummy indices as in product-like \
expressions. *6Mar2019*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexUpDnOrder", "[", 
       RowBox[{"index_:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "$indices", ",", "$index", ",", "$pdum", ",", "$dums", ",", "$dum", 
         ",", "$i", ",", "$out", ",", "$term", ",", 
         RowBox[{"$replace", "=", 
          RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$indices", "=", 
         RowBox[{
          RowBox[{"{", "index", "}"}], "//", "Flatten"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Order", " ", "index", " ", "labels"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$dums", "=", 
         RowBox[{
          RowBox[{"exp", "//", "tuIndexParser"}], "//", "First"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "$indices", "]"}], ">", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"$dums", "=", 
           RowBox[{"Intersection", "[", 
            RowBox[{"$indices", ",", "$dums"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", "$dums", "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$pdum", "=", 
         RowBox[{"exp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"Apply", "[", 
            RowBox[{"Alternatives", ",", "$dums"}], "]"}], "]"}]}]}], ";", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "exp", ",", "\"\< \>\"", ",", "$pdum", ",", "\"\< \>\"", ",", 
            "$dums"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$out", "=", "exp"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"$i", "=", "1"}], ",", 
          RowBox[{"$i", "<=", 
           RowBox[{"Length", "[", "$dums", "]"}]}], ",", 
          RowBox[{"$i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$index", "=", 
            RowBox[{"$dums", "[", 
             RowBox[{"[", "$i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$dum", "=", 
            RowBox[{"Select", "[", 
             RowBox[{"$pdum", ",", 
              RowBox[{
               RowBox[{"tuHasAnyQ", "[", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", "$index"}], "]"}], 
               "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "$dum", "]"}], "\[Equal]", "2"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{"\"\<0: \>\"", ",", "$dum", ",", " ", 
                 RowBox[{"$dum", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
                 RowBox[{"$dum", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "]"}], ";"}], 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$term", "=", 
               RowBox[{"Part", "[", 
                RowBox[{"$out", ",", 
                 RowBox[{"Apply", "[", 
                  RowBox[{"Sequence", ",", 
                   RowBox[{"Most", "[", 
                    RowBox[{"$dum", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], "]"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"(*", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<0a: \>\"", ",", "$term"}], "]"}], ";"}], "*)"}],
               "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"MatchQ", "[", 
                 RowBox[{"$term", ",", 
                  RowBox[{"tuDerivOpsD", "[", "__", "]"}]}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"$out", "=", 
                  RowBox[{"$out", "//", 
                   RowBox[{"tuIndexSwapUpDown", "[", 
                    RowBox[{"$dum", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "]"}]}]}], ";"}], 
                RowBox[{"(*", 
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<Swap1 \>\"", ",", 
                   RowBox[{"$dum", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "]"}], "*)"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"!", 
                    RowBox[{"MatchQ", "[", 
                    RowBox[{"$term", ",", 
                    RowBox[{"tuDerivOpsU", "[", "__", "]"}]}], "]"}]}], "&&", 
                   
                   RowBox[{
                    RowBox[{"$dum", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1", ",", 
                    RowBox[{"-", "2"}]}], "]"}], "]"}], "\[Equal]", "3"}]}], 
                  ",", 
                  RowBox[{"(*", 
                   RowBox[{"Tensor", "[", "Down", "]"}], "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{"$out", "=", 
                   RowBox[{"$out", "//", 
                    RowBox[{"tuIndexSwapUpDown", "[", 
                    RowBox[{"$dum", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "]"}]}]}]}], 
                 RowBox[{"(*", 
                  RowBox[{";", 
                   RowBox[{"Print", "[", 
                    RowBox[{"\"\<Swap2 \>\"", ",", 
                    RowBox[{"$dum", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "]"}]}], "*)"}], 
                 "\[IndentingNewLine]", "]"}]}], 
               RowBox[{"(*", 
                RowBox[{
                "NOTE", " ", "this", " ", "may", " ", "change", " ", "the", 
                 " ", "order", " ", "of", " ", 
                 RowBox[{"terms", "."}]}], "*)"}], "\[IndentingNewLine]", 
               "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "$out"}]}],
       "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"TEST", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tuIndexUpDnOrder", "[", 
       RowBox[{"{", 
        RowBox[{"j", ",", "k"}], "}"}], "]"}], "[", 
      RowBox[{"fn", "[", 
       RowBox[{"fn", "[", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"A", ",", "\"\<ud\>\"", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "j"}], "}"}]}], "]"}], " ", ".", 
         RowBox[{"T", "[", 
          RowBox[{"C", ",", "\"\<du\>\"", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "j"}], "}"}]}], "]"}]}], 
        RowBox[{"(*", 
         RowBox[{"+", 
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"A", ",", "\"\<d\>\"", ",", 
             RowBox[{"{", "i", "}"}]}], "]"}], ".", 
           RowBox[{"T", "[", 
            RowBox[{"B", ",", "\"\<u\>\"", ",", 
             RowBox[{"{", "i", "}"}]}], "]"}]}]}], "*)"}], "]"}], "]"}], 
      "]"}]}], "*)"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexDummyOrdered", "::", "usage"}], "=", 
     "\"\<tuIndexDummyOrdered[indices_:{}][exp_] UpDn orders Dummy indices_ \
of each term found in Plus[] expressions of exp_.  If indicies_ are not \
specified then all dummy indices are used.  \
*2Jan2016**2Jan2018**6Mar2019*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexDummyOrdered", "[", 
       RowBox[{"indices_:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", "Expand"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"Plus", "->", "xPlus"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"tuHasAnyQ", "[", 
           RowBox[{"tmp", ",", "xPlus"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"pp", ":", 
               RowBox[{"xPlus", "[", "a__", "]"}]}], "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"tuIndexUpDnOrder", "[", "indices", "]"}], "[", "#",
                   "]"}], "&"}], "/@", "pp"}], ")"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{"xPlus", "->", "Plus"}]}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{
            RowBox[{"tuIndexUpDnOrder", "[", "indices", "]"}], "[", "tmp", 
            "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "tmp", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"TEST", "\[IndentingNewLine]", "$"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fn", "[", 
          RowBox[{"fn", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"A", ",", "\"\<ud\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "j"}], "}"}]}], "]"}], " ", ".", 
             RowBox[{"T", "[", 
              RowBox[{"C", ",", "\"\<du\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "j"}], "}"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"A", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "i", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"B", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "i", "}"}]}], "]"}]}]}], "]"}], "]"}], 
         "\[IndentingNewLine]", "$"}], "//", 
        RowBox[{
         RowBox[{"tuIndexUpDnDummyOrdered", "[", "]"}], "\[IndentingNewLine]",
          "$"}]}], "//", "ColumnSumExp"}]}], ";"}], "\[IndentingNewLine]", 
    "*)"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"$tmp", "//", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"#", ",", 
           RowBox[{
            RowBox[{"tuHasAnyQ", "[", 
             RowBox[{"#", ",", "\[Alpha]"}], "]"}], "&"}]}], "]"}], "&"}], 
        "\[IndentingNewLine]", 
        RowBox[{"%", "[", 
         RowBox[{"[", 
          RowBox[{"3", ";;", "4"}], "]"}], "]"}]}], "/.", 
       RowBox[{"Times", "\[Rule]", 
        RowBox[{"Dot", "\[IndentingNewLine]", "%"}]}]}]}], "//", 
     RowBox[{"tuIndexUpDnDummyOrdered", "[", "\[Alpha]", "]"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuIndexOrderDummy", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexOrderDummy", "::", "usage"}], "=", 
     "\"\<tuIndexOrderDummy[symTensor_List][exp_]\ncanonically orders terms \
in exp_ containing symmetric Tensor[]s whose symbols are specified in \
symTensor_List. Tensor[]s in symTensor_List are Ordered. *1Mr2018*\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexOrderDummy", "[", "symTensor_List", "]"}], "[", "exp_", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "xorder"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"xorder", "[", 
          RowBox[{"term_", ",", "symTensors_"}], "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "$t", ",", "$index", ",", "$pdum", ",", "$dums", ",", "$dum", ",",
              "$0", ",", "$i", ",", "$", ",", "$ind", ",", 
             RowBox[{"$symTensor", "=", 
              RowBox[{"Apply", "[", 
               RowBox[{"Alternatives", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", "symTensors", "}"}], "]"}]}], "]"}]}], ",", 
             "$tensors"}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"dummy", " ", "labels"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$dums", "=", 
             RowBox[{
              RowBox[{"term", "//", "tuIndexParser"}], "//", "First"}]}], ";", 
            RowBox[{"xPrint", "[", "$dums", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"$t", "=", 
             RowBox[{"term", "//", 
              RowBox[{"tuIndexSwap", "[", "$dums", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"$t", "=", 
             RowBox[{"$t", "//", 
              RowBox[{"tuTensorSlotOrdered", "[", 
               RowBox[{"$symTensor", ",", "$dums"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"OrderedQ", "[", 
               RowBox[{"{", 
                RowBox[{"$t", ",", "term"}], "}"}], "]"}], ",", "$t", ",", 
              "term"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<0 \>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//", 
          RowBox[{"tuTermApplyEach", "[", 
           RowBox[{
            RowBox[{"{", "Tensor", "}"}], ",", 
            RowBox[{"{", "}"}], ",", 
            RowBox[{"{", "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"xorder", "[", 
               RowBox[{"#", ",", "symTensor"}], "]"}], "&"}], "}"}], ",", 
            "1"}], "]"}]}]}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexDummyUniform", "::", "usage"}], "=", 
     "\"\<tuIndexDummyUniform[exp_] ExpandAll[exp_] and attempt to make dummy \
indices in each term uniform by substituting and permuting generic dummy \
indices, dm[].  The intent is to reduce the number of terms in exp_.  The \
uniform dummy indices are labeled dm[1], dm[2], \[CenterEllipsis]. \
*29Jun2017**2Jan2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexDummyUniform", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "$", ",", "$0", ",", "$s", ",", "$n", ",", "$dm", ",", "$p", ",", 
         "$de", ",", "$dep", ",", "$sn", ",", "$pn"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$0", "=", 
         RowBox[{"ExpandAll", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"List", "[", 
            RowBox[{
             RowBox[{"DeleteCases", "[", 
              RowBox[{
               RowBox[{"First", "[", 
                RowBox[{"tuIndexParser", "[", "#", "]"}], "]"}], ",", 
               "_Integer"}], "]"}], ",", "#"}], "]"}], "&"}], "/@", 
          RowBox[{
           RowBox[{"tuTermSelect", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", 
             RowBox[{"{", "}"}], ",", "True"}], "]"}], "[", " ", "$0", " ", 
           "]"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<$s\>\"", ",", "$s"}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "substitute", " ", "and", " ", "permute", " ", "generic", " ", 
           "dummy", " ", "indices"}], ",", " ", 
          RowBox[{"dm", "[", "]"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$p", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"$dm", "=", 
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";", 
              RowBox[{"$de", "=", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ";", 
              RowBox[{"$pn", "=", 
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", 
              RowBox[{"$n", "=", 
               RowBox[{"Length", "[", "$dm", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"$sn", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"Thread", "[", 
                  RowBox[{"$dm", "->", "#"}], "]"}], "&"}], "/@", 
                RowBox[{"Permutations", "[", 
                 RowBox[{
                  RowBox[{"Array", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"dm", "[", "#", "]"}], "&"}], ",", "$n"}], "]"}], 
                  ",", 
                  RowBox[{"{", "$n", "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"$de", "=", 
               RowBox[{"$de", "/.", "$sn"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"$pn", "=", 
               RowBox[{"$de", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"$dep", "=", 
               RowBox[{
                RowBox[{"$pn", "\[Rule]", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"tuRuleAdd", "[", "$de", "]"}], "//", "Last"}], 
                   ")"}], "/", 
                  RowBox[{"$n", "!"}]}]}], "//", "Expand"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "$dep", "]"}], "\[Equal]", "$n"}], 
                ",", 
                RowBox[{"$dep", "=", 
                 RowBox[{"$pn", "->", 
                  RowBox[{"$de", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", "$dep"}], "\[IndentingNewLine]", ")"}], 
            "&"}], ",", "$s"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"$0", ",", "$p"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "TEST", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Get", "[", 
      RowBox[{
      "$HomeDirectory", "<>", 
       "\"\</Mathematica/Gravity/1208.3353.Chern-\
SimonsFormsInGravitationTheroies.out\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"$0", "=", 
      RowBox[{"$", "=", 
       RowBox[{"e", "[", "114.1", "]"}]}]}], ";", 
     RowBox[{"$", "//", "ColumnSumExp"}], ";", "\[IndentingNewLine]", 
     RowBox[{"tuIndexDummyUniform", "[", "$0", "]"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"changeDummyIndices", "[", 
       RowBox[{"to_List", ",", "from_List"}], "]"}], "[", "exp_", "]"}], " ", 
     "changes", " ", "dummy", " ", "indices", " ", "to", " ", "ones", " ", 
     "specified", " ", "by", " ", "the", " ", "to_List", " ", "from", " ", 
     "the", " ", "lists", " ", "of", " ", "lists", " ", "specified", " ", 
     "by", " ", "the", " ", 
     RowBox[{"from_List", ".", "  ", "e", ".", "g", ".", " ", 
      RowBox[{
       RowBox[{"changeDummyIndices", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"k", "[", 
            RowBox[{"il", ",", "iv"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"k", "[", 
              RowBox[{"iv", ",", "j1"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"k", "[", 
              RowBox[{"i1", ",", "iv"}], "]"}]}], "}"}]}], "}"}]}], "]"}], 
       "[", "exp_", "]"}]}], " ", "changes", " ", "to", " ", 
     RowBox[{"{", 
      RowBox[{"i1", ",", 
       RowBox[{"k", "[", 
        RowBox[{"il", ",", "iv"}], "]"}]}], "}"}], " ", "terms", " ", "with", 
     " ", "either", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"j1", ",", 
         RowBox[{"k", "[", 
          RowBox[{"iv", ",", "j1"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i1", ",", 
         RowBox[{"k", "[", 
          RowBox[{"i1", ",", "iv"}], "]"}]}], "}"}]}], "}"}], " ", 
     RowBox[{"indices", ".", " ", "It"}], " ", "chooses", " ", "the", " ", 
     "from_indices", " ", "based", " ", "upon", " ", "the", " ", "greatest", 
     " ", "number", " ", "of", " ", "match", " ", 
     RowBox[{"indices", "."}], "\[IndentingNewLine]", "*", "22", "Oct2014"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"changeDummyIndices", "[", 
       RowBox[{"from_List", ",", "to_List"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "indices", ",", "rules", ",", "in", ",", "replace", ",", 
         "dummy"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"ExpandAll", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"replace", "[", "term_", "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"lin", ",", "out"}], "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"xPrint", "[", 
              RowBox[{"\"\<term:\>\"", ",", "term"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"indices", "=", 
             RowBox[{"tuIndexParser", "[", "term", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"dummy", "=", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"in", "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"in", "=", 
                 RowBox[{"Select", "[", 
                  RowBox[{"dummy", ",", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"from", ",", "#"}], "]"}], "&"}]}], "]"}]}], 
                "]"}], ",", "in"}], "}"}]}], ";", 
            RowBox[{"(*", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"xPrint", "[", 
               RowBox[{
               "\"\<indices:\>\"", ",", "dummy", ",", "\"\<:\>\"", ",", 
                "from", ",", "\"\<:\>\"", ",", "in"}], "]"}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"in", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ">", "0"}], ",", " ", 
              RowBox[{
               RowBox[{"rules", "=", 
                RowBox[{"Thread", "[", 
                 RowBox[{"from", "\[Rule]", "to"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "TODO", " ", "change", " ", "to", " ", "index", " ", 
                 "specific"}], "*)"}], 
               RowBox[{"(*", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"xPrint", "[", 
                  RowBox[{"\"\<rules\>\"", ",", "rules"}], "]"}], ";"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"Return", "[", 
                RowBox[{"term", "/.", "rules"}], "]"}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "term"}]}], "\[IndentingNewLine]", "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "tmp", "]"}], "===", "Plus"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"tmp", "=", 
             RowBox[{"replace", "/@", 
              RowBox[{"Apply", "[", 
               RowBox[{"List", ",", "tmp"}], "]"}]}]}], ";", 
            RowBox[{"Apply", "[", 
             RowBox[{"Plus", ",", "tmp"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"replace", "[", "tmp", "]"}]}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"xPrint", "[", "tmp", "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexSymmetricOrdered", "::", "usage"}], "=", 
     "\"\<tuIndexSymmetricOrdered[index_List][exp_Tensor] canonically ordered \
index_List of symmetric exp_Tensor. Assumes exp_Tensor is symmetric in \
index_List. It does nothing with repeated indices. *12Jul2017*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexSymmetricOrdered", "[", "index_List", "]"}], "[", 
      "exp_Tensor", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$pos", ",", "$pos1", ",", 
         RowBox[{"$sort", "=", 
          RowBox[{"Sort", "[", "index", "]"}]}], ",", "$label"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$label", "=", 
         RowBox[{"$", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$pos", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", 
           RowBox[{"$", "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], "]"}]}], ";", 
        RowBox[{"xPrint", "[", "$pos", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$pos1", "=", 
         RowBox[{
          RowBox[{"Plus", "[", 
           RowBox[{
            RowBox[{"$pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"$pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "//", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "/.", 
             RowBox[{"Void", "\[Rule]", "0"}]}], "&"}], ")"}]}]}], ";", 
        RowBox[{"xPrint", "[", "$pos1", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$pos1", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"$pos1", ",", 
           RowBox[{
            RowBox[{"tuMemberQ", "[", 
             RowBox[{"#", ",", "$sort"}], "]"}], "&"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$pos1", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"$pos1", "->", "$sort"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$pos", "=", 
         RowBox[{"$pos", "//", 
          RowBox[{"tuRuleApply", "[", "$pos1", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"T", "[", 
         RowBox[{"$label", ",", 
          RowBox[{"Apply", "[", 
           RowBox[{"Sequence", ",", "$pos"}], "]"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "TEST", "*)"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"T", "[", 
       RowBox[{"\[Delta]", ",", "\"\<duu\>\"", ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "k", ",", "i"}], "}"}]}], "]"}], 
      "\[IndentingNewLine]", "%"}], "//", 
     RowBox[{"tuIndexSymmetricOrdered", "[", 
      RowBox[{"{", 
       RowBox[{"k", ",", "i"}], "}"}], "]"}]}], "*)"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuTensorSlotOrdered", "]"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"tuTensorSlotOrdered", "::", "usage"}], "=", 
     "\"\<tuTensorSlotOrdered[tensorLabel_,index_List][exp_]\ncanonically \
orders in slot position all index_List indices for Tensor[tensorLabel,_,_] in \
exp_.  All indices of index_List must be present in each Tensor[] and up/down \
position of each index is maintained. *28Feb2018*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuTensorSlotOrdered", "[", 
       RowBox[{"tensorLabel_", ",", "index_List"}], "]"}], "[", "exp_", "]"}],
      ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$pos", ",", "$tensor", ",", 
         "$indList", ",", "$indPos", ",", "$sym", ",", "$up", ",", "$dn", ",",
          "$slots"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$tensor", "=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"Apply", "[", 
            RowBox[{"Alternatives", ",", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", "tensorLabel", "}"}], "]"}]}], "]"}], ",", "_", 
           ",", "_"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$tensor", "=", 
         RowBox[{"exp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", "$tensor", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$pos", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"xPrint", "[", 
               RowBox[{"\"\<1 \>\"", ",", "#"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"$sym", ",", "$up", ",", "$dn"}], "}"}], "=", 
               RowBox[{"Apply", "[", 
                RowBox[{"List", ",", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"$indList", "=", 
               RowBox[{"{", 
                RowBox[{"$up", ",", "$dn"}], "}"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"tuHasAllQ", "[", 
                 RowBox[{"$indList", ",", "index"}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"$indPos", "=", 
                  RowBox[{"$indList", "//", 
                   RowBox[{
                   "tuExtractPositionPattern", "[", "index", "]"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"$slots", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "&"}], "/@", 
                    "$indPos"}], "//", "Sort"}]}], ";", 
                 RowBox[{"xPrint", "[", 
                  RowBox[{"\"\<slots \>\"", ",", "$slots"}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"$indPosV", "=", 
                  RowBox[{
                   RowBox[{"Map", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "#"}], "}"}], "\[Rule]", "Void"}], ",", 
                    
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"2", ",", "#"}], "}"}], "\[Rule]", "Void"}]}], 
                    "}"}], "&"}], ",", "$slots"}], "]"}], "//", "Flatten"}]}],
                  ";", "\[IndentingNewLine]", 
                 RowBox[{"$indList", "=", 
                  RowBox[{"tuReplacePart", "[", 
                   RowBox[{"$indList", ",", "$indPosV"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"$indPos", "=", 
                  RowBox[{"SortBy", "[", 
                   RowBox[{"$indPos", ",", "Last"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"$indPos", "=", 
                  RowBox[{"MapIndexed", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"$slots", ",", "#2"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "->", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "&"}], ",", "$indPos"}],
                    "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"$indList", "=", 
                  RowBox[{"tuReplacePart", "[", 
                   RowBox[{"$indList", ",", "$indPos"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", 
                  RowBox[{"Tensor", "[", 
                   RowBox[{"$sym", ",", 
                    RowBox[{"$indList", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"$indList", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], 
             ")"}], "&"}], ",", "$tensor"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$pos", "=", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"$pos", ",", "Null"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<pos \>\"", ",", "$pos"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"$", ",", "$pos"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"TEST", "\[IndentingNewLine]", "a", " ", 
       RowBox[{"tuDPartial", "[", " ", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"g", ",", "\"\<du\>\"", ",", 
           RowBox[{"{", 
            RowBox[{"\[Nu]", ",", "\[Mu]"}], "}"}]}], "]"}], ",", "\[Nu]"}], 
        "]"}]}], "+", 
      RowBox[{"c", " ", 
       RowBox[{"T", "[", 
        RowBox[{"d", ",", "\"\<udd\>\"", ",", 
         RowBox[{"{", 
          RowBox[{"\[Mu]", ",", "\[Nu]", ",", "\[Mu]"}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", "%"}]}], "//", 
     RowBox[{"tuTensorSlotOrdered", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"g", ",", "d"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}]}], "]"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuIndexSumTerm", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexSumTerm", "::", "usage"}], "=", 
     "\"\<tuIndexSumTerm[index_List,baseindices_List :{0,1,2,3}][exp_] Sum[]s \
dummy indices of exp_ which either in Plus[] expression or individual \
expression. Does not do expressions both Plus[] and non-Plus[] expressions.  \
index_List choose dummy indices or if index_={} all dummy indices are summed. \
Indices are Sum[]d over baselindices. *22Sep2015*5Aug2017*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexSumTerm", "[", 
       RowBox[{
        RowBox[{"index_List:", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"baseindices_List", " ", ":", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "2", ",", "3"}], "}"}]}]}], "]"}], "[", 
      "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "$", ",", "$dum", ",", "$indices", 
         ",", "$dummy", ",", "$terms"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"FreeQ", "[", 
           RowBox[{"tmp", ",", "Plus"}], "]"}], ",", 
          RowBox[{"$terms", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "}"}], "\[Rule]", "tmp"}], "}"}]}], 
          RowBox[{"(*", 
           RowBox[{"no", " ", "Plus", " ", "expression"}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"$terms", "=", 
           RowBox[{"tmp", "//", 
            RowBox[{"tuTermSelect", "[", 
             RowBox[{
              RowBox[{"{", "}"}], ",", 
              RowBox[{"{", "}"}], ",", "True"}], "]"}]}]}]}], 
         RowBox[{"(*", 
          RowBox[{"only", " ", "Plus", " ", "expression"}], "*)"}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$dummy", "=", 
         RowBox[{"tuIndexParser", "/@", "$terms"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$dummy", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "$dummy"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"$terms", ",", "$dummy"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"MapIndexed", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#1", "=!=", 
              RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$", "=", 
               RowBox[{"Extract", "[", 
                RowBox[{"$terms", ",", "#2"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"$indices", "=", 
               RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"index", "===", 
                 RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"$indices", "=", "#1"}], ",", "\[IndentingNewLine]", 
                RowBox[{"$indices", "=", 
                 RowBox[{"Intersection", "[", 
                  RowBox[{"index", ",", "#1"}], "]"}]}]}], 
               "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"$indices", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"#", ",", "baseindices"}], "}"}], "&"}], "/@", 
                "$indices"}]}], ";", 
              RowBox[{"xPrint", "[", "$indices", "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"$", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "=", 
               RowBox[{"xSum", "[", 
                RowBox[{
                 RowBox[{"$", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", 
                 RowBox[{"Apply", "[", 
                  RowBox[{"Sequence", ",", "$indices"}], "]"}]}], "]"}]}], 
              ";", 
              RowBox[{"xPrint", "[", "$", "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"$terms", "[", 
                RowBox[{"[", 
                 RowBox[{"First", "[", "#2", "]"}], "]"}], "]"}], "=", 
               "$"}]}]}], "\[IndentingNewLine]", "]"}], "&"}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", "$dummy"}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$terms", "=", 
         RowBox[{"$terms", "/.", 
          RowBox[{"xSum", "\[Rule]", "Sum"}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"tmp", ",", "$terms"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuIndexSum", "::", "usage"}], "=", 
     "\"\<tuIndexSum[index_List,baseindices_List :{0,1,2,3}][exp_] Expand[]s \
exp_ and for Times expressions Sum[]s dummy indices in index_List. Indices \
are Sum[]d over baselindices.  *22Sep2015*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuIndexSum", "[", 
       RowBox[{"index_List", ",", 
        RowBox[{"baseindices_List", " ", ":", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "2", ",", "3"}], "}"}]}]}], "]"}], "[", 
      "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"$", "//", "Expand"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", 
          RowBox[{"Times", "\[Rule]", "xTimes"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", 
          RowBox[{
           RowBox[{"xTimes", "[", "a__", "]"}], ":>", 
           RowBox[{
            RowBox[{
             RowBox[{"Inactive", "[", "tuIndexSumTerm", "]"}], " ", "[", 
             RowBox[{"index", ",", "baseindices"}], "]"}], " ", "[", 
            RowBox[{
             RowBox[{"Inactive", "[", "Times", "]"}], "[", "a", "]"}], 
            "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//", "Activate"}]}], ";", "\[IndentingNewLine]", 
        "$"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSumIndexUnique", "::", "usage"}], ":=", 
     "\"\<tuSumIndexUnique[exp_] replaces Sum|xSum|Inactive[Sum] indices in \
exp_ with Unique[] indices. *15Jan2016*28Mar2019*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSumIndexUnique", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", ",", 
         RowBox[{"indices", "=", 
          RowBox[{"{", "}"}]}], ",", "sums", ",", "$sums", ",", "i$", ",", 
         "xList", ",", "\[IndentingNewLine]", 
         RowBox[{"head", "=", 
          RowBox[{"Sum", "|", "xSum", "|", 
           RowBox[{"Inactive", "[", "Sum", "]"}]}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sums", "=", 
         RowBox[{"exp", "//", 
          RowBox[{"tuExtractPositionPattern", "[", 
           RowBox[{"{", 
            RowBox[{"head", "[", "__", "]"}], "}"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", "sums", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$sums", "=", 
         RowBox[{"sums", "/.", 
          RowBox[{"head", "\[Rule]", "xList"}]}]}], ";", 
        RowBox[{"xPrint", "[", "$", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i$", "=", "1"}], ",", 
          RowBox[{"i$", "\[LessEqual]", 
           RowBox[{"Length", "[", "$sums", "]"}]}], ",", 
          RowBox[{"i$", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$", "=", 
            RowBox[{"indices", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"$sums", "[", 
                RowBox[{"[", "i$", "]"}], "]"}], "//", 
               RowBox[{"tuExtractPattern", "[", 
                RowBox[{"xList", "[", "__", "]"}], "]"}]}], "//", 
              "First"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"First", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{"{", "#", "}"}], "]"}], "]"}], "&"}], "/@", 
             RowBox[{"(", 
              RowBox[{"Rest", "[", "$", "]"}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "\[Rule]", 
                 RowBox[{
                  RowBox[{"Unique", "[", "n", "]"}], "[", "#", "]"}]}], "&"}],
                ",", "$"}], "]"}], "/.", 
             RowBox[{"xList", "\[Rule]", "List"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"xPrint", "[", 
            RowBox[{"i$", ",", "\"\< \>\"", ",", 
             RowBox[{
              RowBox[{"sums", "[", 
               RowBox[{"[", "i$", "]"}], "]"}], "=", 
              RowBox[{
               RowBox[{"sums", "[", 
                RowBox[{"[", "i$", "]"}], "]"}], "/.", "$"}]}], ",", 
             "\"\< \>\"", ",", "$"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", "sums", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"tuReplacePart", "[", 
          RowBox[{"exp", ",", "sums"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTensorSimplify", "::", "usage"}], "=", 
     "\"\<tuTensorSimplify[exp_Plus] simplifies Plus[] Tensor expression, \
exp_, by reindexing Dummy indices.  Works with Tensor and tuDerivOps \
expressions. *11Sep2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTensorSimplify", "[", "exp_Plus", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "$", ",", "$s", ",", "$s1", ",", "$1", ",", "$1c", ",", "$2", ",", 
         "$2c", ",", "$2t", ",", "$2td", ",", "$2m", ",", 
         RowBox[{"$match", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"$matches", "=", 
          RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"List", "@@", "exp"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"tuIndexParser", "/@", "$"}]}], ";", 
        RowBox[{"$s", "//", "Column"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$2t", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"List", "@@", "#"}], ",", 
             RowBox[{
              RowBox[{"tuTensorQ", "[", "#", "]"}], "&"}]}], "]"}], "&"}], "/@",
           "$"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$2t", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Times", "@@", "#"}], "&"}], "/@", "$2t"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"Tensor", " ", "portion"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$2td", "=", 
         RowBox[{
          RowBox[{"MapIndexed", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"tuIndicesLower", "[", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "[", 
              RowBox[{"$2t", "[", 
               RowBox[{"[", "#2", "]"}], "]"}], "]"}], "&"}], ",", "$s"}], 
           "]"}], "//", "Flatten"}]}], ";", "  ", 
        RowBox[{"(*", 
         RowBox[{"Tensor", " ", "portion", " ", "Lowered", " ", "indices"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$2c", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"List", "@@", "#"}], ",", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"tuTensorQ", "[", "#", "]"}]}], "&"}]}], "]"}], "&"}], 
          "/@", "$"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$2c", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Times", "@@", "#"}], "&"}], "/@", "$2c"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"non", " ", "Tensor", " ", "portion"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"$1", "=", 
            RowBox[{"$", "[", 
             RowBox[{"[", "$i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$1", "=", 
            RowBox[{"List", "@@", "$1"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$1c", "=", 
            RowBox[{"Select", "[", 
             RowBox[{"$1", ",", 
              RowBox[{
               RowBox[{"!", 
                RowBox[{"tuTensorQ", "[", "#", "]"}]}], "&"}]}], "]"}]}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"$1c", "=", 
            RowBox[{"$2c", "[", 
             RowBox[{"[", "$i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$1t", "=", 
            RowBox[{"Select", "[", 
             RowBox[{"$1", ",", 
              RowBox[{
               RowBox[{"tuTensorQ", "[", "#", "]"}], "&"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$1t", "=", 
            RowBox[{"Times", "@@", "$1t"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$s1", "=", 
            RowBox[{"$1t", "//", 
             RowBox[{"tuIndicesLower", "[", 
              RowBox[{"$s", "[", 
               RowBox[{"[", 
                RowBox[{"$i", ",", "1"}], "]"}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$s1", "=", 
            RowBox[{"$2td", "[", 
             RowBox[{"[", "$i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"$s1", "=", 
            RowBox[{"tuAddPatternVariable", "[", 
             RowBox[{
              RowBox[{"$s1", "\[Rule]", "0"}], ",", 
              RowBox[{"$s", "[", 
               RowBox[{"[", 
                RowBox[{"$i", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<LL\>\"", ",", "$s1"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$2m", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"MatchQ", "[", 
               RowBox[{"#", ",", 
                RowBox[{"$s1", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}], "/@", 
             "$2td"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"Cases", "[", 
                RowBox[{"$2m", ",", "True"}], "]"}], "]"}], ">", "1"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$match", "=", 
               RowBox[{"Flatten", "[", 
                RowBox[{"Position", "[", 
                 RowBox[{"$2m", ",", "True"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"$matches", ",", "$match"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"xPrint", "[", 
               RowBox[{"Column", "[", 
                RowBox[{"$2t", "[", 
                 RowBox[{"[", "$match", "]"}], "]"}], "]"}], "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"$i", ",", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "$", "]"}], "]"}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$matches", "=", 
         RowBox[{"$matches", "//", "DeleteDuplicates"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"$match", "=", 
            RowBox[{"$matches", "[", 
             RowBox[{"[", " ", "$i", " ", "]"}], "]"}]}], ";", "  ", 
           RowBox[{"xPrint", "[", 
            RowBox[{"$i", ",", "\"\<::\>\"", ",", "$match"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"$2t", "[", 
                RowBox[{"[", " ", "#", " ", "]"}], "]"}], "=", 
               RowBox[{"$2t", "[", 
                RowBox[{"[", " ", 
                 RowBox[{"$match", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], "]"}]}], ")"}], 
             "&"}], "/@", "$match"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"$i", ",", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "$matches", "]"}], "]"}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Inner", "[", 
         RowBox[{"Times", ",", "$2c", ",", " ", "$2t", ",", "Plus"}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", " ", 
   RowBox[{"(*", "\[IndentingNewLine]", "*)"}], 
   RowBox[{
    RowBox[{
     RowBox[{"tuCoordSolidAngle", "::", "usage"}], "=", 
     "\"\<tuCoordSolidAngle[n_Integer] produces a List[] of spherical \
coordinate directional Cosines, \!\(\*SuperscriptBox[\(\[Omega]\), \(i\)]\), \
of \!\(\*SuperscriptBox[\(S\), \(n\)]\). Also, computes d[\!\(\*SubscriptBox[\
\(\[CapitalOmega]\), \(n\)]\)\!\(\*SuperscriptBox[\(]\), \(2\)]\). \
*11Nov2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCoordSolidAngle", "[", "n_Integer", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", ",", "$0", ",", 
         RowBox[{"$n", "=", 
          RowBox[{"n", "+", "1"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$0", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\"\<spherical coordinates for \>\"", "[", 
                 SuperscriptBox["S", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"$n", "-", "1"}], "]"}]], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"\[Omega]", ",", "\"\<u\>\"", ",", 
                   RowBox[{"{", "1", "}"}]}], "]"}], "\[Rule]", 
                 RowBox[{"Cos", "[", 
                  RowBox[{"T", "[", 
                   RowBox[{"\[Theta]", ",", "\"\<d\>\"", ",", 
                    RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"\[Omega]", ",", "\"\<u\>\"", ",", 
                   RowBox[{"{", "$n", "}"}]}], "]"}], "\[Rule]", 
                 RowBox[{
                  RowBox[{"xProduct", "[", 
                   RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"T", "[", 
                    RowBox[{"\[Theta]", ",", "\"\<d\>\"", ",", 
                    RowBox[{"{", "j", "}"}]}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", "1", ",", 
                    RowBox[{"$n", "-", "2"}]}], "}"}]}], "]"}], 
                  RowBox[{"Sin", "[", 
                   RowBox[{"T", "[", 
                    RowBox[{"\[Theta]", ",", "\"\<d\>\"", ",", 
                    RowBox[{"{", 
                    RowBox[{"$n", "-", "1"}], "}"}]}], "]"}], "]"}]}]}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"T", "[", 
                    RowBox[{"\[Omega]", ",", "\"\<u\>\"", ",", 
                    RowBox[{"{", "i", "}"}]}], "]"}], "\[Rule]", 
                   RowBox[{
                    RowBox[{"xProduct", "[", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{"T", "[", 
                    RowBox[{"\[Theta]", ",", "\"\<d\>\"", ",", 
                    RowBox[{"{", "j", "}"}]}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", "1", ",", 
                    RowBox[{"i", "-", "1"}]}], "}"}]}], "]"}], 
                    RowBox[{"Cos", "[", 
                    RowBox[{"T", "[", 
                    RowBox[{"\[Theta]", ",", "\"\<d\>\"", ",", 
                    RowBox[{"{", "i", "}"}]}], "]"}], "]"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "1", ",", 
                    RowBox[{"$n", "-", "1"}]}], "}"}]}], "]"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"$n", "-", "2"}], ">", "0"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", "\[LessEqual]", 
                    RowBox[{"T", "[", 
                    RowBox[{"\[Theta]", ",", "\"\<d\>\"", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<1\[LessEqual]i\[LessEqual]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"$n", "-", "2"}], "]"}]}], "}"}]}], "]"}], "<", 
                    "\[Pi]"}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
                  RowBox[{"0", "\[LessEqual]", 
                   RowBox[{"T", "[", 
                    RowBox[{"\[Theta]", ",", "\"\<d\>\"", ",", 
                    RowBox[{"{", 
                    RowBox[{"$n", "-", "1"}], "}"}]}], "]"}], "<", 
                   RowBox[{"2", "\[Pi]"}]}]}], "\[IndentingNewLine]", "}"}]}],
                "\[IndentingNewLine]", "}"}], "/.", 
              RowBox[{"xProduct", "\[Rule]", "Product"}]}], "//", "Flatten"}],
             "//", "DeleteDuplicates"}], "//", 
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{"#", ",", "Null"}], "]"}], "&"}]}], "//", "Sort"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            SuperscriptBox[
             RowBox[{"d", "[", 
              SubscriptBox["\[CapitalOmega]", 
               RowBox[{"$n", "-", "1"}]], "]"}], "2"], "/.", 
            RowBox[{"(", 
             RowBox[{"$coordSolidAngle", "//", 
              RowBox[{"tuRuleSelect", "[", 
               RowBox[{"{", 
                SuperscriptBox[
                 RowBox[{"d", "[", 
                  SubscriptBox["\[CapitalOmega]", "_"], "]"}], "2"], "}"}], 
               "]"}]}], ")"}]}], "/.", 
           RowBox[{"xSum", "\[Rule]", "Sum"}]}], "/.", 
          RowBox[{"tuRule", "[", "$0", "]"}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Print", "[", "$", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"d", "[", 
            SubscriptBox["\[CapitalOmega]", 
             RowBox[{"$n", "-", "1"}]], "]"}], "2"], "\[Rule]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"tuOpIndependentVar", "[", 
             RowBox[{"tudExpand", ",", 
              RowBox[{
               RowBox[{"op$", "[", "d", "]"}], "[", "$", "]"}]}], "]"}], "//",
             "Simplify"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"$0", ",", "$"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";", 
    RowBox[{"(*", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"$", "=", 
       RowBox[{"tuCoordSolidAngle", "[", "2", "]"}]}], ";", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ColumnForms", "[", 
           RowBox[{"#1", ",", "2"}], "]"}], "&"}], ")"}], "[", "$", "]"}], 
       "\[IndentingNewLine]", "$coordSolidAngle"}]}], "*)"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4773475527375298`*^9, 3.4773475563534527`*^9}, {
   3.477347607736083*^9, 3.477347839895226*^9}, {3.477348592243739*^9, 
   3.477348600614975*^9}, {3.477448632110298*^9, 3.477448639124702*^9}, {
   3.4774918324627247`*^9, 3.47749193807034*^9}, {3.477493235651927*^9, 
   3.477493265446851*^9}, {3.477493313311185*^9, 3.477493338835821*^9}, {
   3.477493428011973*^9, 3.4774934420025454`*^9}, {3.477493474119735*^9, 
   3.477493541691545*^9}, {3.483021025987207*^9, 3.483021136253598*^9}, {
   3.48302457945413*^9, 3.483024764529106*^9}, {3.483024829133518*^9, 
   3.48302486654644*^9}, {3.483061592449636*^9, 3.483061592883586*^9}, {
   3.483062097089625*^9, 3.483062132179064*^9}, 3.483062175222599*^9, {
   3.4830622357506227`*^9, 3.483062243788485*^9}, {3.4830623044705133`*^9, 
   3.4830623319887238`*^9}, 3.4830623798722467`*^9, {3.483062503647481*^9, 
   3.483062516318101*^9}, {3.483062617673452*^9, 3.483062619317124*^9}, {
   3.483062667122568*^9, 3.483062683439186*^9}, {3.4830628111592703`*^9, 
   3.4830629145926323`*^9}, 3.4830629501845903`*^9, {3.483063017611247*^9, 
   3.4830630612373343`*^9}, {3.483063197916462*^9, 3.4830631988224173`*^9}, {
   3.483063284317224*^9, 3.483063301475482*^9}, {3.4830633904753647`*^9, 
   3.483063391164227*^9}, {3.48306346843407*^9, 3.483063498077379*^9}, 
   3.483098743936537*^9, {3.483099047833047*^9, 3.483099135932027*^9}, {
   3.4830992067438707`*^9, 3.483099210146801*^9}, 3.4831113098470573`*^9, {
   3.483450236992702*^9, 3.483450250499073*^9}, {3.4834569901232243`*^9, 
   3.4834569920798197`*^9}, {3.4834570321718807`*^9, 3.483457079331951*^9}, {
   3.4834650797414923`*^9, 3.483465179898631*^9}, {3.4834652099246387`*^9, 
   3.483465224123583*^9}, {3.483885935469056*^9, 3.483885946728286*^9}, {
   3.483885991611189*^9, 3.48388605282976*^9}, {3.483886099151863*^9, 
   3.483886128498919*^9}, {3.483886167753994*^9, 3.483886168807313*^9}, 
   3.484386650641533*^9, {3.485008276617268*^9, 3.485008276965513*^9}, {
   3.4850083613180723`*^9, 3.48500839771801*^9}, {3.485008498713109*^9, 
   3.485008506781095*^9}, {3.485009380579104*^9, 3.485009382901163*^9}, {
   3.485009466480328*^9, 3.4850094666379557`*^9}, {3.485009511232153*^9, 
   3.485009511826047*^9}, {3.485009660043062*^9, 3.485009929329794*^9}, {
   3.485009993036661*^9, 3.485010032552452*^9}, {3.485701876394525*^9, 
   3.485701928410376*^9}, {3.4857035249070883`*^9, 3.4857035579785643`*^9}, {
   3.486470050600711*^9, 3.486470065149267*^9}, {3.4892429819870253`*^9, 
   3.4892430159803677`*^9}, {3.4892430981717567`*^9, 3.489243113237883*^9}, 
   3.489243169139188*^9, {3.489243400507052*^9, 3.489243412222768*^9}, {
   3.489243467650465*^9, 3.4892434737074127`*^9}, {3.489243560129139*^9, 
   3.489243592187311*^9}, {3.48924366089962*^9, 3.4892436773773727`*^9}, {
   3.489243720696258*^9, 3.4892437448344707`*^9}, {3.489243908859886*^9, 
   3.489243914388681*^9}, {3.489243965805348*^9, 3.48924398761734*^9}, 
   3.489244035933426*^9, {3.489328776097574*^9, 3.489328776864964*^9}, 
   3.490196031174026*^9, {3.490207116087491*^9, 3.49020715504417*^9}, {
   3.490207799543187*^9, 3.4902079255811567`*^9}, {3.4902083033209763`*^9, 
   3.490208313840423*^9}, {3.490208391760701*^9, 3.490208399185895*^9}, {
   3.490208513515875*^9, 3.490208526831757*^9}, {3.4902854423114777`*^9, 
   3.49028546019949*^9}, {3.490285496451221*^9, 3.490285501205297*^9}, {
   3.490285549398183*^9, 3.4902856854256287`*^9}, {3.4913625328459387`*^9, 
   3.491362545352215*^9}, {3.491590726778767*^9, 3.49159072784554*^9}, {
   3.4915914132012873`*^9, 3.49159142221922*^9}, {3.493431308078826*^9, 
   3.4934313913183613`*^9}, {3.505768191844952*^9, 3.5057681926445208`*^9}, {
   3.506184054437717*^9, 3.5061840557781982`*^9}, {3.506185238128063*^9, 
   3.506185288282537*^9}, {3.5061853283816557`*^9, 3.506185380961844*^9}, {
   3.506185637076065*^9, 3.506185642478634*^9}, {3.5061856772691717`*^9, 
   3.5061857237740507`*^9}, {3.506185779450569*^9, 3.506185800344137*^9}, {
   3.506185841637734*^9, 3.5061858443699837`*^9}, {3.5061858988142*^9, 
   3.506185984251598*^9}, {3.506186017309053*^9, 3.506186038961521*^9}, {
   3.5061871713987503`*^9, 3.506187197854344*^9}, {3.5062076240463037`*^9, 
   3.506207629339205*^9}, 3.506207796001915*^9, {3.506207848455763*^9, 
   3.506208013603314*^9}, {3.50639707932187*^9, 3.50639714080936*^9}, {
   3.506397213985841*^9, 3.506397223633387*^9}, {3.506428840636155*^9, 
   3.506428883639*^9}, {3.509404606996077*^9, 3.509404609986002*^9}, {
   3.509404684864975*^9, 3.5094046855345373`*^9}, {3.509411950076603*^9, 
   3.509411977160742*^9}, 3.509412024213531*^9, {3.509421005899817*^9, 
   3.509421028213688*^9}, {3.511097525178762*^9, 3.511097525584671*^9}, {
   3.5110978087721567`*^9, 3.511097810315488*^9}, {3.5129122453353786`*^9, 
   3.512912353900557*^9}, {3.5129601254286137`*^9, 3.512960126584834*^9}, {
   3.512960282377557*^9, 3.51296030403082*^9}, {3.512996867067947*^9, 
   3.512996887797282*^9}, {3.518187279012389*^9, 3.518187402510453*^9}, {
   3.519308637732916*^9, 3.51930865812565*^9}, 3.519308805426991*^9, {
   3.519353056980612*^9, 3.519353219769009*^9}, {3.519358964643111*^9, 
   3.519359031724902*^9}, {3.51935906317253*^9, 3.519359170516951*^9}, {
   3.519359251585491*^9, 3.519359256221977*^9}, {3.521551778528284*^9, 
   3.521551783551043*^9}, {3.521551975879752*^9, 3.521552030956285*^9}, {
   3.521552078741207*^9, 3.521552080464204*^9}, {3.524614804522451*^9, 
   3.5246148075454073`*^9}, {3.541514349954072*^9, 3.541514364590913*^9}, {
   3.541521955867853*^9, 3.5415219751672297`*^9}, {3.5415247125096684`*^9, 
   3.54152478984624*^9}, 3.541525770262753*^9, 3.541525804627961*^9, {
   3.541525877390984*^9, 3.5415259211793747`*^9}, {3.541526563354025*^9, 
   3.5415265814952793`*^9}, {3.541526758522801*^9, 3.5415268281782093`*^9}, {
   3.5417736810176563`*^9, 3.541773702041376*^9}, {3.541773913673313*^9, 
   3.54177393221026*^9}, {3.541774061811198*^9, 3.541774095182458*^9}, {
   3.541774762355134*^9, 3.5417748684279013`*^9}, {3.5417749404478703`*^9, 
   3.541774977745161*^9}, {3.541780584677578*^9, 3.5417806414657288`*^9}, {
   3.541780675912524*^9, 3.54178072410386*^9}, {3.541780939855069*^9, 
   3.541780964596154*^9}, {3.5419380053927794`*^9, 3.541938010313105*^9}, 
   3.5419380677842293`*^9, {3.5419382666641073`*^9, 3.541938331126294*^9}, {
   3.541938366319418*^9, 3.541938402883648*^9}, {3.541938448613525*^9, 
   3.5419384776899233`*^9}, {3.541938516225391*^9, 3.541938517423751*^9}, {
   3.541938847816327*^9, 3.54193886052556*^9}, {3.5419391695455837`*^9, 
   3.541939353583143*^9}, 3.541939402440724*^9, {3.541939433288899*^9, 
   3.5419395366431217`*^9}, {3.541939814453328*^9, 3.5419398587619677`*^9}, {
   3.541939890896982*^9, 3.541939895589965*^9}, {3.541939939401165*^9, 
   3.5419399620945997`*^9}, {3.541940001143775*^9, 3.541940018864416*^9}, {
   3.542460098878603*^9, 3.542460105938076*^9}, {3.5424601661327953`*^9, 
   3.542460169873371*^9}, {3.54248631488757*^9, 3.542486378062258*^9}, 
   3.542742163980897*^9, {3.543257185502894*^9, 3.543257188717368*^9}, {
   3.543258649074502*^9, 3.5432588597768593`*^9}, {3.543258902743141*^9, 
   3.5432589137755547`*^9}, {3.543259439919633*^9, 3.5432594890191193`*^9}, {
   3.5432862635757933`*^9, 3.5432864686657877`*^9}, {3.5432866745904408`*^9, 
   3.543286682506959*^9}, {3.543845801386444*^9, 3.543845894820036*^9}, {
   3.543845934667591*^9, 3.543845972846985*^9}, {3.543846882875828*^9, 
   3.543846897226985*^9}, 3.5438477787107067`*^9, {3.543847810572941*^9, 
   3.5438478172201*^9}, 3.5438479998237753`*^9, {3.543856641116108*^9, 
   3.543856704385516*^9}, {3.543860406129293*^9, 3.543860412455711*^9}, {
   3.543860455307948*^9, 3.54386052023529*^9}, {3.543860692372998*^9, 
   3.543860699466415*^9}, 3.5438607595589457`*^9, {3.543860911816264*^9, 
   3.543860933636252*^9}, {3.543860971933166*^9, 3.543861031702873*^9}, {
   3.5438610752017117`*^9, 3.54386108080757*^9}, 3.543861119872243*^9, {
   3.5438611698552113`*^9, 3.543861253795089*^9}, {3.544203065437025*^9, 
   3.544203284890477*^9}, {3.544203320163192*^9, 3.544203464533681*^9}, {
   3.544203499049303*^9, 3.5442035973213787`*^9}, {3.5442037259800177`*^9, 
   3.544203886856305*^9}, {3.54420394033496*^9, 3.54420395351819*^9}, {
   3.544288971824896*^9, 3.544288992623136*^9}, {3.544326191309277*^9, 
   3.544326194727182*^9}, {3.544360510080388*^9, 3.544360513444187*^9}, {
   3.544360639616139*^9, 3.544360708663818*^9}, {3.5443607538086023`*^9, 
   3.5443607657504597`*^9}, {3.544360799929953*^9, 3.544360810685836*^9}, {
   3.5443611353775387`*^9, 3.544361155313676*^9}, {3.544361198115651*^9, 
   3.544361210285672*^9}, {3.544361629432232*^9, 3.5443617440760612`*^9}, {
   3.544361854739655*^9, 3.544361856000428*^9}, {3.544364612288782*^9, 
   3.544364640746969*^9}, {3.54436482173765*^9, 3.5443649674708967`*^9}, {
   3.544448377801079*^9, 3.544448382080002*^9}, {3.544448920307068*^9, 
   3.5444489838866587`*^9}, {3.544463301545121*^9, 3.54446333246749*^9}, {
   3.5444650868103333`*^9, 3.544465087752903*^9}, {3.5444659214255333`*^9, 
   3.54446592413341*^9}, 3.544476600627363*^9, {3.544526571350459*^9, 
   3.544526612980926*^9}, {3.544526766761381*^9, 3.5445269370327463`*^9}, {
   3.544526994073488*^9, 3.5445271434816103`*^9}, {3.544527177125853*^9, 
   3.544527322634919*^9}, {3.544527358770355*^9, 3.544527378002994*^9}, {
   3.5445274942401743`*^9, 3.544527497865752*^9}, {3.544527626354926*^9, 
   3.5445276425184927`*^9}, {3.544527746781517*^9, 3.544527917896962*^9}, {
   3.544527958067939*^9, 3.5445280587042093`*^9}, {3.544528118058004*^9, 
   3.544528221353538*^9}, {3.54452834827678*^9, 3.544528493314189*^9}, {
   3.544529475628793*^9, 3.544529485646245*^9}, {3.5445295192953176`*^9, 
   3.5445295220369787`*^9}, {3.544529567835415*^9, 3.544529626007925*^9}, {
   3.544529704147564*^9, 3.5445297228607492`*^9}, {3.54452976319534*^9, 
   3.5445297659173603`*^9}, {3.5447944183791103`*^9, 3.544794418762504*^9}, {
   3.5449139509234047`*^9, 3.5449139812598457`*^9}, {3.544914021746448*^9, 
   3.544914029854908*^9}, {3.544925747853654*^9, 3.544925786444316*^9}, {
   3.544925902787459*^9, 3.544925916392934*^9}, {3.5466098888269053`*^9, 
   3.546609911726308*^9}, {3.546610023369576*^9, 3.5466100242428427`*^9}, {
   3.546610096596222*^9, 3.546610134984069*^9}, {3.546781176086257*^9, 
   3.546781210375478*^9}, {3.546782010836919*^9, 3.546782117075982*^9}, {
   3.5467832481441927`*^9, 3.546783263184057*^9}, {3.54678334152181*^9, 
   3.546783348764505*^9}, {3.546783379209073*^9, 3.546783415752384*^9}, {
   3.546783802598967*^9, 3.546783820304635*^9}, {3.546784001829908*^9, 
   3.5467840092249613`*^9}, {3.54678490967599*^9, 3.5467849141664133`*^9}, {
   3.546785406966564*^9, 3.546785434193153*^9}, {3.546785491613348*^9, 
   3.54678549459608*^9}, {3.547869020035129*^9, 3.5478690844917707`*^9}, {
   3.547869129460802*^9, 3.547869175956581*^9}, {3.547869206369473*^9, 
   3.5478692670062933`*^9}, {3.548096150427466*^9, 3.5480961830087214`*^9}, {
   3.548096217535236*^9, 3.5480962516186533`*^9}, {3.548156352778963*^9, 
   3.5481564096644983`*^9}, {3.548162261625474*^9, 3.548162356469994*^9}, {
   3.548162398279325*^9, 3.548162452454236*^9}, {3.548162706539695*^9, 
   3.548162730467846*^9}, 3.54816298471115*^9, {3.548163045165983*^9, 
   3.548163054281245*^9}, {3.548163104036346*^9, 3.5481631498380127`*^9}, {
   3.548163214207891*^9, 3.548163250712479*^9}, {3.548163483189362*^9, 
   3.5481635158946753`*^9}, {3.548163579214087*^9, 3.5481635943548813`*^9}, 
   3.548166969519422*^9, {3.550406369372375*^9, 3.5504064639072113`*^9}, 
   3.550406919153273*^9, 3.550407606360365*^9, 3.55041145559824*^9, {
   3.55145142677208*^9, 3.551451430884066*^9}, {3.5514518893123617`*^9, 
   3.551451901333664*^9}, {3.55162299086979*^9, 3.551623112859686*^9}, {
   3.551623198505536*^9, 3.551623231595662*^9}, {3.551626042307724*^9, 
   3.551626048671577*^9}, 3.551626755864697*^9, {3.551704997581642*^9, 
   3.551705033175972*^9}, {3.551750703997164*^9, 3.5517507051806498`*^9}, {
   3.551790103660368*^9, 3.551790144331633*^9}, {3.5517902511166*^9, 
   3.5517902555280237`*^9}, {3.551793924069166*^9, 3.551793944411086*^9}, {
   3.551794118457*^9, 3.5517941380112534`*^9}, {3.5517941751736393`*^9, 
   3.5517941776035767`*^9}, {3.551794430388092*^9, 3.551794431566308*^9}, 
   3.551794805353182*^9, 3.5517976505546494`*^9, {3.551798031068694*^9, 
   3.551798058409389*^9}, {3.5519737956531277`*^9, 3.5519738107450533`*^9}, {
   3.552150831409588*^9, 3.552150839932828*^9}, {3.5523929627312317`*^9, 
   3.5523930076280537`*^9}, {3.552707621475563*^9, 3.5527076216470222`*^9}, {
   3.5530173221405087`*^9, 3.5530173309554453`*^9}, {3.553268921945538*^9, 
   3.5532689248760977`*^9}, {3.553273365781242*^9, 3.553273371210886*^9}, {
   3.553312249438501*^9, 3.553312289442852*^9}, {3.553312465226903*^9, 
   3.553312466344776*^9}, {3.553351875366049*^9, 3.553352043762376*^9}, {
   3.553356581884632*^9, 3.553356646125886*^9}, {3.55335669612151*^9, 
   3.553356756638172*^9}, {3.5540841627739277`*^9, 3.554084328127899*^9}, {
   3.554084365996643*^9, 3.55408437395151*^9}, {3.5540844063736134`*^9, 
   3.554084555472418*^9}, {3.554084691311713*^9, 3.554084707988446*^9}, 
   3.5540853445453157`*^9, {3.554085384740364*^9, 3.554085391353279*^9}, {
   3.554085832531794*^9, 3.554085837288651*^9}, {3.554127349982629*^9, 
   3.554127410393628*^9}, {3.554732781351122*^9, 3.554732791824135*^9}, {
   3.5562953815874367`*^9, 3.556295472046803*^9}, {3.556295511545188*^9, 
   3.5562955918277807`*^9}, {3.556295624905603*^9, 3.5562957182430553`*^9}, {
   3.556295761442687*^9, 3.556295766188158*^9}, {3.556296402957077*^9, 
   3.556296454622802*^9}, {3.556459929427203*^9, 3.556459929615342*^9}, {
   3.556480630896596*^9, 3.55648071553139*^9}, {3.5565400836445427`*^9, 
   3.556540134705553*^9}, {3.5565401746037397`*^9, 3.556540253603018*^9}, {
   3.556540291033532*^9, 3.5565403489192657`*^9}, {3.556540383269258*^9, 
   3.556540398445524*^9}, {3.556540430120627*^9, 3.5565405454743853`*^9}, {
   3.556540576265923*^9, 3.556540579324832*^9}, {3.55654105197182*^9, 
   3.556541081304378*^9}, {3.5565626986505013`*^9, 3.556562780281198*^9}, {
   3.556562810871114*^9, 3.5565628531963367`*^9}, {3.5565630349856663`*^9, 
   3.556563047950672*^9}, {3.55656309444748*^9, 3.5565632890527773`*^9}, {
   3.55656336111231*^9, 3.5565633669488993`*^9}, {3.55657087647471*^9, 
   3.556570907154606*^9}, {3.557513372146214*^9, 3.557513409779991*^9}, {
   3.557513446210696*^9, 3.557513446804088*^9}, {3.55904283738625*^9, 
   3.5590428507455473`*^9}, 3.5590464395443363`*^9, {3.5591788145591516`*^9, 
   3.5591788626900263`*^9}, {3.559213785238493*^9, 3.55921380374937*^9}, {
   3.55923061190136*^9, 3.559230614949588*^9}, {3.5593402871261587`*^9, 
   3.5593403047862186`*^9}, {3.5593403845857697`*^9, 3.559340403775227*^9}, {
   3.56302505946002*^9, 3.563025062419647*^9}, {3.5630286731034737`*^9, 
   3.563028733270933*^9}, {3.563028778929475*^9, 3.5630288644998837`*^9}, {
   3.563028896250622*^9, 3.563028918235861*^9}, {3.563305974276361*^9, 
   3.563305980158317*^9}, {3.563306011725602*^9, 3.563306217041746*^9}, {
   3.56397622306421*^9, 3.563976224985881*^9}, {3.563977023758071*^9, 
   3.563977038746163*^9}, {3.563977625855967*^9, 3.563977634916712*^9}, {
   3.564239640260929*^9, 3.564239658014103*^9}, {3.564239694206579*^9, 
   3.564239836924109*^9}, {3.564245855566853*^9, 3.564245896965309*^9}, {
   3.564245999855029*^9, 3.564246019110609*^9}, {3.564255696582219*^9, 
   3.564255764671875*^9}, {3.564255815629655*^9, 3.564255919117135*^9}, {
   3.564323045284978*^9, 3.564323048336505*^9}, {3.564323746966608*^9, 
   3.564323758363431*^9}, {3.56449149560525*^9, 3.5644914962818327`*^9}, {
   3.5644926372205153`*^9, 3.564492650641983*^9}, 3.564492949526086*^9, {
   3.564494625824481*^9, 3.564494662622373*^9}, 3.5662267914435863`*^9, {
   3.56622682594429*^9, 3.566226844462323*^9}, {3.566226954100905*^9, 
   3.566226977945952*^9}, {3.566227035054432*^9, 3.566227035185236*^9}, {
   3.566227065992968*^9, 3.5662271278958597`*^9}, {3.566271665178877*^9, 
   3.566271675079322*^9}, {3.566272117294778*^9, 3.566272137811193*^9}, {
   3.566304161251878*^9, 3.566304165863496*^9}, {3.5672035101042137`*^9, 
   3.56720353793935*^9}, {3.567265894073002*^9, 3.567266135332642*^9}, {
   3.567266175098613*^9, 3.567266195929015*^9}, {3.56726631494449*^9, 
   3.567266339393764*^9}, 3.567473275364106*^9, {3.5674733078870687`*^9, 
   3.5674733336452*^9}, {3.5674760859211273`*^9, 3.567476151696601*^9}, {
   3.567476609731614*^9, 3.567476612581066*^9}, {3.568471482631672*^9, 
   3.568471486709858*^9}, {3.568471576196185*^9, 3.568471642295783*^9}, {
   3.568473652575448*^9, 3.56847365361762*^9}, {3.5684748236373034`*^9, 
   3.568474883721877*^9}, {3.571148212520651*^9, 3.5711482272865553`*^9}, {
   3.571233950759736*^9, 3.571234041043736*^9}, {3.57123481620859*^9, 
   3.571234816890524*^9}, {3.5712386420788116`*^9, 3.571238677140491*^9}, {
   3.577063082701847*^9, 3.577063281123901*^9}, {3.577068645746892*^9, 
   3.577068657252906*^9}, {3.57706869821502*^9, 3.577068778215439*^9}, 
   3.5770688360363398`*^9, {3.577068874322394*^9, 3.577068919353261*^9}, {
   3.5770691215091476`*^9, 3.577069225848633*^9}, {3.577100063325409*^9, 
   3.577100070508792*^9}, 3.577106754532979*^9, 3.577106803550227*^9, {
   3.577107036135715*^9, 3.577107099943634*^9}, {3.579972564179906*^9, 
   3.579972697999551*^9}, {3.5813617797640057`*^9, 3.581361816687133*^9}, {
   3.581680179888173*^9, 3.581680297971985*^9}, 3.581680723857224*^9, {
   3.582547252644877*^9, 3.582547255879627*^9}, {3.5825473952828503`*^9, 
   3.582547398452777*^9}, {3.582547430169529*^9, 3.5825475690961027`*^9}, {
   3.582573319557955*^9, 3.582573433633951*^9}, {3.5826585185156717`*^9, 
   3.582658522141851*^9}, {3.583596066317171*^9, 3.5835961115477333`*^9}, {
   3.583810059023596*^9, 3.583810289281345*^9}, {3.583810343390422*^9, 
   3.583810462758038*^9}, {3.583811055582191*^9, 3.583811085758766*^9}, 
   3.583811185379368*^9, {3.5838419312722*^9, 3.5838419346104727`*^9}, {
   3.5838619067870293`*^9, 3.583861909939917*^9}, {3.584095704110198*^9, 
   3.584095724907469*^9}, {3.584095768340908*^9, 3.5840957704263153`*^9}, {
   3.584095844727723*^9, 3.584095876232564*^9}, 3.5840980390044317`*^9, {
   3.584098771634811*^9, 3.584098873267302*^9}, {3.5840989042517138`*^9, 
   3.584098940450838*^9}, {3.585333287514881*^9, 3.5853333411421833`*^9}, {
   3.585655557790028*^9, 3.585655558230818*^9}, {3.5856559935102262`*^9, 
   3.585656011844439*^9}, {3.585656042464643*^9, 3.58565607522974*^9}, {
   3.586659991898362*^9, 3.586660020522354*^9}, {3.587474017069088*^9, 
   3.58747406658206*^9}, {3.5874740971426353`*^9, 3.587474115086616*^9}, {
   3.587474175927903*^9, 3.587474177792101*^9}, 3.5879903635930023`*^9, {
   3.588420648966527*^9, 3.588420674805196*^9}, {3.588421052765531*^9, 
   3.588421077873498*^9}, {3.588514757118635*^9, 3.588514766042863*^9}, {
   3.596142417260438*^9, 3.596142435542757*^9}, {3.596147066629057*^9, 
   3.5961472500707407`*^9}, {3.59614728509583*^9, 3.596147441259964*^9}, {
   3.59621040716304*^9, 3.596210518629636*^9}, {3.596210747327124*^9, 
   3.5962107536230993`*^9}, {3.596211315411769*^9, 3.596211353883408*^9}, {
   3.5962157552034492`*^9, 3.596215783836928*^9}, {3.596297000348822*^9, 
   3.596297032796479*^9}, {3.596297062842392*^9, 3.5962971320291452`*^9}, {
   3.597421612739997*^9, 3.597421636094288*^9}, 3.597421778267393*^9, {
   3.5975338443813553`*^9, 3.59753386024816*^9}, {3.597533940775585*^9, 
   3.5975339680915813`*^9}, {3.597534001057077*^9, 3.5975340146360893`*^9}, {
   3.597598510047164*^9, 3.597598516410266*^9}, 3.597637268497424*^9, {
   3.597758995840349*^9, 3.5977591102993193`*^9}, {3.597887219986291*^9, 
   3.597887234214037*^9}, 3.597889695777129*^9, {3.597931665637488*^9, 
   3.597931666724394*^9}, {3.5981544367244263`*^9, 3.598154962196108*^9}, {
   3.598155067102902*^9, 3.598155067790161*^9}, {3.598200446866166*^9, 
   3.598200529874975*^9}, {3.5982717233261747`*^9, 3.598271744010686*^9}, 
   3.598272631874207*^9, {3.601300616160369*^9, 3.601300630509615*^9}, {
   3.601735744015177*^9, 3.60173588557095*^9}, {3.602948198418297*^9, 
   3.602948225290915*^9}, 3.602951263223875*^9, {3.6033761305805683`*^9, 
   3.6033761468528967`*^9}, {3.604077565907392*^9, 3.604077581353277*^9}, {
   3.604077711416197*^9, 3.604077714999774*^9}, {3.604077796039269*^9, 
   3.6040778721318007`*^9}, {3.604078892415984*^9, 3.604078899576017*^9}, {
   3.604236917258963*^9, 3.604236919025391*^9}, 3.60423791784116*^9, {
   3.60431714626985*^9, 3.604317154951869*^9}, {3.604754612116002*^9, 
   3.604754780315493*^9}, {3.604754843837102*^9, 3.604754867950124*^9}, {
   3.6047569999764643`*^9, 3.604757041303928*^9}, {3.606140434410822*^9, 
   3.606140537357711*^9}, {3.606480650748344*^9, 3.6064806537125387`*^9}, {
   3.606480729484745*^9, 3.606480734734436*^9}, 3.607387747164617*^9, {
   3.6074473938352833`*^9, 3.6074474046850443`*^9}, {3.607447548228627*^9, 
   3.607447613901403*^9}, {3.607447740580043*^9, 3.607447926987814*^9}, 
   3.607447975553131*^9, {3.607705184124557*^9, 3.607705185348225*^9}, {
   3.6077059103864107`*^9, 3.607705982847597*^9}, 3.6077060238265867`*^9, {
   3.608469281292849*^9, 3.6084692841465807`*^9}, {3.608469372927747*^9, 
   3.608469601850527*^9}, {3.616466539552606*^9, 3.616466540305497*^9}, {
   3.620098304275885*^9, 3.6200983044831877`*^9}, {3.620143792900073*^9, 
   3.62014381141866*^9}, {3.6204859287581244`*^9, 3.620486032731596*^9}, {
   3.62049718350422*^9, 3.6204971997965813`*^9}, 3.6204977204015417`*^9, {
   3.62049896641368*^9, 3.620498967331523*^9}, {3.620500373160653*^9, 
   3.620500375449564*^9}, 3.620500566084425*^9, {3.6224665218819027`*^9, 
   3.6224666972322474`*^9}, {3.622466762690741*^9, 3.62246677002334*^9}, {
   3.622471438784326*^9, 3.6224714396976023`*^9}, 3.62247184300352*^9, {
   3.622483934635551*^9, 3.622483967606336*^9}, 3.622602401679162*^9, 
   3.622919809801806*^9, {3.6229217294670963`*^9, 3.6229219581526537`*^9}, {
   3.6229238529497013`*^9, 3.622923886423929*^9}, 3.623464393361278*^9, {
   3.623718541763751*^9, 3.623718544882413*^9}, {3.6237185952721777`*^9, 
   3.623718656190448*^9}, 3.6237187561430607`*^9, {3.6241962157704363`*^9, 
   3.624196225987751*^9}, {3.626572654798688*^9, 3.626572671653266*^9}, {
   3.6265728418789053`*^9, 3.6265728867187347`*^9}, {3.626572996062495*^9, 
   3.6265730120268803`*^9}, {3.628866485038731*^9, 3.628866519829784*^9}, {
   3.63110910797258*^9, 3.631109125248331*^9}, {3.6312877301813593`*^9, 
   3.631287740982332*^9}, {3.631453871054947*^9, 3.631453873902645*^9}, {
   3.631453930667897*^9, 3.631453959278174*^9}, {3.631454017343486*^9, 
   3.631454046531152*^9}, {3.631454435839432*^9, 3.631454458247748*^9}, {
   3.631454523091104*^9, 3.6314545447182217`*^9}, {3.63145457619851*^9, 
   3.63145457633947*^9}, {3.6314552653165913`*^9, 3.631455373911187*^9}, {
   3.631801049210188*^9, 3.6318010552073402`*^9}, {3.631801089436268*^9, 
   3.631801109612495*^9}, {3.63180118315444*^9, 3.631801187847991*^9}, {
   3.631801223991727*^9, 3.631801258890974*^9}, {3.6324278239954453`*^9, 
   3.632427829410478*^9}, {3.632428406133975*^9, 3.632428442041614*^9}, {
   3.6324300870296917`*^9, 3.632430091065179*^9}, {3.63448082935747*^9, 
   3.634480838272187*^9}, {3.638933617503766*^9, 3.638933681438665*^9}, {
   3.638933917583123*^9, 3.638933920464773*^9}, {3.638934732844041*^9, 
   3.638934783776347*^9}, {3.641517899057185*^9, 3.641517904623878*^9}, {
   3.641521642405264*^9, 3.64152167326208*^9}, {3.641522475115858*^9, 
   3.6415227755750303`*^9}, {3.6419057050936613`*^9, 
   3.6419058498566427`*^9}, {3.641906120490769*^9, 3.6419062032219467`*^9}, {
   3.6419062388133793`*^9, 3.6419062425440617`*^9}, {3.641908541783701*^9, 
   3.6419085560085707`*^9}, 3.642516482128025*^9, {3.6425184280291567`*^9, 
   3.6425184529024754`*^9}, 3.642518675155774*^9, 3.6436850562428102`*^9, {
   3.643709700208853*^9, 3.643709758546295*^9}, {3.643710344265852*^9, 
   3.643710374277834*^9}, {3.643710420336873*^9, 3.643710428713255*^9}, {
   3.6437104592545547`*^9, 3.6437104810939837`*^9}, {3.646753686546967*^9, 
   3.646753694610345*^9}, 3.646753938637732*^9, 3.648571076340597*^9, {
   3.64865013767526*^9, 3.648650233237308*^9}, 3.6486503135506268`*^9, {
   3.648653474699793*^9, 3.64865347480632*^9}, 3.650385224076714*^9, {
   3.6503853354993887`*^9, 3.6503853410212917`*^9}, {3.65098329058668*^9, 
   3.6509832906597033`*^9}, 3.650983397861239*^9, {3.650992875516724*^9, 
   3.650992888456408*^9}, 3.651443616838572*^9, 3.6515237416472607`*^9, 
   3.6515378795130243`*^9, {3.651537923447844*^9, 3.6515380789203777`*^9}, 
   3.651538158581814*^9, {3.651538597032528*^9, 3.65153863477641*^9}, 
   3.651931317480123*^9, {3.6536768075518227`*^9, 3.653676860191318*^9}, {
   3.654959214523098*^9, 3.654959246089506*^9}, {3.654960772034903*^9, 
   3.654960820118287*^9}, {3.6549610580611963`*^9, 3.654961069591951*^9}, {
   3.654961108611559*^9, 3.654961148070417*^9}, {3.656252648602803*^9, 
   3.6562527519140472`*^9}, {3.6565182612327547`*^9, 3.6565182616604843`*^9}, 
   3.6567753211516*^9, {3.656775402448584*^9, 3.6567754205675364`*^9}, {
   3.656777871296053*^9, 3.6567779764440813`*^9}, {3.6567780133570843`*^9, 
   3.656778032743149*^9}, {3.6580722839399233`*^9, 3.6580722889526157`*^9}, 
   3.658086468504573*^9, {3.658086903409443*^9, 3.6580869380810204`*^9}, {
   3.6585945071685963`*^9, 3.658594825259048*^9}, {3.658784068764127*^9, 
   3.6587840722544203`*^9}, {3.660762592892807*^9, 3.660762657806147*^9}, {
   3.6607627125727797`*^9, 3.660762720360753*^9}, {3.660762750569295*^9, 
   3.6607627689045343`*^9}, {3.661360582823194*^9, 3.661360583791793*^9}, {
   3.661360681950777*^9, 3.661360687916316*^9}, {3.661360750193286*^9, 
   3.661360780263468*^9}, {3.6618836091581917`*^9, 3.6618836311578283`*^9}, {
   3.661883726797378*^9, 3.661883837082362*^9}, {3.661902582316058*^9, 
   3.661902595515377*^9}, {3.661918699443779*^9, 3.661918739934442*^9}, {
   3.6619188224746*^9, 3.661918824186697*^9}, 3.661918868211755*^9, {
   3.6622398854699*^9, 3.6622398870251217`*^9}, {3.6646352922410517`*^9, 
   3.664635366133237*^9}, 3.664635563045684*^9, 3.6691269800215473`*^9, 
   3.669137250560281*^9, 3.669137308119814*^9, 3.672330785302636*^9, {
   3.672577735889639*^9, 3.672577762087512*^9}, {3.67733747861054*^9, 
   3.677337485722077*^9}, {3.677338031935891*^9, 3.67733804591051*^9}, 
   3.677338204640394*^9, {3.677338266693554*^9, 3.677338321065865*^9}, {
   3.677338418601738*^9, 3.677338488932642*^9}, {3.681736712641778*^9, 
   3.681736723077626*^9}, {3.681737625925617*^9, 3.6817376299847393`*^9}, {
   3.6844150934280663`*^9, 3.684415105434967*^9}, {3.684466227849605*^9, 
   3.684466346846304*^9}, 3.684502773652968*^9, {3.684671536825543*^9, 
   3.684671600251886*^9}, {3.6846716996580267`*^9, 3.68467169994948*^9}, {
   3.6846780777396603`*^9, 3.6846780920859137`*^9}, {3.6846781320941257`*^9, 
   3.6846781924500933`*^9}, 3.6918939842438602`*^9, {3.691894180044825*^9, 
   3.691894306902755*^9}, 3.691894410525478*^9, 3.691894758255163*^9, {
   3.693156563401335*^9, 3.693156564073312*^9}, 3.693157170919324*^9, 
   3.6931931057494583`*^9, 3.6931931409690933`*^9, {3.693194375892077*^9, 
   3.693194381825469*^9}, {3.69319441187416*^9, 3.6931944376457853`*^9}, {
   3.695869270109647*^9, 3.695869344209095*^9}, {3.696042439029419*^9, 
   3.696042478247836*^9}, {3.696354941291903*^9, 3.696354982159011*^9}, 
   3.696355018775114*^9, {3.696355054850387*^9, 3.696355083139944*^9}, {
   3.696698399423395*^9, 3.69669840825163*^9}, {3.696707755588442*^9, 
   3.696707850147504*^9}, {3.6967752653102493`*^9, 3.696775276859106*^9}, {
   3.6967753773195972`*^9, 3.6967754490222054`*^9}, 3.696783661719157*^9, {
   3.6967838739005213`*^9, 3.696783954839774*^9}, {3.6967840058087873`*^9, 
   3.696784007178574*^9}, {3.696784041017334*^9, 3.6967840905996*^9}, 
   3.696863973337788*^9, {3.6968640258513412`*^9, 3.696864067828882*^9}, {
   3.6968641052766533`*^9, 3.696864150331225*^9}, {3.6968740380043173`*^9, 
   3.6968740383631067`*^9}, {3.702647231745686*^9, 3.702647239706785*^9}, 
   3.7026472971634083`*^9, {3.70368380798709*^9, 3.703683823065613*^9}, {
   3.7036838914659443`*^9, 3.703683913180685*^9}, {3.703684831578363*^9, 
   3.7036849027035723`*^9}, {3.704032064347501*^9, 3.704032109782961*^9}, {
   3.704032630043387*^9, 3.7040326707645187`*^9}, {3.706188961889786*^9, 
   3.706189003345035*^9}, {3.7061890354744253`*^9, 3.70618905489252*^9}, {
   3.706189129354335*^9, 3.706189149982253*^9}, 3.706191220579974*^9, {
   3.706296632584564*^9, 3.70629663509048*^9}, {3.70774583135221*^9, 
   3.707745839802146*^9}, {3.708447716030261*^9, 3.7084477162331457`*^9}, 
   3.7084479388769627`*^9, {3.708702611906495*^9, 3.7087026120570183`*^9}, {
   3.708702845838799*^9, 3.708702853563458*^9}, {3.708706244995449*^9, 
   3.708706255593998*^9}, {3.7088721055692577`*^9, 3.7088721213114853`*^9}, {
   3.708872334880764*^9, 3.708872335378923*^9}, {3.708956343193225*^9, 
   3.708956366765452*^9}, {3.708956577489942*^9, 3.70895658991698*^9}, {
   3.709048857460981*^9, 3.709048887756576*^9}, 3.709049265426251*^9, {
   3.70904954509226*^9, 3.70904954625021*^9}, {3.71094532140202*^9, 
   3.710945350020452*^9}, {3.711736565643415*^9, 3.711736653944908*^9}, {
   3.71173671073064*^9, 3.711736779738428*^9}, {3.711736893959959*^9, 
   3.711736895020898*^9}, {3.711737033220418*^9, 3.7117370443558407`*^9}, 
   3.723904161194558*^9, {3.723905709009104*^9, 3.723905709790586*^9}, {
   3.723906083812002*^9, 3.723906145830393*^9}, {3.723908135106*^9, 
   3.723908147415552*^9}, {3.723908230543427*^9, 3.723908277398929*^9}, 
   3.723908553623973*^9, {3.7239097031078043`*^9, 3.723909732974135*^9}, {
   3.7239098537266827`*^9, 3.7239098923123007`*^9}, {3.723909924982737*^9, 
   3.7239099496013937`*^9}, 3.723910037135309*^9, {3.7239108182488823`*^9, 
   3.7239108514452047`*^9}, {3.7239154800393677`*^9, 3.723915500510705*^9}, {
   3.724765377372408*^9, 3.724765392162388*^9}, {3.725458710068994*^9, 
   3.72545873858502*^9}, {3.726585146421756*^9, 3.726585146587882*^9}, {
   3.726585187048997*^9, 3.72658523569168*^9}, 3.728310456210861*^9, 
   3.728310524181477*^9, {3.728448025610876*^9, 3.728448052322649*^9}, {
   3.728475175240601*^9, 3.7284752777984247`*^9}, 3.728476169162806*^9, {
   3.728846912625268*^9, 3.728846917375843*^9}, {3.728853297682446*^9, 
   3.728853300178207*^9}, {3.728878150861353*^9, 3.728878155579132*^9}, {
   3.728924251388576*^9, 3.728924259462356*^9}, 3.729606800387376*^9, 
   3.729611871312499*^9, 3.740334412706863*^9, {3.746297870472294*^9, 
   3.7462978949893513`*^9}, {3.746367319437482*^9, 3.7463673312521353`*^9}, {
   3.746709805644609*^9, 3.7467098230366364`*^9}, {3.746719583739944*^9, 
   3.746719613418428*^9}, 3.746719678772687*^9, {3.746803024748217*^9, 
   3.746803034487533*^9}, {3.74680330539097*^9, 3.746803333057107*^9}, {
   3.750954447190846*^9, 3.750954457815509*^9}, {3.750960541658024*^9, 
   3.750960570186489*^9}, {3.75096088249489*^9, 3.750960890668192*^9}, {
   3.751205800899639*^9, 3.751205817735993*^9}, {3.75120646123717*^9, 
   3.7512064927330313`*^9}, {3.751209175666288*^9, 3.75120918264713*^9}, {
   3.756048523044579*^9, 3.756048625796835*^9}, {3.756137137590192*^9, 
   3.7561371535880327`*^9}, {3.7561373094644117`*^9, 3.756137311968288*^9}, 
   3.756310811405583*^9, 3.757601537768443*^9, {3.757601736583446*^9, 
   3.7576017371285877`*^9}, {3.7596099850082684`*^9, 3.759610002205614*^9}, {
   3.7596320396522923`*^9, 3.759632039892911*^9}, {3.760715760188705*^9, 
   3.760715936140459*^9}, {3.760716169825058*^9, 3.760716174999161*^9}, 
   3.7607179268252087`*^9, {3.760718799947051*^9, 3.760718805625799*^9}, {
   3.760883399144861*^9, 3.760883399347026*^9}, 3.760970913839486*^9, {
   3.761051628193812*^9, 3.761051686125355*^9}, {3.7610517220984697`*^9, 
   3.761051734544503*^9}, {3.761051769104199*^9, 3.7610518696698713`*^9}, 
   3.761316697469269*^9, {3.7613167453426*^9, 3.761316753974086*^9}, {
   3.761319596933836*^9, 3.7613196064958982`*^9}, 3.7614421050668373`*^9, {
   3.7614464081502867`*^9, 3.76144643016253*^9}, {3.7614825530270433`*^9, 
   3.761482555526352*^9}, 3.7624350781902*^9, {3.762436233389597*^9, 
   3.7624362576037617`*^9}, {3.762791232415841*^9, 3.762791272073797*^9}, {
   3.7770438257460546`*^9, 3.777043886107031*^9}, {3.792423730650865*^9, 
   3.792424066853413*^9}, {3.792427550165865*^9, 3.792427622634595*^9}, {
   3.792502648289472*^9, 3.792502649264194*^9}, {3.7995900478793077`*^9, 
   3.7995900648420553`*^9}, {3.79959017955459*^9, 3.7995901802609167`*^9}, {
   3.7995902123937693`*^9, 3.799590217870265*^9}, {3.799590250235022*^9, 
   3.799590255743359*^9}, 
   3.7995903310952053`*^9},ExpressionUUID->"7a04b535-6c36-4a8a-98cb-\
240b63c315fd"],

Cell[BoxData["\<\"tuIndexRaiseAll[from_,to_][exp_] raises one index from_ to \
to_ found in exp_.  Handles indices in DerivOpsD to DerivOpsU \
*20Jun2015*\"\>"], "Output",
 CellChangeTimes->{
  3.644023127185568*^9, 3.65505647933284*^9, 3.6559939344476957`*^9, 
   3.656123974151372*^9, 3.6563825457435637`*^9, 3.656597842117392*^9, 
   3.65677797801862*^9, 3.6610181307979097`*^9, 3.663425311199163*^9, 
   3.664641246406206*^9, 3.666499660996263*^9, 3.667573750943434*^9, 
   3.669493491786029*^9, 3.669553372825872*^9, 3.6697491553790483`*^9, 
   3.670080154920767*^9, {3.672446274506906*^9, 3.6724462763111677`*^9}, {
   3.672446306759951*^9, 3.672446308530508*^9}, {3.695141638076166*^9, 
   3.6951416628743553`*^9}, {3.696874043097456*^9, 3.696874043974801*^9}, 
   3.699730560169174*^9, 3.6997960472515383`*^9, 3.700059788709687*^9, 
   3.700145204432823*^9, 3.7005320530371523`*^9, 3.7054249421699667`*^9, 
   3.7067153420572643`*^9, 3.707052300833342*^9, 3.71414310587948*^9, 
   3.731069824363638*^9, 3.7321069018041153`*^9, 3.73219145687014*^9, 
   3.733240406526243*^9, 3.735089501867144*^9, {3.735089942701157*^9, 
   3.7350899448785763`*^9}, 3.7356469258704977`*^9, 3.7397942821929607`*^9, 
   3.741353171356246*^9, {3.7449730656814127`*^9, 3.7449730696798563`*^9}, 
   3.745263605741939*^9, 3.7452673114559793`*^9, 3.745492872167403*^9, 
   3.7474137486249447`*^9, {3.750954479847919*^9, 3.7509544817492*^9}, 
   3.752936816442136*^9, 3.756049304289547*^9, 3.759072054252743*^9, 
   3.796393439864449*^9, {3.799589229765307*^9, 3.7995892362139874`*^9}, {
   3.7995892689592867`*^9, 3.7995892753881483`*^9}, 3.799589490358363*^9, 
   3.7995897134810867`*^9, 3.799589796654931*^9, 3.799589915688382*^9, {
   3.799590053844449*^9, 3.799590066481312*^9}, 3.799590181847818*^9, 
   3.7995902191367273`*^9, {3.799590258612731*^9, 3.799590284632159*^9}, 
   3.79959033271052*^9},ExpressionUUID->"eb0ec73b-b576-4cb3-8593-\
d4762ba818e4"],

Cell[BoxData["\<\"tuIndexReplace[from_,to_][exp_] replaces all indices in \
exp_ from from_ to to_. *16Sep2015\"\>"], "Output",
 CellChangeTimes->{
  3.644023127185568*^9, 3.65505647933284*^9, 3.6559939344476957`*^9, 
   3.656123974151372*^9, 3.6563825457435637`*^9, 3.656597842117392*^9, 
   3.65677797801862*^9, 3.6610181307979097`*^9, 3.663425311199163*^9, 
   3.664641246406206*^9, 3.666499660996263*^9, 3.667573750943434*^9, 
   3.669493491786029*^9, 3.669553372825872*^9, 3.6697491553790483`*^9, 
   3.670080154920767*^9, {3.672446274506906*^9, 3.6724462763111677`*^9}, {
   3.672446306759951*^9, 3.672446308530508*^9}, {3.695141638076166*^9, 
   3.6951416628743553`*^9}, {3.696874043097456*^9, 3.696874043974801*^9}, 
   3.699730560169174*^9, 3.6997960472515383`*^9, 3.700059788709687*^9, 
   3.700145204432823*^9, 3.7005320530371523`*^9, 3.7054249421699667`*^9, 
   3.7067153420572643`*^9, 3.707052300833342*^9, 3.71414310587948*^9, 
   3.731069824363638*^9, 3.7321069018041153`*^9, 3.73219145687014*^9, 
   3.733240406526243*^9, 3.735089501867144*^9, {3.735089942701157*^9, 
   3.7350899448785763`*^9}, 3.7356469258704977`*^9, 3.7397942821929607`*^9, 
   3.741353171356246*^9, {3.7449730656814127`*^9, 3.7449730696798563`*^9}, 
   3.745263605741939*^9, 3.7452673114559793`*^9, 3.745492872167403*^9, 
   3.7474137486249447`*^9, {3.750954479847919*^9, 3.7509544817492*^9}, 
   3.752936816442136*^9, 3.756049304289547*^9, 3.759072054252743*^9, 
   3.796393439864449*^9, {3.799589229765307*^9, 3.7995892362139874`*^9}, {
   3.7995892689592867`*^9, 3.7995892753881483`*^9}, 3.799589490358363*^9, 
   3.7995897134810867`*^9, 3.799589796654931*^9, 3.799589915688382*^9, {
   3.799590053844449*^9, 3.799590066481312*^9}, 3.799590181847818*^9, 
   3.7995902191367273`*^9, {3.799590258612731*^9, 3.799590284632159*^9}, 
   3.799590332833243*^9},ExpressionUUID->"3c3e4bc4-21d8-4697-b52e-\
09f50965f30a"],

Cell[BoxData["\<\"tuDupdn2tuPartial[exp_] Converts \
D[fn_[\[Mu][up],\[Nu][dn],...],\[Mu][up],\[Nu][dn],...] form to \
tuDPartial[tuDPartialu[fn,\[Mu]],\[Nu]] form.  *1Jan2014*\"\>"], "Output",
 CellChangeTimes->{
  3.644023127185568*^9, 3.65505647933284*^9, 3.6559939344476957`*^9, 
   3.656123974151372*^9, 3.6563825457435637`*^9, 3.656597842117392*^9, 
   3.65677797801862*^9, 3.6610181307979097`*^9, 3.663425311199163*^9, 
   3.664641246406206*^9, 3.666499660996263*^9, 3.667573750943434*^9, 
   3.669493491786029*^9, 3.669553372825872*^9, 3.6697491553790483`*^9, 
   3.670080154920767*^9, {3.672446274506906*^9, 3.6724462763111677`*^9}, {
   3.672446306759951*^9, 3.672446308530508*^9}, {3.695141638076166*^9, 
   3.6951416628743553`*^9}, {3.696874043097456*^9, 3.696874043974801*^9}, 
   3.699730560169174*^9, 3.6997960472515383`*^9, 3.700059788709687*^9, 
   3.700145204432823*^9, 3.7005320530371523`*^9, 3.7054249421699667`*^9, 
   3.7067153420572643`*^9, 3.707052300833342*^9, 3.71414310587948*^9, 
   3.731069824363638*^9, 3.7321069018041153`*^9, 3.73219145687014*^9, 
   3.733240406526243*^9, 3.735089501867144*^9, {3.735089942701157*^9, 
   3.7350899448785763`*^9}, 3.7356469258704977`*^9, 3.7397942821929607`*^9, 
   3.741353171356246*^9, {3.7449730656814127`*^9, 3.7449730696798563`*^9}, 
   3.745263605741939*^9, 3.7452673114559793`*^9, 3.745492872167403*^9, 
   3.7474137486249447`*^9, {3.750954479847919*^9, 3.7509544817492*^9}, 
   3.752936816442136*^9, 3.756049304289547*^9, 3.759072054252743*^9, 
   3.796393439864449*^9, {3.799589229765307*^9, 3.7995892362139874`*^9}, {
   3.7995892689592867`*^9, 3.7995892753881483`*^9}, 3.799589490358363*^9, 
   3.7995897134810867`*^9, 3.799589796654931*^9, 3.799589915688382*^9, {
   3.799590053844449*^9, 3.799590066481312*^9}, 3.799590181847818*^9, 
   3.7995902191367273`*^9, {3.799590258612731*^9, 3.799590284632159*^9}, 
   3.799590332962758*^9},ExpressionUUID->"d45e53f2-94de-40ef-8bbe-\
8f822f66211d"]
}, Open  ]],

Cell["Energy-Momentum tensors", "Text",
 CellChangeTimes->{{3.4774875997271137`*^9, 3.4774876451707582`*^9}, {
  3.4774877449202957`*^9, 3.477487751315998*^9}, {3.4774889083550587`*^9, 
  3.477488909767075*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"tuFvectorboson", "::", "usage"}], "=", 
   "\"\<tuFvectorboson returns the Abelian vector boson energy-momentum \
tensor:\[IndentingNewLine]-F[\[Mu],\[Nu]].F[\[Mu],\[Nu]]/4 \[Rule] derivative \
of A definition and Fourier transform form of A } *21Dec2014*8Mar2020*\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tuFvectorboson", ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "tmp", ",", "subF", ",", "subFA", ",", "subA", ",", "F2", ",", "FA2"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"\"\<Abelian case\>\"", ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"subF", "=", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"F", ",", "\"\<dd\>\""}], "]"}], "[", 
           RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}], "\[Rule]", 
          RowBox[{
           RowBox[{"tuDPartial", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"A", ",", "\"\<d\>\""}], "]"}], "[", "\[Nu]", "]"}], 
             ",", "\[Mu]"}], "]"}], "-", 
           RowBox[{"tuDPartial", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"A", ",", "\"\<d\>\""}], "]"}], "[", "\[Mu]", "]"}], 
             ",", "\[Nu]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"F", ",", "\"\<uu\>\""}], "]"}], "[", 
           RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}], "->", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
             RowBox[{"\[Mu]", ",", "\[Alpha]"}], "]"}], 
            RowBox[{"tuDPartial", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"A", ",", "\"\<u\>\""}], "]"}], "[", "\[Nu]", "]"}], 
              ",", "\[Alpha]"}], "]"}]}], "-", 
           RowBox[{
            RowBox[{"tuDPartial", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"A", ",", "\"\<u\>\""}], "]"}], "[", "\[Mu]", "]"}], 
              ",", "\[Alpha]"}], "]"}], 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
             RowBox[{"\[Alpha]", ",", "\[Nu]"}], "]"}]}]}]}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"\"\< and Fourier transform \>\"", ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"subA", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"A", ",", "\"\<d\>\""}], "]"}], "[", "i_", "]"}], 
          "\[Rule]", 
          RowBox[{"xIntegral", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"a", ",", "\"\<d\>\"", ",", 
                RowBox[{"{", "i", "}"}]}], "]"}], "[", "k", "]"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{"k", ".", "x"}]}], "]"}]}], ",", "k"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"A", ",", "\"\<u\>\""}], "]"}], "[", "i_", "]"}], 
          "\[Rule]", 
          RowBox[{"xIntegral", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"a", ",", "\"\<u\>\"", ",", 
                RowBox[{"{", "i", "}"}]}], "]"}], "[", "k", "]"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", "I"}], " ", 
               RowBox[{"k", ".", "x"}]}], "]"}]}], ",", "k"}], "]"}]}]}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"subFA", "=", 
       RowBox[{"subF", "/.", "subA"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"subFA", "=", 
       RowBox[{"subFA", "//", 
        RowBox[{"tuOpSwitch", "[", 
         RowBox[{"tuDPartial", ",", "xIntegral"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"subFA", "=", 
       RowBox[{
        RowBox[{"subFA", "/.", 
         RowBox[{
          RowBox[{"tuDPartial", "[", 
           RowBox[{
            RowBox[{"a_", " ", 
             RowBox[{"Exp", "[", "b_", "]"}]}], ",", "c_"}], "]"}], "->", 
          RowBox[{"I", " ", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"k", ",", "\"\<d\>\""}], "]"}], "[", "c", "]"}], " ", 
           "a", " ", 
           RowBox[{"Exp", "[", "b", "]"}]}]}]}], "//.", 
        "tuIntegralGatherR"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"subFA", "=", 
       RowBox[{"subFA", "//", 
        RowBox[{"tuIndexContractAll", "[", "g", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"F2", "=", 
       RowBox[{
        RowBox[{"-", 
         FractionBox["1", "4"]}], 
        RowBox[{
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"F", ",", "\"\<dd\>\""}], "]"}], "[", 
          RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}], ".", 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"F", ",", "\"\<uu\>\""}], "]"}], "[", 
          RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}]}]}]}], " ", ";", 
      RowBox[{"(*", " ", 
       RowBox[{"Abelian", " ", "case"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"FA2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"F2", "/.", "subF"}], "//", 
           RowBox[{"expandDC", "[", "]"}]}], "//", 
          RowBox[{"tuIndexContractAll", "[", "g", "]"}]}], "//", 
         "tuIndexDummyUniform"}], "//", "Simplify"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"FA2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"FA2", "//.", 
            RowBox[{
             RowBox[{"dm", "[", "1", "]"}], "\[Rule]", "\[Mu]"}]}], "//.", 
           RowBox[{
            RowBox[{"dm", "[", "2", "]"}], "\[Rule]", "\[Nu]"}]}], "//", 
          RowBox[{"tuIndexDummyOrdered", "[", 
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "]"}]}], "//", 
         "Simplify"}], "//", "\[IndentingNewLine]", 
        RowBox[{"tuTermApplyEach", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"tuDPartialu", "[", 
            RowBox[{"_", ",", "\[Nu]"}], "]"}], "}"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"tuIndexSwap", "[", 
               RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}], "[", "#", "]"}], ")"}],
             "&"}], "}"}], ",", "1"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"$fF2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"FA2", "/.", "subA"}], "/.", 
           RowBox[{
            RowBox[{"pp", ":", 
             RowBox[{"tuDPartial", "[", 
              RowBox[{"_", ",", "_"}], "]"}]}], ":>", 
            RowBox[{
             RowBox[{"tuOpSwitch", "[", 
              RowBox[{"tuDPartial", ",", "xIntegral"}], "]"}], "[", "pp", 
             "]"}]}]}], "/.", 
          RowBox[{
           RowBox[{"pp", ":", 
            RowBox[{"tuDPartialu", "[", 
             RowBox[{"_", ",", "_"}], "]"}]}], ":>", 
           RowBox[{
            RowBox[{"tuOpSwitch", "[", 
             RowBox[{"tuDPartialu", ",", "xIntegral"}], "]"}], "[", "pp", 
            "]"}]}]}], "/.", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"i1", ":", 
             RowBox[{"xIntegral", "[", 
              RowBox[{"a_", ",", "k"}], "]"}]}], ")"}], ".", 
           RowBox[{"(", 
            RowBox[{"i2", ":", 
             RowBox[{"xIntegral", "[", 
              RowBox[{"b_", ",", "k"}], "]"}]}], ")"}]}], "\[RuleDelayed]", 
          RowBox[{"i1", ".", 
           RowBox[{"(", 
            RowBox[{"i2", "/.", 
             RowBox[{"k", "\[Rule]", "k1"}]}], ")"}]}]}]}], "//", 
        RowBox[{"tuOpGather", "[", "xIntegral", "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"$fF2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"$fF2", "/.", 
           RowBox[{
            RowBox[{"tuDPartial", "[", 
             RowBox[{
              RowBox[{"a_", " ", 
               RowBox[{"Exp", "[", 
                RowBox[{"b_", " ", 
                 RowBox[{"k_", " ", ".", "x"}]}], "]"}]}], ",", "c_"}], "]"}],
             "->", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"k", ",", "\"\<d\>\""}], "]"}], "[", "c", "]"}], " ", 
             "a", " ", 
             RowBox[{"Exp", "[", "b", "]"}]}]}]}], "/.", 
          RowBox[{
           RowBox[{"tuDPartialu", "[", 
            RowBox[{
             RowBox[{"a_", " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"b_", " ", 
                RowBox[{"k_", " ", ".", "x"}]}], "]"}]}], ",", "c_"}], "]"}], 
           "->", 
           RowBox[{"I", " ", 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"k", ",", "\"\<u\>\""}], "]"}], "[", "c", "]"}], " ", 
            "a", " ", 
            RowBox[{"Exp", "[", "b", "]"}]}]}]}], "//", "tuIntegralGather"}], 
        "//", 
        RowBox[{"expandDC", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{
              RowBox[{"k", "|", "k1"}], ",", "_", ",", "_"}], "]"}], ",", 
            RowBox[{"Exp", "[", "_", "]"}]}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"F2", ",", 
        RowBox[{"F2", "->", "FA2"}], ",", 
        RowBox[{"F2", "->", "$fF2"}]}], "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.47748769590289*^9, 3.477488081976946*^9}, {
   3.477488467366118*^9, 3.47748856240867*^9}, {3.4774886173547*^9, 
   3.477488689887061*^9}, {3.477488783679697*^9, 3.477488891200232*^9}, {
   3.4774890260432034`*^9, 3.477489027043998*^9}, {3.4787002770801*^9, 
   3.478700304259726*^9}, {3.478700337742271*^9, 3.4787003558857403`*^9}, {
   3.4787004081321077`*^9, 3.478700409637163*^9}, {3.478700484471265*^9, 
   3.478700493147669*^9}, {3.4787005607021103`*^9, 3.478700578013245*^9}, {
   3.478700747998646*^9, 3.4787007718227797`*^9}, {3.478700835425137*^9, 
   3.4787008361641417`*^9}, {3.478700903527666*^9, 3.478700940649012*^9}, {
   3.478701045194685*^9, 3.478701149492828*^9}, {3.478704320157867*^9, 
   3.478704323769582*^9}, {3.478704490384317*^9, 3.478704500451713*^9}, {
   3.4787045522054253`*^9, 3.478704552739633*^9}, {3.478705233192141*^9, 
   3.4787054095950947`*^9}, {3.478705491843224*^9, 3.478705535399572*^9}, {
   3.478705722452095*^9, 3.4787058649332542`*^9}, {3.478706506806182*^9, 
   3.478706521800769*^9}, {3.4787066159488497`*^9, 3.478706646976132*^9}, 
   3.478706747037608*^9, {3.4787073783542967`*^9, 3.478707402018137*^9}, {
   3.4787075434663754`*^9, 3.478707570006216*^9}, {3.478707632749713*^9, 
   3.478707656331195*^9}, 3.478707823778586*^9, 3.47870786784011*^9, {
   3.478707999361418*^9, 3.478708003258916*^9}, {3.478708033893132*^9, 
   3.478708034647367*^9}, {3.478708089257148*^9, 3.47870808942437*^9}, {
   3.478708145207407*^9, 3.478708145823763*^9}, {3.478708230618517*^9, 
   3.478708245716*^9}, {3.478708286024069*^9, 3.478708295613978*^9}, {
   3.4787085435736837`*^9, 3.47870857039248*^9}, {3.478913665609343*^9, 
   3.478913774421372*^9}, {3.48306602512379*^9, 3.483066039251102*^9}, 
   3.483066073796667*^9, {3.483066108709731*^9, 3.48306612202439*^9}, 
   3.483066175485804*^9, {3.4831114606087*^9, 3.483111467270363*^9}, {
   3.48346652079375*^9, 3.483466537376966*^9}, {3.483466593532233*^9, 
   3.483466633720793*^9}, {3.4834666644502077`*^9, 3.483466669939042*^9}, {
   3.483705685236389*^9, 3.483705691093693*^9}, 3.483705815088426*^9, {
   3.48370705050918*^9, 3.483707058055099*^9}, 3.483711896803485*^9, {
   3.4837119910682077`*^9, 3.483711991750771*^9}, 3.483712050310136*^9, {
   3.483712107723477*^9, 3.48371215135907*^9}, {3.483712190864435*^9, 
   3.4837122026970778`*^9}, {3.4837122376063747`*^9, 3.483712239165442*^9}, {
   3.483712285122829*^9, 3.4837122993194017`*^9}, 3.483712435396253*^9, {
   3.4837127868105164`*^9, 3.483712788861042*^9}, {3.483712867100431*^9, 
   3.4837128759838552`*^9}, {3.483712932802442*^9, 3.483712949848173*^9}, {
   3.4837129879056473`*^9, 3.4837129883944387`*^9}, 3.4840503384043016`*^9, {
   3.485360172661951*^9, 3.485360192272628*^9}, {3.4864687552872066`*^9, 
   3.486468786089674*^9}, {3.486468934516407*^9, 3.4864689819919243`*^9}, {
   3.486469960265414*^9, 3.48646998756607*^9}, {3.551451277553227*^9, 
   3.551451309801996*^9}, {3.5514513532024307`*^9, 3.551451413073202*^9}, {
   3.551451479464472*^9, 3.5514515365454903`*^9}, {3.551451890149411*^9, 
   3.551451890200033*^9}, 3.5671748262353373`*^9, {3.6282699504521523`*^9, 
   3.62826996883504*^9}, {3.628270010485003*^9, 3.6282700448091793`*^9}, {
   3.6282704012302437`*^9, 3.628270416828353*^9}, {3.6282704833973427`*^9, 
   3.62827049263977*^9}, 3.628347252334495*^9, {3.62834734047725*^9, 
   3.628347359884639*^9}, {3.6283474042652407`*^9, 3.628347470534936*^9}, {
   3.684671601712317*^9, 3.684671602400259*^9}, {3.792429772578103*^9, 
   3.792429814006763*^9}, {3.792430017164019*^9, 3.79243006767864*^9}, {
   3.7924303706716013`*^9, 3.792430375178431*^9}, {3.7925024317436523`*^9, 
   3.7925025714999437`*^9}},ExpressionUUID->"c770fa78-aa24-4097-a7f8-\
27eea9de20b6"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"DeclareIndexFlavor", "[", 
   RowBox[{"{", 
    RowBox[{"gaugeG", ",", "Blue"}], "}"}], "]"}], 
  RowBox[{"(*", "Placeholder", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"AddBaseIndex", "[", 
  RowBox[{"{", 
   RowBox[{"gaugeG", ",", 
    RowBox[{"Range", "[", "8", "]"}]}], "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{"nonAbelianF", ",", "FFna"}], "]"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Computes", " ", "non"}], "-", 
    RowBox[{
    "abelian", " ", "gauge", " ", "boson", " ", "energy", " ", "momentum", 
     " ", "tensor", " ", 
     RowBox[{"expressions", ".", " ", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"F", ".", "F"}], " ", "lagrangian", " ", "term"}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"F", ".", "F"}], " ", "in", " ", "terms", " ", "of", " ", 
          RowBox[{"A", "'"}], 
          RowBox[{"s", ".", "\[IndentingNewLine]", "Resets"}], " ", 
          "BaseIndices", " ", "with", " ", 
          RowBox[{"Length", "[", " ", 
           RowBox[{"Flavor", "[", "gaugeG", "]"}], " ", "]"}]}], "->", 
         "groupN"}]}], "\[IndentingNewLine]"}]}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"nonAbelianF", "[", "gaugeN_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "tmp", ",", "subF", ",", "subFA", ",", "subA", ",", "sF2", ",", "FA2", 
        ",", "NgaugeR", ",", "list", ",", 
        RowBox[{"DEBUG", "=", "0"}], ",", 
        RowBox[{"mName", "=", "\"\<nonAbelianF\>\""}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"DefineTensor", "[", 
        RowBox[{"A", ",", "F", ",", "f"}], " ", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"CompleteBaseIndices", "/.", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"gaugeG", ",", "_"}], "}"}], "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"gaugeG", ",", 
            RowBox[{"Range", "[", "gaugeN", "]"}]}], "}"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"DeclareBaseIndices", "[", 
        RowBox[{"Apply", "[", 
         RowBox[{"Sequence", ",", "tmp"}], "]"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"**", " ", "Define"}], " ", "gauge", " ", "field", " ", 
         "A"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"IfDEBUG", "[", 
        RowBox[{"mName", ",", 
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"A", "@", 
          RowBox[{"ud", "[", 
           RowBox[{
            RowBox[{"gaugeG", "@", "2"}], ",", "\[Mu]"}], "]"}]}], ",", 
         "\"\<A@ud\>\""}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"**", " ", "Define"}], " ", "field", " ", "strength", " ", 
         "F"}], "  ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"subFA", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"F", "@", 
            RowBox[{"udd", "[", 
             RowBox[{
              RowBox[{"gaugeG", "@", "c_"}], ",", "\[Mu]_", ",", "\[Nu]_"}], 
             "]"}]}], "->", 
           RowBox[{
            RowBox[{"xPartialD", "[", 
             RowBox[{
              RowBox[{"A", "@", 
               RowBox[{"ud", "[", 
                RowBox[{
                 RowBox[{"gaugeG", "@", "c"}], ",", "\[Nu]"}], "]"}]}], ",", 
              "\[Mu]"}], "]"}], "-", 
            RowBox[{"xPartialD", "[", 
             RowBox[{
              RowBox[{"A", "@", 
               RowBox[{"ud", "[", 
                RowBox[{
                 RowBox[{"gaugeG", "@", "c"}], ",", "\[Mu]"}], "]"}]}], ",", 
              "\[Nu]"}], "]"}], "+", 
            RowBox[{"g", " ", 
             RowBox[{"f", "@", 
              RowBox[{"uuu", "[", 
               RowBox[{
                RowBox[{"gaugeG", "@", "a"}], ",", 
                RowBox[{"gaugeG", "@", "b"}], ",", 
                RowBox[{"gaugeG", "@", "c"}]}], "]"}]}], 
             RowBox[{"A", "@", 
              RowBox[{"ud", "[", 
               RowBox[{
                RowBox[{"gaugeG", "@", "a"}], ",", "\[Mu]"}], "]"}]}], 
             RowBox[{"A", "@", 
              RowBox[{"ud", "[", 
               RowBox[{
                RowBox[{"gaugeG", "@", "b"}], ",", "\[Nu]"}], "]"}]}]}]}]}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"F", "@", 
            RowBox[{"uuu", "[", 
             RowBox[{
              RowBox[{"gaugeG", "@", "c_"}], ",", "\[Mu]_", ",", "\[Nu]_"}], 
             "]"}]}], "->", 
           RowBox[{
            RowBox[{"xPartialDu", "[", 
             RowBox[{
              RowBox[{"A", "@", 
               RowBox[{"uu", "[", 
                RowBox[{
                 RowBox[{"gaugeG", "@", "c"}], ",", "\[Nu]"}], "]"}]}], ",", 
              "\[Mu]"}], "]"}], "-", 
            RowBox[{"xPartialDu", "[", 
             RowBox[{
              RowBox[{"A", "@", 
               RowBox[{"uu", "[", 
                RowBox[{
                 RowBox[{"gaugeG", "@", "c"}], ",", "\[Mu]"}], "]"}]}], ",", 
              "\[Nu]"}], "]"}], "+", 
            RowBox[{"g", " ", 
             RowBox[{"f", "@", 
              RowBox[{"uuu", "[", 
               RowBox[{
                RowBox[{"gaugeG", "@", "a"}], ",", 
                RowBox[{"gaugeG", "@", "b"}], ",", 
                RowBox[{"gaugeG", "@", "c"}]}], "]"}]}], 
             RowBox[{"A", "@", 
              RowBox[{"uu", "[", 
               RowBox[{
                RowBox[{"gaugeG", "@", "a"}], ",", "\[Mu]"}], "]"}]}], 
             RowBox[{"A", "@", 
              RowBox[{"uu", "[", 
               RowBox[{
                RowBox[{"gaugeG", "@", "b"}], ",", "\[Nu]"}], "]"}]}]}]}]}]}],
          "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"IfDEBUG", "[", 
        RowBox[{"mName", ",", 
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"{", "subFA", "}"}], ",", "\"\<subFA\>\""}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"**", " ", "Define"}], " ", "kinetic", " ", "term"}], "  ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"sF2", "=", 
        RowBox[{
         RowBox[{"FFna", "[", 
          RowBox[{
           RowBox[{"gaugeG", "@", "a_"}], ",", "\[Mu]_", ",", "\[Nu]_"}], 
          "]"}], "->", 
         RowBox[{
          RowBox[{"-", 
           FractionBox["1", "4"]}], 
          RowBox[{
           RowBox[{"F", "@", 
            RowBox[{"udd", "[", 
             RowBox[{
              RowBox[{"gaugeG", "@", "a"}], ",", "\[Mu]", ",", "\[Nu]"}], 
             "]"}]}], ".", 
           RowBox[{"F", "@", 
            RowBox[{"uuu", "[", 
             RowBox[{
              RowBox[{"gaugeG", "@", "a"}], ",", "\[Mu]", ",", "\[Nu]"}], 
             "]"}]}]}]}]}]}], ";", " ", "\[IndentingNewLine]", 
       RowBox[{"IfDEBUG", "[", 
        RowBox[{"mName", ",", 
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"{", "sF2", "}"}], ",", "\"\<sF2\>\""}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"FFna", "[", 
           RowBox[{
            RowBox[{"gaugeG", "@", "c"}], ",", "\[Mu]", ",", "\[Nu]"}], "]"}],
           "/.", "sF2"}], "/.", 
         RowBox[{"subFA", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "/.", 
         RowBox[{"subFA", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"DotExpandMode", "[", "True", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"tmp", "/.", "simpleDot"}], "//", "Expand"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dclTensorSymmetry", "[", 
         RowBox[{"f", ",", "3"}], "]"}], "=", 
        RowBox[{"AntiSymmetric", "[", 
         RowBox[{"1", ",", "2", ",", "3"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"list", "=", 
        RowBox[{"Apply", "[", 
         RowBox[{"List", ",", "tmp"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"list", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Swaps", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "b"}], "}"}]}], "}"}], "]"}], "[", 
          RowBox[{"list", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "//", 
         RowBox[{"SymmetrizeSlots", "[", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"list", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Swaps", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "b"}], "}"}]}], "}"}], "]"}], "[", 
          RowBox[{"list", "[", 
           RowBox[{"[", "4", "]"}], "]"}], "]"}], "//", 
         RowBox[{"SymmetrizeSlots", "[", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"list", "[", 
         RowBox[{"[", "8", "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Swaps", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "b"}], "}"}]}], "}"}], "]"}], "[", 
          RowBox[{"list", "[", 
           RowBox[{"[", "8", "]"}], "]"}], "]"}], "//", 
         RowBox[{"SymmetrizeSlots", "[", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"list", "[", 
         RowBox[{"[", "9", "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Swaps", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "b"}], "}"}]}], "}"}], "]"}], "[", 
          RowBox[{"list", "[", 
           RowBox[{"[", "9", "]"}], "]"}], "]"}], "//", 
         RowBox[{"SymmetrizeSlots", "[", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"list", "=", 
        RowBox[{"list", "/.", "simpleDot"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"list", "=", 
        RowBox[{"Apply", "[", 
         RowBox[{"Plus", ",", "list"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"list", "=", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "list"}], "]"}], "/.", "commuteDot"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"list", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"list", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "//", 
         RowBox[{"SwapUpDownIndices", "[", 
          RowBox[{"{", 
           RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"list", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"list", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "/.", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{"A_", ",", "B_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"A", "/.", 
              RowBox[{
               RowBox[{"gaugeG", "@", "a_"}], "->", 
               RowBox[{"gaugeG", "@", 
                RowBox[{"a", "[", "1", "]"}]}]}]}], ",", 
             RowBox[{"B", "/.", 
              RowBox[{
               RowBox[{"gaugeG", "@", "a_"}], "->", 
               RowBox[{"gaugeG", "@", 
                RowBox[{"a", "[", "2", "]"}]}]}]}]}], "]"}]}]}], "/.", 
         RowBox[{
          RowBox[{"gaugeG", "@", 
           RowBox[{"c", "[", "_", "]"}]}], "->", 
          RowBox[{"gaugeG", "@", "c"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"IfDEBUG", "[", 
        RowBox[{"mName", ",", 
         RowBox[{"DEBUG", ">", "0"}], ",", 
         RowBox[{"{", "list", "}"}], ",", "\"\<list\>\""}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"list", "=", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Plus", ",", "list"}], "]"}], "/.", 
         RowBox[{"Dot", "\[Rule]", "Times"}]}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"DotExpandMode", "[", "False", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"sF2", ",", "subFA", ",", "list"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"Column", "[", "\[IndentingNewLine]", 
   RowBox[{"sNAFF", "=", 
    RowBox[{"nonAbelianF", "[", "3", "]"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.47748769590289*^9, 3.477488081976946*^9}, {
   3.477488467366118*^9, 3.47748856240867*^9}, {3.4774886173547*^9, 
   3.477488689887061*^9}, {3.477488783679697*^9, 3.477488891200232*^9}, {
   3.4774890260432034`*^9, 3.477489027043998*^9}, {3.4787002770801*^9, 
   3.478700304259726*^9}, {3.478700337742271*^9, 3.4787003558857403`*^9}, {
   3.4787004081321077`*^9, 3.478700409637163*^9}, {3.478700484471265*^9, 
   3.478700493147669*^9}, {3.4787005607021103`*^9, 3.478700578013245*^9}, {
   3.478700747998646*^9, 3.4787007718227797`*^9}, {3.478700835425137*^9, 
   3.4787008361641417`*^9}, {3.478700903527666*^9, 3.478700940649012*^9}, {
   3.478701045194685*^9, 3.478701149492828*^9}, {3.478704320157867*^9, 
   3.478704323769582*^9}, {3.478704490384317*^9, 3.478704500451713*^9}, {
   3.4787045522054253`*^9, 3.478704552739633*^9}, {3.478705233192141*^9, 
   3.4787054095950947`*^9}, {3.478705491843224*^9, 3.478705535399572*^9}, {
   3.478705722452095*^9, 3.4787058649332542`*^9}, {3.478706506806182*^9, 
   3.478706521800769*^9}, {3.4787066159488497`*^9, 3.478706646976132*^9}, 
   3.478706747037608*^9, {3.4787073783542967`*^9, 3.478707402018137*^9}, {
   3.4787075434663754`*^9, 3.478707570006216*^9}, {3.478707632749713*^9, 
   3.478707656331195*^9}, 3.478707823778586*^9, 3.47870786784011*^9, {
   3.478707999361418*^9, 3.478708003258916*^9}, {3.478708033893132*^9, 
   3.478708034647367*^9}, {3.478708089257148*^9, 3.47870808942437*^9}, {
   3.478708145207407*^9, 3.478708145823763*^9}, {3.478708230618517*^9, 
   3.478708245716*^9}, {3.478708286024069*^9, 3.478708295613978*^9}, {
   3.4787085435736837`*^9, 3.47870857039248*^9}, {3.478913665609343*^9, 
   3.478913774421372*^9}, {3.48306602512379*^9, 3.483066039251102*^9}, 
   3.483066073796667*^9, {3.483066108709731*^9, 3.48306612202439*^9}, 
   3.483066175485804*^9, {3.4831114606087*^9, 3.483111467270363*^9}, {
   3.48346652079375*^9, 3.483466537376966*^9}, {3.483466593532233*^9, 
   3.483466633720793*^9}, {3.4834666644502077`*^9, 3.483466669939042*^9}, {
   3.483705685236389*^9, 3.483705691093693*^9}, 3.483705815088426*^9, {
   3.48370705050918*^9, 3.483707058055099*^9}, 3.483711896803485*^9, {
   3.4837119910682077`*^9, 3.483711991750771*^9}, 3.483712050310136*^9, {
   3.483712107723477*^9, 3.48371215135907*^9}, {3.483712190864435*^9, 
   3.4837122026970778`*^9}, {3.4837122376063747`*^9, 3.483712239165442*^9}, {
   3.483712285122829*^9, 3.4837122993194017`*^9}, 3.483712435396253*^9, {
   3.4837127868105164`*^9, 3.483712788861042*^9}, {3.483712867100431*^9, 
   3.4837128759838552`*^9}, {3.483712932802442*^9, 3.483712949848173*^9}, {
   3.4837129879056473`*^9, 3.4837129883944387`*^9}, 3.4840503384043016`*^9, {
   3.485360172661951*^9, 3.485360192272628*^9}, {3.4864687552872066`*^9, 
   3.486468786089674*^9}, {3.486468934516407*^9, 3.4864689819919243`*^9}, {
   3.486469960265414*^9, 3.48646998756607*^9}, {3.551451277553227*^9, 
   3.551451309801996*^9}, {3.5514513532024307`*^9, 3.551451413073202*^9}, {
   3.551451479464472*^9, 3.5514515365454903`*^9}, {3.551451890149411*^9, 
   3.551451890200033*^9}, 3.5671748262353373`*^9, {3.6282699504521523`*^9, 
   3.62826996883504*^9}, {3.628270010485003*^9, 3.6282700448091793`*^9}, {
   3.6282704012302437`*^9, 3.628270416828353*^9}, {3.6282704833973427`*^9, 
   3.62827049263977*^9}, 3.628347252334495*^9, {3.62834734047725*^9, 
   3.628347359884639*^9}, {3.6283474042652407`*^9, 3.628347470534936*^9}, {
   3.684671601712317*^9, 3.684671602400259*^9}, {3.792429772578103*^9, 
   3.792429814006763*^9}, {3.792430017164019*^9, 3.79243006767864*^9}, {
   3.7924303706716013`*^9, 3.792430375178431*^9}, {3.7925024317436523`*^9, 
   3.7925025714999437`*^9}},ExpressionUUID->"971b6b96-812b-43aa-bfb9-\
9a1fbb3f1bef"],

Cell[BoxData[
 RowBox[{"DeclareIndexFlavor", "[", 
  RowBox[{"{", 
   RowBox[{"gaugeG", ",", 
    InterpretationBox[
     ButtonBox[
      TooltipBox[
       GraphicsBox[{
         {GrayLevel[0], RectangleBox[{0, 0}]}, 
         {GrayLevel[0], RectangleBox[{1, -1}]}, 
         {RGBColor[0, 0, 1], RectangleBox[{0, -1}, {2, 1}]}},
        AspectRatio->1,
        DefaultBaseStyle->"ColorSwatchGraphics",
        Frame->True,
        FrameStyle->RGBColor[0., 0., 0.6666666666666666],
        FrameTicks->None,
        ImageSize->
         Dynamic[{
          Automatic, 1.35 CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
           Magnification]}],
        PlotRangePadding->None,
        ImageCache->GraphicsData["CompressedBitmap", "\<\
eJzzTSzJSM1NLMlMTlRwL0osyMhMLlZwyy8CCjEzMjAwcIGwAgOI/R/IhBJc
/4GAgYETiFcxQtgMzCAOEIM4/xlYQSTjMJJH8SsjAGgWehU=\
\>"]],
       "RGBColor[0, 0, 1]"],
      Appearance->None,
      BaseStyle->{},
      BaselinePosition->Baseline,
      ButtonFunction:>With[{Typeset`box$ = EvaluationBox[]}, 
        If[
         Not[
          AbsoluteCurrentValue["Deployed"]], 
         SelectionMove[Typeset`box$, All, Expression]; 
         FrontEnd`Private`$ColorSelectorInitialAlpha = 1; 
         FrontEnd`Private`$ColorSelectorInitialColor = RGBColor[0, 0, 1]; 
         FrontEnd`Private`$ColorSelectorUseMakeBoxes = True; 
         MathLink`CallFrontEnd[
           FrontEnd`AttachCell[Typeset`box$, 
            FrontEndResource["RGBColorValueSelector"], {0, {Left, Bottom}}, {
            Left, Top}, 
            "ClosingActions" -> {
             "SelectionDeparture", "ParentChanged", "EvaluatorQuit"}]]]],
      DefaultBaseStyle->{},
      Evaluator->Automatic,
      Method->"Preemptive"],
     RGBColor[0, 0, 1],
     Editable->False,
     Selectable->False]}], "}"}], "]"}]], "Output",
 CellChangeTimes->{
  3.552665667436974*^9, 3.552997792052054*^9, 3.553186058474865*^9, 
   3.554084579485176*^9, 3.555429885478176*^9, 3.5557780190877857`*^9, 
   3.556368719970965*^9, 3.556375761943359*^9, {3.556376973787032*^9, 
   3.556376994119143*^9}, 3.55690469213125*^9, 3.556974062069005*^9, 
   3.5569748101554213`*^9, 3.556974878094599*^9, 3.556974913021592*^9, 
   3.557076031853304*^9, 3.5589636194792557`*^9, 3.5589882813558292`*^9, 
   3.559212052187327*^9, 3.559395858174959*^9, 3.5648823621977386`*^9, {
   3.566226551022175*^9, 3.566226552707708*^9}, 3.5662692800039577`*^9, {
   3.566271127435327*^9, 3.566271149446657*^9}, 3.56717435837115*^9, 
   3.5673468319770403`*^9, 3.5684716578600883`*^9, 3.568820175346838*^9, 
   3.570206030458252*^9, 3.570842353711426*^9, 3.573225230175878*^9, 
   3.577065894685439*^9, 3.579972714503653*^9, {3.580212766924968*^9, 
   3.580212782962194*^9}, {3.5802128218506727`*^9, 3.580212823636622*^9}, 
   3.580212859645523*^9, 3.580213012849635*^9, 3.580573985764207*^9, 
   3.5805745273798933`*^9, 3.582572303554714*^9, 3.582884272670753*^9, {
   3.5831537943939247`*^9, 3.583153796084386*^9}, 3.5838530434657793`*^9, 
   3.585144488524762*^9, 3.5884210816425667`*^9, 3.590540982734951*^9, 
   3.593918765895804*^9, 3.596205466618565*^9, 3.597533863733087*^9, 
   3.5976357249755297`*^9, 3.597635980143879*^9, 3.600109616706399*^9, 
   3.602946178455658*^9, 3.604077750260817*^9, 3.606480752537363*^9, 
   3.607447651701108*^9, 3.6082191771007357`*^9, 3.608994966692976*^9, 
   3.60970468787847*^9, 3.6114087703805847`*^9, 3.615478588878859*^9, 
   3.62014418910819*^9, 3.620397380908106*^9, {3.6203981200399237`*^9, 
   3.620398125707468*^9}, {3.620398925349059*^9, 3.620398931862318*^9}, 
   3.6203989798088713`*^9, 3.620500594274272*^9, 3.620568666704718*^9, 
   3.620999765011112*^9, 3.621342771987961*^9, 3.6216024763831*^9, 
   3.626275956205662*^9, 3.626971027504203*^9, 3.627063164664135*^9, 
   3.628866557772627*^9, 3.6310354930006857`*^9, {3.631375872402239*^9, 
   3.631375881077227*^9}, 3.631453857318288*^9, {3.631800805499748*^9, 
   3.631800807978109*^9}, 3.6318008423031683`*^9, 3.6334627669524612`*^9, {
   3.6334628032915077`*^9, 3.6334628224122143`*^9}, 3.634309614251446*^9, 
   3.634310215666637*^9, 3.6352625514676228`*^9, 3.6358593210459023`*^9, 
   3.638886123822068*^9, 3.6419085697399063`*^9, 3.643670100665887*^9, 
   3.643683389356538*^9, 3.644023127460252*^9, 3.655056479876953*^9, 
   3.6559939348206367`*^9, 3.656123974499569*^9, 3.656382546134591*^9, 
   3.656597842539706*^9, 3.661018131135889*^9, 3.663425311491467*^9, 
   3.664641246752192*^9, 3.666499661283496*^9, 3.667573751410742*^9, 
   3.6724462767981653`*^9, 3.672446309014545*^9, {3.695141640120699*^9, 
   3.695141663258*^9}, 3.7350899455059433`*^9, 3.7449730706444283`*^9, 
   3.799589237136571*^9, 
   3.799589276735886*^9},ExpressionUUID->"7a074377-317e-41e4-98c9-\
8413c67db62e"],

Cell[BoxData["CompleteBaseIndices"], "Output",
 CellChangeTimes->{
  3.552665667436974*^9, 3.552997792052054*^9, 3.553186058474865*^9, 
   3.554084579485176*^9, 3.555429885478176*^9, 3.5557780190877857`*^9, 
   3.556368719970965*^9, 3.556375761943359*^9, {3.556376973787032*^9, 
   3.556376994119143*^9}, 3.55690469213125*^9, 3.556974062069005*^9, 
   3.5569748101554213`*^9, 3.556974878094599*^9, 3.556974913021592*^9, 
   3.557076031853304*^9, 3.5589636194792557`*^9, 3.5589882813558292`*^9, 
   3.559212052187327*^9, 3.559395858174959*^9, 3.5648823621977386`*^9, {
   3.566226551022175*^9, 3.566226552707708*^9}, 3.5662692800039577`*^9, {
   3.566271127435327*^9, 3.566271149446657*^9}, 3.56717435837115*^9, 
   3.5673468319770403`*^9, 3.5684716578600883`*^9, 3.568820175346838*^9, 
   3.570206030458252*^9, 3.570842353711426*^9, 3.573225230175878*^9, 
   3.577065894685439*^9, 3.579972714503653*^9, {3.580212766924968*^9, 
   3.580212782962194*^9}, {3.5802128218506727`*^9, 3.580212823636622*^9}, 
   3.580212859645523*^9, 3.580213012849635*^9, 3.580573985764207*^9, 
   3.5805745273798933`*^9, 3.582572303554714*^9, 3.582884272670753*^9, {
   3.5831537943939247`*^9, 3.583153796084386*^9}, 3.5838530434657793`*^9, 
   3.585144488524762*^9, 3.5884210816425667`*^9, 3.590540982734951*^9, 
   3.593918765895804*^9, 3.596205466618565*^9, 3.597533863733087*^9, 
   3.5976357249755297`*^9, 3.597635980143879*^9, 3.600109616706399*^9, 
   3.602946178455658*^9, 3.604077750260817*^9, 3.606480752537363*^9, 
   3.607447651701108*^9, 3.6082191771007357`*^9, 3.608994966692976*^9, 
   3.60970468787847*^9, 3.6114087703805847`*^9, 3.615478588878859*^9, 
   3.62014418910819*^9, 3.620397380908106*^9, {3.6203981200399237`*^9, 
   3.620398125707468*^9}, {3.620398925349059*^9, 3.620398931862318*^9}, 
   3.6203989798088713`*^9, 3.620500594274272*^9, 3.620568666704718*^9, 
   3.620999765011112*^9, 3.621342771987961*^9, 3.6216024763831*^9, 
   3.626275956205662*^9, 3.626971027504203*^9, 3.627063164664135*^9, 
   3.628866557772627*^9, 3.6310354930006857`*^9, {3.631375872402239*^9, 
   3.631375881077227*^9}, 3.631453857318288*^9, {3.631800805499748*^9, 
   3.631800807978109*^9}, 3.6318008423031683`*^9, 3.6334627669524612`*^9, {
   3.6334628032915077`*^9, 3.6334628224122143`*^9}, 3.634309614251446*^9, 
   3.634310215666637*^9, 3.6352625514676228`*^9, 3.6358593210459023`*^9, 
   3.638886123822068*^9, 3.6419085697399063`*^9, 3.643670100665887*^9, 
   3.643683389356538*^9, 3.644023127460252*^9, 3.655056479876953*^9, 
   3.6559939348206367`*^9, 3.656123974499569*^9, 3.656382546134591*^9, 
   3.656597842539706*^9, 3.661018131135889*^9, 3.663425311491467*^9, 
   3.664641246752192*^9, 3.666499661283496*^9, 3.667573751410742*^9, 
   3.6724462767981653`*^9, 3.672446309014545*^9, {3.695141640120699*^9, 
   3.695141663258*^9}, 3.7350899455059433`*^9, 3.7449730706444283`*^9, 
   3.799589237136571*^9, 
   3.7995892768515673`*^9},ExpressionUUID->"5af246bd-680d-4321-848e-\
6e487a9b37cf"]
}, Open  ]],

Cell["xPartialD routines", "Text",
 CellChangeTimes->{{3.47855132833631*^9, 3.478551336207296*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
     "Simplifies", " ", "xPartialD", " ", "in", " ", "exp_", " ", "based", 
      " ", "upon", " ", "list", " ", "of", " ", 
      RowBox[{"constants_", " ", ".", "  ", "Only"}], " ", "extracts", " ", 
      "multiplicative", " ", 
      RowBox[{"constants", ".", "\[IndentingNewLine]", "NOT"}], " ", 
      "FINISHED"}], " ", "->", " ", "use"}], " ", "/.", 
    RowBox[{"xPartialDExpand", "[", "]"}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"PartialDSimplify", "[", 
      RowBox[{"exp_", ",", "constants_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", 
         RowBox[{"tmp0", "=", "Null"}], ",", "pos", ",", "xpart", ",", "arg", 
         ",", "dx", ",", "i"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp0", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "//.", 
             RowBox[{"xPartialDExpand", "[", "constants", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"OP", ":", 
                 RowBox[{"xPartialD", "|", "xPartialDu"}]}], ")"}], "[", 
               RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
              RowBox[{"0", "/;", 
               RowBox[{"MemberQ", "[", 
                RowBox[{"constants", ",", "a"}], "]"}]}]}]}]}]}]}], 
         RowBox[{"(*", 
          RowBox[{";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"xPartialD", "[", 
               RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
              RowBox[{"0", "/;", 
               RowBox[{"MemberQ", "[", 
                RowBox[{"constants", ",", "a"}], "]"}]}]}]}]}], ";", "  ", 
           RowBox[{"(*", "XXX", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"xPartialDu", "[", 
               RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
              RowBox[{"0", "/;", 
               RowBox[{"MemberQ", "[", 
                RowBox[{"constants", ",", "a"}], "]"}]}]}]}]}]}], "  ", 
          RowBox[{"(*", "XXX", "*)"}], "\[IndentingNewLine]", "*)"}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Rules", " ", "for", " ", "applying", " ", 
      RowBox[{"D", "[", ",", "]"}], " ", "instead", " ", "of", " ", 
      RowBox[{
       RowBox[{"xPartialD", "[", ",", "]"}], ".", "  ", 
       RowBox[{"Usage", ":", " ", "exp"}]}]}], "/.", 
     RowBox[{"xPartialD2D", "[", 
      RowBox[{"1", ",", "x"}], "]"}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"xPartialD2D", "[", 
       RowBox[{"mu_", ",", "x_"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", "=", 
         RowBox[{"Hold", "[", "exp", "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", 
          RowBox[{
           RowBox[{"xPartialD", "|", "xPartialDu"}], "->", "D"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "//", "ReleaseHold"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], 
   RowBox[{
    RowBox[{
     RowBox[{"tuDerivOps2D", "::", "usage"}], "=", 
     "\"\<tuDerivOps2D[exp_] simply converts DerivOps into D expressions. \
*9Sep2015*13Jul2017*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuDerivOps2D", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"exp", "//.", 
          RowBox[{
           RowBox[{"DerivOps", "[", "a__", "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Inactive", "[", "D", "]"}], "[", "a", "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Activate", "[", 
         RowBox[{"$", ",", "D"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "TEST", "*)"}], 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"$", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"tuDPartialu", "[", 
         RowBox[{
          RowBox[{"\[Chi]", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"u", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"\[Beta]", "[", "1", "]"}], "}"}]}], "]"}], "[", 
             "\[Gamma]", "]"}], ",", 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"u", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"\[Beta]", "[", "2", "]"}], "}"}]}], "]"}], "[", 
             "\[Gamma]", "]"}], ",", 
            RowBox[{"tuDPartial", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"u", ",", "\"\<u\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Beta]", "[", "3", "]"}], "}"}]}], "]"}], "[", 
               "\[Gamma]", "]"}], ",", "\[Gamma]"}], "]"}], ",", 
            RowBox[{"tuDPartial", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"u", ",", "\"\<d\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"\[Beta]", "[", "4", "]"}], "}"}]}], "]"}], "[", 
               "\[Gamma]", "]"}], ",", "\[Gamma]"}], "]"}]}], "]"}], ",", 
          "\[Gamma]"}], "]"}], "\[IndentingNewLine]", "$"}], "=", 
       RowBox[{"$", "//", "tuDerivOps2D"}]}]}], ";", 
     RowBox[{
      RowBox[{"$", "//", 
       RowBox[{"ColumnSumExp", "\[IndentingNewLine]", "$"}]}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"$", "//", 
         RowBox[{"tuD2tuDOp", "[", "tuDPartialu", "]"}]}], "//", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#", "/.", 
           RowBox[{
            RowBox[{"\[Chi]", "[", "__", "]"}], "\[Rule]", "\[Chi]"}]}], 
          "&"}], ")"}]}], "//", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "/.", 
          RowBox[{
           RowBox[{"a_", "[", "\[Gamma]", "]"}], "\[Rule]", "a"}]}], "&"}], 
        ")"}]}]}], ";", 
     RowBox[{"$", "//", "ColumnSumExp"}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Rules", " ", "that", " ", "transform", " ", 
      RowBox[{"{", 
       RowBox[{"xPartialD", ",", "xPartialDu"}], "}"}], " ", "to", " ", 
      "Tensorial", " ", "\[PartialD]"}], ":", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"xPartialD", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], "->", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\"\<\[PartialD]\>\"", ",", "\"\<d\>\""}], "]"}], "[", 
           "b", "]"}], "[", "a", "]"}]}], ",", 
        RowBox[{
         RowBox[{"xPartialDu", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], "->", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\"\<\[PartialD]\>\"", ",", "\"\<u\>\""}], "]"}], "[", 
           "b", "]"}], "[", "a", "]"}]}]}], "}"}], "\[IndentingNewLine]", " ",
       "7", "Apr2012"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"xPartialD2Dupdn", "[", 
          RowBox[{"var_List", ",", "field_List"}], "]"}], "[", "exp_", "]"}], 
        " ", "converts", " ", "Tensor", " ", "exp_", " ", "indices", " ", 
        "into", " ", 
        RowBox[{"functional", "[", 
         RowBox[{"var_", "[", 
          RowBox[{"up", "|", "dn"}], "]"}], "]"}], " ", "where", " ", 
        RowBox[{"{", 
         RowBox[{"up", ",", "dn"}], "}"}], " ", "indicates", " ", "the", " ", 
        "position", " ", "of", " ", "the", " ", 
        RowBox[{"indices", ".", "  ", "The"}], " ", "field_List", " ", 
        RowBox[{"(", 
         RowBox[{"Patterns", " ", "OK"}], ")"}], " ", "contains", " ", "the", 
        " ", "Tensor", " ", "fields", " ", "that", " ", "are", " ", 
        "functions", " ", "of", " ", 
        RowBox[{
         RowBox[{"var_List", "[", 
          RowBox[{"up", "|", "dn"}], "]"}], ".", "  ", "The"}], " ", "fields",
         " ", "can", " ", "have", " ", "Patterns", " ", "as", " ", "indices", 
        " ", "to", " ", "encompass", " ", "a", " ", "more", " ", "general", 
        " ", "set", " ", "of", " ", 
        RowBox[{"fields", ".", "  ", "This"}], " ", "is", " ", "useful", " ", 
        "when", " ", "we", " ", "want", " ", "to", " ", "use", " ", "the", 
        " ", "D", " ", "operation", " ", "in", " ", "exp_", " ", "where", " ",
         "the", " ", "notation", " ", "is", " ", "in", " ", "xPartialD"}], 
       " ", "&"}], " ", "xPartialDu"}], ",", " ", 
     RowBox[{
      RowBox[{"Tensor", ".", "  ", "Used"}], " ", "to", " ", "compute", " ", 
      "EulerEquation", " ", "in", " ", "Tensor", " ", "notation"}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"e", ".", "g", "."}], ",", "\[IndentingNewLine]", 
     RowBox[{"tmp", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"xPartialD", "[", 
         RowBox[{
          RowBox[{"xPartialDu", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"A", "@", 
              RowBox[{"ud", "[", 
               RowBox[{"a", ",", "b"}], "]"}]}], " ", 
             RowBox[{"A", "@", 
              RowBox[{"uu", "[", 
               RowBox[{"c", ",", "d"}], "]"}]}]}], ",", " ", "e"}], "]"}], 
          ",", "e"}], "]"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"xPartialD2Dupdn", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"e", ",", "\[Nu]"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"A", "@", 
              RowBox[{"ud", "[", 
               RowBox[{"a", ",", "\[Mu]_"}], "]"}]}], ",", 
             RowBox[{"A", "@", 
              RowBox[{"uu", "[", 
               RowBox[{"\[Nu]_", ",", "a_"}], "]"}]}]}], "}"}]}], "]"}], "[", 
         " ", "tmp", " ", "]"}]}], "\[IndentingNewLine]", "=", 
       RowBox[{">", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             InterpretationBox[
              SubsuperscriptBox["A", 
               StyleBox[
                RowBox[{"c", "e"}],
                StripOnInput->False,
                ShowContents->False], 
               RowBox[{"c", "e"}]],
              
              TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`c, $CellContext`e}, {
               TensorCalculus4V6`Tensorial`Void, 
                TensorCalculus4V6`Tensorial`Void}],
              BaseStyle->{AutoMultiplicationSymbol -> False},
              Editable->False], ")"}], 
            TagBox[
             RowBox[{"(", 
              RowBox[{"0", ",", "1", ",", "0", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{
            RowBox[{"e", "[", "up", "]"}], ",", 
            RowBox[{"e", "[", "dn", "]"}], ",", 
            RowBox[{"c", "[", "up", "]"}], ",", 
            RowBox[{"c", "[", "dn", "]"}]}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             InterpretationBox[
              SubsuperscriptBox["A", 
               RowBox[{
                StyleBox["a",
                 StripOnInput->False,
                 ShowContents->False], "b"}], 
               RowBox[{"a", 
                StyleBox["b",
                 StripOnInput->False,
                 ShowContents->False]}]],
              
              TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`a, TensorCalculus4V6`Tensorial`Void}, {
               TensorCalculus4V6`Tensorial`Void, $CellContext`b}],
              BaseStyle->{AutoMultiplicationSymbol -> False},
              Editable->False], ")"}], 
            TagBox[
             RowBox[{"(", 
              RowBox[{"1", ",", "0", ",", "0", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{
            RowBox[{"e", "[", "up", "]"}], ",", 
            RowBox[{"e", "[", "dn", "]"}], ",", 
            RowBox[{"\[Nu]", "[", "up", "]"}], ",", 
            RowBox[{"\[Nu]", "[", "dn", "]"}]}], "]"}]}], "+", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             InterpretationBox[
              SubsuperscriptBox["A", 
               RowBox[{
                StyleBox["a",
                 StripOnInput->False,
                 ShowContents->False], "b"}], 
               RowBox[{"a", 
                StyleBox["b",
                 StripOnInput->False,
                 ShowContents->False]}]],
              
              TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`a, TensorCalculus4V6`Tensorial`Void}, {
               TensorCalculus4V6`Tensorial`Void, $CellContext`b}],
              BaseStyle->{AutoMultiplicationSymbol -> False},
              Editable->False], ")"}], 
            TagBox[
             RowBox[{"(", 
              RowBox[{"0", ",", "1", ",", "0", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{
            RowBox[{"e", "[", "up", "]"}], ",", 
            RowBox[{"e", "[", "dn", "]"}], ",", 
            RowBox[{"\[Nu]", "[", "up", "]"}], ",", 
            RowBox[{"\[Nu]", "[", "dn", "]"}]}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             InterpretationBox[
              SubsuperscriptBox["A", 
               StyleBox[
                RowBox[{"c", "e"}],
                StripOnInput->False,
                ShowContents->False], 
               RowBox[{"c", "e"}]],
              
              TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`c, $CellContext`e}, {
               TensorCalculus4V6`Tensorial`Void, 
                TensorCalculus4V6`Tensorial`Void}],
              BaseStyle->{AutoMultiplicationSymbol -> False},
              Editable->False], ")"}], 
            TagBox[
             RowBox[{"(", 
              RowBox[{"1", ",", "0", ",", "0", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{
            RowBox[{"e", "[", "up", "]"}], ",", 
            RowBox[{"e", "[", "dn", "]"}], ",", 
            RowBox[{"c", "[", "up", "]"}], ",", 
            RowBox[{"c", "[", "dn", "]"}]}], "]"}]}], "+", 
         RowBox[{
          RowBox[{
           InterpretationBox[
            SubsuperscriptBox["A", 
             StyleBox[
              RowBox[{"c", "e"}],
              StripOnInput->False,
              ShowContents->False], 
             RowBox[{"c", "e"}]],
            
            TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`c, $CellContext`e}, {
             TensorCalculus4V6`Tensorial`Void, 
              TensorCalculus4V6`Tensorial`Void}],
            BaseStyle->{AutoMultiplicationSymbol -> False},
            Editable->False], "[", 
           RowBox[{
            RowBox[{"e", "[", "up", "]"}], ",", 
            RowBox[{"e", "[", "dn", "]"}], ",", 
            RowBox[{"c", "[", "up", "]"}], ",", 
            RowBox[{"c", "[", "dn", "]"}]}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             InterpretationBox[
              SubsuperscriptBox["A", 
               RowBox[{
                StyleBox["a",
                 StripOnInput->False,
                 ShowContents->False], "b"}], 
               RowBox[{"a", 
                StyleBox["b",
                 StripOnInput->False,
                 ShowContents->False]}]],
              
              TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`a, TensorCalculus4V6`Tensorial`Void}, {
               TensorCalculus4V6`Tensorial`Void, $CellContext`b}],
              BaseStyle->{AutoMultiplicationSymbol -> False},
              Editable->False], ")"}], 
            TagBox[
             RowBox[{"(", 
              RowBox[{"1", ",", "1", ",", "0", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{
            RowBox[{"e", "[", "up", "]"}], ",", 
            RowBox[{"e", "[", "dn", "]"}], ",", 
            RowBox[{"\[Nu]", "[", "up", "]"}], ",", 
            RowBox[{"\[Nu]", "[", "dn", "]"}]}], "]"}]}], "+", 
         RowBox[{
          RowBox[{
           InterpretationBox[
            SubsuperscriptBox["A", 
             RowBox[{
              StyleBox["a",
               StripOnInput->False,
               ShowContents->False], "b"}], 
             RowBox[{"a", 
              StyleBox["b",
               StripOnInput->False,
               ShowContents->False]}]],
            
            TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`a, TensorCalculus4V6`Tensorial`Void}, {
             TensorCalculus4V6`Tensorial`Void, $CellContext`b}],
            BaseStyle->{AutoMultiplicationSymbol -> False},
            Editable->False], "[", 
           RowBox[{
            RowBox[{"e", "[", "up", "]"}], ",", 
            RowBox[{"e", "[", "dn", "]"}], ",", 
            RowBox[{"\[Nu]", "[", "up", "]"}], ",", 
            RowBox[{"\[Nu]", "[", "dn", "]"}]}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             InterpretationBox[
              SubsuperscriptBox["A", 
               StyleBox[
                RowBox[{"c", "e"}],
                StripOnInput->False,
                ShowContents->False], 
               RowBox[{"c", "e"}]],
              
              TensorCalculus4V6`Tensorial`Tensor[$CellContext`A, \
{$CellContext`c, $CellContext`e}, {
               TensorCalculus4V6`Tensorial`Void, 
                TensorCalculus4V6`Tensorial`Void}],
              BaseStyle->{AutoMultiplicationSymbol -> False},
              Editable->False], ")"}], 
            TagBox[
             RowBox[{"(", 
              RowBox[{"1", ",", "1", ",", "0", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{
            RowBox[{"e", "[", "up", "]"}], ",", 
            RowBox[{"e", "[", "dn", "]"}], ",", 
            RowBox[{"c", "[", "up", "]"}], ",", 
            RowBox[{"c", "[", "dn", "]"}]}], "]"}], "\[IndentingNewLine]", 
          "*", "2", "Jan2014"}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"xPartialD2Dupdn", "[", 
       RowBox[{"var_List", ",", "field_List"}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sub", ",", 
         RowBox[{"tmp", "=", "exp"}], ",", 
         RowBox[{"vars", "=", 
          RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"vars", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Append", "[", 
              RowBox[{"vars", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"#", "[", "up", "]"}], ",", 
                 RowBox[{"#", "[", "dn", "]"}]}], "}"}]}], "]"}], "&"}], ",", 
            "var"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"sub", "=", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", "\[Rule]", 
               RowBox[{"Apply", "[", 
                RowBox[{
                 RowBox[{"RemovePatterns", "[", "#", "]"}], ",", "vars"}], 
                "]"}]}], "}"}], "&"}], ",", 
            RowBox[{"DeleteDuplicates", "[", "field", "]"}]}], "]"}], "//", 
          "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<sub:\>\"", ",", "sub"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", "sub"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tmp:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sub", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"xPartialD", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"xD", "[", 
              RowBox[{"a", ",", 
               RowBox[{"b", "[", "dn", "]"}]}], "]"}], "/;", 
             RowBox[{"!", 
              RowBox[{"FreeQ", "[", 
               RowBox[{"a", ",", 
                RowBox[{"up", "|", "dn"}]}], "]"}]}]}]}], ",", 
           RowBox[{
            RowBox[{"xPartialDu", "[", 
             RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"xD", "[", 
              RowBox[{"a", ",", 
               RowBox[{"b", "[", "up", "]"}]}], "]"}], "/;", 
             RowBox[{"!", 
              RowBox[{"FreeQ", "[", 
               RowBox[{"a", ",", 
                RowBox[{"up", "|", "dn"}]}], "]"}]}]}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<sub:\>\"", ",", "sub"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", "sub"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<tmp:\>\"", ",", "tmp"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", 
          RowBox[{"xD", "\[Rule]", "D"}]}]}], ";", "\[IndentingNewLine]", 
        "tmp"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "CombineDeriv", " ", "Rules", " ", "for", " ", "combining", " ", "sum", 
     " ", "and", " ", "differences", " ", "of", " ", "Deriv", " ", "s", "*", 
     "31", "August2012"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"CombineDeriv", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "DerivOps"}], ")"}], "[", 
         RowBox[{"a_", ",", "b_"}], "]"}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "DerivOps"}], ")"}], "[", 
         RowBox[{"c_", ",", "b_"}], "]"}]}], "->", 
       RowBox[{"op", "[", 
        RowBox[{
         RowBox[{"a", "+", "c"}], ",", "b"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "DerivOps"}], ")"}], "[", 
         RowBox[{"a_", ",", "b_"}], "]"}], "-", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "DerivOps"}], ")"}], "[", 
         RowBox[{"c_", ",", "b_"}], "]"}]}], "->", 
       RowBox[{"op", "[", 
        RowBox[{
         RowBox[{"a", "-", "c"}], ",", "b"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "DerivOps"}], ")"}], "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], "c_"}], "+", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "DerivOps"}], ")"}], "[", 
          RowBox[{"c_", ",", "b_"}], "]"}], "a_"}]}], "->", 
       RowBox[{"op", "[", 
        RowBox[{
         RowBox[{"a", " ", "c"}], ",", "b"}], "]"}]}]}], 
     RowBox[{"(*", 
      RowBox[{"inverse", " ", "chain", " ", "rule"}], "*)"}], 
     "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuEulerPartials", "::", "usage"}], "=", 
     "\"\<tuEulerPartials are Rule[]s that handle tuDPartial's that result \
from tuEulerLagrangeTensor which are not handled properly, e.g., \
ConjugateTranspose[] that result from work with EulerLagrange equations.  \
*2Apr2014* *7Mar2019*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuEulerPartials", ":=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartial", "[", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"s_", ",", "\"\<d\>\"", ",", 
              RowBox[{"{", "a_", "}"}]}], "]"}], ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartial", "[", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"s_", ",", "\"\<d\>\"", ",", 
              RowBox[{"{", "c_", "}"}]}], "]"}], ",", "b_"}], "]"}]}], "]"}], 
        ":>", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Delta]", ",", "\"\<du\>\""}], "]"}], "[", 
         RowBox[{"a", ",", "c"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartial", "[", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"s_", ",", "\"\<u\>\"", ",", 
              RowBox[{"{", "a_", "}"}]}], "]"}], ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartial", "[", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"s_", ",", "\"\<u\>\"", ",", 
              RowBox[{"{", "c_", "}"}]}], "]"}], ",", "b_"}], "]"}]}], "]"}], 
        ":>", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Delta]", ",", "\"\<ud\>\""}], "]"}], "[", 
         RowBox[{"a", ",", "c"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartialu", "[", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"s_", ",", "\"\<d\>\"", ",", 
              RowBox[{"{", "a_", "}"}]}], "]"}], ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartialu", "[", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"s_", ",", "\"\<d\>\"", ",", 
              RowBox[{"{", "c_", "}"}]}], "]"}], ",", "b_"}], "]"}]}], "]"}], 
        ":>", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Delta]", ",", "\"\<du\>\""}], "]"}], "[", 
         RowBox[{"a", ",", "c"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartialu", "[", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"s_", ",", "\"\<u\>\"", ",", 
              RowBox[{"{", "a_", "}"}]}], "]"}], ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartialu", "[", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"s_", ",", "\"\<u\>\"", ",", 
              RowBox[{"{", "c_", "}"}]}], "]"}], ",", "b_"}], "]"}]}], "]"}], 
        ":>", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Delta]", ",", "\"\<ud\>\""}], "]"}], "[", 
         RowBox[{"a", ",", "c"}], "]"}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartialu", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartialu", "[", 
           RowBox[{"a_", ",", "d_"}], "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Delta]", ",", "\"\<ud\>\""}], "]"}], "[", 
         RowBox[{"b", ",", "d"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartialu", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartial", "[", 
           RowBox[{"a_", ",", "d_"}], "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Delta]", ",", "\"\<uu\>\""}], "]"}], "[", 
         RowBox[{"b", ",", "d"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartial", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartialu", "[", 
           RowBox[{"a_", ",", "d_"}], "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Delta]", ",", "\"\<dd\>\""}], "]"}], "[", 
         RowBox[{"b", ",", "d"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartial", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartial", "[", 
           RowBox[{"a_", ",", "d_"}], "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Delta]", ",", "\"\<du\>\""}], "]"}], "[", 
         RowBox[{"b", ",", "d"}], "]"}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartialu", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartial", "[", 
           RowBox[{"c_", ",", "d_"}], "]"}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{"a", "=!=", "c"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartial", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartial", "[", 
           RowBox[{"c_", ",", "d_"}], "]"}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{"a", "=!=", "c"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartialu", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartialu", "[", 
           RowBox[{"c_", ",", "d_"}], "]"}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{"a", "=!=", "c"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"tuDPartial", "[", 
           RowBox[{"a_", ",", "b_"}], "]"}], ",", 
          RowBox[{"tuDPartialu", "[", 
           RowBox[{"c_", ",", "d_"}], "]"}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{"a", "=!=", "c"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartial", "[", 
         RowBox[{"a_", ",", 
          RowBox[{
           RowBox[{"tuDPartial", "[", 
            RowBox[{"b_", ",", "d_"}], "]"}], "|", 
           RowBox[{"tuDPartialu", "[", 
            RowBox[{"b_", ",", "d_"}], "]"}]}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{"tuHasNoneQ", "[", 
          RowBox[{"a", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"tuDUp", "[", "\"\<\[PartialD]\>\"", "]"}], "[", "__", 
              "]"}], ",", 
             RowBox[{
              RowBox[{"tuDDown", "[", "\"\<\[PartialD]\>\"", "]"}], "[", "__",
               "]"}]}], "}"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartialu", "[", 
         RowBox[{"a_", ",", 
          RowBox[{
           RowBox[{"tuDPartial", "[", 
            RowBox[{"b_", ",", "d_"}], "]"}], "|", 
           RowBox[{"tuDPartialu", "[", 
            RowBox[{"b_", ",", "d_"}], "]"}]}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{"tuHasNoneQ", "[", 
          RowBox[{"a", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"tuDUp", "[", "\"\<\[PartialD]\>\"", "]"}], "[", "__", 
              "]"}], ",", 
             RowBox[{
              RowBox[{"tuDDown", "[", "\"\<\[PartialD]\>\"", "]"}], "[", "__",
               "]"}]}], "}"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"tuDPartial", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], 
         RowBox[{"tuDPartialu", "[", 
          RowBox[{
           RowBox[{"ccc", ":", 
            RowBox[{"ConjugateTranspose", "|", "Det", "|", "OverBar"}]}], ",",
            "a_"}], "]"}]}], "\[Rule]", 
        RowBox[{"tuDPartial", "[", 
         RowBox[{
          RowBox[{"ccc", "[", "a", "]"}], ",", "b"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tuDPartialu", "[", 
         RowBox[{
          RowBox[{"ccc", ":", 
           RowBox[{"ConjugateTranspose", "|", "Det"}]}], ",", "a_"}], "]"}], 
        "\[Rule]", 
        RowBox[{"ccc", "[", 
         SubscriptBox["1", "dim"], "]"}]}]}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuEulerPartialsDot", "::", "usage"}], "=", 
     "\"\<tuEulerPartialsDot are Rules that fix the EulerLagrange output when \
the tuDPartialu[ConjugateTranspose|Det|OverBar,_] terms appears in Dot[]ed \
term. May need to apply twice since the order of Replacement is ambiguous. \
*19Apr20-19*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuEulerPartialsDot", ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"pp", ":", "productOps"}], ")"}], "[", 
         RowBox[{"a___", ",", 
          RowBox[{"b", ":", " ", 
           RowBox[{"tuDPartialu", "[", 
            RowBox[{
             RowBox[{"ccc", ":", 
              RowBox[{"ConjugateTranspose", "|", "Det", "|", "OverBar"}]}], 
             ",", "ii_"}], "]"}]}], ",", "c___"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"(", 
         RowBox[{"pp", "[", 
          RowBox[{"a", ",", 
           RowBox[{
            RowBox[{"First", "[", 
             RowBox[{
              RowBox[{"tuExtractPattern", "[", 
               RowBox[{"tuDPartial", "[", 
                RowBox[{"ii", ",", "_"}], "]"}], "]"}], "[", 
              RowBox[{"{", 
               RowBox[{"a", ",", "c"}], "}"}], "]"}], "]"}], "/.", 
            RowBox[{
             RowBox[{"tuDPartial", "[", 
              RowBox[{"ii", ",", "s_"}], "]"}], "\[Rule]", 
             RowBox[{"xx$", "[", 
              RowBox[{"tuDPartial", "[", 
               RowBox[{
                RowBox[{"ccc", "[", "ii", "]"}], ",", "s"}], "]"}], "]"}]}]}],
            ",", "\[IndentingNewLine]", "c"}], "]"}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"pp", ":", "productOps"}], ")"}], "[", 
         RowBox[{"a___", ",", " ", 
          RowBox[{"xx$", "[", 
           RowBox[{"bb", ":", 
            RowBox[{"(", 
             RowBox[{"tuDPartial", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"ccc", ":", 
                  RowBox[{
                  "ConjugateTranspose", "|", "Det", "|", "OverBar"}]}], ")"}],
                 "[", "b_", "]"}], ",", "s_"}], "]"}], ")"}]}], "]"}], ",", 
          "\[IndentingNewLine]", "c___"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"pp", "[", 
           RowBox[{"a", ",", "bb", ",", "c"}], "]"}], "/.", 
          RowBox[{
           RowBox[{"tuDPartial", "[", 
            RowBox[{"b", ",", "s"}], "]"}], "\[Rule]", "1"}]}], ")"}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"lagrangexPartialD", ":=", "tuEulerPartials", 
    RowBox[{"(*", "compatibility", "*)"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.478551389706888*^9, 3.4785515358116007`*^9}, {
   3.4785516345704823`*^9, 3.4785517669765177`*^9}, {3.478554043998272*^9, 
   3.478554339247868*^9}, {3.478554398304984*^9, 3.478554477654948*^9}, {
   3.478554542328661*^9, 3.478554545550701*^9}, {3.47855460428652*^9, 
   3.478554639236051*^9}, {3.478554689420269*^9, 3.4785548143426943`*^9}, {
   3.478555391167883*^9, 3.4785553956073217`*^9}, {3.478608930572361*^9, 
   3.47860896388291*^9}, {3.478609018852754*^9, 3.478609036893507*^9}, {
   3.478609133049045*^9, 3.478609222376202*^9}, {3.478613014580678*^9, 
   3.478613108342133*^9}, {3.478740282173703*^9, 3.478740285293358*^9}, {
   3.478740333303894*^9, 3.478740335044236*^9}, {3.4787405627042027`*^9, 
   3.4787405675456753`*^9}, {3.478740599319392*^9, 3.478740636785309*^9}, {
   3.478795756125477*^9, 3.478795757586532*^9}, {3.478795830521118*^9, 
   3.4787958332656183`*^9}, {3.478796072376257*^9, 3.478796216606846*^9}, {
   3.478796306170896*^9, 3.47879634649895*^9}, {3.478796720618372*^9, 
   3.478796721592349*^9}, {3.4787970036279078`*^9, 3.4787970649695044`*^9}, 
   3.478797481237751*^9, {3.478797620342938*^9, 3.47879764317006*^9}, {
   3.4787976877044287`*^9, 3.478797696291999*^9}, {3.478797928944718*^9, 
   3.478797954325674*^9}, {3.478798043935894*^9, 3.478798099631764*^9}, {
   3.4787982649822397`*^9, 3.478798343911577*^9}, {3.478865371139368*^9, 
   3.478865375551931*^9}, 3.4788656422976923`*^9, {3.4788656889429703`*^9, 
   3.478865696419318*^9}, {3.478866658479106*^9, 3.478866673281382*^9}, 
   3.479306077069529*^9, {3.482150330181652*^9, 3.482150392536244*^9}, {
   3.4821526207544518`*^9, 3.4821526212173*^9}, {3.482425615697535*^9, 
   3.482425652873488*^9}, {3.482425807694729*^9, 3.482425808162942*^9}, {
   3.483890105781703*^9, 3.483890106580196*^9}, {3.483890150448735*^9, 
   3.48389015092092*^9}, {3.483890399242186*^9, 3.483890408757266*^9}, {
   3.485801106492999*^9, 3.485801115164288*^9}, 3.485801876389031*^9, 
   3.485801935736408*^9, {3.4864330612027073`*^9, 3.486433070025606*^9}, {
   3.486434304046398*^9, 3.4864343061731358`*^9}, {3.54280868479506*^9, 
   3.54280881016145*^9}, {3.543267944238566*^9, 3.543268261808578*^9}, {
   3.543268291923558*^9, 3.5432683303121233`*^9}, {3.5432687456173067`*^9, 
   3.5432687808467283`*^9}, {3.5432851042613897`*^9, 3.543285105693192*^9}, {
   3.543285916484414*^9, 3.543285917651185*^9}, 3.543750479196534*^9, {
   3.54375052135118*^9, 3.543750671265151*^9}, {3.543750755334663*^9, 
   3.543750934656241*^9}, {3.543751025069448*^9, 3.5437510630758533`*^9}, {
   3.543751103421706*^9, 3.543751132127318*^9}, {3.543751168317618*^9, 
   3.543751171185442*^9}, {3.543751203530601*^9, 3.5437512133325033`*^9}, {
   3.543751587307334*^9, 3.543751590909317*^9}, {3.5437516548988323`*^9, 
   3.5437516844841223`*^9}, {3.543752739737816*^9, 3.543752755813175*^9}, {
   3.5437530364712667`*^9, 3.5437531557924833`*^9}, 3.543753192378345*^9, {
   3.543753300884533*^9, 3.543753325539263*^9}, {3.54375352019421*^9, 
   3.543753526139051*^9}, {3.544531032656431*^9, 3.544531262983433*^9}, {
   3.544532209263638*^9, 3.5445322483492804`*^9}, {3.551451421294149*^9, 
   3.5514514222115583`*^9}, {3.551614645865068*^9, 3.551614697127687*^9}, {
   3.551614770619913*^9, 3.551614848233285*^9}, {3.5554294626476507`*^9, 
   3.555429630986377*^9}, {3.555429940519989*^9, 3.555429997379244*^9}, {
   3.555430092071967*^9, 3.5554301174020987`*^9}, {3.55543066888905*^9, 
   3.555430762610381*^9}, {3.555432550949603*^9, 3.5554325735138702`*^9}, {
   3.580042770448946*^9, 3.580042774612969*^9}, {3.581363154839178*^9, 
   3.581363154943692*^9}, {3.581363189917705*^9, 3.581363257245117*^9}, {
   3.581363305036963*^9, 3.581363307111726*^9}, {3.581363775792817*^9, 
   3.581363779704282*^9}, {3.5814370316253777`*^9, 3.581437041641366*^9}, {
   3.5977714560354767`*^9, 3.597771469543192*^9}, {3.597771502049623*^9, 
   3.597771570472705*^9}, 3.607390102226239*^9, {3.607390140136436*^9, 
   3.607390329949091*^9}, 3.607390363451378*^9, {3.6074472445705*^9, 
   3.607447253909552*^9}, 3.607447375892837*^9, {3.6074479856063213`*^9, 
   3.607447990574465*^9}, 3.607449351516202*^9, 3.607449459934744*^9, 
   3.6074499459032784`*^9, {3.607450022947929*^9, 3.6074500445954247`*^9}, {
   3.6074511959401817`*^9, 3.607451201079302*^9}, {3.609073596135651*^9, 
   3.609073614233506*^9}, {3.614433098332597*^9, 3.61443310875596*^9}, 
   3.6210013266003113`*^9, {3.6508036498144503`*^9, 3.650803734344232*^9}, {
   3.650803784341793*^9, 3.650803794776284*^9}, 3.684671609553199*^9, {
   3.708959410354857*^9, 3.708959428034315*^9}, {3.7090491712943296`*^9, 
   3.709049171548624*^9}, {3.709049502940589*^9, 3.709049520404516*^9}, {
   3.717260783338799*^9, 3.7172607966848917`*^9}, {3.7172608559985847`*^9, 
   3.717260869329809*^9}, {3.717260910389174*^9, 3.717260922926289*^9}, {
   3.7609702830794888`*^9, 3.760970321163754*^9}, {3.761011120833177*^9, 
   3.761011123552702*^9}, {3.7610527216583147`*^9, 3.761052843133113*^9}, {
   3.761055140603953*^9, 3.761055226126836*^9}, 3.761097520552001*^9, 
   3.7611413156432333`*^9, {3.761665731028933*^9, 3.761665744427738*^9}, 
   3.761665940283103*^9, 3.761702624595134*^9, {3.762090652477015*^9, 
   3.762090670472938*^9}, {3.7641190929369802`*^9, 3.76411909732248*^9}, {
   3.764615987638048*^9, 3.764616061961253*^9}, {3.7646169370387983`*^9, 
   3.764616959168724*^9}, {3.764617147315473*^9, 3.764617176511077*^9}, {
   3.7646172547470217`*^9, 3.7646173920528097`*^9}, {3.764617587338748*^9, 
   3.764617628720749*^9}},ExpressionUUID->"cec0b34e-6af5-48ea-beb3-\
94ef963f2b5d"],

Cell["Prototypes", "Text",
 CellChangeTimes->{{3.478610215116564*^9, 3.478610225498597*^9}}],

Cell["Feynman parameterization technique", "Text",
 CellChangeTimes->{{3.479261010835832*^9, 3.479261017614574*^9}, {
  3.479297148863298*^9, 3.4792971589651423`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Function", " ", "to", " ", "generate", " ", "IntegralOp", " ", 
    "variables", " ", "for", " ", 
    RowBox[{"F", "[", "n_", "]"}], " ", "in", " ", 
    RowBox[{"e1410", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"xF", "[", "n_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"out", ",", "i"}], "}"}], ",", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"out", "=", 
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"x", "[", "1", "]"}], ",", "0", ",", "1"}], "}"}], 
             "}"}]}], ";", 
           RowBox[{"i", "=", "2"}]}], ",", 
          RowBox[{"i", "<=", "n"}], ",", 
          RowBox[{"i", "++"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"out", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x", "[", "i", "]"}], ",", "0", ",", "1"}], "}"}]}], 
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", "out"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Fn", "[", "n_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"out", ",", "i", ",", "j"}], "}"}], ",", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"out", "=", 
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"x", "[", "1", "]"}], ",", "0", ",", "1"}], "}"}], 
             "}"}]}], ";", 
           RowBox[{"i", "=", "2"}]}], ",", 
          RowBox[{"i", "<=", "n"}], ",", 
          RowBox[{"i", "++"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"out", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x", "[", "i", "]"}], ",", "0", ",", 
              RowBox[{"1", "-", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{"x", "[", 
                  RowBox[{"j", "-", "1"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", "2", ",", "i"}], "}"}]}], "]"}]}]}], 
             "}"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", "out"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"DefPrint", "[", 
    RowBox[{"\"\<e1410\>\"", ",", 
     RowBox[{
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{"F", "[", "n_", "]"}], "}"}], "}"}], ",", "a__"}], "]"}], ":>", 
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"xF", "[", "n", "]"}], ",", 
        RowBox[{"a", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"n", "-", "1"}], ")"}], "!"}], " ", 
         RowBox[{"DiracDelta", "[", 
          RowBox[{
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"x", "[", "i", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}], "-", "1"}], 
          "]"}]}]}], "]"}]}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"DefPrint", "[", 
    RowBox[{"\"\<e1427\>\"", ",", 
     RowBox[{
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", "q", "}"}], "}"}], ",", 
        RowBox[{
         FractionBox["1", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"2", " ", "\[Pi]"}], ")"}], "d"]], 
         FractionBox[
          SuperscriptBox[
           RowBox[{"(", 
            SuperscriptBox["q", "2"], ")"}], "a"], 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             SuperscriptBox["q", "2"], "+", "D"}], ")"}], "b"]]}]}], "]"}], "->", 
      RowBox[{
       FractionBox[
        RowBox[{
         RowBox[{"Gamma", "[", 
          RowBox[{"b", "-", "a", "-", 
           RowBox[{"d", "/", "2"}]}], "]"}], 
         RowBox[{"Gamma", "[", 
          RowBox[{"a", "+", 
           RowBox[{"d", "/", "2"}]}], "]"}]}], 
        RowBox[{
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"4", " ", "\[Pi]"}], ")"}], 
          RowBox[{"d", "/", "2"}]], 
         RowBox[{"Gamma", "[", "b", "]"}], 
         RowBox[{"Gamma", "[", 
          RowBox[{"d", "/", "2"}], "]"}]}]], 
       SuperscriptBox["D", 
        RowBox[{"-", 
         RowBox[{"(", 
          RowBox[{"b", "-", "a", "-", 
           RowBox[{"d", "/", "2"}]}], ")"}]}]]}]}]}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"DefPrint", "[", 
    RowBox[{"\"\<e1427s\>\"", ",", 
     RowBox[{
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", "q", "}"}], "}"}], ",", 
        FractionBox[
         SuperscriptBox[
          RowBox[{"(", 
           SuperscriptBox["q", "2"], ")"}], "a"], 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["q", "2"], "+", "D"}], ")"}], "b"]]}], "]"}], "->", 
      RowBox[{
       FractionBox[
        RowBox[{
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"2", " ", "\[Pi]"}], ")"}], "d"], 
         RowBox[{"Gamma", "[", 
          RowBox[{"b", "-", "a", "-", 
           RowBox[{"d", "/", "2"}]}], "]"}], 
         RowBox[{"Gamma", "[", 
          RowBox[{"a", "+", 
           RowBox[{"d", "/", "2"}]}], "]"}]}], 
        RowBox[{
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"4", " ", "\[Pi]"}], ")"}], 
          RowBox[{"d", "/", "2"}]], 
         RowBox[{"Gamma", "[", "b", "]"}], 
         RowBox[{"Gamma", "[", 
          RowBox[{"d", "/", "2"}], "]"}]}]], 
       SuperscriptBox["D", 
        RowBox[{"-", 
         RowBox[{"(", 
          RowBox[{"b", "-", "a", "-", 
           RowBox[{"d", "/", "2"}]}], ")"}]}]]}]}]}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"DefPrint", "[", 
    RowBox[{"\"\<e1427hitoshi\>\"", ",", 
     RowBox[{
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", "q", "}"}], "}"}], ",", 
        FractionBox[
         SuperscriptBox[
          RowBox[{"(", 
           SuperscriptBox["q", "2"], ")"}], "a"], 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["q", "2"], "-", "D", "-", 
            RowBox[{"I", " ", "\[CurlyEpsilon]"}]}], ")"}], "b"]]}], "]"}], "->", 
      RowBox[{
       FractionBox[
        RowBox[{"I", " ", 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"-", "1"}], ")"}], 
          RowBox[{"b", "+", "a"}]], 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"2", " ", "\[Pi]"}], ")"}], "d"], 
         RowBox[{"Gamma", "[", 
          RowBox[{"b", "-", "a", "-", 
           RowBox[{"d", "/", "2"}]}], "]"}], 
         RowBox[{"Gamma", "[", 
          RowBox[{"a", "+", 
           RowBox[{"d", "/", "2"}]}], "]"}]}], 
        RowBox[{
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"4", " ", "\[Pi]"}], ")"}], 
          RowBox[{"d", "/", "2"}]], 
         RowBox[{"Gamma", "[", "b", "]"}], 
         RowBox[{"Gamma", "[", 
          RowBox[{"d", "/", "2"}], "]"}]}]], 
       SuperscriptBox["D", 
        RowBox[{"-", 
         RowBox[{"(", 
          RowBox[{"b", "-", "a", "-", 
           RowBox[{"d", "/", "2"}]}], ")"}]}]]}]}]}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"DefPrint", "[", 
    RowBox[{"\"\<e1426\>\"", ",", 
     RowBox[{
      RowBox[{"Gamma", "[", 
       RowBox[{
        RowBox[{"-", "n"}], "+", "\[CurlyEpsilon]"}], "]"}], ":>", 
      RowBox[{
       FractionBox[
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"-", "1"}], ")"}], "n"], 
        RowBox[{
         RowBox[{"(", "n", ")"}], "!"}]], 
       RowBox[{"(", 
        RowBox[{
         FractionBox["1", "\[CurlyEpsilon]"], "-", "\[Gamma]", "+", 
         RowBox[{"Sum", "[", 
          RowBox[{
           SuperscriptBox["k", 
            RowBox[{"-", "1"}]], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ")"}]}]}]}], 
    "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CompleteSquare1", "[", 
     RowBox[{"denomlist_", ",", "var_"}], "]"}], ":=", "\[IndentingNewLine]", 
    
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "Finds", " ", "square", " ", "of", " ", "quadradic", " ", 
       "polynomial"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"a", " ", "x", " ", "x"}], " ", "+", " ", 
        RowBox[{"b", " ", "x"}], " ", "+", " ", "c"}], " ", "->", " ", 
       RowBox[{
        RowBox[{"f", 
         SuperscriptBox[
          RowBox[{"(", " ", 
           RowBox[{"x", " ", "+", " ", "d"}], " ", ")"}], "2"]}], " ", "+", 
        " ", "e"}]}], ",", " ", 
      RowBox[{"with", " ", "var_", " ", "as", " ", "the", " ", 
       RowBox[{"x_variable", ".", "  ", "Returns"}], " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Complete", " ", "quadratic"}], ",", " ", 
          RowBox[{"Shifted", " ", "quadratic", " ", "term"}], ",", " ", 
          "Offset", ",", " ", 
          RowBox[{"variable", " ", "shift", " ", "factor"}]}], "}"}], "."}], 
       "  ", "*", "BUG"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "factor", ",", "coef", ",", "denom", ",", "n", ",", "tmp", ",", "tmp1",
         ",", "tmp2", ",", "tmp3", ",", "sub1", ",", "a", ",", "b", ",", "c", 
        ",", "f", ",", "d", ",", "e", ",", "x", ",", "sub", ",", "sube", ",", 
        "subfD2", ",", "subfD2e", ",", "subshift"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
      "\"\<Generate substitution Rule[] for quadratic polynomial of \
form.\>\"", ";", "\[IndentingNewLine]", 
       RowBox[{"Clear", "[", 
        RowBox[{"fD2", ",", "fD2e", ",", "fD2off", ",", "varshift"}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"a", " ", "x", " ", "x"}], " ", "+", " ", 
         RowBox[{"b", " ", "x"}], " ", "+", " ", "c"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"General", " ", "quadratic", " ", "equation"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"tmp1", "=", 
        RowBox[{
         RowBox[{"f", "*", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x", "+", "d"}], ")"}], "^", "2"}]}], "+", "e"}]}], ";", 
       " ", 
       RowBox[{"(*", " ", 
        RowBox[{"Solution", " ", "form"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"tmp", "-", "tmp1"}], "//", "Expand"}], "//", 
         RowBox[{
          RowBox[{"CoefficientList", "[", 
           RowBox[{"#", ",", "x"}], "]"}], "&"}]}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"Difference", " ", "in", " ", 
         RowBox[{"form", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"tmp1", "=", 
        RowBox[{
         RowBox[{"Solve", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"tmp", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "==", "0"}], ",", "f"}], "]"}], "//",
          "First"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "/.", "tmp1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp2", "=", 
        RowBox[{
         RowBox[{"Solve", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"tmp", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "==", "0"}], ",", "d"}], "]"}], "//",
          "First"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "/.", "tmp2"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tmp3", "=", 
        RowBox[{
         RowBox[{"Solve", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"tmp", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "==", "0"}], ",", "e"}], "]"}], "//",
          "First"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"sub1", "=", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"tmp1", ",", "tmp2", ",", "tmp3"}], "}"}], "//", 
         "Flatten"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"Solutions", " ", "for", " ", 
         RowBox[{"{", 
          RowBox[{"f", ",", "d", ",", "e"}], "}"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"subfD2", "=", 
        RowBox[{
         RowBox[{"fD2", "->", 
          RowBox[{"f", "*", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x", "+", "d"}], ")"}], "^", "2"}]}]}], "/.", "sub1"}]}],
        ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"f", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"x", " ", "+", " ", "d"}], ")"}], "^", "2"}], " ", 
         "part"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"sube", "=", 
        RowBox[{"fD2offset", "->", 
         RowBox[{"(", 
          RowBox[{"e", "/.", "sub1"}], ")"}]}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"e", " ", "part"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"subfD2e", "=", 
        RowBox[{
         RowBox[{"fD2all", "->", 
          RowBox[{
           RowBox[{"f", "*", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"x", "+", "d"}], ")"}], "^", "2"}]}], "+", "e"}]}], "/.",
          "sub1"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"f", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x", "+", "d"}], ")"}], "^", "2"}]}], "+", "e"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"subshift", "=", 
        RowBox[{
         RowBox[{"varshift", "->", 
          RowBox[{"var", "->", 
           RowBox[{"var", "-", "d"}]}]}], "/.", "sub1"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"var", "-", 
          RowBox[{"d", " ", "so", " ", "that", " ", "x"}], "-", "d"}], "->", 
         "x"}], "  ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"factor", ",", "denom", ",", "n"}], "}"}], "=", 
        RowBox[{"denomlist", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "3"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"coef", "=", 
        RowBox[{"CoefficientList", "[", 
         RowBox[{"denom", ",", "var"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"sub", "=", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "->", "#2"}], "&"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"c", ",", "b", ",", "a"}], "}"}], ",", "coef"}], "}"}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"subfD2e", ",", "subfD2", ",", "sube", ",", "subshift"}], 
          "}"}], "/.", "sub"}], "/.", 
        RowBox[{"x", "->", "var"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Factors", " ", "exp_", " ", "in", " ", "form", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "/", "A1"}], ")"}], ".", 
         RowBox[{"(", 
          RowBox[{"1", "/", "A2"}], ")"}], ".", 
         RowBox[{"(", 
          RowBox[{"1", "/", "A3"}], ")"}]}]}], "..."}], " ", "into", " ", 
      "Feynman", " ", "form"}], ",", " ", 
     RowBox[{
      RowBox[{
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"x", "[", "1", "]"}], " ", "A1"}], "+"}], "..."}], "+", 
          RowBox[{
           RowBox[{"x", "[", "n", "]"}], " ", "An"}]}], ")"}], "n"], ".", 
       "  ", "Returns"}], " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"coef", ",", " ", "denom", ",", " ", 
         RowBox[{"exponent", " ", "of", " ", "denom"}], ",", 
         RowBox[{"sum", " ", "of", " ", 
          RowBox[{"x", "[", "n", "]"}]}]}], "}"}], "."}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FactorDotFeynman", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "i", ",", "n", ",", "square", ",", "tmp", ",", "xs", ",", "numer", 
         ",", "denom", ",", 
         RowBox[{"DEBUG", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "exp"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "tmp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"numer", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Numerator", ",", "tmp"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xs", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"x", "[", 
           RowBox[{"Range", "[", "n", "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"numer", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Numerator", "[", "tmp", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#3", 
             RowBox[{"#1", "/", "#2"}]}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"xs", ",", "tmp", ",", "numer"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IfDEBUG", "[", 
         RowBox[{
         "\"\<FactorDotFeynman\>\"", ",", "DEBUG", ",", "tmp", ",", 
          "\"\<tmp\>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"denom", "=", 
         RowBox[{
          RowBox[{"Apply", "[", 
           RowBox[{"Plus", ",", "tmp"}], "]"}], "/.", 
          RowBox[{"Dot", "->", "Times"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"denom", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"denom", "//", "Expand"}], "//", "SimplifyTensorSum"}], "//",
            "UpDownAdjust"}], "//", "Simplify"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"denom", "=", 
         RowBox[{
          RowBox[{"denom", "/.", 
           RowBox[{
            RowBox[{"x", "[", "n", "]"}], "->", 
            RowBox[{"1", "-", 
             RowBox[{"Apply", "[", 
              RowBox[{"Plus", ",", 
               RowBox[{"Most", "[", "xs", "]"}]}], "]"}]}]}]}], "//", 
          "Expand"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"Apply", "[", 
           RowBox[{"Times", ",", "numer"}], "]"}], "/", 
          SuperscriptBox["denom", "n"]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Apply", "[", 
           RowBox[{"Times", ",", "numer"}], "]"}], ",", "denom", ",", "n", 
          ",", 
          RowBox[{"Apply", "[", 
           RowBox[{"Plus", ",", "xs"}], "]"}]}], "}"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"simpleVertex", "[", "scalars_List", "]"}], "[", "exp_Vertex", 
       "]"}], " ", "removes", " ", "all", " ", "scalars_List", " ", "from", 
      " ", 
      RowBox[{
       RowBox[{"Vertex", "[", "]"}], ".", " ", "Only"}], " ", "terms", " ", 
      "retained", " ", "in", " ", 
      RowBox[{"Vertex", "[", "]"}], " ", "are", " ", 
      RowBox[{"dotOps", ".", "  ", 
       RowBox[{"Usage", ":", " ", "tmp"}]}]}], "/.", 
     RowBox[{
      RowBox[{"v", ":", 
       RowBox[{"Vertex", "[", "a__", "]"}]}], ":>", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"simpleVertex", "[", 
         RowBox[{"{", 
          RowBox[{"e", ",", "q"}], "}"}], "]"}], "[", "v", "]"}], " ", "*", 
       "11", "Sep2012"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"simpleVertex", "[", "scalars_List", "]"}], "[", "exp_Vertex", 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"Vertex", "[", "a__", "]"}], ":>", 
           RowBox[{"Vertex", "[", 
            RowBox[{
             RowBox[{"simpleDot1a", "[", "scalars", "]"}], "[", "a", "]"}], 
            "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"Vertex", "[", 
            RowBox[{"a___", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"op", ":", "dotOps"}], ")"}], "[", "b__", "]"}]}], 
            "]"}], "->", 
           RowBox[{"a", " ", 
            RowBox[{"Vertex", "[", 
             RowBox[{"op", "[", "b", "]"}], "]"}]}]}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"CollectDotNumerator", "[", 
       RowBox[{"exp_Dot", "|", "xDot"}], "]"}], " ", "takes", " ", 
      "exp_Dot"}], "|", 
     RowBox[{
     "xDot", " ", "where", " ", "each", " ", "dotted", " ", "term", " ", 
      "may", " ", "be", " ", "a", " ", "fraction", " ", "and", " ", 
      "converts", " ", "into", " ", "a", " ", "dotted", " ", "Numerator", " ",
       "and", " ", "Times", " ", 
      RowBox[{"Denominator", ".", "  ", "Assumes"}], " ", "that", " ", "the", 
      " ", "Denominators", " ", "of", " ", "the", " ", "terms", " ", "are", 
      " ", 
      RowBox[{"scalar", "."}], " ", "*", "10", "Nov2012"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CollectDotNumerator", "[", 
      RowBox[{"exp_Dot", "|", "xDot"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "head", ",", "tmpn", ",", "tmpd"}],
         "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"head", "=", 
         RowBox[{"Head", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "tmp"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmpn", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Numerator", "[", "#", "]"}], "&"}], ",", "tmp"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmpd", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Denominator", "[", "#", "]"}], "&"}], ",", "tmp"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"head", ",", "tmpn"}], "]"}], "/", 
         RowBox[{"Apply", "[", 
          RowBox[{"Times", ",", "tmpd"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"Peskin", "-", 
     RowBox[{"Schroeder", " ", "6.42", " ", "*", "10", "Nov2012"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PS642", "[", "n_", "]"}], ":=", 
     RowBox[{
      FractionBox["1", 
       RowBox[{"Product", "[", 
        RowBox[{
         RowBox[{
          SubscriptBox["A", "i"], "^", 
          SubscriptBox["m", "i"]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "n"}], "}"}]}], "]"}]], "\[Rule]", 
      RowBox[{"IntegralOp", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            SubscriptBox["x", "i"], ",", "0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "n"}], "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"\[Delta]", "[", 
          RowBox[{
           RowBox[{"Sum", "[", 
            RowBox[{
             SubscriptBox["x", "i"], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "n"}], "}"}]}], "]"}], "-", "1"}], "]"}], 
         FractionBox[
          RowBox[{"Product", "[", 
           RowBox[{
            RowBox[{
             SubscriptBox["x", "i"], "^", 
             RowBox[{"(", 
              RowBox[{
               SubscriptBox["m", "i"], "-", "1"}], ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "n"}], "}"}]}], "]"}], 
          RowBox[{
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              SubscriptBox["x", "i"], 
              SubscriptBox["A", "i"]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "n"}], "}"}]}], "]"}], "^", 
           RowBox[{"Sum", "[", 
            RowBox[{
             SubscriptBox["m", "i"], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}]], 
         FractionBox[
          RowBox[{"\[CapitalGamma]", "[", 
           RowBox[{"Sum", "[", 
            RowBox[{
             SubscriptBox["m", "i"], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "n"}], "}"}]}], "]"}], "]"}], 
          RowBox[{"Product", "[", 
           RowBox[{
            RowBox[{"\[CapitalGamma]", "[", 
             SubscriptBox["m", "i"], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "n"}], "}"}]}], "]"}]]}]}], 
       "\[IndentingNewLine]", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"egRule", ":", " ", 
      RowBox[{
       RowBox[{"Conjugate", " ", "of", " ", "bi"}], "-", 
       RowBox[{"spinor", " ", "product", " ", "PS", ".5", ".2"}]}], ":", " ", 
      "conjugateUgU"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"Conjugate", "[", 
        RowBox[{
         OverscriptBox["u_", "_"], "[", "pu_", "]"}], "]"}], ".", 
       RowBox[{"Conjugate", "[", 
        RowBox[{"tt", ":", 
         RowBox[{"Tensor", "[", 
          RowBox[{"\[Gamma]", ",", "a_", ",", "b_"}], "]"}]}], "]"}], ".", 
       RowBox[{"Conjugate", "[", 
        RowBox[{"v_", "[", "pv_", "]"}], "]"}]}], "->", 
      RowBox[{
       RowBox[{
        RowBox[{
         OverscriptBox["v", "_"], " ", "[", "pv", "]"}], ".", " ", "tt", ".", 
        
        RowBox[{"u", "[", "pu", "]"}]}], "\[IndentingNewLine]", "*", "1", 
       "Dec2014"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"groupUUpp", "[", "p_", "]"}], " ", "Rule", " ", "that", " ", 
     "connect", " ", 
     RowBox[{"Dot", "[", "]"}], " ", "expressions", " ", "that", " ", "end", 
     " ", "and", " ", "begin", " ", "with", " ", "p_.", " ", "1", "Dec2014"}],
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"groupUUpp", "[", "p_", "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"aa", ":", 
        RowBox[{"Dot", "[", 
         RowBox[{"b__", ",", 
          RowBox[{"a_", "[", "p", "]"}]}], "]"}]}], ")"}], 
      RowBox[{"(", 
       RowBox[{"bb", ":", 
        RowBox[{"Dot", "[", 
         RowBox[{
          RowBox[{"a1_", "[", "p", "]"}], ",", "b1__"}], "]"}]}], ")"}]}], 
     "\[Rule]", 
     RowBox[{"aa", ".", "bb"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"FeynmannParameterization", "[", 
       RowBox[{"exp_Dot", "|", "xDot"}], "]"}], " ", "takes", " ", 
      "exp_Dot"}], "|", 
     RowBox[{
     "xDot", " ", "which", " ", "is", " ", "the", " ", "result", " ", "of", 
      " ", "evaluating", " ", "vertices", " ", "and", " ", "propagators", " ",
       "of", " ", "a", " ", "Feynmann", " ", "diagram", " ", "and", " ", 
      "converts", " ", "into", " ", "an", " ", "expression", " ", "using", 
      " ", "Feynmann", " ", 
      RowBox[{"parameterization", "."}], "  ", "*", "10", "Nov2012"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FeynmannParameterization", "[", 
      RowBox[{"exp_Dot", "|", "xDot"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "head", ",", "tmpn", ",", "tmpd", 
         ",", "tmpdconstant", ",", "tmpdpow", ",", "$n", ",", "pow", ",", 
         "subA", ",", "subm", ",", "out"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"head", "=", 
         RowBox[{"Head", "[", "exp", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "tmp"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmpn", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"head", ",", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Numerator", "[", "#", "]"}], "&"}], ",", "tmp"}], 
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmpd", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Denominator", "[", "#", "]"}], "&"}], ",", "tmp"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmpd", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", 
           RowBox[{"Apply", "[", 
            RowBox[{"Times", ",", "tmpd"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmpdconstant", "=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", "1", "}"}], ",", 
           RowBox[{"DeleteCases", "[", 
            RowBox[{"tmpd", ",", 
             RowBox[{"Except", "[", "_NumberQ", "]"}]}], "]"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"tmpd", "=", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"tmpd", ",", "_NumberQ"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$n", "=", 
         RowBox[{"Length", "[", "tmpd", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmpdpow", "=", 
         RowBox[{"tmpd", "/.", 
          RowBox[{
           RowBox[{"b_", "^", 
            RowBox[{"(", 
             RowBox[{"pow", ":", "c_"}], ")"}]}], "\[RuleDelayed]", 
           "pow"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmpdpow", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"NumberQ", "[", "#", "]"}], ",", "#", ",", "1"}], "]"}],
             "&"}], ",", "tmpdpow"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"subA", "=", 
         RowBox[{"MapIndexed", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             SubscriptBox["A", 
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]], "\[Rule]", "#1"}], "&"}], ",",
            "tmpd"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"subm", "=", 
         RowBox[{"MapIndexed", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             SubscriptBox["m", 
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]], "\[Rule]", "#1"}], "&"}], ",",
            "tmpdpow"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"out", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"PS642", "[", "$n", "]"}], "/.", "subA"}], "/.", 
          "subm"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"tmpn", " ", 
             RowBox[{"#", "/", 
              RowBox[{"tmpdconstant", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}]}], "&"}], ",", "out"}], "]"}],
          "/.", 
         RowBox[{"\[CapitalGamma]", "->", "Gamma"}]}]}]}], "\n", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuCompleteSquareUpDn", "::", "usage"}], "=", 
     "\"\<tuCompleteSquareUpDn[var_][exp_] converts exp_ of form \
\[IndentingNewLine]$generalForm=$a xu xd + bu xd + $c \[Rule] $targetForm=$d \
((xu+yu)(xd+yd)+$e) . \[IndentingNewLine]It assumes that the $generalForm is \
a proper Tensor expression and assumes that var_ in a Lower indexed Tensor \
variable.  Returns {$targetForm, $d, yd, $e} *19Dec2014*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"tuCompleteSquareUpDn", "[", "var_", "]"}], "[", "exp_", "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "$generalForm", ",", "$targetForm", ",", "xu", ",", "xd", ",", "yu", 
         ",", "yd", ",", "bu", ",", "bd", ",", "eyd", ",", "tmp", ",", "sub1",
          ",", "tmpeL", ",", "abc", ",", "$a", ",", "$b", ",", "$c", ",", 
         "$d", ",", "$e", ",", "$x", ",", "$y"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Build", " ", "template", " ", "for", " ", "converting", " ", 
         "quadratic", " ", "to", " ", 
         RowBox[{"CompleteSquare", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xu", "=", 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"$x", ",", "\"\<u\>\""}], "]"}], "[", "\[Mu]", "]"}]}], 
        ";", " ", 
        RowBox[{"xd", "=", 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"$x", ",", "\"\<d\>\""}], "]"}], "[", "\[Mu]", "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"yu", "=", 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"$y", ",", "\"\<u\>\""}], "]"}], "[", "\[Mu]", "]"}]}], 
        ";", " ", 
        RowBox[{"yd", "=", 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"$y", ",", "\"\<d\>\""}], "]"}], "[", "\[Mu]", "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"bu", "=", 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"$b", ",", "\"\<u\>\""}], "]"}], "[", "\[Mu]", "]"}]}], 
        ";", " ", 
        RowBox[{"bd", "=", 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"$b", ",", "\"\<d\>\""}], "]"}], "[", "\[Mu]", "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"$generalForm", "=", 
         RowBox[{
          RowBox[{"$a", " ", "xu", " ", "xd"}], " ", "+", " ", 
          RowBox[{"bu", " ", "xd"}], " ", "+", " ", "$c"}]}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{"General", " ", "quadratic", " ", "equation"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$targetForm", "=", 
         RowBox[{
          RowBox[{"$d", " ", 
           RowBox[{"(", 
            RowBox[{"xu", "+", "yu"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"xd", "+", "yd"}], ")"}]}], "+", "$e"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"Target", " ", 
          RowBox[{"form", ".", " ", "Find"}], " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"y", "'"}], "s"}], ",", "$d", ",", "$e"}], "}"}], 
           "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"$generalForm", "-", "$targetForm"}], "/.", 
           "sLowerAllIndices"}], "//", 
          RowBox[{
           RowBox[{"CoefficientList", "[", 
            RowBox[{"#", ",", "xd"}], "]"}], "&"}]}]}], ";", " ", 
        RowBox[{"(*", 
         RowBox[{"Coefficients", " ", "must", " ", "be", " ", "0."}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "\[Equal]", "0"}], "&"}], ",", "tmp"}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"Solve", "[", 
           RowBox[{"tmp", ",", 
            RowBox[{"{", 
             RowBox[{"$e", ",", "yd", ",", "$d"}], "}"}]}], "]"}], "//", 
          "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"eyd", "=", 
         RowBox[{
          RowBox[{"Append", "[", 
           RowBox[{"tmp", ",", 
            RowBox[{
             RowBox[{"tmp", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "/.", 
             RowBox[{"sRaiseAllIndices", "[", 
              RowBox[{"{", "}"}], "]"}]}]}], "]"}], "/.", 
          RowBox[{
           RowBox[{"bd", "^", "2"}], "\[Rule]", 
           RowBox[{"bd", " ", "bu"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Note", " ", "$b", " ", "is", " ", "a", " ", "Tensor", " ", "and", 
          " ", "figure", " ", "out", " ", "what", " ", "the", " ", "UpDn", 
          " ", "indices", " ", "are", " ", "assuming", " ", "that", " ", 
          "their", " ", "values", " ", "is", " ", "the", " ", 
          RowBox[{"same", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"tmpeL", "=", 
          RowBox[{"exp", "/.", "sLowerAllIndices"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"abc", "=", 
          RowBox[{
           RowBox[{"CoefficientList", "[", 
            RowBox[{"tmpeL", ",", "var"}], "]"}], "/.", 
           RowBox[{"sRaiseAllIndices", "[", 
            RowBox[{"{", "}"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "abc", "]"}], "\[NotEqual]", "3"}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"CR", "[", 
            RowBox[{
            "\"\<CompleteSquareUpDn expects 3 coefficients from exp_:\>\"", 
             ",", "exp"}], "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"xPrint", "[", 
         RowBox[{"abc", "=", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"$c", ",", "bu", ",", "$a"}], "}"}], "->", "abc"}], 
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"xPrint", "[", 
         RowBox[{"abc", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"abc", ",", 
            RowBox[{
             RowBox[{"abc", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "/.", "sLowerAllIndices"}]}], 
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"eyd", "=", 
         RowBox[{"eyd", "/.", "abc"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"$targetForm", ",", "$d", ",", "yd", ",", "$e"}], "}"}], "/.",
            "eyd"}], "/.", 
          RowBox[{"xd", "\[Rule]", "var"}]}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"xu", "\[RuleDelayed]", "var"}], "/.", 
           RowBox[{"sRaiseAllIndices", "[", 
            RowBox[{"{", "}"}], "]"}]}], "}"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CompleteSquareUpDn", "[", 
      RowBox[{"exp_", ",", "var_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"tuCompleteSquareUpDn", "[", "var", "]"}], "[", "exp", "]"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479297170306069*^9, 3.4792971794940042`*^9}, {
   3.479305689940733*^9, 3.479305705554863*^9}, {3.479310324800173*^9, 
   3.479310432881599*^9}, {3.4793154166210527`*^9, 3.479315417670186*^9}, {
   3.47934473443865*^9, 3.4793447843669252`*^9}, {3.4793448566563177`*^9, 
   3.4793448643394613`*^9}, {3.4793461660266933`*^9, 3.479346172446604*^9}, {
   3.47934625491818*^9, 3.479346263826591*^9}, {3.4793464059336643`*^9, 
   3.4793464086175947`*^9}, 3.4793467741410522`*^9, {3.4794038845260763`*^9, 
   3.479403972780167*^9}, 3.479404005534459*^9, {3.4794040512527742`*^9, 
   3.4794040516990337`*^9}, {3.4797273979173517`*^9, 3.479727427661332*^9}, {
   3.479727466635909*^9, 3.479727475020212*^9}, {3.479727676073221*^9, 
   3.479727684342013*^9}, {3.47972775349432*^9, 3.479727757558448*^9}, {
   3.479727811720315*^9, 3.479727818684025*^9}, {3.479728047628635*^9, 
   3.479728048313567*^9}, {3.47974713983729*^9, 3.479747140536675*^9}, {
   3.479813871842847*^9, 3.479813983731187*^9}, {3.479820009732444*^9, 
   3.4798200226468697`*^9}, {3.479820182822812*^9, 3.479820214384513*^9}, {
   3.479838179892621*^9, 3.479838180334902*^9}, 3.548205829489676*^9, {
   3.5482059249363823`*^9, 3.548206008782058*^9}, {3.548206069164526*^9, 
   3.548206088248096*^9}, {3.548206288839216*^9, 3.548206317341303*^9}, 
   3.5482063672838707`*^9, {3.548206402819908*^9, 3.548206520632107*^9}, {
   3.54842390650207*^9, 3.548423983478595*^9}, {3.5484242502939377`*^9, 
   3.548424259508923*^9}, 3.548508847843162*^9, {3.548508948505664*^9, 
   3.5485089529270563`*^9}, {3.548509043427318*^9, 3.548509064490347*^9}, {
   3.5564549778334103`*^9, 3.556455043040139*^9}, {3.561606961522088*^9, 
   3.561607035273394*^9}, {3.561607074961975*^9, 3.561607431821745*^9}, {
   3.5616075235315733`*^9, 3.561607525015626*^9}, {3.5616079627139378`*^9, 
   3.5616079683672857`*^9}, {3.5617363659233303`*^9, 
   3.5617363938460073`*^9}, {3.5620199497719584`*^9, 
   3.5620199504257936`*^9}, {3.563027128194283*^9, 3.563027131703106*^9}, {
   3.603372751705833*^9, 3.603372758593635*^9}, {3.620230271463119*^9, 
   3.620230277104291*^9}, {3.626455947878614*^9, 3.6264559772796707`*^9}, {
   3.626456366941513*^9, 3.626456473826425*^9}, {3.626456620282076*^9, 
   3.62645663077724*^9}, {3.626464139964409*^9, 3.626464221277289*^9}, {
   3.627226015118252*^9, 3.6272260158846493`*^9}, {3.6272269447684937`*^9, 
   3.627226945086039*^9}, {3.6272286196507387`*^9, 3.627228620153122*^9}, {
   3.627228701773726*^9, 3.627228717237611*^9}, 3.627230239885857*^9, 
   3.6272494389942217`*^9, {3.6272494864844313`*^9, 3.627249544735857*^9}, {
   3.6272514505856533`*^9, 3.627251461270656*^9}, {3.629217372679283*^9, 
   3.629217390378211*^9}, {3.663559007097856*^9, 3.663559012823853*^9}, 
   3.6846716112673063`*^9},ExpressionUUID->"88adb9f9-3546-4237-a366-\
45cac2c5f214"],

Cell[BoxData[
 RowBox[{"DefPrint", "[", 
  RowBox[{"\<\"e1410\"\>", ",", 
   RowBox[{
    InterpretationBox[
     RowBox[{
      SubscriptBox["\<\"\[Integral]\"\>", 
       TagBox[GridBox[{
          {
           RowBox[{"{", 
            RowBox[{"F", "[", "n_", "]"}], "}"}]}
         },
         DefaultBaseStyle->"Column",
         GridBoxAlignment->{"Columns" -> {{Left}}},
         GridBoxItemSize->{
          "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
        "Column"]], "[", "a__", "]"}],
     $CellContext`tuIntegral[{{
        $CellContext`F[
         Pattern[$CellContext`n, 
          Blank[]]]}}, 
      Pattern[$CellContext`a, 
       BlankSequence[]]],
     Editable->False,
     SyntaxForm->Automatic], "\[RuleDelayed]", 
    RowBox[{"IntegralOp", "[", 
     RowBox[{
      RowBox[{"xF", "[", "n", "]"}], ",", 
      RowBox[{"a", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"n", "-", "1"}], ")"}], "!"}], " ", 
       RowBox[{"DiracDelta", "[", 
        RowBox[{
         RowBox[{
          UnderoverscriptBox["\[Sum]", 
           RowBox[{"i", "=", "1"}], "n"], 
          RowBox[{"x", "[", "i", "]"}]}], "-", "1"}], "]"}]}]}], "]"}]}]}], 
  "]"}]], "Output",
 CellChangeTimes->{{3.672446274798018*^9, 3.672446309980341*^9}, {
   3.6951416383040657`*^9, 3.6951416638185062`*^9}, 3.6968740433543463`*^9, 
   3.699730560426428*^9, 3.6997960475144663`*^9, 3.700059788987978*^9, 
   3.700145204772491*^9, 3.7005320533859463`*^9, 3.705424942547414*^9, 
   3.70671534232001*^9, 3.7070523010926933`*^9, 3.714143106160748*^9, 
   3.7310698247244253`*^9, 3.732106902263297*^9, 3.732191457308957*^9, 
   3.7332404069237423`*^9, 3.735089502157165*^9, {3.735089942959635*^9, 
   3.735089946353589*^9}, 3.7356469265531197`*^9, 3.7397942825956717`*^9, 
   3.741353171719557*^9, {3.744973066416238*^9, 3.744973071948923*^9}, 
   3.745263606191019*^9, 3.74526731186873*^9, 3.745492872626748*^9, 
   3.747413749132107*^9, 3.750954480446657*^9, 3.752936817204665*^9, 
   3.75604930501974*^9, 3.7590720549320297`*^9, 3.7963934407240753`*^9, {
   3.7995892310829563`*^9, 3.799589238491538*^9}, {3.7995892703830833`*^9, 
   3.799589278322611*^9}, 3.7995894916129*^9, 3.7995897143791647`*^9, 
   3.799589797532351*^9},ExpressionUUID->"fd0185c9-1d37-4c70-a25a-\
89f14072dc38"],

Cell[BoxData[
 RowBox[{"DefPrint", "[", 
  RowBox[{"\<\"e1427\"\>", ",", 
   RowBox[{
    InterpretationBox[
     RowBox[{
      SubscriptBox["\<\"\[Integral]\"\>", 
       TagBox[GridBox[{
          {
           RowBox[{"{", "q", "}"}]}
         },
         DefaultBaseStyle->"Column",
         GridBoxAlignment->{"Columns" -> {{Left}}},
         GridBoxItemSize->{
          "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
        "Column"]], "[", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"2", " ", "\[Pi]"}], ")"}], 
        RowBox[{"-", "d"}]], " ", 
       SuperscriptBox[
        RowBox[{"(", 
         SuperscriptBox["q", "2"], ")"}], "a"], " ", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"D", "+", 
          SuperscriptBox["q", "2"]}], ")"}], 
        RowBox[{"-", "b"}]]}], "]"}],
     $CellContext`tuIntegral[{{$CellContext`q}}, (2 
        Pi)^(-$CellContext`d) ($CellContext`q^2)^$CellContext`a (
        D + $CellContext`q^2)^(-$CellContext`b)],
     Editable->False,
     SyntaxForm->Automatic], "\[Rule]", 
    FractionBox[
     RowBox[{
      SuperscriptBox["2", 
       RowBox[{"-", "d"}]], " ", 
      SuperscriptBox["D", 
       RowBox[{"a", "-", "b", "+", 
        FractionBox["d", "2"]}]], " ", 
      SuperscriptBox["\[Pi]", 
       RowBox[{
        RowBox[{"-", "d"}], "/", "2"}]], " ", 
      RowBox[{"Gamma", "[", 
       RowBox[{
        RowBox[{"-", "a"}], "+", "b", "-", 
        FractionBox["d", "2"]}], "]"}], " ", 
      RowBox[{"Gamma", "[", 
       RowBox[{"a", "+", 
        FractionBox["d", "2"]}], "]"}]}], 
     RowBox[{
      RowBox[{"Gamma", "[", "b", "]"}], " ", 
      RowBox[{"Gamma", "[", 
       FractionBox["d", "2"], "]"}]}]]}]}], "]"}]], "Output",
 CellChangeTimes->{{3.672446274798018*^9, 3.672446309980341*^9}, {
   3.6951416383040657`*^9, 3.6951416638185062`*^9}, 3.6968740433543463`*^9, 
   3.699730560426428*^9, 3.6997960475144663`*^9, 3.700059788987978*^9, 
   3.700145204772491*^9, 3.7005320533859463`*^9, 3.705424942547414*^9, 
   3.70671534232001*^9, 3.7070523010926933`*^9, 3.714143106160748*^9, 
   3.7310698247244253`*^9, 3.732106902263297*^9, 3.732191457308957*^9, 
   3.7332404069237423`*^9, 3.735089502157165*^9, {3.735089942959635*^9, 
   3.735089946353589*^9}, 3.7356469265531197`*^9, 3.7397942825956717`*^9, 
   3.741353171719557*^9, {3.744973066416238*^9, 3.744973071948923*^9}, 
   3.745263606191019*^9, 3.74526731186873*^9, 3.745492872626748*^9, 
   3.747413749132107*^9, 3.750954480446657*^9, 3.752936817204665*^9, 
   3.75604930501974*^9, 3.7590720549320297`*^9, 3.7963934407240753`*^9, {
   3.7995892310829563`*^9, 3.799589238491538*^9}, {3.7995892703830833`*^9, 
   3.799589278322611*^9}, 3.7995894916129*^9, 3.7995897143791647`*^9, 
   3.799589797553521*^9},ExpressionUUID->"7166744c-4752-4cc1-98ac-\
63e2703393b4"],

Cell[BoxData[
 RowBox[{"DefPrint", "[", 
  RowBox[{"\<\"e1427s\"\>", ",", 
   RowBox[{
    InterpretationBox[
     RowBox[{
      SubscriptBox["\<\"\[Integral]\"\>", 
       TagBox[GridBox[{
          {
           RowBox[{"{", "q", "}"}]}
         },
         DefaultBaseStyle->"Column",
         GridBoxAlignment->{"Columns" -> {{Left}}},
         GridBoxItemSize->{
          "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
        "Column"]], "[", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"(", 
         SuperscriptBox["q", "2"], ")"}], "a"], " ", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"D", "+", 
          SuperscriptBox["q", "2"]}], ")"}], 
        RowBox[{"-", "b"}]]}], "]"}],
     $CellContext`tuIntegral[{{$CellContext`q}}, \
($CellContext`q^2)^$CellContext`a (D + $CellContext`q^2)^(-$CellContext`b)],
     Editable->False,
     SyntaxForm->Automatic], "\[Rule]", 
    FractionBox[
     RowBox[{
      SuperscriptBox["D", 
       RowBox[{"a", "-", "b", "+", 
        FractionBox["d", "2"]}]], " ", 
      SuperscriptBox["\[Pi]", 
       RowBox[{"d", "/", "2"}]], " ", 
      RowBox[{"Gamma", "[", 
       RowBox[{
        RowBox[{"-", "a"}], "+", "b", "-", 
        FractionBox["d", "2"]}], "]"}], " ", 
      RowBox[{"Gamma", "[", 
       RowBox[{"a", "+", 
        FractionBox["d", "2"]}], "]"}]}], 
     RowBox[{
      RowBox[{"Gamma", "[", "b", "]"}], " ", 
      RowBox[{"Gamma", "[", 
       FractionBox["d", "2"], "]"}]}]]}]}], "]"}]], "Output",
 CellChangeTimes->{{3.672446274798018*^9, 3.672446309980341*^9}, {
   3.6951416383040657`*^9, 3.6951416638185062`*^9}, 3.6968740433543463`*^9, 
   3.699730560426428*^9, 3.6997960475144663`*^9, 3.700059788987978*^9, 
   3.700145204772491*^9, 3.7005320533859463`*^9, 3.705424942547414*^9, 
   3.70671534232001*^9, 3.7070523010926933`*^9, 3.714143106160748*^9, 
   3.7310698247244253`*^9, 3.732106902263297*^9, 3.732191457308957*^9, 
   3.7332404069237423`*^9, 3.735089502157165*^9, {3.735089942959635*^9, 
   3.735089946353589*^9}, 3.7356469265531197`*^9, 3.7397942825956717`*^9, 
   3.741353171719557*^9, {3.744973066416238*^9, 3.744973071948923*^9}, 
   3.745263606191019*^9, 3.74526731186873*^9, 3.745492872626748*^9, 
   3.747413749132107*^9, 3.750954480446657*^9, 3.752936817204665*^9, 
   3.75604930501974*^9, 3.7590720549320297`*^9, 3.7963934407240753`*^9, {
   3.7995892310829563`*^9, 3.799589238491538*^9}, {3.7995892703830833`*^9, 
   3.799589278322611*^9}, 3.7995894916129*^9, 3.7995897143791647`*^9, 
   3.799589797567841*^9},ExpressionUUID->"2241afc3-f685-4d21-90d1-\
7f0127830899"],

Cell[BoxData[
 RowBox[{"DefPrint", "[", 
  RowBox[{"\<\"e1427hitoshi\"\>", ",", 
   RowBox[{
    InterpretationBox[
     RowBox[{
      SubscriptBox["\<\"\[Integral]\"\>", 
       TagBox[GridBox[{
          {
           RowBox[{"{", "q", "}"}]}
         },
         DefaultBaseStyle->"Column",
         GridBoxAlignment->{"Columns" -> {{Left}}},
         GridBoxItemSize->{
          "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
        "Column"]], "[", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"(", 
         SuperscriptBox["q", "2"], ")"}], "a"], " ", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "D"}], "+", 
          SuperscriptBox["q", "2"], "-", 
          RowBox[{"\[ImaginaryI]", " ", "\[CurlyEpsilon]"}]}], ")"}], 
        RowBox[{"-", "b"}]]}], "]"}],
     $CellContext`tuIntegral[{{$CellContext`q}}, \
($CellContext`q^2)^$CellContext`a (-D + $CellContext`q^2 + 
        Complex[0, -1] $CellContext`\[CurlyEpsilon])^(-$CellContext`b)],
     Editable->False,
     SyntaxForm->Automatic], "\[Rule]", 
    FractionBox[
     RowBox[{"\[ImaginaryI]", " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"-", "1"}], ")"}], 
       RowBox[{"a", "+", "b"}]], " ", 
      SuperscriptBox["D", 
       RowBox[{"a", "-", "b", "+", 
        FractionBox["d", "2"]}]], " ", 
      SuperscriptBox["\[Pi]", 
       RowBox[{"d", "/", "2"}]], " ", 
      RowBox[{"Gamma", "[", 
       RowBox[{
        RowBox[{"-", "a"}], "+", "b", "-", 
        FractionBox["d", "2"]}], "]"}], " ", 
      RowBox[{"Gamma", "[", 
       RowBox[{"a", "+", 
        FractionBox["d", "2"]}], "]"}]}], 
     RowBox[{
      RowBox[{"Gamma", "[", "b", "]"}], " ", 
      RowBox[{"Gamma", "[", 
       FractionBox["d", "2"], "]"}]}]]}]}], "]"}]], "Output",
 CellChangeTimes->{{3.672446274798018*^9, 3.672446309980341*^9}, {
   3.6951416383040657`*^9, 3.6951416638185062`*^9}, 3.6968740433543463`*^9, 
   3.699730560426428*^9, 3.6997960475144663`*^9, 3.700059788987978*^9, 
   3.700145204772491*^9, 3.7005320533859463`*^9, 3.705424942547414*^9, 
   3.70671534232001*^9, 3.7070523010926933`*^9, 3.714143106160748*^9, 
   3.7310698247244253`*^9, 3.732106902263297*^9, 3.732191457308957*^9, 
   3.7332404069237423`*^9, 3.735089502157165*^9, {3.735089942959635*^9, 
   3.735089946353589*^9}, 3.7356469265531197`*^9, 3.7397942825956717`*^9, 
   3.741353171719557*^9, {3.744973066416238*^9, 3.744973071948923*^9}, 
   3.745263606191019*^9, 3.74526731186873*^9, 3.745492872626748*^9, 
   3.747413749132107*^9, 3.750954480446657*^9, 3.752936817204665*^9, 
   3.75604930501974*^9, 3.7590720549320297`*^9, 3.7963934407240753`*^9, {
   3.7995892310829563`*^9, 3.799589238491538*^9}, {3.7995892703830833`*^9, 
   3.799589278322611*^9}, 3.7995894916129*^9, 3.7995897143791647`*^9, 
   3.799589797580917*^9},ExpressionUUID->"41f7599f-65d0-4bf4-8af9-\
712bae8edd4e"],

Cell[BoxData[
 RowBox[{"DefPrint", "[", 
  RowBox[{"\<\"e1426\"\>", ",", 
   RowBox[{
    RowBox[{"Gamma", "[", 
     RowBox[{
      RowBox[{"-", "n"}], "+", "\[CurlyEpsilon]"}], "]"}], "\[RuleDelayed]", 
    FractionBox[
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"-", "1"}], ")"}], "n"], " ", 
      RowBox[{"(", 
       RowBox[{
        FractionBox["1", "\[CurlyEpsilon]"], "-", "\[Gamma]", "+", 
        RowBox[{
         UnderoverscriptBox["\[Sum]", 
          RowBox[{"k", "=", "1"}], "n"], 
         FractionBox["1", "k"]}]}], ")"}]}], 
     RowBox[{"n", "!"}]]}]}], "]"}]], "Output",
 CellChangeTimes->{{3.672446274798018*^9, 3.672446309980341*^9}, {
   3.6951416383040657`*^9, 3.6951416638185062`*^9}, 3.6968740433543463`*^9, 
   3.699730560426428*^9, 3.6997960475144663`*^9, 3.700059788987978*^9, 
   3.700145204772491*^9, 3.7005320533859463`*^9, 3.705424942547414*^9, 
   3.70671534232001*^9, 3.7070523010926933`*^9, 3.714143106160748*^9, 
   3.7310698247244253`*^9, 3.732106902263297*^9, 3.732191457308957*^9, 
   3.7332404069237423`*^9, 3.735089502157165*^9, {3.735089942959635*^9, 
   3.735089946353589*^9}, 3.7356469265531197`*^9, 3.7397942825956717`*^9, 
   3.741353171719557*^9, {3.744973066416238*^9, 3.744973071948923*^9}, 
   3.745263606191019*^9, 3.74526731186873*^9, 3.745492872626748*^9, 
   3.747413749132107*^9, 3.750954480446657*^9, 3.752936817204665*^9, 
   3.75604930501974*^9, 3.7590720549320297`*^9, 3.7963934407240753`*^9, {
   3.7995892310829563`*^9, 3.799589238491538*^9}, {3.7995892703830833`*^9, 
   3.799589278322611*^9}, 3.7995894916129*^9, 3.7995897143791647`*^9, 
   3.7995897975932913`*^9},ExpressionUUID->"efd09ae0-a004-4db4-8f52-\
f83974f8cb68"]
}, Open  ]],

Cell["\<\
Dotted/Undotted indices for spinor/twistor/SUSY representation\
\>", "Text",
 CellChangeTimes->{{3.5206058604068623`*^9, 3.52060588746894*^9}, {
  3.526925800319191*^9, 
  3.526925802837124*^9}},ExpressionUUID->"d756f207-6c02-4fc2-b681-\
100fc02a92ec"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"define", " ", 
    RowBox[{"dotted", "/", "undotted"}], " ", "indices", " ", "for", " ", 
    RowBox[{"spinor", "/", "twistor"}], " ", "representations"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"DefineDottedIndices", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DeclareIndexFlavor", "[", 
         RowBox[{"{", 
          RowBox[{"twistor", ",", "Orange"}], "}"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"DeclareBaseIndices", "[", 
         RowBox[{"{", 
          RowBox[{"twistor", ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}]}], "}"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"d0", "[", "a_", "]"}], ":=", 
         RowBox[{"twistor", "@", "a"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"d1", "[", "a_", "]"}], ":=", 
         RowBox[{"twistor", "@", 
          OverscriptBox["a", "."]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"OverBar", " ", "Tensor", " ", "definitions"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBu", "[", 
          RowBox[{"a_", ",", "\[Mu]_"}], "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"OverBar", "[", "a", "]"}], ",", 
           RowBox[{"{", "\[Mu]", "}"}], ",", 
           RowBox[{"{", "Void", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{
         RowBox[{"OBd", "[", 
          RowBox[{"a_", ",", "\[Mu]_"}], "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"OverBar", "[", "a", "]"}], ",", 
           RowBox[{"{", "Void", "}"}], ",", 
           RowBox[{"{", "\[Mu]", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBuu", "[", 
          RowBox[{"a_", ",", "\[Mu]_", ",", "\[Nu]_"}], "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"OverBar", "[", "a", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBud", "[", 
          RowBox[{"a_", ",", "\[Mu]_", ",", "\[Nu]_"}], "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"OverBar", "[", "a", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "Void"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "\[Nu]"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBdd", "[", 
          RowBox[{"a_", ",", "\[Mu]_", ",", "\[Nu]_"}], "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"OverBar", "[", "a", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBuuu", "[", 
          RowBox[{"a_", ",", "\[Mu]_", ",", "\[Nu]_", ",", "\[Alpha]_"}], 
          "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"OverBar", "[", "a", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "\[Nu]", ",", "\[Alpha]"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void", ",", "Void"}], "}"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBduu", "[", 
          RowBox[{"a_", ",", "\[Mu]_", ",", "\[Nu]_", ",", "\[Alpha]_"}], 
          "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"OverBar", "[", "a", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "\[Nu]", ",", "\[Alpha]"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "Void", ",", "Void"}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBudd", "[", 
          RowBox[{"a_", ",", "\[Mu]_", ",", "\[Nu]_", ",", "\[Alpha]_"}], 
          "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"OverBar", "[", "a", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "Void", ",", "Void"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "\[Nu]", ",", "\[Alpha]"}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBuud", "[", 
          RowBox[{"a_", ",", "\[Mu]_", ",", "\[Nu]_", ",", "\[Alpha]_"}], 
          "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"OverBar", "[", "a", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "\[Nu]", ",", "Void"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void", ",", "\[Alpha]"}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBuuud", "[", 
          RowBox[{
          "a_", ",", "\[Mu]_", ",", "\[Nu]_", ",", "\[Alpha]_", ",", 
           "\[Beta]_"}], "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"OverBar", "[", "a", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "\[Nu]", ",", "\[Alpha]", ",", "Void"}], 
            "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void", ",", "Void", ",", "\[Beta]"}], 
            "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBuudu", "[", 
          RowBox[{
          "a_", ",", "\[Mu]_", ",", "\[Nu]_", ",", "\[Alpha]_", ",", 
           "\[Beta]_"}], "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"OverBar", "[", "a", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "\[Nu]", ",", "Void", ",", "\[Beta]"}], 
            "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Void", ",", "Void", ",", "\[Alpha]", ",", "Void"}], 
            "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Default", " ", "\[Sigma]", " ", "index", " ", "expansion"}],
          "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "\[Mu]", "]"}]}], "->", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"udd", "[", 
           RowBox[{"\[Mu]", ",", 
            RowBox[{"d0", "@", "\[Alpha]"}], ",", 
            RowBox[{"d1", "@", "\[Beta]"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBu", "[", 
          RowBox[{"\[Sigma]", ",", "\[Mu]"}], "]"}], "->", 
         RowBox[{"OBuuu", "[", 
          RowBox[{"\[Sigma]", ",", "\[Mu]", ",", 
           RowBox[{"d1", "@", "\[Beta]"}], ",", 
           RowBox[{"d0", "@", "\[Alpha]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"subsigbar", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"OBu", "[", 
             RowBox[{"\[Sigma]", ",", "a_"}], "]"}], ":>", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"a", "=!=", "0"}], ",", 
              RowBox[{"-", 
               RowBox[{"\[Sigma]", "@", 
                RowBox[{"u", "[", "a", "]"}]}]}], ",", 
              RowBox[{"\[Sigma]", "@", 
               RowBox[{"u", "[", "a", "]"}]}]}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"OBd", "[", 
             RowBox[{"\[Sigma]", ",", "a_"}], "]"}], ":>", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"a", "=!=", "0"}], ",", 
              RowBox[{"-", 
               RowBox[{"\[Sigma]", "@", 
                RowBox[{"d", "[", "a", "]"}]}]}], ",", 
              RowBox[{"\[Sigma]", "@", 
               RowBox[{"d", "[", "a", "]"}]}]}], "]"}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Default", " ", 
          RowBox[{"dotted", "/", "undotted"}], " ", "expansion", " ", 
          "function"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AddDotIndex\[Sigma]", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"OBu", "[", 
             RowBox[{"\[Sigma]", ",", "\[Mu]_"}], "]"}], ":>", 
            RowBox[{
             RowBox[{"OBuuu", "[", 
              RowBox[{"\[Sigma]", ",", "\[Mu]", ",", 
               RowBox[{"d1", "@", "a"}], ",", 
               RowBox[{"d0", "@", "b"}]}], "]"}], "/;", 
             RowBox[{"\[Mu]", "=!=", "0"}]}]}], ",", 
           RowBox[{
            RowBox[{"\[Sigma]", "@", 
             RowBox[{"u", "[", "\[Mu]_", "]"}]}], "->", 
            RowBox[{"\[Sigma]", "@", 
             RowBox[{"udd", "[", 
              RowBox[{"\[Mu]", ",", 
               RowBox[{"d0", "@", "b"}], ",", 
               RowBox[{"d1", "@", "a"}]}], "]"}]}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AddDotIndex\[Sigma]\[Sigma]", "[", 
          RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"OBu", "[", 
              RowBox[{"\[Sigma]", ",", "\[Mu]_"}], "]"}], ".", 
             RowBox[{"\[Sigma]", "@", 
              RowBox[{"u", "[", "\[Nu]_", "]"}]}]}], ":>", 
            RowBox[{
             RowBox[{"OBuuu", "[", 
              RowBox[{"\[Sigma]", ",", "\[Mu]", ",", 
               RowBox[{"d1", "@", "a"}], ",", 
               RowBox[{"d0", "@", "b"}]}], "]"}], ".", 
             RowBox[{"\[Sigma]", "@", 
              RowBox[{"udd", "[", 
               RowBox[{"\[Nu]", ",", 
                RowBox[{"d0", "@", "b"}], ",", 
                RowBox[{"d1", "@", "c"}]}], "]"}]}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"\[Sigma]", "@", 
              RowBox[{"u", "[", "\[Mu]_", "]"}]}], ".", 
             RowBox[{"OBu", "[", 
              RowBox[{"\[Sigma]", ",", "\[Nu]_"}], "]"}]}], ":>", 
            RowBox[{
             RowBox[{"\[Sigma]", "@", 
              RowBox[{"udd", "[", 
               RowBox[{"\[Mu]", ",", 
                RowBox[{"d0", "@", "a"}], ",", 
                RowBox[{"d1", "@", "b"}]}], "]"}]}], ".", 
             RowBox[{"OBuuu", "[", 
              RowBox[{"\[Sigma]", ",", "\[Nu]", ",", 
               RowBox[{"d1", "@", "b"}], ",", 
               RowBox[{"d0", "@", "c"}]}], "]"}]}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "additional", " ", "OverBar", " ", "and", " ", "Dotted", " ", 
          "routines"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OBCu", "[", 
          RowBox[{"a_", ",", "\[Mu]_"}], "]"}], ":=", 
         RowBox[{"Tensor", "[", 
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{"OverBar", "[", "a", "]"}], "]"}], ",", 
           RowBox[{"{", "\[Mu]", "}"}], ",", 
           RowBox[{"{", "Void", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{
         RowBox[{"AddOB", "[", "a_Tensor", "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tmp", "=", "a"}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"tmp", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "=", 
             RowBox[{"OverBar", "[", 
              RowBox[{"tmp", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "tmp"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "AddDotted", " ", "adds", " ", "proper", " ", "dotted", " ", 
          "indices", " ", "to", " ", 
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"u", "[", "]"}]}], " ", "and", " ", 
          RowBox[{
           RowBox[{"\[Sigma]", "@", 
            RowBox[{"uu", "[", "]"}]}], "."}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AddDotted", "[", "a_Tensor", "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"tmp", "=", "a"}], ",", 
             RowBox[{"nindex", "=", 
              RowBox[{"Length", "[", 
               RowBox[{"a", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"a", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "=!=", "\[Sigma]"}], "&&", 
               RowBox[{
                RowBox[{"Head", "[", 
                 RowBox[{"a", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "=!=", "OverBar"}]}],
               ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"{", "Void", "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"d0", "@", "$\[Alpha]"}], "}"}]}], "]"}]}]}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"a", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "=!=", 
                OverscriptBox["\[Sigma]", "_"]}], "&&", 
               RowBox[{
                RowBox[{"Head", "[", 
                 RowBox[{"a", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "===", "OverBar"}]}],
               ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"d1", "@", "$\[Alpha]"}], "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], ",", 
                  RowBox[{"{", "Void", "}"}]}], "]"}]}]}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"nindex", "===", "1"}], "&&", 
               RowBox[{
                RowBox[{"a", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "===", "\[Sigma]"}]}], ",", 
              RowBox[{"(*", 
               RowBox[{"for", " ", 
                RowBox[{"\[Sigma]", "@", 
                 RowBox[{"u", "[", "\[Mu]", "]"}]}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Void", ",", "Void"}], "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"d0", "@", "$\[Alpha]"}], ",", 
                    RowBox[{"d1", "@", "$\[Beta]"}]}], "}"}]}], "]"}]}]}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"nindex", "===", "1"}], "&&", 
               RowBox[{
                RowBox[{"a", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "===", 
                OverscriptBox["\[Sigma]", "_"]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Void", ",", "Void"}], "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"d1", "@", "$\[Beta]"}], ",", 
                    RowBox[{"d0", "@", "$\[Alpha]"}]}], "}"}]}], "]"}]}]}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"nindex", "===", "2"}], "&&", 
               RowBox[{
                RowBox[{"a", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "===", "\[Sigma]"}]}], ",", 
              RowBox[{"(*", 
               RowBox[{"for", " ", 
                RowBox[{"\[Sigma]", "@", 
                 RowBox[{"uu", "[", 
                  RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}]}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Void", ",", 
                    RowBox[{"d0", "@", "$\[Beta]"}]}], "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"d0", "@", "$\[Alpha]"}], ",", "Void"}], "}"}]}], 
                 "]"}]}]}]}], "\[IndentingNewLine]", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"nindex", "===", "2"}], "&&", 
               RowBox[{
                RowBox[{"a", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "===", 
                OverscriptBox["\[Sigma]", "_"]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"d1", "@", "$\[Alpha]"}], ",", "Void"}], "}"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Void", ",", 
                    RowBox[{"d1", "@", "$\[Beta]"}]}], "}"}]}], "]"}]}]}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            "tmp"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AddDottedRule", "=", 
         RowBox[{
          RowBox[{"Tensor", "[", 
           RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
          RowBox[{"AddDotted", "[", 
           RowBox[{"Tensor", "[", 
            RowBox[{"a", ",", "b", ",", "c"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "AddDotted1", " ", "adds", " ", "dotted", " ", "indices", " ", 
          "Tensors", " ", 
          RowBox[{"(", 
           RowBox[{"via", " ", "AddDotted"}], ")"}], " ", "and", " ", 
          "nonTensor", " ", 
          RowBox[{"variables", ".", " ", "Correct"}], " ", "indices", " ", 
          "in", " ", "following", " ", 
          RowBox[{"step", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AddDotted1", "[", "a_", "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tmp", "=", "a"}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Head", "[", "tmp", "]"}], "===", "Tensor"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"tmp", "=", 
               RowBox[{"AddDotted", "[", "tmp", "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"!", 
                 RowBox[{"NumericQ", "[", "tmp", "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "[", "tmp", "]"}], "=!=", "OverBar"}], ",",
                   "\[IndentingNewLine]", 
                  RowBox[{"tmp", "=", 
                   RowBox[{"Tensor", "[", 
                    RowBox[{"tmp", ",", 
                    RowBox[{"{", "Void", "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"d0", "@", "$a"}], "}"}]}], "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"tmp", "=", 
                   RowBox[{"Tensor", "[", 
                    RowBox[{"tmp", ",", 
                    RowBox[{"{", 
                    RowBox[{"d1", "@", "$b"}], "}"}], ",", 
                    RowBox[{"{", "Void", "}"}]}], "]"}]}]}], 
                 "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
               "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
            "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "RemoveDotted", " ", "remove", " ", "Dotted", " ", "indices", " ", 
          "from", " ", 
          RowBox[{"Tensor", ".", "  ", "Assumes"}], " ", "Dotted", " ", 
          "indices", " ", "are", " ", "at", " ", "the", " ", 
          RowBox[{"end", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"RemoveDotted", "[", "a_Tensor", "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"tmp", "=", "a"}], ",", "l2a", ",", "length0", ",", "l2",
              ",", "l3", ",", "remove", ",", "list2", ",", "list3"}], "}"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"length0", "=", 
             RowBox[{"Length", "[", 
              RowBox[{"tmp", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"list2", "=", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{"tmp", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"d0", "@", "_"}], "|", 
                RowBox[{"d1", "@", "_"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"list3", "=", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{"tmp", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"d0", "@", "_"}], "|", 
                RowBox[{"d1", "@", "_"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"remove", "=", " ", 
             RowBox[{"Join", "[", 
              RowBox[{"list2", ",", "list3"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tmp", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "=", 
             RowBox[{"Delete", "[", 
              RowBox[{
               RowBox[{"tmp", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "remove"}], "]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tmp", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "=", 
             RowBox[{"Delete", "[", 
              RowBox[{
               RowBox[{"tmp", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", "remove"}], "]"}]}], ";",
             "\[IndentingNewLine]", "tmp"}]}], "\[IndentingNewLine]", "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"RemoveDottedAll", "[", "exp_", "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", 
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
              RowBox[{"RemoveDotted", "[", 
               RowBox[{"Tensor", "[", 
                RowBox[{"a", ",", "b", ",", "c"}], "]"}], "]"}]}]}]}]}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"RemoveDottedRule", "=", 
         RowBox[{
          RowBox[{"Tensor", "[", 
           RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], ":>", 
          RowBox[{"RemoveDotted", "[", 
           RowBox[{"Tensor", "[", 
            RowBox[{"a", ",", "b", ",", "c"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Some", " ", "SUSY", " ", "identities", " ", "with", " ", "Weyl", 
          " ", "spinors"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"subWeyl", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Transpose", "[", "\[Alpha]", "]"}], ".", "A", ".", 
            "\[Beta]"}], "->", 
           RowBox[{"-", 
            RowBox[{
             RowBox[{"Transpose", "[", "\[Beta]", "]"}], ".", 
             RowBox[{"Transpose", "[", "A", "]"}], ".", "\[Alpha]"}]}]}], 
          "\[IndentingNewLine]", "}"}]}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.520605892252281*^9, {3.520605965616035*^9, 3.5206059778487043`*^9}, {
   3.5246161897855*^9, 3.524616221712633*^9}, {3.52461758210124*^9, 
   3.5246176101621227`*^9}, {3.524621754894805*^9, 3.524621806113892*^9}, {
   3.524655632242281*^9, 3.524655692522332*^9}, {3.524672449476449*^9, 
   3.524672535752029*^9}, {3.524672577490987*^9, 3.524672647677272*^9}, {
   3.524673874776582*^9, 3.5246738755696077`*^9}, {3.52470423871179*^9, 
   3.524704294815878*^9}, {3.524708251775449*^9, 3.524708253374915*^9}, {
   3.524709448953209*^9, 3.5247094546399803`*^9}, {3.524743197891663*^9, 
   3.524743330350456*^9}, {3.524743378752625*^9, 3.524743438017548*^9}, {
   3.5247434936732616`*^9, 3.524743502519956*^9}, {3.5247438771976137`*^9, 
   3.52474390458594*^9}, {3.524884358808598*^9, 3.524884410440493*^9}, 
   3.5249285493450193`*^9, {3.526089507784247*^9, 3.526089706810973*^9}, {
   3.526089745962099*^9, 3.526089770671084*^9}, {3.526089860395155*^9, 
   3.526089933261153*^9}, {3.5260903715710278`*^9, 3.526090372364642*^9}, {
   3.526130299002017*^9, 3.5261303111851254`*^9}, {3.526250468315283*^9, 
   3.526250547045397*^9}, {3.526925641076002*^9, 3.526925719519319*^9}, {
   3.5269258354644213`*^9, 3.526925868285638*^9}, {3.5269259958136683`*^9, 
   3.526926112996401*^9}, {3.52733640943672*^9, 3.527336474994605*^9}, {
   3.527336536632595*^9, 3.52733655202465*^9}, {3.527336622104604*^9, 
   3.527336681218379*^9}, {3.527336744320376*^9, 3.5273367602419577`*^9}, {
   3.5273368012286167`*^9, 3.527336828448324*^9}, {3.527337169109803*^9, 
   3.5273372474556103`*^9}, {3.527337285871078*^9, 3.527337359249517*^9}, {
   3.527337408419754*^9, 3.527337409826665*^9}, {3.527337447687907*^9, 
   3.527337584863031*^9}, {3.527337665042701*^9, 3.527337780717963*^9}, 
   3.527337822656946*^9, {3.527337909695936*^9, 3.5273380635734797`*^9}, {
   3.527338128606709*^9, 3.527338137622954*^9}, {3.542807695464113*^9, 
   3.542807825902419*^9}, {3.542807869536427*^9, 3.542807870046032*^9}, 
   3.542807913362625*^9, {3.5436671197325087`*^9, 3.543667131874216*^9}, {
   3.543669777075658*^9, 3.543669832852623*^9}, {3.5436700327751923`*^9, 
   3.543670035086544*^9}, {3.5436702955328903`*^9, 3.543670315163862*^9}, {
   3.566304355836576*^9, 3.566304360696828*^9}, {3.566304402417389*^9, 
   3.566304443479583*^9}, {3.573995161145712*^9, 3.5739951704396048`*^9}, {
   3.583372796789064*^9, 3.5833728514198227`*^9}, {3.5833729256926603`*^9, 
   3.583372933297921*^9}, 3.600691675236071*^9, 3.600790925642868*^9, 
   3.600791028101528*^9, {3.6203974260091257`*^9, 3.6203974326125383`*^9}, 
   3.631883095860264*^9, {3.631883261291581*^9, 3.6318833649529057`*^9}, {
   3.661352588493905*^9, 3.661352601059908*^9}, {3.661352641211375*^9, 
   3.661352939837595*^9}, {3.661355090555849*^9, 3.6613550973489637`*^9}, 
   3.6615458009220552`*^9, {3.6615458793697166`*^9, 3.6615458842149467`*^9}, {
   3.66654243221872*^9, 
   3.6665424464937*^9}},ExpressionUUID->"d8de14d8-e2a0-4cd4-8eeb-\
ce4fbda04a40"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Column", "[", 
   RowBox[{"subWeyl", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", "\[Alpha]", "]"}], ".", "A", ".", 
        "\[Beta]"}], "->", 
       RowBox[{"-", 
        RowBox[{
         RowBox[{"Transpose", "[", "\[Beta]", "]"}], ".", 
         RowBox[{"Transpose", "[", "A", "]"}], ".", "\[Alpha]"}]}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Chi]", ".", "\[Lambda]"}], "->", 
       RowBox[{
        RowBox[{"Transpose", "[", "\[Chi]", "]"}], ".", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "I"}], " ", 
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"u", "[", "2", "]"}]}]}], ")"}], ".", "\[Lambda]"}]}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        OverscriptBox["\[Chi]", "_"], ".", 
        OverscriptBox["\[Lambda]", "_"]}], "->", 
       RowBox[{
        SuperscriptBox["\[Chi]", "\[Dagger]"], ".", 
        RowBox[{"(", 
         RowBox[{"I", " ", 
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"u", "[", "2", "]"}]}]}], ")"}], ".", 
        RowBox[{"Transpose", "[", 
         SuperscriptBox["\[Lambda]", "\[Dagger]"], "]"}]}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Chi]", ".", "\[Lambda]"}], "->", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Chi]u", "[", 
          RowBox[{"d0", "@", "a"}], "]"}], ".", 
         RowBox[{"T", "[", 
          RowBox[{"\[Lambda]", ",", "\"\<d\>\"", ",", 
           RowBox[{"{", 
            RowBox[{"d0", "@", "a"}], "}"}]}], "]"}]}], "->", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Chi]d", "[", 
           RowBox[{"d0", "@", "a"}], "]"}], ".", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "I"}], " ", 
            RowBox[{"T", "[", 
             RowBox[{"\[Sigma]", ",", "\"\<uuu\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", 
                RowBox[{"d0", "@", "a"}], ",", 
                RowBox[{"d0", "@", "b"}]}], "}"}]}], "]"}]}], ")"}], ".", 
          RowBox[{"T", "[", 
           RowBox[{"\[Lambda]", ",", "\"\<d\>\"", ",", 
            RowBox[{"{", 
             RowBox[{"d0", "@", "a"}], "}"}]}], "]"}]}], "->", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Chi]d", "[", "2", "]"}], ".", 
           RowBox[{"\[Lambda]d", "[", "1", "]"}]}], "-", 
          RowBox[{
           RowBox[{"\[Chi]d", "[", "1", "]"}], ".", 
           RowBox[{"\[Lambda]d", "[", "2", "]"}]}]}]}]}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        OverscriptBox["\[Chi]", "_"], ".", 
        RowBox[{"T", "[", 
         RowBox[{
          OverscriptBox["\[Sigma]", "_"], ",", "\"\<u\>\"", ",", 
          RowBox[{"{", "\[Mu]", "}"}]}], "]"}], ".", "\[Lambda]"}], "->", 
       RowBox[{"-", 
        RowBox[{"\[Lambda]", ".", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "\[Mu]", "]"}]}], ".", 
         OverscriptBox["\[Chi]", "_"]}]}]}]}], "\[IndentingNewLine]", "}"}]}],
    "]"}], 
  RowBox[{"(*", 
   RowBox[{"ref", ":", "Labelle"}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.526926138138111*^9, 3.526926216208303*^9}, {
  3.526926269065487*^9, 3.526926736821856*^9}, {3.5269273571500263`*^9, 
  3.526927472008397*^9}, {3.5833728580332317`*^9, 
  3.583372864081295*^9}},ExpressionUUID->"5629597f-dc01-4310-b751-\
ce90822ccf83"],

Cell[BoxData[
 TagBox[GridBox[{
    {
     RowBox[{
      RowBox[{
       InterpretationBox[
        TemplateBox[{"\[Alpha]","T"},
         "Superscript"],
        Transpose[$CellContext`\[Alpha]],
        Editable->False,
        SyntaxForm->Automatic], ".", "A", ".", "\[Beta]"}], "\[Rule]", 
      RowBox[{"-", 
       RowBox[{
        InterpretationBox[
         TemplateBox[{"\[Beta]","T"},
          "Superscript"],
         Transpose[$CellContext`\[Beta]],
         Editable->False,
         SyntaxForm->Automatic], ".", 
        InterpretationBox[
         TemplateBox[{"A","T"},
          "Superscript"],
         Transpose[$CellContext`A],
         Editable->False,
         SyntaxForm->Automatic], ".", "\[Alpha]"}]}]}]},
    {
     RowBox[{
      RowBox[{"\[Chi]", ".", "\[Lambda]"}], "\[Rule]", 
      RowBox[{
       InterpretationBox[
        TemplateBox[{"\[Chi]","T"},
         "Superscript"],
        Transpose[$CellContext`\[Chi]],
        Editable->False,
        SyntaxForm->Automatic], ".", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{"\[Sigma]", "[", 
          RowBox[{"u", "[", "2", "]"}], "]"}]}], ")"}], ".", 
       "\[Lambda]"}]}]},
    {
     RowBox[{
      RowBox[{
       OverscriptBox["\[Chi]", "_"], ".", 
       OverscriptBox["\[Lambda]", "_"]}], "\[Rule]", 
      RowBox[{
       SuperscriptBox["\[Chi]", "\[Dagger]"], ".", 
       RowBox[{"(", 
        RowBox[{"\[ImaginaryI]", " ", 
         RowBox[{"\[Sigma]", "[", 
          RowBox[{"u", "[", "2", "]"}], "]"}]}], ")"}], ".", 
       InterpretationBox[
        TemplateBox[{SuperscriptBox["\[Lambda]", "\[Dagger]"],"T"},
         "Superscript"],
        Transpose[
         SuperDagger[$CellContext`\[Lambda]]],
        Editable->False,
        SyntaxForm->Automatic]}]}]},
    {
     RowBox[{
      RowBox[{"\[Chi]", ".", "\[Lambda]"}], "\[Rule]", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Chi]u", "[", 
         RowBox[{"d0", "[", "a", "]"}], "]"}], ".", 
        InterpretationBox[
         SubsuperscriptBox["\[Lambda]", 
          RowBox[{"d0", "[", "a", "]"}], 
          StyleBox[
           RowBox[{"d0", "[", "a", "]"}],
           StripOnInput->False,
           ShowContents->False]],
         $CellContext`Tensor[$CellContext`\[Lambda], {$CellContext`Void}, {
           $CellContext`d0[$CellContext`a]}],
         BaseStyle->{AutoMultiplicationSymbol -> False},
         Editable->False]}], "\[Rule]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Chi]d", "[", 
          RowBox[{"d0", "[", "a", "]"}], "]"}], ".", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "\[ImaginaryI]"}], " ", 
           InterpretationBox[
            SubsuperscriptBox["\[Sigma]", 
             StyleBox[
              RowBox[{"2", 
               RowBox[{"d0", "[", "a", "]"}], 
               RowBox[{"d0", "[", "b", "]"}]}],
              StripOnInput->False,
              ShowContents->False], 
             RowBox[{"2", 
              RowBox[{"d0", "[", "a", "]"}], 
              RowBox[{"d0", "[", "b", "]"}]}]],
            $CellContext`Tensor[$CellContext`\[Sigma], {2, 
              $CellContext`d0[$CellContext`a], 
              $CellContext`d0[$CellContext`b]}, {$CellContext`Void, \
$CellContext`Void, $CellContext`Void}],
            BaseStyle->{AutoMultiplicationSymbol -> False},
            Editable->False]}], ")"}], ".", 
         InterpretationBox[
          SubsuperscriptBox["\[Lambda]", 
           RowBox[{"d0", "[", "a", "]"}], 
           StyleBox[
            RowBox[{"d0", "[", "a", "]"}],
            StripOnInput->False,
            ShowContents->False]],
          $CellContext`Tensor[$CellContext`\[Lambda], {$CellContext`Void}, {
            $CellContext`d0[$CellContext`a]}],
          BaseStyle->{AutoMultiplicationSymbol -> False},
          Editable->False]}], "\[Rule]", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{
           RowBox[{"\[Chi]d", "[", "1", "]"}], ".", 
           RowBox[{"\[Lambda]d", "[", "2", "]"}]}]}], "+", 
         RowBox[{
          RowBox[{"\[Chi]d", "[", "2", "]"}], ".", 
          RowBox[{"\[Lambda]d", "[", "1", "]"}]}]}]}]}]}]},
    {
     RowBox[{
      RowBox[{
       OverscriptBox["\[Chi]", "_"], ".", 
       InterpretationBox[
        SubsuperscriptBox[
         OverscriptBox["\[Sigma]", "_"], 
         StyleBox["\[Mu]",
          StripOnInput->False,
          ShowContents->False], "\[Mu]"],
        $CellContext`Tensor[
         OverBar[$CellContext`\[Sigma]], {$CellContext`\[Mu]}, \
{$CellContext`Void}],
        BaseStyle->{AutoMultiplicationSymbol -> False},
        Editable->False], ".", "\[Lambda]"}], "\[Rule]", 
      RowBox[{"-", 
       RowBox[{"\[Lambda]", ".", 
        RowBox[{"\[Sigma]", "[", 
         RowBox[{"u", "[", "\[Mu]", "]"}], "]"}], ".", 
        OverscriptBox["\[Chi]", "_"]}]}]}]}
   },
   DefaultBaseStyle->"Column",
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
  "Column"]], "Output",
 CellChangeTimes->{
  3.620398127253579*^9, 3.620398933670849*^9, 3.620398981416493*^9, 
   3.6313758827053843`*^9, 3.6318008081649103`*^9, 3.631800842484462*^9, 
   3.6334628225725107`*^9, 3.6343096145030537`*^9, 3.634310215827281*^9, 
   3.6724462778319407`*^9, 3.672446310084469*^9, {3.695141640737874*^9, 
   3.6951416638983717`*^9}, 3.735089946477935*^9, 3.744973072103434*^9, 
   3.799589238844008*^9, 
   3.799589278637314*^9},ExpressionUUID->"f5952000-68a6-4eb2-b48c-\
3f8279a689b9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 TagBox[GridBox[{
    {
     RowBox[{
      RowBox[{
       InterpretationBox[
        TemplateBox[{"\[Alpha]","T"},
         "Superscript"],
        Transpose[$CellContext`\[Alpha]],
        Editable->False,
        SyntaxForm->Automatic], ".", "A", ".", "\[Beta]"}], "\[Rule]", 
      RowBox[{"-", 
       RowBox[{
        InterpretationBox[
         TemplateBox[{"\[Beta]","T"},
          "Superscript"],
         Transpose[$CellContext`\[Beta]],
         Editable->False,
         SyntaxForm->Automatic], ".", 
        InterpretationBox[
         TemplateBox[{"A","T"},
          "Superscript"],
         Transpose[$CellContext`A],
         Editable->False,
         SyntaxForm->Automatic], ".", "\[Alpha]"}]}]}]},
    {
     RowBox[{
      RowBox[{"\[Chi]", ".", "\[Lambda]"}], "\[Rule]", 
      RowBox[{
       InterpretationBox[
        TemplateBox[{"\[Chi]","T"},
         "Superscript"],
        Transpose[$CellContext`\[Chi]],
        Editable->False,
        SyntaxForm->Automatic], ".", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "2", "]"}]}]}], ")"}], ".", "\[Lambda]"}]}]},
    {
     RowBox[{
      RowBox[{
       OverscriptBox["\[Chi]", "_"], ".", 
       OverscriptBox["\[Lambda]", "_"]}], "\[Rule]", 
      RowBox[{
       SuperscriptBox["\[Chi]", "\[Dagger]"], ".", 
       RowBox[{"(", 
        RowBox[{"\[ImaginaryI]", " ", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "2", "]"}]}]}], ")"}], ".", 
       InterpretationBox[
        TemplateBox[{SuperscriptBox["\[Lambda]", "\[Dagger]"],"T"},
         "Superscript"],
        Transpose[
         SuperDagger[$CellContext`\[Lambda]]],
        Editable->False,
        SyntaxForm->Automatic]}]}]},
    {
     RowBox[{
      RowBox[{"\[Chi]", ".", "\[Lambda]"}], "\[Rule]", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Chi]u", "[", 
         RowBox[{"d0", "[", "a", "]"}], "]"}], ".", 
        InterpretationBox[
         SubsuperscriptBox["\[Lambda]", 
          RowBox[{"d0", "[", "a", "]"}], 
          StyleBox[
           RowBox[{"d0", "[", "a", "]"}],
           StripOnInput->False,
           ShowContents->False]],
         TensorCalculus5`Tensorial`Tensor[$CellContext`\[Lambda], {
          TensorCalculus5`Tensorial`Void}, {
           $CellContext`d0[$CellContext`a]}],
         BaseStyle->{AutoMultiplicationSymbol -> False},
         Editable->False]}], "\[Rule]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Chi]d", "[", 
          RowBox[{"d0", "[", "a", "]"}], "]"}], ".", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "\[ImaginaryI]"}], " ", 
           InterpretationBox[
            SubsuperscriptBox["\[Sigma]", 
             StyleBox[
              RowBox[{"2", 
               RowBox[{"d0", "[", "a", "]"}], 
               RowBox[{"d0", "[", "b", "]"}]}],
              StripOnInput->False,
              ShowContents->False], 
             RowBox[{"2", 
              RowBox[{"d0", "[", "a", "]"}], 
              RowBox[{"d0", "[", "b", "]"}]}]],
            TensorCalculus5`Tensorial`Tensor[$CellContext`\[Sigma], {2, 
              $CellContext`d0[$CellContext`a], 
              $CellContext`d0[$CellContext`b]}, {
             TensorCalculus5`Tensorial`Void, TensorCalculus5`Tensorial`Void, 
              TensorCalculus5`Tensorial`Void}],
            BaseStyle->{AutoMultiplicationSymbol -> False},
            Editable->False]}], ")"}], ".", 
         InterpretationBox[
          SubsuperscriptBox["\[Lambda]", 
           RowBox[{"d0", "[", "a", "]"}], 
           StyleBox[
            RowBox[{"d0", "[", "a", "]"}],
            StripOnInput->False,
            ShowContents->False]],
          
          TensorCalculus5`Tensorial`Tensor[$CellContext`\[Lambda], {
           TensorCalculus5`Tensorial`Void}, {
            $CellContext`d0[$CellContext`a]}],
          BaseStyle->{AutoMultiplicationSymbol -> False},
          Editable->False]}], "\[Rule]", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{
           RowBox[{"\[Chi]d", "[", "1", "]"}], ".", 
           RowBox[{"\[Lambda]d", "[", "2", "]"}]}]}], "+", 
         RowBox[{
          RowBox[{"\[Chi]d", "[", "2", "]"}], ".", 
          RowBox[{"\[Lambda]d", "[", "1", "]"}]}]}]}]}]}]},
    {
     RowBox[{
      RowBox[{
       OverscriptBox["\[Chi]", "_"], ".", 
       InterpretationBox[
        SubsuperscriptBox[
         OverscriptBox["\[Sigma]", "_"], 
         StyleBox["\[Mu]",
          StripOnInput->False,
          ShowContents->False], "\[Mu]"],
        TensorCalculus5`Tensorial`Tensor[
         OverBar[$CellContext`\[Sigma]], {$CellContext`\[Mu]}, {
         TensorCalculus5`Tensorial`Void}],
        BaseStyle->{AutoMultiplicationSymbol -> False},
        Editable->False], ".", "\[Lambda]"}], "\[Rule]", 
      RowBox[{"-", 
       RowBox[{"\[Lambda]", ".", 
        RowBox[{"\[Sigma]", "@", 
         RowBox[{"u", "[", "\[Mu]", "]"}]}], ".", 
        OverscriptBox["\[Chi]", "_"]}]}]}]}
   },
   DefaultBaseStyle->"Column",
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
  "Column"]], "Input",
 CellChangeTimes->{{3.583372871910316*^9, 
  3.583372878795154*^9}},ExpressionUUID->"96614df9-e151-45d5-a3ef-\
b8c44ba0e8a9"],

Cell[BoxData[
 TagBox[GridBox[{
    {
     RowBox[{
      RowBox[{
       InterpretationBox[
        TemplateBox[{"\[Alpha]","T"},
         "Superscript"],
        Transpose[$CellContext`\[Alpha]],
        Editable->False,
        SyntaxForm->Automatic], ".", "A", ".", "\[Beta]"}], "\[Rule]", 
      RowBox[{"-", 
       RowBox[{
        InterpretationBox[
         TemplateBox[{"\[Beta]","T"},
          "Superscript"],
         Transpose[$CellContext`\[Beta]],
         Editable->False,
         SyntaxForm->Automatic], ".", 
        InterpretationBox[
         TemplateBox[{"A","T"},
          "Superscript"],
         Transpose[$CellContext`A],
         Editable->False,
         SyntaxForm->Automatic], ".", "\[Alpha]"}]}]}]},
    {
     RowBox[{
      RowBox[{"\[Chi]", ".", "\[Lambda]"}], "\[Rule]", 
      RowBox[{
       InterpretationBox[
        TemplateBox[{"\[Chi]","T"},
         "Superscript"],
        Transpose[$CellContext`\[Chi]],
        Editable->False,
        SyntaxForm->Automatic], ".", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{"\[Sigma]", "[", 
          RowBox[{"u", "[", "2", "]"}], "]"}]}], ")"}], ".", 
       "\[Lambda]"}]}]},
    {
     RowBox[{
      RowBox[{
       OverscriptBox["\[Chi]", "_"], ".", 
       OverscriptBox["\[Lambda]", "_"]}], "\[Rule]", 
      RowBox[{
       SuperscriptBox["\[Chi]", "\[Dagger]"], ".", 
       RowBox[{"(", 
        RowBox[{"\[ImaginaryI]", " ", 
         RowBox[{"\[Sigma]", "[", 
          RowBox[{"u", "[", "2", "]"}], "]"}]}], ")"}], ".", 
       InterpretationBox[
        TemplateBox[{SuperscriptBox["\[Lambda]", "\[Dagger]"],"T"},
         "Superscript"],
        Transpose[
         SuperDagger[$CellContext`\[Lambda]]],
        Editable->False,
        SyntaxForm->Automatic]}]}]},
    {
     RowBox[{
      RowBox[{"\[Chi]", ".", "\[Lambda]"}], "\[Rule]", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Chi]u", "[", 
         RowBox[{"d0", "[", "a", "]"}], "]"}], ".", 
        RowBox[{"TensorCalculus5`Tensorial`Tensor", "[", 
         RowBox[{"\[Lambda]", ",", 
          RowBox[{"{", "TensorCalculus5`Tensorial`Void", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"d0", "[", "a", "]"}], "}"}]}], "]"}]}], "\[Rule]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Chi]d", "[", 
          RowBox[{"d0", "[", "a", "]"}], "]"}], ".", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "\[ImaginaryI]"}], " ", 
           RowBox[{"TensorCalculus5`Tensorial`Tensor", "[", 
            RowBox[{"\[Sigma]", ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", 
               RowBox[{"d0", "[", "a", "]"}], ",", 
               RowBox[{"d0", "[", "b", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "TensorCalculus5`Tensorial`Void", ",", 
               "TensorCalculus5`Tensorial`Void", ",", 
               "TensorCalculus5`Tensorial`Void"}], "}"}]}], "]"}]}], ")"}], 
         ".", 
         RowBox[{"TensorCalculus5`Tensorial`Tensor", "[", 
          RowBox[{"\[Lambda]", ",", 
           RowBox[{"{", "TensorCalculus5`Tensorial`Void", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"d0", "[", "a", "]"}], "}"}]}], "]"}]}], "\[Rule]", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{
           RowBox[{"\[Chi]d", "[", "1", "]"}], ".", 
           RowBox[{"\[Lambda]d", "[", "2", "]"}]}]}], "+", 
         RowBox[{
          RowBox[{"\[Chi]d", "[", "2", "]"}], ".", 
          RowBox[{"\[Lambda]d", "[", "1", "]"}]}]}]}]}]}]},
    {
     RowBox[{
      RowBox[{
       OverscriptBox["\[Chi]", "_"], ".", 
       RowBox[{"TensorCalculus5`Tensorial`Tensor", "[", 
        RowBox[{
         OverscriptBox["\[Sigma]", "_"], ",", 
         RowBox[{"{", "\[Mu]", "}"}], ",", 
         RowBox[{"{", "TensorCalculus5`Tensorial`Void", "}"}]}], "]"}], ".", 
       "\[Lambda]"}], "\[Rule]", 
      RowBox[{"-", 
       RowBox[{"\[Lambda]", ".", 
        RowBox[{"\[Sigma]", "[", 
         RowBox[{"u", "[", "\[Mu]", "]"}], "]"}], ".", 
        OverscriptBox["\[Chi]", "_"]}]}]}]}
   },
   DefaultBaseStyle->"Column",
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
  "Column"]], "Output",
 CellChangeTimes->{
  3.6203981279020777`*^9, 3.6203989350856047`*^9, 3.62039898199268*^9, 
   3.631375884890411*^9, 3.6318008081960783`*^9, 3.631800842503167*^9, 
   3.633462822603799*^9, 3.63430961472362*^9, 3.6343102158496313`*^9, 
   3.672446277867673*^9, 3.672446310119894*^9, {3.6951416407671947`*^9, 
   3.695141663953698*^9}, 3.7350899465339613`*^9, 3.744973072180464*^9, 
   3.799589238976644*^9, 
   3.799589278788302*^9},ExpressionUUID->"fa5f6e9b-4605-4a74-91f3-\
8a5fd64b9cee"]
}, Open  ]],

Cell["Gamma matrix technology", "Text",
 CellChangeTimes->{{3.475328083875739*^9, 
  3.4753280940834923`*^9}},ExpressionUUID->"a1ef8199-5caf-4e7a-872b-\
111d2d1f4087"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Pauli", " ", "and", " ", "Gamma", " ", "matrix", " ", "identities"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"tuGammaList", "::", "usage"}], ":=", 
     "\"\<tuGammaList[indices_List,dot_:Dot] returns dot_'d \[Gamma](up)'s \
with indices_List.  *18Jan2013*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuGammaList", "[", 
      RowBox[{"indices_List", ",", 
       RowBox[{"dot_:", "Dot"}]}], "]"}], ":=", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"T", "[", 
         RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
          RowBox[{"{", "i", "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "indices"}], "}"}]}], "]"}], "//", 
      RowBox[{
       RowBox[{"Apply", "[", 
        RowBox[{"dot", ",", "#"}], "]"}], "&"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Gamma]dot", ":=", "tuGammaList"}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuPauliMatrices", "::", "usage"}], "=", 
     "\"\<tuPauliMatrices are Rule[]s for expanding Pauli \[Sigma]-matrices \
to common 2x2 representation. *22Mar2016*\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuPauliMatrices", ":=", "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Sigma]", ",", "\"\<u\>\"", ",", 
           RowBox[{"{", "1", "}"}]}], "]"}], "|", 
         RowBox[{"T", "[", 
          RowBox[{"\[Sigma]", ",", "\"\<d\>\"", ",", 
           RowBox[{"{", "1", "}"}]}], "]"}]}], "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0"}], "}"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Sigma]", ",", "\"\<u\>\"", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}], "|", 
         RowBox[{"T", "[", 
          RowBox[{"\[Sigma]", ",", "\"\<d\>\"", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}]}], "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", "I"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"I", ",", "0"}], "}"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Sigma]", ",", "\"\<u\>\"", ",", 
           RowBox[{"{", "3", "}"}]}], "]"}], "|", 
         RowBox[{"T", "[", 
          RowBox[{"\[Sigma]", ",", "\"\<d\>\"", ",", 
           RowBox[{"{", "3", "}"}]}], "]"}]}], "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Sigma]", ",", "\"\<u\>\"", ",", 
           RowBox[{"{", "0", "}"}]}], "]"}], "|", 
         RowBox[{"T", "[", 
          RowBox[{"\[Sigma]", ",", "\"\<d\>\"", ",", 
           RowBox[{"{", "0", "}"}]}], "]"}]}], "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        SubscriptBox["1", "2"], "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        SubscriptBox["0", "2"], "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}]}], "}"}]}]}], "\[IndentingNewLine]",
       "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuPauliExpand", ":=", "tuPauliMatrices"}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sPauli", ":=", "tuPauliMatrices"}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Gamma", " ", "matrix", " ", "identities", " ", "*", "12", "May2018", 
     "*"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "tuGammaIdentities", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuGammaIdentities", "::", "usage"}], "=", 
     "\"\<tuGammaIdentities returns a list of Rules that represent Dirac \
gamma matrices.  Dot[] is used to indicate matrix multiply. *5Sep2018*\>\""}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuGammaIdentities", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", ",", "$1"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "\[Mu]_", 
              "]"}], ".", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "\[Mu]_", 
              "]"}]}], "->", 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
             RowBox[{"\[Mu]", ",", "\[Mu]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<d\>\""}], "]"}], "[", "\[Mu]_", 
              "]"}], ".", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<d\>\""}], "]"}], "[", "\[Mu]_", 
              "]"}]}], "->", 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"g", ",", "\"\<dd\>\""}], "]"}], "[", 
             RowBox[{"\[Mu]", ",", "\[Mu]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$", "=", 
             RowBox[{
              RowBox[{"CommutatorP", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "\[Mu]",
                  "]"}], ",", 
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "\[Nu]",
                  "]"}]}], "]"}], "->", 
              RowBox[{"2", " ", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
                RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"$", "//", 
             RowBox[{"tuAddPatternVariable", "[", 
              RowBox[{"{", 
               RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$", "=", 
             RowBox[{"$", "/.", "tuCommutatorExpand"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"$", "//", 
             RowBox[{"tuAddPatternVariable", "[", 
              RowBox[{"{", 
               RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"$", "//", 
              RowBox[{"tuRuleSolveF", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "\[Mu]",
                  "]"}], ".", 
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "\[Nu]",
                  "]"}]}], "]"}]}], "//", "First"}], "//", 
            RowBox[{"tuAddPatternVariable", "[", 
             RowBox[{"{", 
              RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "]"}]}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$", "=", 
             RowBox[{
              RowBox[{"CommutatorP", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"\[Gamma]", ",", "\"\<d\>\""}], "]"}], "[", "\[Mu]",
                  "]"}], ",", 
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"\[Gamma]", ",", "\"\<d\>\""}], "]"}], "[", "\[Nu]",
                  "]"}]}], "]"}], "->", 
              RowBox[{"2", " ", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"g", ",", "\"\<dd\>\""}], "]"}], "[", 
                RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"$", "//", 
             RowBox[{"tuAddPatternVariable", "[", 
              RowBox[{"{", 
               RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$", "=", 
             RowBox[{"$", "/.", "tuCommutatorExpand"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"$", "//", 
             RowBox[{"tuAddPatternVariable", "[", 
              RowBox[{"{", 
               RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"$", "//", 
              RowBox[{"tuRuleSolveF", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"\[Gamma]", ",", "\"\<d\>\""}], "]"}], "[", "\[Mu]",
                  "]"}], ".", 
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"\[Gamma]", ",", "\"\<d\>\""}], "]"}], "[", "\[Nu]",
                  "]"}]}], "]"}]}], "//", "First"}], "//", 
            RowBox[{"tuAddPatternVariable", "[", 
             RowBox[{"{", 
              RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "]"}]}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
              RowBox[{"{", "5", "}"}]}], "]"}], "->", 
            RowBox[{"I", " ", 
             RowBox[{"tuGammaList", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1", ",", "2", ",", "3"}], "}"}], "]"}]}]}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ConjugateTranspose", "[", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "5", "}"}]}], "]"}], "]"}], "\[Rule]", 
            RowBox[{"T", "[", 
             RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
              RowBox[{"{", "5", "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
           
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "5", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "5", "}"}]}], "]"}]}], "\[Rule]", 
            SubscriptBox["1", "4"]}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"tuGammaList", "[", 
             RowBox[{"{", 
              RowBox[{"0", ",", "5", ",", "0"}], "}"}], "]"}], "->", 
            RowBox[{"T", "[", 
             RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
              RowBox[{"{", "5", "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"$", "=", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
                RowBox[{"{", "\[Mu]_", "}"}]}], "]"}], "]"}], "->", 
             RowBox[{"tuGammaList", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Mu]", ",", "0"}], "}"}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"$", "//", 
            RowBox[{"tuIndicesLower", "[", 
             RowBox[{"{", 
              RowBox[{"\[Mu]", ",", "\[Mu]_"}], "}"}], "]"}]}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$", "=", 
             RowBox[{
              RowBox[{"CommutatorP", "[", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
                  RowBox[{"{", "\[Mu]", "}"}]}], "]"}], ",", 
                RowBox[{"T", "[", 
                 RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
                  RowBox[{"{", "5", "}"}]}], "]"}]}], "]"}], "->", "0"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"$", "//", 
             RowBox[{"tuAddPatternVariable", "[", "\[Mu]", "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$", "=", 
             RowBox[{"$", "/.", "tuCommutatorExpand"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tuRuleDelayAdd", "[", 
              RowBox[{"$", ",", 
               RowBox[{"\[Mu]", "!=", "5"}]}], "]"}], "//", 
             RowBox[{"tuAddPatternVariable", "[", "\[Mu]", "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$1", "=", 
             RowBox[{
              RowBox[{"$", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[Rule]", 
              RowBox[{
               RowBox[{"$", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", 
               RowBox[{"$", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tuRuleDelayAdd", "[", 
              RowBox[{"$1", ",", 
               RowBox[{"\[Mu]", "!=", "5"}]}], "]"}], "//", 
             RowBox[{"tuAddPatternVariable", "[", "\[Mu]", "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$1", "=", 
             RowBox[{
              RowBox[{"$", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2"}], "]"}], "]"}], "\[Rule]", 
              RowBox[{
               RowBox[{"$", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", 
               RowBox[{"$", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tuRuleDelayAdd", "[", 
              RowBox[{"$1", ",", 
               RowBox[{"\[Mu]", "!=", "5"}]}], "]"}], "//", 
             RowBox[{"tuAddPatternVariable", "[", "\[Mu]", "]"}]}]}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}]}], "->", 
            RowBox[{"4", " ", 
             SubscriptBox["1", "4"]}]}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "b_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}]}], "->", 
            RowBox[{
             RowBox[{"-", "2"}], " ", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "b", "}"}]}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "b_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}]}], "->", 
            RowBox[{
             RowBox[{"-", "2"}], " ", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "b", "}"}]}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "b_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "c_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}]}], "\[Rule]", 
            "\[IndentingNewLine]", 
            RowBox[{"4", " ", 
             RowBox[{"T", "[", 
              RowBox[{"\[Eta]", ",", "\"\<uu\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"b", ",", "c"}], "}"}]}], "]"}], 
             SubscriptBox["1", "4"]}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "b_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "c_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}]}], "->", 
            RowBox[{"4", " ", 
             RowBox[{"T", "[", 
              RowBox[{"\[Eta]", ",", "\"\<uu\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"b", ",", "c"}], "}"}]}], "]"}], " ", 
             SubscriptBox["1", "4"]}]}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "b_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "c_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "d_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}]}], "\[Rule]", 
            RowBox[{
             RowBox[{"-", "2"}], 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
                RowBox[{"{", "d", "}"}]}], "]"}], ".", 
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
                RowBox[{"{", "c", "}"}]}], "]"}], ".", 
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
                RowBox[{"{", "b", "}"}]}], "]"}]}]}]}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "b_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "c_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "d_", "}"}]}], "]"}], ".", 
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
               RowBox[{"{", "a_", "}"}]}], "]"}]}], "\[Rule]", 
            RowBox[{
             RowBox[{"-", "2"}], 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
                RowBox[{"{", "d", "}"}]}], "]"}], ".", 
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
                RowBox[{"{", "c", "}"}]}], "]"}], ".", 
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<d\>\"", ",", 
                RowBox[{"{", "b", "}"}]}], "]"}]}]}]}]}], 
          "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", "$"}]}],
       "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Gamma", " ", "matrices", " ", "in", " ", "Pauli", " ", "matrices"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuGammaPauli", "::", "usage"}], "=", 
     "\"\<tuGammaPauli[basis_] gives List[]s of Rule for Gamma matrices in \
terms of Pauli \[Sigma] matrices for basis_: {Dirac,Weyl,Majorana}. \
*12May2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuGammaPauli", "[", "basis_", "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{
      "basis", ",", "\[IndentingNewLine]", "\"\<Dirac\>\"", ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "0", "]"}], "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "0", 
               "]"}], ",", 
              SubscriptBox["0", "2"]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              RowBox[{"-", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "0", 
                "]"}]}]}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", 
           RowBox[{"i", ":", 
            RowBox[{"(", 
             RowBox[{"1", "|", "2", "|", "3"}], ")"}]}], "]"}], "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "i", 
               "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "i", 
                "]"}]}], ",", 
              SubscriptBox["0", "2"]}], "}"}]}], "}"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "5", "]"}], "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              SubscriptBox["1", "2"]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["1", "2"], ",", 
              SubscriptBox["0", "2"]}], "}"}]}], "}"}]}]}], 
        "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
       "\"\<Weyl\>\"", ",", "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "0", "]"}], "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              SubscriptBox["1", "2"]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["1", "2"], ",", 
              SubscriptBox["0", "2"]}], "}"}]}], "}"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", 
           RowBox[{"i", ":", 
            RowBox[{"(", 
             RowBox[{"1", "|", "2", "|", "3"}], ")"}]}], "]"}], "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "i", 
               "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "i", 
                "]"}]}], ",", 
              SubscriptBox["0", "2"]}], "}"}]}], "}"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "5", "]"}], "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", 
               SubscriptBox["1", "2"]}], ",", 
              SubscriptBox["0", "2"]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              SubscriptBox["1", "2"]}], "}"}]}], "}"}]}]}], 
        "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
       "\"\<Majorana\>\"", ",", "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "0", "]"}], 
          "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "2", 
               "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "2", 
               "]"}], ",", 
              SubscriptBox["0", "2"]}], "}"}]}], "}"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "1", "]"}], "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"I", " ", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "3", 
                "]"}]}], ",", 
              SubscriptBox["0", "2"]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              RowBox[{"I", " ", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "3", 
                "]"}]}]}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "2", "]"}], "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              RowBox[{"-", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "2", 
                "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "2", 
               "]"}], ",", 
              SubscriptBox["0", "2"]}], "}"}]}], "}"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "3", "]"}], "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "I"}], " ", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "1", 
                "]"}]}], ",", 
              SubscriptBox["0", "2"]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              RowBox[{
               RowBox[{"-", "I"}], " ", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "1", 
                "]"}]}]}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "5", "]"}], "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "2", 
               "]"}], ",", 
              SubscriptBox["0", "2"]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              RowBox[{"-", " ", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "2", 
                "]"}]}]}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"C", "[", 
           RowBox[{"CG", "[", "\"\<charge conjugation\>\"", "]"}], "]"}], "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["0", "2"], ",", 
              RowBox[{
               RowBox[{"-", "I"}], " ", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "2", 
                "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "I"}], " ", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "2", 
                "]"}]}], ",", 
              SubscriptBox["0", "2"]}], "}"}]}], "}"}]}]}], 
        "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuGammaExpanded", "::", "usage"}], "=", 
     "\"\<tuGammaExpanded[basis_] are Rules for 4x4 \[Gamma]-matices in the \
basis_:{Dirac,Weyl,Majorana} *12May2018*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuGammaExpanded", "[", "basis_", "]"}], ":=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dum$", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "->", 
             RowBox[{"ArrayFlatten", "[", 
              RowBox[{
               RowBox[{"#", "//.", 
                RowBox[{"tuGammaPauli", "[", "basis", "]"}]}], "//.", 
               "tuPauliMatrices"}], "]"}]}], "&"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\"", ",", 
               RowBox[{"{", "\[Mu]", "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"\[Mu]", ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1", ",", "2", ",", "3", ",", "5"}], 
                "}"}]}], "}"}]}], "]"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"dum$", "=", 
          RowBox[{"dum$", "//", 
           RowBox[{"tuIndicesLower", "[", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1", ",", "2", ",", "3", ",", "5"}], "}"}], 
            "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"dum$", "=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"MapAt", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "#"}], "&"}], ",", "#", ",", "2"}], "]"}], "&"}],
             ",", "dum$"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         SubscriptBox["1", "4"], "\[Rule]", 
         RowBox[{"DiagonalMatrix", "[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], "]"}]}]}], 
       "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuGammaExpand", "::", "usage"}], "=", 
     "\"\<tuGammaExpand Rule[]s for \[Gamma] matrix standard 4x4 expansion.\>\
\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuGammaExpand", ":=", 
     RowBox[{"tuGammaExpanded", "[", "\"\<Dirac\>\"", "]"}]}], ";"}], " ", 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sub\[Gamma]Matrices", ":=", 
     RowBox[{"tuGammaExpanded", "[", "\"\<Dirac\>\"", "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"**", "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], 
     "**"}], "*************)"}], "   ", 
   RowBox[{"(*", 
    RowBox[{"**", "**", "**", "**", "**", "**", "**", "**"}], 
    "*************)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"Generate", " ", 
     RowBox[{"Tr", "[", 
      RowBox[{"\[Gamma]", "^", "i"}], "]"}], " ", "Rules", " ", "for", " ", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "4", ",", "n"}], "}"}]}], "}"}], " ", "*", "18", 
     "Jan2013"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"generateTr\[Gamma]", "[", "n_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "sub", ",", "tmp", ",", "tmp0", ",", "indices", ",", "test", ",", 
         "nlim", ",", "n0", ",", 
         RowBox[{"collection", "=", 
          RowBox[{"{", "}"}]}], ",", "char", ",", "char0", ",", "ii"}], "}"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"char", "=", 
         RowBox[{
          RowBox[{"CharacterRange", "[", 
           RowBox[{"\"\<a\>\"", ",", "\"\<z\>\""}], "]"}], "//", 
          "ToExpression"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"sub", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "a", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "b_", "]"}]}]}], "->", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{
             RowBox[{"\[Gamma]", "@", 
              RowBox[{"u", "[", "b", "]"}]}], ".", 
             RowBox[{"\[Gamma]", "@", 
              RowBox[{"u", "[", "a", "]"}]}]}]}], "+", 
           RowBox[{"2", " ", 
            RowBox[{"g", "@", 
             RowBox[{"uu", "[", 
              RowBox[{"a", ",", "b"}], "]"}]}]}]}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"a", " ", "is", " ", "marker", " ", "index"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"char0", "=", 
            RowBox[{"char", "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "n0"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"indices", "=", 
            RowBox[{"Table", "[", 
             RowBox[{"ii", ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "char0"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp0", "=", 
            RowBox[{"tmp", "=", 
             RowBox[{"Tr", "[", 
              RowBox[{"\[Gamma]dot", "[", "indices", "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"nlim", "=", "1"}], ";", "\[IndentingNewLine]", 
           RowBox[{"While", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"nlim", "<", "20"}], "&&", 
              RowBox[{"test", "=!=", "tmp"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"test", "=", "tmp"}], ";", "\[IndentingNewLine]", 
              RowBox[{"tmp", "=", 
               RowBox[{
                RowBox[{"tmp", "/.", "sub"}], "//.", 
                RowBox[{"simpleTr2", "[", 
                 RowBox[{"{", 
                  RowBox[{"g", "@", 
                   RowBox[{"uu", "[", 
                    RowBox[{"_", ",", "_"}], "]"}]}], "}"}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"nlim", "++"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp0", "->", 
             RowBox[{"(", 
              RowBox[{"tmp", "/.", 
               RowBox[{
                RowBox[{"Dot", "[", 
                 RowBox[{"b_", ",", 
                  RowBox[{"\[Gamma]", "@", 
                   RowBox[{"u", "[", "a", "]"}]}]}], "]"}], "->", 
                RowBox[{"Dot", "[", 
                 RowBox[{
                  RowBox[{"\[Gamma]", "@", 
                   RowBox[{"u", "[", "a", "]"}]}], ",", "b"}], "]"}]}]}], 
              ")"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"RuleX", "[", 
                 RowBox[{"tmp", ",", "tmp0"}], "]"}], "/.", 
                RowBox[{
                 RowBox[{"Tr", "[", "]"}], "->", "4"}]}], ")"}], "//", 
              "First"}], "//", 
             RowBox[{"RuleVarPattern", "[", "char0", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"collection", ",", "tmp"}], "]"}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"n0", ",", "2", ",", "n", ",", "2"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"MapAt", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "//.", "collection"}], "&"}], ",", "#", ",", 
               "2"}], "]"}], "&"}], ",", "collection"}], "]"}], "//", 
          "Simplify"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp0", "=", 
         RowBox[{"tmp", "/.", "sLowerAllIndices"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Join", "[", 
         RowBox[{"tmp", ",", "tmp0"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"PeskinSchroeder", " ", "\[Gamma]", " ", 
     RowBox[{"Rules", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"psa16", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ACommutator", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "\[Mu]_", 
             "]"}], ",", 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "\[Nu]_", 
             "]"}]}], "]"}], "/.", 
          RowBox[{"Dot", "\[Rule]", "dotOps"}]}], ")"}], "\[Rule]", 
        RowBox[{"2", " ", 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
          RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ACommutator", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\""}], "]"}], "[", "\[Mu]_", 
             "]"}], ",", 
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<d\>\""}], "]"}], "[", "\[Nu]_", 
             "]"}]}], "]"}], "/.", 
          RowBox[{"Dot", "\[Rule]", "dotOps"}]}], ")"}], "\[Rule]", 
        RowBox[{"2", " ", 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"g", ",", "\"\<dd\>\""}], "]"}], "[", 
          RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}]}]}]}], "\[IndentingNewLine]",
       "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"psa16a", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "\[Mu]_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "\[Nu]_", "]"}]}]}], "->", 
        RowBox[{
         RowBox[{"2", " ", 
          RowBox[{"g", "@", 
           RowBox[{"uu", "[", 
            RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}]}]}], "-", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "\[Nu]", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "\[Mu]", "]"}]}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "\[Mu]_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "\[Nu]_", "]"}]}]}], "->", 
        RowBox[{
         RowBox[{"2", " ", 
          RowBox[{"g", "@", 
           RowBox[{"dd", "[", 
            RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}]}]}], "-", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "\[Nu]", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "\[Mu]", "]"}]}]}]}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ps368", "=", 
     RowBox[{
      RowBox[{"\[Gamma]", "@", 
       RowBox[{"u", "[", "5", "]"}]}], "->", 
      RowBox[{"I", " ", 
       RowBox[{
        RowBox[{"\[Gamma]", "@", 
         RowBox[{"u", "[", "0", "]"}]}], ".", 
        RowBox[{"\[Gamma]", "@", 
         RowBox[{"u", "[", "1", "]"}]}], ".", 
        RowBox[{"\[Gamma]", "@", 
         RowBox[{"u", "[", "2", "]"}]}], ".", 
        RowBox[{"\[Gamma]", "@", 
         RowBox[{"u", "[", "3", "]"}]}]}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ps369", "=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"ConjugateTranspose", "[", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "5", "]"}]}], "]"}], "->", 
        RowBox[{"\[Gamma]", "@", 
         RowBox[{"u", "[", "5", "]"}]}]}], " ", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "0", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "5", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "0", "]"}]}]}], "->", 
        RowBox[{"\[Gamma]", "@", 
         RowBox[{"u", "[", "5", "]"}]}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"wiki1", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"ConjugateTranspose", "[", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "\[Mu]_", "]"}]}], "]"}], "->", 
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "0", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "\[Mu]", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "0", "]"}]}]}]}], ",", 
       RowBox[{
        RowBox[{"ConjugateTranspose", "[", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "\[Mu]_", "]"}]}], "]"}], "->", 
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "0", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "\[Mu]", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "0", "]"}]}]}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ps370", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Gamma]", "@", 
        RowBox[{"u", "[", "5", "]"}]}], ".", 
       RowBox[{"\[Gamma]", "@", 
        RowBox[{"u", "[", "5", "]"}]}]}], "->", "1"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ps371", "=", 
     RowBox[{
      RowBox[{"ACommutator", "[", 
       RowBox[{
        RowBox[{"\[Gamma]", "@", 
         RowBox[{"u", "[", "\[Mu]", "]"}]}], ",", 
        RowBox[{"\[Gamma]", "@", 
         RowBox[{"u", "[", "5", "]"}]}]}], "]"}], "->", "0"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ps55a", "=", 
     RowBox[{
      RowBox[{"Tr", "[", "Id", "]"}], "->", "4"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ps55b", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "2", ",", "3"}], "}"}], ",", "a"}], 
          "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "a_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "b_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "c_", "]"}]}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{"FreeQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a", ",", "b", ",", "c"}], "}"}], ",", "5"}], "]"}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "a_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "b_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "c_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "d_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "e_", "]"}]}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{"FreeQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a", ",", "b", ",", "c", ",", "d", ",", "e"}], "}"}], ",",
            "5"}], "]"}]}]}]}], "\[IndentingNewLine]", "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ps55c", "=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "\[Mu]_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "\[Nu]_", "]"}]}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"4", " ", 
          RowBox[{"g", "@", 
           RowBox[{"uu", "[", 
            RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}]}]}], "/;", 
         RowBox[{"FreeQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], ",", "5"}], "]"}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "\[Mu]_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "\[Nu]_", "]"}]}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"4", " ", 
          RowBox[{"g", "@", 
           RowBox[{"dd", "[", 
            RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}]}]}], "/;", 
         RowBox[{"FreeQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], ",", "5"}], "]"}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "\[Mu]_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "\[Nu]_", "]"}]}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"\[Mu]", "===", "5"}], "&&", 
            RowBox[{"\[Nu]", "=!=", "5"}]}], ")"}], "||", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"\[Mu]", "=!=", "5"}], "&&", 
            RowBox[{"\[Nu]", "===", "5"}]}], ")"}]}]}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ps55d", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "a_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "b_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "c_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "d_", "]"}]}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"4", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"g", "@", 
              RowBox[{"uu", "[", 
               RowBox[{"a", ",", "b"}], "]"}]}], 
             RowBox[{"g", "@", 
              RowBox[{"uu", "[", 
               RowBox[{"c", ",", "d"}], "]"}]}]}], "-", 
            RowBox[{
             RowBox[{"g", "@", 
              RowBox[{"uu", "[", 
               RowBox[{"a", ",", "c"}], "]"}]}], 
             RowBox[{"g", "@", 
              RowBox[{"uu", "[", 
               RowBox[{"b", ",", "d"}], "]"}]}]}], "+", 
            RowBox[{
             RowBox[{"g", "@", 
              RowBox[{"uu", "[", 
               RowBox[{"a", ",", "d"}], "]"}]}], 
             RowBox[{"g", "@", 
              RowBox[{"uu", "[", 
               RowBox[{"b", ",", "c"}], "]"}]}]}]}], ")"}]}], "/;", 
         RowBox[{"FreeQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], ",", "5"}], 
          "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "a_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "b_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "c_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "d_", "]"}]}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"4", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"g", "@", 
              RowBox[{"dd", "[", 
               RowBox[{"a", ",", "b"}], "]"}]}], 
             RowBox[{"g", "@", 
              RowBox[{"dd", "[", 
               RowBox[{"c", ",", "d"}], "]"}]}]}], "-", 
            RowBox[{
             RowBox[{"g", "@", 
              RowBox[{"dd", "[", 
               RowBox[{"a", ",", "c"}], "]"}]}], 
             RowBox[{"g", "@", 
              RowBox[{"dd", "[", 
               RowBox[{"b", ",", "d"}], "]"}]}]}], "+", 
            RowBox[{
             RowBox[{"g", "@", 
              RowBox[{"dd", "[", 
               RowBox[{"a", ",", "d"}], "]"}]}], 
             RowBox[{"g", "@", 
              RowBox[{"dd", "[", 
               RowBox[{"b", ",", "c"}], "]"}]}]}]}], ")"}]}], "/;", 
         RowBox[{"FreeQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], ",", "5"}], 
          "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "a_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "b_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "c_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "d_", "]"}]}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], ",", "5"}], 
           "]"}], "===", "1"}]}]}]}], "\[IndentingNewLine]", "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ps55e", "=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "5", "]"}]}], "]"}], "->", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "a_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "b_", "]"}]}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "b"}], "}"}], ",", "5"}], "]"}], "===", 
          "1"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "a_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "b_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "c_", "]"}]}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "b", ",", "c"}], "}"}], ",", "5"}], "]"}], "===",
           "1"}]}]}]}], "\[IndentingNewLine]", "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"psA27g", "=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "a_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "b_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "c_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "d_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "5", "]"}]}]}], "]"}], "->", 
        RowBox[{
         RowBox[{"-", "4"}], " ", "I", " ", 
         RowBox[{"\[Epsilon]", "@", 
          RowBox[{"uuuu", "[", 
           RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "]"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "5", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "a_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "b_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "c_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "d_", "]"}]}]}], "]"}], "->", 
        RowBox[{
         RowBox[{"-", "4"}], " ", "I", " ", 
         RowBox[{"\[Epsilon]", "@", 
          RowBox[{"uuuu", "[", 
           RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "]"}]}]}]}]}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"psA29", "=", 
     RowBox[{"{", 
      RowBox[{"(*", 
       RowBox[{"Einstein", " ", 
        RowBox[{"summed", ".", " ", "sLowerAllIndices"}], " ", "NEEDS", " ", 
        "to", " ", "be", " ", "handled", " ", 
        RowBox[{"seperately", ".", " ", 
         RowBox[{"TODO", ":", " ", 
          RowBox[{
           RowBox[{
           "generalize", " ", "to", " ", "make", " ", "this", " ", 
            "independent", " ", "of", " ", "up"}], "-", 
           RowBox[{
           "down", " ", "indices", " ", "of", " ", "uncontracted", " ", 
            RowBox[{"\[Gamma]", "'"}], "s"}]}]}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}]}], "->", "4"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}]}], "->", 
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "b", "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "c_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}]}], "->", 
        RowBox[{"4", " ", 
         RowBox[{"g", "@", 
          RowBox[{"uu", "[", 
           RowBox[{"b", ",", "c"}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "c_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "d_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}]}], "->", 
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "d", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "c", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "b", "]"}]}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}]}], "->", 
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "b", "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "c_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}]}], "->", 
        RowBox[{"4", " ", 
         RowBox[{"g", "@", 
          RowBox[{"dd", "[", 
           RowBox[{"b", ",", "c"}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "c_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "d_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}]}], "->", 
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "d", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "c", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "b", "]"}]}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}]}], "->", "4"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}]}], "->", 
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "b", "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "c_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}]}], "->", 
        RowBox[{"4", " ", 
         RowBox[{"g", "@", 
          RowBox[{"uu", "[", 
           RowBox[{"b", ",", "c"}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "c_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "d_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}]}], "->", 
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "d", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "c", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "b", "]"}]}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}]}], "->", 
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "b", "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "c_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}]}], "->", 
        RowBox[{"4", " ", 
         RowBox[{"g", "@", 
          RowBox[{"dd", "[", 
           RowBox[{"b", ",", "c"}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "b_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "c_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"d", "[", "d_", "]"}]}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}]}], "->", 
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "d", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "c", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"d", "[", "b", "]"}]}]}]}]}]}], "\[IndentingNewLine]", 
      "}"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Review", " ", "for", " ", "accuracy", " ", "and", " ", "consistency"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"simpleGammau", "=", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
       "ps370", ",", "ps369", ",", "wiki1", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "i_", "]"}]}], ".", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "i_", "]"}]}]}], "->", 
         RowBox[{"g", "@", 
          RowBox[{"uu", "[", 
           RowBox[{"i", ",", "i"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        "ps55a", ",", "ps55b", ",", "ps55b", ",", "ps55c", ",", "ps55e", ",", 
        "ps55d", ",", "\[IndentingNewLine]", "psA27g", ",", "psA29"}], 
       "\[IndentingNewLine]", "}"}], "//", "DeleteDuplicates"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"simpleGamma", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"Append", "[", 
        RowBox[{"simpleGammau", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"simpleGammau", "//.", 
             RowBox[{"{", 
              RowBox[{"sLowerAllIndices", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
                 RowBox[{"i_", ",", "j_"}], "]"}], "->", 
                RowBox[{
                 RowBox[{"T", "[", 
                  RowBox[{"g", ",", "\"\<dd\>\""}], "]"}], "[", 
                 RowBox[{"i", ",", "j"}], "]"}]}]}], "}"}]}], ")"}], ",", 
           "simpleDot"}], "}"}]}], "]"}], "//", "Flatten"}], "//", 
      "DeleteDuplicates"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"sPauliFlatten", "::", "usage"}], ":=", 
     "\"\<sPauliFlatten[exp_] changes exp_ with Pauli matrices with standard \
representation. Applies ArrayFlatten to List's in exp_ to convert to matrix \
form. *24Apr2015*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"sPauliFlatten", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"$", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", 
         RowBox[{"$", "//.", "sPauli"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "/.", 
          RowBox[{
           RowBox[{"ll", ":", 
            RowBox[{"List", "[", "__", "]"}]}], "\[RuleDelayed]", 
           RowBox[{"ArrayFlatten", "[", "ll", "]"}]}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"SU", "[", "2", "]"}], " ", "\[Sigma]", " ", "commutation", " ", 
     "relationship"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"su2commutation", "[", 
     RowBox[{"lab_", ",", "a_", ",", "b_", ",", "c_"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MCommutator", "[", 
       RowBox[{
        RowBox[{"Tensor", "[", 
         RowBox[{"lab", ",", 
          RowBox[{"{", "a", "}"}], ",", 
          RowBox[{"{", "Void", "}"}]}], "]"}], ",", 
        RowBox[{"Tensor", "[", 
         RowBox[{"lab", ",", 
          RowBox[{"{", "b", "}"}], ",", 
          RowBox[{"{", "Void", "}"}]}], "]"}]}], "]"}], "->", 
      RowBox[{"I", " ", 
       RowBox[{"\[Epsilon]uuu", "[", 
        RowBox[{"a", ",", "b", ",", "c"}], "]"}], 
       RowBox[{"Tensor", "[", 
        RowBox[{"lab", ",", 
         RowBox[{"{", "c", "}"}], ",", 
         RowBox[{"{", "Void", "}"}]}], "]"}]}]}], "}"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSU2commutation", "::", "usage"}], "=", 
     "\"\<tuSU2commutation[lab_] Rule for converting commutation relation of \
SU2 vectors Tensor[] with symbol lab_.  On output c$ index is summed over. \
*8Apr2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuSU2commutation", "[", "lab_", "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"CommutatorM", "[", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"lab", ",", 
              RowBox[{"{", "a", "}"}], ",", 
              RowBox[{"{", "Void", "}"}]}], "]"}], ",", 
            RowBox[{"Tensor", "[", 
             RowBox[{"lab", ",", 
              RowBox[{"{", "b", "}"}], ",", 
              RowBox[{"{", "Void", "}"}]}], "]"}]}], "]"}], "\[Rule]", 
          RowBox[{"2", " ", "I", " ", 
           RowBox[{"T", "[", 
            RowBox[{"\[Epsilon]", ",", "\"\<uuu\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "b", ",", "c$"}], "}"}]}], "]"}], 
           RowBox[{"Tensor", "[", 
            RowBox[{"lab", ",", 
             RowBox[{"{", "Void", "}"}], ",", 
             RowBox[{"{", "c$", "}"}]}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{"CommutatorM", "[", 
           RowBox[{
            RowBox[{"Tensor", "[", 
             RowBox[{"lab", ",", 
              RowBox[{"{", "Void", "}"}], ",", 
              RowBox[{"{", "a", "}"}]}], "]"}], ",", 
            RowBox[{"Tensor", "[", 
             RowBox[{"lab", ",", 
              RowBox[{"{", "Void", "}"}], ",", 
              RowBox[{"{", "b", "}"}]}], "]"}]}], "]"}], "\[Rule]", 
          RowBox[{"2", " ", "I", " ", 
           RowBox[{"T", "[", 
            RowBox[{"\[Epsilon]", ",", "\"\<ddd\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "b", ",", "c$"}], "}"}]}], "]"}], 
           RowBox[{"Tensor", "[", 
            RowBox[{"lab", ",", 
             RowBox[{"{", "c$", "}"}], ",", 
             RowBox[{"{", "Void", "}"}]}], "]"}]}]}]}], "}"}], "//", 
       RowBox[{"tuAddPatternVariable", "[", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}], "]"}]}], ")"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"Rules", " ", "that", " ", "simplifies", " ", 
     RowBox[{"Dot", "[", 
      RowBox[{"\[Sigma]", "@", 
       RowBox[{"u", "[", "n", "]"}]}], "]"}], " ", "expressions", " ", "*", 
     "22", "Jul2013"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"simplePauli", "=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"0", "[", "\[Sigma]", "]"}], " ", "rules"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"dotOps", "[", 
         RowBox[{"b___", ",", 
          RowBox[{"0", "[", "\[Sigma]", "]"}], " ", ",", "  ", "a___"}], 
         "]"}], "->", 
        RowBox[{"0", "[", "\[Sigma]", "]"}]}], ",", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"dotOps", "[", 
           RowBox[{"a_", " ", ",", "  ", 
            RowBox[{"0", "[", "\[Sigma]", "]"}]}], "]"}], "->", 
          RowBox[{"0", "[", "\[Sigma]", "]"}]}], ","}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"0", "[", "\[Sigma]", "]"}], "^", "n_"}], "\[Rule]", 
        RowBox[{"0", "[", "\[Sigma]", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"a__", "  ", 
         RowBox[{"0", "[", "\[Sigma]", "]"}]}], "->", 
        RowBox[{"0", "[", "\[Sigma]", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dotOps", "[", 
         RowBox[{"a___", ",", 
          RowBox[{"0", "[", "\[Sigma]", "]"}], ",", "b___"}], "]"}], "->", 
        RowBox[{"0", "[", "\[Sigma]", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Plus", "[", 
         RowBox[{"a___", ",", 
          RowBox[{"0", "[", "\[Sigma]", "]"}], ",", "b___"}], "]"}], ":>", 
        RowBox[{"a", "+", "b"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Id", "[", "\[Sigma]", "]"}], " ", "rules"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "0", "]"}]}], "|", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"d", "[", "0", "]"}]}]}], "->", 
        RowBox[{"Id", "[", "\[Sigma]", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         OverscriptBox[
          RowBox[{"Id", "[", "\[Sigma]", "]"}], "_"], "|", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"Id", "[", "\[Sigma]", "]"}], "]"}], "|", 
         RowBox[{"Transpose", "[", 
          RowBox[{"Id", "[", "\[Sigma]", "]"}], "]"}]}], "->", 
        RowBox[{"Id", "[", "\[Sigma]", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dotOps", "[", 
         RowBox[{
          RowBox[{"Id", "[", "\[Sigma]", "]"}], ",", 
          RowBox[{"Id", "[", "\[Sigma]", "]"}]}], "]"}], "->", 
        RowBox[{"Id", "[", "\[Sigma]", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
         RowBox[{"a___", ",", 
          RowBox[{"Id", "[", "\[Sigma]", "]"}], ",", "b___"}], "]"}], 
        "\[Rule]", 
        RowBox[{"dd", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Id", "[", "\[Sigma]", "]"}], "^", "n_"}], "\[Rule]", 
        RowBox[{"Id", "[", "\[Sigma]", "]"}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ConjugateTranspose", "[", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], "]"}], "->", 
        RowBox[{"\[Sigma]", "@", 
         RowBox[{"u", "[", "a", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ConjugateTranspose", "[", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], "]"}], "->", 
        RowBox[{"\[Sigma]", "@", 
         RowBox[{"d", "[", "a", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"d", "[", "a", "]"}]}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1", ",", "3", ",", 
              RowBox[{"space", "/@", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}]}]}], "}"}], "]"}], ",", "a"}], 
          "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "a", "]"}]}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1", ",", "3", ",", 
              RowBox[{"space", "/@", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}]}]}], "}"}], "]"}], ",", "a"}], 
          "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"d", "[", "a", "]"}]}]}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"2", ",", 
             RowBox[{"space", "@", "2"}]}], "}"}], ",", "a"}], "]"}]}]}], ",",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"u", "[", "a", "]"}]}]}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"2", ",", 
             RowBox[{"space", "@", "2"}]}], "}"}], ",", "a"}], "]"}]}]}], ",",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Conjugate", "[", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"d", "[", "a", "]"}]}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1", ",", "3", ",", 
              RowBox[{"space", "/@", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}]}]}], "}"}], "]"}], ",", "a"}], 
          "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Conjugate", "[", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "a", "]"}]}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1", ",", "3", ",", 
              RowBox[{"space", "/@", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}]}]}], "}"}], "]"}], ",", "a"}], 
          "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Conjugate", "[", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"d", "[", "a", "]"}]}]}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"2", ",", 
              RowBox[{"space", "/@", "2"}]}], "}"}], "]"}], ",", "a"}], 
          "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Conjugate", "[", 
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"u", "[", "a", "]"}]}]}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"2", ",", 
              RowBox[{"space", "/@", "2"}]}], "}"}], "]"}], ",", "a"}], 
          "]"}]}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dotOps", "[", 
         RowBox[{
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"d", "[", "a_", "]"}]}], ",", 
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"d", "[", "b_", "]"}]}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"KroneckerDelta", "[", 
              RowBox[{"a", ",", "b"}], "]"}], " ", 
             RowBox[{"Id", "[", "\[Sigma]", "]"}]}], "+", 
            RowBox[{"I", "  ", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"LeviCivitaTensor", "[", "3", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"a", ",", "b", ",", "i$"}], "]"}], "]"}], ".", 
                RowBox[{"\[Sigma]", "@", 
                 RowBox[{"d", "[", "i$", "]"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i$", ",", "3"}], "}"}]}], "]"}]}]}], "//.", 
           "simpleDot"}], ")"}], "/;", 
         RowBox[{
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "2", ",", "3", ",", 
               RowBox[{"space", "/@", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2", ",", "3"}], "}"}]}]}], "}"}], "]"}], 
            ",", "a"}], "]"}], "&&", 
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"1", ",", "2", ",", "3", ",", 
               RowBox[{"space", "/@", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2", ",", "3"}], "}"}]}]}], "}"}], "]"}], 
            ",", "b"}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dotOps", "[", 
         RowBox[{
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"u", "[", "a_", "]"}]}], ",", 
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"u", "[", "b_", "]"}]}]}], "]"}], ":>", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"KroneckerDelta", "[", 
              RowBox[{"a", ",", "b"}], "]"}], 
             RowBox[{"Id", "[", "\[Sigma]", "]"}]}], "+", 
            RowBox[{"I", "  ", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"LeviCivitaTensor", "[", "3", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"a", ",", "b", ",", "i$"}], "]"}], "]"}], ".", 
                RowBox[{"\[Sigma]", "@", 
                 RowBox[{"u", "[", "i$", "]"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i$", ",", "3"}], "}"}]}], "]"}]}]}], "//.", 
           "simpleDot"}], ")"}], "/;", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2", ",", "3", ",", 
                RowBox[{"space", "/@", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "2", ",", "3"}], "}"}]}]}], "}"}], "]"}], 
             ",", "a"}], "]"}], "&&", 
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2", ",", "3", ",", 
                RowBox[{"space", "/@", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "2", ",", "3"}], "}"}]}]}], "}"}], "]"}], 
             ",", "b"}], "]"}]}], ")"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        OverscriptBox[
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"d", "[", "a_", "]"}]}], "_"], ":>", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"d", "[", "a", "]"}]}]}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"2", ",", 
             RowBox[{"space", "@", "2"}]}], "}"}], ",", "a"}], "]"}]}]}], ",",
        "\[IndentingNewLine]", 
       RowBox[{
        OverscriptBox[
         RowBox[{"\[Sigma]", "@", 
          RowBox[{"u", "[", "a_", "]"}]}], "_"], ":>", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"\[Sigma]", "@", 
           RowBox[{"u", "[", "a", "]"}]}]}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"2", ",", 
             RowBox[{"space", "@", "2"}]}], "}"}], ",", "a"}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Applies", " ", "simplePauli", " ", "and", " ", "simpleDot", " ", 
     "repeatedly"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simplePauli1", "[", 
      RowBox[{"exp_", ",", "scalar_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "tmp1"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"xDot", "->", "Dot"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"tmp", "=!=", "tmp1"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tmp1", "=", "tmp"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{
             RowBox[{"tmp", "//.", "simplePauli"}], "//.", 
             RowBox[{"simpleDot2", "[", "scalar", "]"}]}]}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simplePauli1", "[", "scalar_List", "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"simplePauli1", "[", 
     RowBox[{"exp", ",", "scalar"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"subPauli", "[", 
      RowBox[{"pattern_List:", 
       RowBox[{"{", "}"}]}], "]"}], " ", "putputs", " ", "a", " ", "list", 
     " ", "of", " ", "common", " ", 
     RowBox[{"Rule", "[", "]"}], "s", " ", "for", " ", "Pauli", " ", "spin", 
     " ", 
     RowBox[{"matrices", ".", "  ", "pattern_List"}], " ", "are", " ", 
     "variables", " ", "used", " ", "to", " ", "apply", " ", 
     RowBox[{
      RowBox[{"RuleVarPattern", "[", "pattern", "]"}], "."}], " ", "*", "27", 
     "Oct2014"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subPauli", "[", 
     RowBox[{"pattern_List:", 
      RowBox[{"{", "}"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sub", ",", "$\[Sigma]"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"$\[Sigma]", "[", "i_", "]"}], ":=", 
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"\[Sigma]", ",", "\"\<u\>\""}], "]"}], "[", "i", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"sub", "=", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"MCommutator", "[", 
            RowBox[{
             RowBox[{"$\[Sigma]", "[", "i", "]"}], ",", 
             RowBox[{"$\[Sigma]", "[", "j", "]"}]}], "]"}], ":>", 
           RowBox[{
            RowBox[{"2", " ", "I", " ", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Epsilon]", ",", "\"\<uuu\>\""}], "]"}], "[", 
              RowBox[{"i", ",", "j", ",", "k"}], "]"}], 
             RowBox[{"$\[Sigma]", "[", "k", "]"}]}], "/;", 
            RowBox[{"FreeQ", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", "0"}], 
             "]"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ACommutator", "[", 
            RowBox[{
             RowBox[{"$\[Sigma]", "[", "i", "]"}], ",", 
             RowBox[{"$\[Sigma]", "[", "j", "]"}]}], "]"}], ":>", 
           RowBox[{
            RowBox[{"2", " ", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Delta]", ",", "\"\<uu\>\""}], "]"}], "[", 
              RowBox[{"i", ",", "j"}], "]"}]}], "/;", 
            RowBox[{"FreeQ", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"i", ",", "j"}], "}"}], ",", "0"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"$\[Sigma]", "[", "i", "]"}], ",", 
             RowBox[{"$\[Sigma]", "[", "j", "]"}]}], "]"}], ":>", 
           RowBox[{
            RowBox[{
             RowBox[{"I", "  ", 
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"\[Epsilon]", ",", "\"\<uuu\>\""}], "]"}], "[", 
               RowBox[{"i", ",", "j", ",", "k"}], "]"}], 
              RowBox[{"$\[Sigma]", "[", "k", "]"}]}], "+", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Delta]", ",", "\"\<uu\>\""}], "]"}], "[", 
              RowBox[{"i", ",", "j"}], "]"}]}], "/;", 
            RowBox[{"FreeQ", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", "0"}], 
             "]"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"$\[Sigma]", "[", "i", "]"}], ".", 
            RowBox[{"$\[Sigma]", "[", "0", "]"}]}], "->", 
           RowBox[{"$\[Sigma]", "[", "i", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"$\[Sigma]", "[", "0", "]"}], ".", 
            RowBox[{"$\[Sigma]", "[", "i", "]"}]}], "->", 
           RowBox[{"$\[Sigma]", "[", "i", "]"}]}]}], "\[IndentingNewLine]", 
         "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"RuleVarPattern", "[", "pattern", "]"}], "/@", "sub"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "sub\[Gamma]Matrices", "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuGammaPauliExpand", "::", "usage"}], "=", 
     "\"\<tuGammaPauliExpand Rule[] for \[Gamma] matrix expansion into Dirac \
\[Sigma] matrices.\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuGammaPauliExpand", ":=", 
     RowBox[{"tuGammaPauli", "[", "\"\<Dirac\>\"", "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sub\[Gamma]Pauli", ":=", 
     RowBox[{"tuGammaPauli", "[", "\"\<Dirac\>\"", "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Evaluates", " ", "xDot", " ", "expression", " ", "using", " ", "Dot", 
     " ", "for", " ", "actual", " ", "matrix", " ", "multiply", " ", "but", 
     " ", "maintaining", " ", "order", " ", "of", " ", "xDot", " ", 
     RowBox[{"terms", ".", "  ", "Used"}], " ", "in", " ", 
     "EvalVia\[Sigma]Matrices"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AxDot2Dot", "[", "xDotexp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "a", ",", "A$"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"MapIndexed", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{"A$", "[", "#2", "]"}], ",", "#1", ",", 
              RowBox[{"{", "2", "}"}]}], "]"}], "&"}], ",", "xDotexp", ",", 
           "1"}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"Mark", " ", "for", " ", "order"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"xDot", "\[Rule]", "Dot"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"Do", " ", 
          RowBox[{"Dot", "[", "]"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Off", "[", 
         RowBox[{"Dot", "::", "dotsh"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"Times", "\[Rule]", "Dot"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"fix", " ", 
          RowBox[{"ordering", ".", " ", "This"}], " ", "step", " ", "cause", 
          " ", "error", " ", 
          RowBox[{"messages", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"On", "[", 
         RowBox[{"Dot", "::", "dotsh"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"A$", "[", "_", "]"}], "[", "a_", "]"}], "\[Rule]", 
           "a"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"remove", " ", "ordering", " ", "parameter"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", "simpleDot"}]}], ";", 
        RowBox[{"(*", "simplify", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"tmp", "//.", "sub\[Gamma]Pauli"}], "/.", 
          RowBox[{"xDot", "\[Rule]", "Dot"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{"simplify", " ", "\[Sigma]"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", "sPauli"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "expand", " ", "\[Sigma]", " ", "for", " ", "each", " ", "element", 
          " ", "in", " ", 
          RowBox[{"Dot", "[", "]"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ArrayFlatten", "[", "#", "]"}], "&"}], ",", "tmp"}], 
          "]"}]}]}]}], 
      RowBox[{"(*", "*)"}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Evaluates", " ", "matrix", " ", "exp_", " ", "with", " ", "\[Gamma]", 
     " ", "matrices", " ", "to", " ", "pure", " ", "matrix", " ", 
     "expression", " ", "via", " ", "\[Sigma]", " ", "matrices"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"EvalVia\[Sigma]Matrices", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"tmp", "=", "exp"}], ",", "a"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "//.", "sub\[Gamma]Pauli"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{
           RowBox[{"xDot", "[", "a___", "]"}], ":>", 
           RowBox[{"AxDot2Dot", "[", 
            RowBox[{"xDot", "[", "a", "]"}], "]"}]}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuMatrixFactor", "::", "usage"}], "=", 
     "\"\<tuMatrixFactor[EXP_?MatrixQ] separates common multiplicative \
factors from EXP_?Matrix into {common factor, stripped matrix}. *17May2018*\>\
\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuMatrixFactor", "[", 
      RowBox[{"EXP_", "?", "MatrixQ"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$0", "=", 
          RowBox[{"EXP", "//", "Simplify"}]}], ",", 
         RowBox[{"c$", "=", 
          RowBox[{"Unique", "[", "]"}]}], ",", "$", ",", "$s"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$", "=", "$0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"c$", "[", "i", "]"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "$", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Transpose", "[", "$", "]"}], " ", ".", "$s"}], "//", 
             "Simplify"}], "//", "Flatten"}], "//", "First"}], "//", 
          "Simplify"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"$", "\[Rule]", "0"}], "//", "tuRuleRHS0factor"}], "//", 
          "Flatten"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$", "=", 
         RowBox[{"$", "//", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"tuHasNoneQ", "[", 
               RowBox[{"#", ",", 
                RowBox[{"c$", "[", "_", "]"}]}], "]"}], "&"}]}], "]"}], 
           "&"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "$"}], "//", 
          RowBox[{
           RowBox[{"Apply", "[", 
            RowBox[{"Times", ",", "#"}], "]"}], "&"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"$s", ",", 
          RowBox[{"$0", "/", "$s"}]}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "tuMatrixOrderedMultiply", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuMatrixOrderedMultiply", "::", "usage"}], "=", 
     "\"\<tuMatrixOrderedMultiply[exp_] evaluates top Level matrix \
expressions (Head->dotOps) using Dot for actual matrix multiply but \
maintaining order of elements from each matrix.  The matrix inputs must have \
the same proper form and sizes. This routine is useful when matrix elements \
are noncommuting matrices. *18Feb2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuMatrixOrderedMultiply", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tmp", ",", "A$", ",", "head", ",", "pos", ",", "$p", ",", "i", ",", 
         "$n", ",", "$"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pos", "=", 
         RowBox[{
          RowBox[{"tuExtractPositionPattern", "[", "dotOps", "]"}], "[", 
          "exp", "]"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<>>\>\"", ",", "pos"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{"tuPositionNestDelete", "[", "pos", "]"}]}], ";", 
        RowBox[{"xPrint", "[", 
         RowBox[{"\"\<>>\>\"", ",", "pos"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "extract", " ", "top", " ", "level", " ", "dotOps", " ", "terms"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"$p", "=", 
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ";", " ", 
           RowBox[{"xPrint", "[", 
            RowBox[{"$p", ",", "\"\<<<\>\""}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"$p", "=", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"$p", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}], "\[Equal]", "0"}], ",", 
              RowBox[{"Delete", "[", 
               RowBox[{"$p", ",", 
                RowBox[{"-", "1"}]}], "]"}]}], "]"}]}], ";", 
           RowBox[{"(*", 
            RowBox[{"delete", " ", "Head", " ", "index"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"$", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"exp", ",", 
              RowBox[{"Apply", "[", 
               RowBox[{"Sequence", ",", "$p"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"xPrint", "[", 
            RowBox[{"\"\<===\>\"", ",", "$"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "1"}], "]"}], "]"}], "=", "$p"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MatchQ", "[", 
              RowBox[{
               RowBox[{"head", "=", 
                RowBox[{"Head", "[", "$", "]"}]}], ",", "dotOps"}], "]"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "Matrix", " ", "multiply", " ", "only", " ", "first", " ", 
               "level"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"tmp", "=", 
               RowBox[{"MapIndexed", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Map", "[", 
                   RowBox[{
                    RowBox[{"A$", "[", "#2", "]"}], ",", "#1", ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}], "&"}], ",", "$"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"tmp", "=", 
               RowBox[{"tmp", "/.", 
                RowBox[{"head", "\[Rule]", "Dot"}]}]}], ";", 
              RowBox[{"(*", 
               RowBox[{
               "rely", " ", "on", " ", "lexiconical", " ", "ordering", " ", 
                "of", " ", "Times", " ", 
                RowBox[{"NOTE", ":", " ", 
                 RowBox[{
                 "may", " ", "not", " ", "properly", " ", "handle", " ", 
                  "mixed", " ", "dotOps", " ", "in", " ", 
                  RowBox[{"expression", "."}]}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"tmp", "=", 
               RowBox[{"tmp", "/.", 
                RowBox[{"Times", "\[Rule]", "head"}]}]}], ";", 
              RowBox[{"(*", 
               RowBox[{
               "fix", " ", "ordering", " ", "within", " ", "matrix", " ", 
                RowBox[{"elements", "."}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"tmp", "=", 
               RowBox[{"tmp", "/.", 
                RowBox[{
                 RowBox[{
                  RowBox[{"A$", "[", "_", "]"}], "[", "a_", "]"}], "\[Rule]", 
                 "a"}]}]}]}]}], "  ", 
            RowBox[{"(*", 
             RowBox[{"remove", " ", "ordering", " ", "header"}], "*)"}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2"}], "]"}], "]"}], "=", "tmp"}]}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "pos", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", " ", "[", 
         RowBox[{"exp", ",", "pos"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OrderedxDotMultiply", "[", "exp_xDot", "]"}], ":=", 
     RowBox[{"tuMatrixOrderedMultiply", "[", "exp", "]"}]}], ";"}], 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"OrderedxDotMultiplySimpleDot", "[", "scalar_List", "]"}], "[", 
      "exp_xDot", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"OrderedxDotMultiply", "[", "exp", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "//.", 
         RowBox[{"tuOpSimplify", "[", 
          RowBox[{"dotOps", ",", "scalar"}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"OrderedxDotMultiplyAll", "[", 
       RowBox[{"scalar_List:", 
        RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", "=", "exp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"tmp", "=", 
        RowBox[{"tmp", "//.", 
         RowBox[{
          RowBox[{"xDot", "[", "a__", "]"}], ":>", 
          RowBox[{
           RowBox[{"OrderedxDotMultiplySimpleDot", "[", "scalar", "]"}], "[", 
           
           RowBox[{"xDot", "[", "a", "]"}], "]"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuArrayFlatten", "::", "usage"}], "=", 
     "\"\<tuArrayFlatten[exp_] applies ArrayFlatten to possible Matrix  terms \
in exp_. *24Jun2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuArrayFlatten", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"$", "=", "exp"}], ",", "$s"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$s", "=", 
         RowBox[{"$", "//.", 
          RowBox[{"List", "\[Rule]", "xList"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"find", " ", "potential", " ", "Matrices"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"$s", "//", 
          RowBox[{"tuExtractPositionPattern", "[", " ", 
           RowBox[{"xList", "[", 
            RowBox[{
             RowBox[{"xList", "[", "__", "]"}], ",", "__"}], "]"}], " ", 
           "]"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "List", " ", "does", " ", "not", " ", "work", " ", "with", " ", 
          "tuExtractPositionPattern"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{
          RowBox[{"$s", "//.", 
           RowBox[{"xList", "\[Rule]", "List"}]}], "//", 
          "tuPositionNestDelete"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", 
             RowBox[{"ArrayFlatten", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "&"}], ",", "$s"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"$s", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"$s", ",", 
           RowBox[{
            RowBox[{"MatrixQ", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "&"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tuReplacePart", "[", 
         RowBox[{"$", ",", "$s"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Defines", " ", "SU3", " ", "representations"}], ",", " ", 
     RowBox[{"n", "->", 
      RowBox[{"1", ":", " ", 
       RowBox[{"PS", ".20", ".38"}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DefSU3rep", "[", "n_", "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Switch", "[", 
         RowBox[{"n", ",", "1", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"DefineTensor", "[", 
            RowBox[{"D", ",", "\[Tau]", ",", "T", ",", "t"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"SU3rep", "=", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"t", "@", 
                RowBox[{"u", "[", "4", "]"}]}], "->", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}], "/", 
                "2"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"t", "@", 
                RowBox[{"u", "[", "5", "]"}]}], "->", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "I"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"I", ",", "0", ",", "0"}], "}"}]}], "}"}], "/", 
                "2"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"t", "@", 
                RowBox[{"u", "[", "6", "]"}]}], "->", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], "/", 
                "2"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"t", "@", 
                RowBox[{"u", "[", "7", "]"}]}], "->", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "I"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "I", ",", "0"}], "}"}]}], "}"}], "/", 
                "2"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"t", "@", 
                RowBox[{"u", "[", "8", "]"}]}], "->", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "2"}]}], "}"}]}], "}"}], "/", 
                RowBox[{"(", 
                 RowBox[{"2", 
                  SqrtBox["3"]}], ")"}]}]}]}], "\[IndentingNewLine]", "}"}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i$", "=", "1"}], ",", 
             RowBox[{"i$", "<=", "3"}], ",", 
             RowBox[{"i$", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"tmp", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"\[Sigma]", "@", 
                  RowBox[{"u", "[", "i$", "]"}]}], "/", "2"}], "/.", 
                "sPauli"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"tmp", "=", 
               RowBox[{"ArrayPad", "[", 
                RowBox[{"tmp", ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"SU3rep", ",", 
                RowBox[{
                 RowBox[{"t", "@", 
                  RowBox[{"u", "[", "i$", "]"}]}], "->", "tmp"}]}], "]"}], 
              ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"SU3rep", "=", 
            RowBox[{"Sort", "[", "SU3rep", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Column", "[", "\[IndentingNewLine]", "SU3rep", "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tuTrGamma", "::", "usage"}], "=", 
     "\"\<tuTrGamma are Rule[]s to reduce Tr[\[Gamma]'s] expressions \
*11Mar2016*\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tuTrGamma", ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Tr", "[", "]"}], "\[Rule]", "1"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", "0", "]"}], "->", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         SubscriptBox["1", "n_"], "]"}], "\[Rule]", 
        RowBox[{"dim", "[", "n", "]"}]}], ",", 
       RowBox[{"(*", " ", "new", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{"Tensor", "[", 
          RowBox[{"\[Gamma]", ",", 
           RowBox[{"{", "u_", "}"}], ",", 
           RowBox[{"{", "d_", "}"}]}], "]"}], "]"}], "\[Rule]", "0"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"oo", ":", "dotOps"}], ")"}], "[", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", "u1_", ",", "d1_"}], "]"}], ",", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", "u2_", ",", "d2_"}], "]"}]}], "]"}], " ",
          "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"4", " ", 
          RowBox[{"Tensor", "[", 
           RowBox[{"g", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"u1", ",", "u2"}], "}"}], "]"}], ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"d1", ",", "d2"}], "}"}], "]"}]}], "]"}]}], "/;", 
         RowBox[{"!", 
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"u1", ",", "d1", ",", "u2", ",", "d2"}], "}"}], "]"}], 
            ",", "5"}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"oo", ":", "dotOps"}], ")"}], "[", 
         RowBox[{"Tr", "[", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", 
             RowBox[{"{", "u1_", "}"}], ",", 
             RowBox[{"{", "d1_", "}"}]}], "]"}], ",", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", 
             RowBox[{"{", "u2_", "}"}], ",", 
             RowBox[{"{", "d2_", "}"}]}], "]"}]}], "]"}], " ", "]"}], 
        "\[RuleDelayed]", 
        RowBox[{"0", "/;", 
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"u1", ",", "d1", ",", "u2", ",", "d2"}], "}"}], "]"}], 
            ",", "5"}], "]"}], "\[Equal]", "1"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{"dd", ":", 
          RowBox[{"dotOps", "[", "a__", "]"}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{
          RowBox[{"allGammaQ", "[", "dd", "]"}], "&&", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"EvenQ", "[", 
               RowBox[{"Length", "[", "dd", "]"}], "]"}], "&&", 
              RowBox[{
               RowBox[{"Count", "[", 
                RowBox[{"dd", ",", 
                 RowBox[{"Tensor", "[", 
                  RowBox[{"\[Gamma]", ",", 
                   RowBox[{"{", 
                    RowBox[{"Void", "|", "5"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"Void", "|", "5"}], "}"}]}], "]"}]}], "]"}], "==",
                "1"}]}], ")"}], "||", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"OddQ", "[", 
              RowBox[{"Length", "[", "dd", "]"}], "]"}], "&&", 
             RowBox[{
              RowBox[{"Count", "[", 
               RowBox[{"dd", ",", 
                RowBox[{"Tensor", "[", 
                 RowBox[{"\[Gamma]", ",", 
                  RowBox[{"{", 
                   RowBox[{"Void", "|", "5"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Void", "|", "5"}], "}"}]}], "]"}]}], "]"}], 
              "\[Equal]", "0"}]}]}], "\[IndentingNewLine]", ")"}]}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{"dd", ":", 
          RowBox[{"dotOps", "[", "a__", "]"}]}], "]"}], ":>", 
        RowBox[{"0", "/;", 
         RowBox[{
          RowBox[{"allGammaQ", "[", "dd", "]"}], "&&", 
          RowBox[{"(", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "dd", "]"}], "\[Equal]", "3"}], "&&", 
             RowBox[{
              RowBox[{"Count", "[", 
               RowBox[{"dd", ",", 
                RowBox[{"Tensor", "[", 
                 RowBox[{"\[Gamma]", ",", 
                  RowBox[{"{", 
                   RowBox[{"Void", "|", "5"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Void", "|", "5"}], "}"}]}], "]"}]}], "]"}], "==", 
              "1"}]}], ")"}], "\[IndentingNewLine]", ")"}]}]}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"Tensor", "[", 
           RowBox[{"\[Gamma]", ",", "a1_", ",", "b1_"}], "]"}], ".", 
          RowBox[{"Tensor", "[", 
           RowBox[{"\[Gamma]", ",", "a2_", ",", "b2_"}], "]"}], ".", 
          RowBox[{"Tensor", "[", 
           RowBox[{"\[Gamma]", ",", "a3_", ",", "b3_"}], "]"}], ".", 
          RowBox[{"Tensor", "[", 
           RowBox[{"\[Gamma]", ",", "a4_", ",", "b4_"}], "]"}]}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"4", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"g", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"a1", ",", "a2"}], "}"}], "]"}], ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"b1", ",", "b2"}], "}"}], "]"}]}], "]"}], 
              RowBox[{"Tensor", "[", 
               RowBox[{"g", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"a3", ",", "a4"}], "}"}], "]"}], ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"b3", ",", "b4"}], "}"}], "]"}]}], "]"}]}], ")"}], 
            "\[IndentingNewLine]", "-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"g", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"a1", ",", "a3"}], "}"}], "]"}], ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"b1", ",", "b3"}], "}"}], "]"}]}], "]"}], 
              RowBox[{"Tensor", "[", 
               RowBox[{"g", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"a2", ",", "a4"}], "}"}], "]"}], ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"b2", ",", "b4"}], "}"}], "]"}]}], "]"}]}], ")"}], 
            "\[IndentingNewLine]", "+", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Tensor", "[", 
               RowBox[{"g", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"a1", ",", "a4"}], "}"}], "]"}], ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"b1", ",", "b4"}], "}"}], "]"}]}], "]"}], 
              RowBox[{"Tensor", "[", 
               RowBox[{"g", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"a2", ",", "a3"}], "}"}], "]"}], ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"b2", ",", "b3"}], "}"}], "]"}]}], "]"}]}], ")"}]}],
            "\[IndentingNewLine]", ")"}]}], "/;", 
         RowBox[{"!", 
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{
              "a1", ",", "a2", ",", "a3", ",", "a4", ",", "b1", ",", "b2", 
               ",", "b3", ",", "b4"}], "}"}], "]"}], ",", "5"}], "]"}]}]}]}], 
       ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{"dotOps", "[", 
          RowBox[{
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", "a1_", ",", "b1_"}], "]"}], ",", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", "a2_", ",", "b2_"}], "]"}], ",", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", "a3_", ",", "b3_"}], "]"}], ",", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", "a4_", ",", "b4_"}], "]"}], ",", 
           RowBox[{"Tensor", "[", 
            RowBox[{"\[Gamma]", ",", "a5_", ",", "b5_"}], "]"}]}], "]"}], 
         "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "4"}], "I", " ", 
          RowBox[{"Tensor", "[", 
           RowBox[{"\[Epsilon]", ",", "\[IndentingNewLine]", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"a1", ",", "a2", ",", "a3", ",", "a4"}], "}"}], "]"}], 
            ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"b1", ",", "b2", ",", "b3", ",", "b4"}], "}"}], "]"}]}],
            "]"}]}], "/;", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"a5", ",", "b5"}], "}"}], "]"}], ",", "5"}], "]"}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"In", " ", "case", " ", 
         SuperscriptBox["\[Gamma]", "5"], " ", "is", " ", "not", " ", "at", 
         " ", 
         RowBox[{"end", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"dd", ":", "dotOps"}], ")"}], "[", 
          RowBox[{"a_", ",", "b__"}], "]"}], "]"}], ":>", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "4"}], "I", " ", 
          RowBox[{"\[Epsilon]", "@", 
           RowBox[{"uuuu", "[", " ", 
            RowBox[{"Apply", "[", 
             RowBox[{"Sequence", ",", 
              RowBox[{"Extract\[Gamma]Indices", "[", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{
                 RowBox[{"dd", "[", 
                  RowBox[{"a", ",", "b"}], "]"}], ",", 
                 RowBox[{"\[Gamma]", "@", 
                  RowBox[{"u", "[", "5", "]"}]}]}], "]"}], "]"}]}], "]"}], 
            "]"}]}]}], "/;", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"allGammaQ", "[", 
            RowBox[{"dd", "[", 
             RowBox[{"a", ",", "b"}], "]"}], "]"}], "&&", 
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"dd", "[", 
              RowBox[{"a", ",", "b"}], "]"}], "]"}], "==", "5"}], "&&", 
           RowBox[{
            RowBox[{"Count", "[", 
             RowBox[{
              RowBox[{"dd", "[", 
               RowBox[{"a", ",", "b"}], "]"}], ",", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "5", "]"}]}]}], "]"}], "==", "1"}]}], 
          ")"}]}]}]}], "\[IndentingNewLine]", "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subTraceGamma0", ":=", "tuTrGamma"}], ";"}], " ", 
   RowBox[{"(*", "Compatibility", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "Test", " ", "if", " ", "exp_", " ", "is", " ", "Listable", " ", "list", 
      " ", "of", " ", "all", " ", 
      RowBox[{"\[Gamma]", "@", 
       RowBox[{"u", "[", "]"}]}]}], "||", 
     RowBox[{
      RowBox[{"\[Gamma]", "@", 
       RowBox[{"d", "[", "]"}]}], " ", "*", "12", "Oct2012"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"allGammaQ", "[", "exp_", "]"}], ":=", 
     RowBox[{"Apply", "[", 
      RowBox[{"And", ",", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"{", "#", "}"}], ",", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "_", 
              "]"}]}], "]"}], "||", 
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"{", "#", "}"}], ",", 
             RowBox[{
              RowBox[{"T", "[", 
               RowBox[{"\[Gamma]", ",", "\"\<d\>\""}], "]"}], "[", "_", 
              "]"}]}], "]"}]}], "&"}], ",", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "exp"}], "]"}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Extracts", " ", "list", " ", "of", " ", "indices", " ", "from", " ", 
     "dot", " ", "product", " ", "of", " ", 
     RowBox[{"\[Gamma]", "@", 
      RowBox[{"u", "[", "]"}]}], 
     RowBox[{"s", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Extract\[Gamma]Indices", "[", "exp_", "]"}], ":=", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Apply", "[", 
        RowBox[{"List", ",", "exp"}], "]"}], "/.", 
       RowBox[{
        RowBox[{"Tensor", "[", 
         RowBox[{"\[Gamma]", ",", "a_", ",", "b_"}], "]"}], "->", "a"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Test", " ", "of", " ", 
       RowBox[{"subTraceGamma0", ".", "\[IndentingNewLine]", "tmp"}]}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Tr", "[", "Id", "]"}], ",", 
         RowBox[{"Tr", "[", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "5", "]"}]}], "]"}], ",", 
         RowBox[{"Tr", "[", 
          RowBox[{"\[Gamma]", "@", 
           RowBox[{"u", "[", "a", "]"}]}], "]"}], ",", 
         RowBox[{"Tr", "[", 
          RowBox[{
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "a", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "b", "]"}]}]}], "]"}], ",", 
         RowBox[{"Tr", "[", 
          RowBox[{
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "a", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "5", "]"}]}]}], "]"}], ",", 
         RowBox[{"Tr", "[", 
          RowBox[{
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "a", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "d", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "c", "]"}]}]}], "]"}], ",", 
         RowBox[{"Tr", "[", 
          RowBox[{
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "a", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "d", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "5", "]"}]}]}], "]"}], ",", 
         RowBox[{"Tr", "[", 
          RowBox[{
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "a", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "b", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "c", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "d", "]"}]}]}], "]"}], ",", 
         RowBox[{"Tr", "[", 
          RowBox[{
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "a", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "b", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "c", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "5", "]"}]}]}], "]"}], ",", 
         RowBox[{"Tr", "[", 
          RowBox[{
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "a", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "b", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "c", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "d", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "e", "]"}]}]}], "]"}], ",", 
         RowBox[{"Tr", "[", 
          RowBox[{
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "a", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "b", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "c", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "d", "]"}]}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "5", "]"}]}]}], "]"}]}], "}"}], 
       "\[IndentingNewLine]", 
       RowBox[{"TableForm", "[", "\[IndentingNewLine]", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{"#", "/.", "subTraceGamma0"}]}], "}"}], "&"}], ",", 
          "tmp"}], "]"}], "\[IndentingNewLine]", "]"}]}]}], ";"}], "     ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"simpleTrGamma1", "[", "scalar_List", "]"}], "[", "exp_", "]"}],
      " ", "simplifies", " ", 
     RowBox[{"Tr", "[", 
      RowBox[{
       RowBox[{"\[Gamma]", "'"}], "s"}], "]"}], " ", "terms", " ", "in", " ", 
     "exp_.", " ", "Assumes", " ", 
     RowBox[{"NDim", "."}], " ", "*", "7", "Dec2015"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simpleTrGamma1", "[", 
      RowBox[{"scalar_List:", 
       RowBox[{"{", "}"}]}], "]"}], "[", "exp_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"$tmp", "=", "exp"}], ",", "test"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"test", "=!=", "$tmp"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"test", "=", "$tmp"}], ";", "\[IndentingNewLine]", 
          RowBox[{"$tmp", "=", 
           RowBox[{
            RowBox[{"$tmp", "//.", 
             RowBox[{"simpleTr2", "[", "scalar", "]"}]}], "//", 
            RowBox[{"simpleDot3", "[", "scalar", "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"$tmp", "=", 
           RowBox[{
            RowBox[{"$tmp", "//", 
             RowBox[{"GammaLeft", "[", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "5", "]"}]}], "]"}]}], "//", 
            RowBox[{"GammaLeft", "[", 
             RowBox[{"\[Gamma]", "@", 
              RowBox[{"u", "[", "5", "]"}]}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"$tmp", "=", 
           RowBox[{
            RowBox[{"$tmp", "//.", "subTraceGamma0"}], "//.", 
            "simpleGamma"}]}]}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "$tmp"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"simpleTrGamma", "[", "exp_", "]"}], " ", "simplifies", " ", 
     RowBox[{"Tr", "[", 
      RowBox[{
       RowBox[{"Dot", "[", 
        RowBox[{
         RowBox[{"\[Gamma]", "'"}], "s"}], "]"}], " ", "terms", " ", "in", 
       " ", "exp_.", "  ", "Implements", " ", "all", " ", "of", " ", "the", 
       " ", "relations", " ", "in", " ", 
       RowBox[{"PS", ".", "A"}], 
       RowBox[{".27", ".", " ", 
        RowBox[{"OBSOLETE", ":", " ", 
         RowBox[{
         "use", " ", "simpleTrGamma1", " ", "*", "24", "Sep2012"}]}]}]}]}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"simpleTrGamma", "[", "exp_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "sub", ",", "subu", ",", "subd"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sub", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Tr", "[", "]"}], "\[Rule]", "1"}], ",", 
           RowBox[{
            RowBox[{"Tr", "[", "0", "]"}], "->", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{"Id", "|", 
              RowBox[{"Id", "[", "__", "]"}]}], "]"}], ":>", "NDim"}], ",", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"assume", " ", "4"}], "-", 
             RowBox[{"dim", "."}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{"\[Gamma]", "@", 
              RowBox[{"d", "[", "_", "]"}]}], "]"}], "->", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{"\[Gamma]", "@", 
              RowBox[{"u", "[", "_", "]"}]}], "]"}], "->", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{"-", "a_"}], "]"}], "->", 
            RowBox[{"-", 
             RowBox[{"Tr", "[", "a", "]"}]}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Even", " ", "and", " ", "Odd", " ", "number", " ", "of", " ", 
             RowBox[{"\[Gamma]", "'"}], 
             RowBox[{"s", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"op", ":", "dotOps"}], ")"}], "[", "a__", "]"}], "]"}],
             ":>", 
            RowBox[{"0", "/;", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"allGammaQ", "[", 
                RowBox[{"{", "a", "}"}], "]"}], "&&", 
               RowBox[{"EvenQ", "[", 
                RowBox[{"Length", "[", 
                 RowBox[{"{", "a", "}"}], "]"}], "]"}], "&&", 
               RowBox[{"OddQ", "[", 
                RowBox[{
                 RowBox[{"Count", "[", 
                  RowBox[{
                   RowBox[{"{", "a", "}"}], ",", 
                   RowBox[{"\[Gamma]", "@", 
                    RowBox[{"u", "[", "5", "]"}]}]}], "]"}], "+", 
                 RowBox[{"Count", "[", 
                  RowBox[{
                   RowBox[{"{", "a", "}"}], ",", 
                   RowBox[{"\[Gamma]", "@", 
                    RowBox[{"d", "[", "5", "]"}]}]}], "]"}]}], "]"}]}], 
              ")"}]}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"op", ":", "dotOps"}], ")"}], "[", "a__", "]"}], "]"}],
             ":>", 
            RowBox[{"0", "/;", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"allGammaQ", "[", 
                RowBox[{"{", "a", "}"}], "]"}], "&&", 
               RowBox[{"OddQ", "[", 
                RowBox[{"Length", "[", 
                 RowBox[{"{", "a", "}"}], "]"}], "]"}], "&&", 
               RowBox[{"EvenQ", "[", 
                RowBox[{
                 RowBox[{"Count", "[", 
                  RowBox[{
                   RowBox[{"{", "a", "}"}], ",", 
                   RowBox[{"\[Gamma]", "@", 
                    RowBox[{"u", "[", "5", "]"}]}]}], "]"}], "+", 
                 RowBox[{"Count", "[", 
                  RowBox[{
                   RowBox[{"{", "a", "}"}], ",", 
                   RowBox[{"\[Gamma]", "@", 
                    RowBox[{"d", "[", "5", "]"}]}]}], "]"}]}], "]"}]}], 
              ")"}]}]}]}], "\[IndentingNewLine]", "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"subd", "=", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "a_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "b_", "]"}]}]}], "]"}], ":>", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", "a", "}"}], ",", "5"}], "]"}], ",", "0", ",", 
              RowBox[{"4", " ", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"g", ",", "\"\<dd\>\""}], "]"}], "[", 
                RowBox[{"a", ",", "b"}], "]"}]}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "a_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "b_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "c_", "]"}]}]}], "]"}], ":>", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "a_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "b_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "c_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "d_", "]"}]}]}], "]"}], ":>", 
            RowBox[{
             RowBox[{"4", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<dd\>\""}], "]"}], "[", 
                  RowBox[{"a", ",", "b"}], "]"}], 
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<dd\>\""}], "]"}], "[", " ", 
                  RowBox[{"c", ",", "d"}], "]"}]}], "-", 
                RowBox[{
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<dd\>\""}], "]"}], "[", 
                  RowBox[{"a", ",", "c"}], "]"}], 
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<dd\>\""}], "]"}], "[", " ", 
                  RowBox[{"b", ",", "d"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<dd\>\""}], "]"}], "[", 
                  RowBox[{"a", ",", "d"}], "]"}], 
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<dd\>\""}], "]"}], "[", 
                  RowBox[{"b", ",", "c"}], "]"}]}]}], ")"}]}], "/;", 
             RowBox[{"(", 
              RowBox[{"!", 
               RowBox[{"MemberQ", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], ",", 
                 "5"}], "]"}]}], ")"}]}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "a_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "b_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "c_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "e_", "]"}]}]}], "]"}], ":>", 
            RowBox[{"0", "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", "a", "}"}], ",", "5"}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "a_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "b_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "c_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "d_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"d", "[", "e_", "]"}]}]}], "]"}], ":>", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], " ", "I", " ", 
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"\[Epsilon]", ",", "\"\<dddd\>\""}], "]"}], "[", 
               RowBox[{"b", ",", "c", ",", "d", ",", "e"}], "]"}]}], "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", "a", "}"}], ",", "5"}], "]"}]}]}]}], 
          "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"subu", "=", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "a_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "b_", "]"}]}]}], "]"}], ":>", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", "a", "}"}], ",", "5"}], "]"}], ",", "0", ",", 
              RowBox[{"4", " ", 
               RowBox[{
                RowBox[{"T", "[", 
                 RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
                RowBox[{"a", ",", "b"}], "]"}]}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "a_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "b_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "c_", "]"}]}]}], "]"}], ":>", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "a_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "b_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "c_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "d_", "]"}]}]}], "]"}], ":>", 
            RowBox[{
             RowBox[{"4", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
                  RowBox[{"a", ",", "b"}], "]"}], 
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", " ", 
                  RowBox[{"c", ",", "d"}], "]"}]}], "-", 
                RowBox[{
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
                  RowBox[{"a", ",", "c"}], "]"}], 
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", " ", 
                  RowBox[{"b", ",", "d"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
                  RowBox[{"a", ",", "d"}], "]"}], 
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"g", ",", "\"\<uu\>\""}], "]"}], "[", 
                  RowBox[{"b", ",", "c"}], "]"}]}]}], ")"}]}], "/;", 
             RowBox[{"(", 
              RowBox[{"!", 
               RowBox[{"MemberQ", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "}"}], ",", 
                 "5"}], "]"}]}], ")"}]}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "a_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "b_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "c_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "e_", "]"}]}]}], "]"}], ":>", 
            RowBox[{"0", "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", "a", "}"}], ",", "5"}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "a_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "b_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "c_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "d_", "]"}]}], ".", 
              RowBox[{"\[Gamma]", "@", 
               RowBox[{"u", "[", "e_", "]"}]}]}], "]"}], ":>", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], " ", "I", " ", 
              RowBox[{
               RowBox[{"T", "[", 
                RowBox[{"\[Epsilon]", ",", "\"\<uuuu\>\""}], "]"}], "[", 
               RowBox[{"b", ",", "c", ",", "d", ",", "e"}], "]"}]}], "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", "a", "}"}], ",", "5"}], "]"}]}]}]}], 
          "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"exp", "//", 
           RowBox[{"GammaLeft", "[", 
            RowBox[{"\[Gamma]", "@", 
             RowBox[{"d", "[", "5", "]"}]}], "]"}]}], "//", 
          RowBox[{"GammaLeft", "[", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "5", "]"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "//.", 
         RowBox[{"Join", "[", 
          RowBox[{"sub", ",", "subd", ",", "subu"}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"RaiseTr\[Gamma]Indices", "[", "exp_Tr", "]"}], " ", "raises", 
     " ", "the", " ", "index", " ", "of", " ", "all", " ", 
     RowBox[{"\[Gamma]", "@", 
      RowBox[{"d", "[", "]"}]}], " ", "Tensors", " ", "in", " ", "exp_Tr", 
     " ", "using", " ", "metric", " ", "Tensor", " ", 
     RowBox[{
      RowBox[{"g", "@", 
       RowBox[{"dd", "[", "]"}]}], ".", "  ", "The"}], " ", "purpose", " ", 
     "of", " ", "this", " ", "Module", " ", "is", " ", "so", " ", "we", " ", 
     "can", " ", "apply", " ", 
     RowBox[{"simpleTrGamma", ".", " ", 
      RowBox[{"NOTE", ":", " ", 
       RowBox[{
       "Might", " ", "want", " ", "to", " ", "incorporate", " ", "into", " ", 
        
        RowBox[{"simpleTrGamma", "."}], " ", "*", "14", "Oct2012"}]}]}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RaiseTr\[Gamma]Indices", "[", "exp_Tr", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "glist", ",", "tmpi"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"glist", "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"List", ",", "exp"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"glist", "=", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"glist", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"\[Gamma]", ",", "\"\<d\>\""}], "]"}], "[", "x_", 
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"exp", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"\[Gamma]", ",", "\"\<d\>\""}], "]"}], "[", "x_", "]"}], 
           ":>", 
           RowBox[{
            RowBox[{
             RowBox[{"T", "[", 
              RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", 
             RowBox[{"(", 
              RowBox[{"tmpi", "=", 
               RowBox[{"Unique", "[", "]"}]}], ")"}], "]"}], 
            RowBox[{"g", "@", 
             RowBox[{"dd", "[", 
              RowBox[{"x", ",", "tmpi"}], "]"}]}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"tmp", "//.", 
           RowBox[{"simpleDot2", "[", 
            RowBox[{"{", 
             RowBox[{"g", "@", 
              RowBox[{"dd", "[", 
               RowBox[{"_", ",", "_"}], "]"}]}], "}"}], "]"}]}], "//.", 
          RowBox[{"simpleTr2", "[", 
           RowBox[{"{", 
            RowBox[{"g", "@", 
             RowBox[{"dd", "[", 
              RowBox[{"_", ",", "_"}], "]"}]}], "}"}], "]"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Rule", " ", "generator", " ", "for", " ", "expanding", " ", 
      "spinorBar"}], ",", " ", 
     OverscriptBox["u", "_"], ",", " ", 
     RowBox[{"expressions", "->", 
      RowBox[{
       RowBox[{
        SuperscriptBox["u", "\[Dagger]"], ".", "\[Gamma]0"}], "->", 
       RowBox[{"\[Gamma]0", ".", "u", " ", "."}]}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"spinorBarExpand", "[", "\[Psi]_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sub", ",", 
         RowBox[{"tmpu", "=", "\[Psi]"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sub", "=", 
         RowBox[{
          OverscriptBox["\[Psi]", "_"], "->", 
          RowBox[{
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{"RemovePatterns", "[", "\[Psi]", "]"}], "]"}], ".", 
           RowBox[{"\[Gamma]", "@", 
            RowBox[{"u", "[", "0", "]"}]}]}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ConjugateTranspose", "[", "#", "]"}], "&"}], ",", 
             "sub"}], "]"}], "/.", 
           RowBox[{"simpleHermitian", "[", 
            RowBox[{"{", 
             RowBox[{"\[Gamma]", "@", 
              RowBox[{"u", "[", "_", "]"}]}], "}"}], "]"}]}], ",", "sub"}], 
         "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Example", " ", "of", " ", "how", " ", "to", " ", "form", " ", "Rules"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"spinorBarExpandRule", "[", "spinor_List", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"spinorBarExpand", "[", "#", "]"}], "&"}], ",", 
            "spinor"}], "]"}], "//", "Flatten"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MapAt", "[", 
            RowBox[{"(*", 
             RowBox[{"Pattern", " ", "confuses", " ", 
              RowBox[{"match", "."}]}], "*)"}], 
            RowBox[{
             RowBox[{
              RowBox[{"RemovePatterns", "[", "#", "]"}], "&"}], ",", "#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], "&"}], ",", "tmp"}], "]"}]}]}],
       "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
    "Templates", " ", "Rules", " ", "for", " ", "evaluating", " ", 
     "scattering", " ", 
     RowBox[{"amplitutes", "."}], " ", "*", "14", "Jan2014"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"scatteringAmplitudeRules", ":=", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"\[ScriptCapitalM]", "[", "_", "]"}], "]"}], "^", "2"}], ":>", 
        RowBox[{
         SuperscriptBox["\[ScriptCapitalM]", "\[Dagger]"], ".", 
         "\[ScriptCapitalM]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"a___", " ", 
         RowBox[{
          RowBox[{
           OverscriptBox["u_", "_"], "[", "pu_", "]"}], ".", 
          RowBox[{
           RowBox[{"T", "[", 
            RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "\[Mu]_", 
           "]"}], ".", 
          RowBox[{"v_", "[", "pv_", "]"}]}]}], "\[Rule]", 
        RowBox[{"a", " ", 
         RowBox[{"Conjugate", "[", " ", 
          RowBox[{
           RowBox[{
            OverscriptBox["v", "_"], "[", "pv", "]"}], ".", 
           RowBox[{
            RowBox[{"T", "[", 
             RowBox[{"\[Gamma]", ",", "\"\<u\>\""}], "]"}], "[", "\[Mu]", 
            "]"}], ".", 
           RowBox[{"u", "[", "pu", "]"}]}], "]"}]}]}], ",", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Use", " ", "carefully"}], "-", "loops"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"ConjugateTranspose", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"U", ":", "u_"}], ")"}], "[", "a_", "]"}], "]"}], ".", 
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "0", "]"}]}]}], "->", 
        RowBox[{
         OverscriptBox["U", "_"], "[", "a", "]"}]}], ",", 
       RowBox[{"(*", 
        RowBox[{"PS", ".3", ".55"}], "*)"}], 
       RowBox[{
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "0", "]"}]}], ".", 
         RowBox[{"ConjugateTranspose", "[", 
          RowBox[{
           OverscriptBox[
            RowBox[{"(", 
             RowBox[{"U", ":", "u_"}], ")"}], "_"], "[", "a_", "]"}], "]"}]}],
         "->", 
        RowBox[{"U", "[", "a", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"ConjugateTranspose", "[", 
          RowBox[{
           OverscriptBox[
            RowBox[{"(", 
             RowBox[{"U", ":", "u_"}], ")"}], "_"], "[", "a_", "]"}], "]"}], 
         ".", " ", 
         RowBox[{
          OverscriptBox["u_", "_"], "[", "a_", "]"}]}], "->", 
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", "0", "]"}]}], ".", " ", 
         RowBox[{"U", "[", "a", "]"}], ".", 
         RowBox[{
          OverscriptBox["U", "_"], "[", "a", "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Sum", " ", "fermion", " ", "spins", " ", "*", "PS", ".5", ".3"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
         RowBox[{"a___", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"V", ":", "v_"}], ")"}], "[", "p_", "]"}], ",", 
          RowBox[{
           OverscriptBox["v_", "_"], "[", "p_", "]"}], ",", "b___"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{"a", ",", 
           RowBox[{
            RowBox[{"Slash", "[", "p", "]"}], "+", 
            SubscriptBox["m", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]]}], ",", "b"}], "]"}], "/;", 
         RowBox[{"!", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"V", ",", "u"}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{
           OverscriptBox["v_", "_"], "[", "p_", "]"}], ",", "a___", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"V", ":", "v_"}], ")"}], "[", "p_", "]"}], ",", "b___"}], 
         "]"}], ":>", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Slash", "[", "p", "]"}], "+", 
            SubscriptBox["m", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]]}], ",", "a"}], "]"}], "/;", 
         RowBox[{"!", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"V", ",", "u"}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
         RowBox[{"a___", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"V", ":", "u_"}], ")"}], "[", "p_", "]"}], ",", 
          RowBox[{
           OverscriptBox["u_", "_"], "[", "p_", "]"}], ",", "b___"}], "]"}], ":>", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{"a", ",", 
           RowBox[{
            RowBox[{"Slash", "[", "p", "]"}], "-", 
            SubscriptBox["m", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]]}], ",", "b"}], "]"}], "/;", 
         RowBox[{"!", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"V", ",", "v"}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
         RowBox[{
          RowBox[{
           OverscriptBox["u_", "_"], "[", "p_", "]"}], ",", "a___", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"V", ":", "u_"}], ")"}], "[", "p_", "]"}], ",", "b___"}], 
         "]"}], ":>", 
        RowBox[{
         RowBox[{"op", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Slash", "[", "p", "]"}], "-", 
            SubscriptBox["m", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]]}], ",", "a"}], "]"}], "/;", 
         RowBox[{"!", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"V", ",", "v"}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Other", " ", "forms", " ", "of", " ", "fermion", " ", "spin", " ", 
         "sum"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
         RowBox[{"a___", ",", 
          RowBox[{"V", ":", 
           RowBox[{"v_", "[", "p_", "]"}]}], ",", 
          RowBox[{
           OverscriptBox["v_", "_"], "[", "p_", "]"}], ",", "b___"}], "]"}], "->", 
        RowBox[{"op", "[", 
         RowBox[{"a", ",", 
          RowBox[{
           RowBox[{"Slash", "[", "p", "]"}], "-", 
           SubscriptBox["m", "V"]}], ",", "b"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xDot", "[", 
         RowBox[{
          RowBox[{"V", ":", 
           RowBox[{
            OverscriptBox["u", "_"], "[", "p_", "]"}]}], ",", "a__", ",", 
          RowBox[{"u", "[", "p_", "]"}]}], "]"}], "->", 
        RowBox[{
         RowBox[{"a", ".", 
          RowBox[{"Slash", "[", "p", "]"}]}], "+", 
         SubscriptBox["m", "V"]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"HoldPattern", "[", 
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"V", ":", 
            RowBox[{
             OverscriptBox["u", "_"], "[", "p_", "]"}]}], ",", "a__", ",", 
           RowBox[{"u", "[", "p_", "]"}]}], "]"}], "]"}], "->", 
        RowBox[{
         RowBox[{"a", ".", 
          RowBox[{"Slash", "[", "p", "]"}]}], "+", 
         SubscriptBox["m", "V"]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"V", ":", 
           RowBox[{"v", "[", "p_", "]"}]}], ")"}], ".", 
         RowBox[{
          OverscriptBox["v", "_"], "[", "p_", "]"}]}], "->", 
        RowBox[{
         RowBox[{"Slash", "[", "p", "]"}], "-", 
         SubscriptBox["m", "V"]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"V", ":", 
           RowBox[{"u", "[", "p_", "]"}]}], ")"}], ".", 
         RowBox[{
          OverscriptBox["u", "_"], "[", "p_", "]"}]}], "->", 
        RowBox[{
         RowBox[{"Slash", "[", "p", "]"}], "+", 
         SubscriptBox["m", "V"]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"v_", "[", "p_", "]"}], ".", 
         RowBox[{
          OverscriptBox["v_", "_"], "[", "p_", "]"}]}], "->", 
        RowBox[{
         RowBox[{"Slash", "[", "p", "]"}], "-", 
         SubscriptBox["m", "p"]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"HoldPattern", "[", 
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             OverscriptBox["u_", "_"], ")"}], "[", "p_", "]"}], ",", "a__", 
           ",", 
           RowBox[{"u_", "[", "p_", "]"}]}], "]"}], "]"}], "->", 
        RowBox[{"a", ".", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Slash", "[", "p", "]"}], "+", 
           SubscriptBox["m", "p"]}], ")"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"HoldPattern", "[", 
         RowBox[{
          RowBox[{
           OverscriptBox["u", "_"], "[", "p_", "]"}], ".", "a__", " ", ".", 
          "  ", 
          RowBox[{"(", 
           RowBox[{"V", ":", 
            RowBox[{"u", "[", "p_", "]"}]}], ")"}]}], "]"}], "->", 
        RowBox[{"a", " ", ".", "  ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Slash", "[", "p", "]"}], "+", 
           SubscriptBox["m", "V"]}], ")"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"HoldPattern", "[", 
         RowBox[{
          RowBox[{
           OverscriptBox["v", "_"], "[", "p_", "]"}], ".", "a__", " ", ".", 
          "  ", 
          RowBox[{"(", 
           RowBox[{"V", ":", 
            RowBox[{"v", "[", "p_", "]"}]}], ")"}]}], "]"}], "->", 
        RowBox[{"a", " ", ".", "  ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Slash", "[", "p", "]"}], "-", 
           SubscriptBox["m", "V"]}], ")"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Slash", "[", "p_", "]"}], ":>", 
        RowBox[{
         RowBox[{"\[Gamma]", "@", 
          RowBox[{"u", "[", 
           RowBox[{"i$", "=", 
            RowBox[{"Unique", "[", "]"}]}], "]"}]}], 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"p", ",", "\"\<d\>\""}], "]"}], "[", "i$", "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Times", "|", "Dot"}], ")"}], "[", 
         RowBox[{
          RowBox[{"Slash", "[", "a_", "]"}], ",", 
          RowBox[{"Slash", "[", "b_", "]"}]}], "]"}], "->", 
        RowBox[{
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"a", ",", "\"\<u\>\""}], "]"}], "[", 
          RowBox[{"i$", "=", 
           RowBox[{"Unique", "[", "]"}]}], "]"}], 
         RowBox[{
          RowBox[{"T", "[", 
           RowBox[{"b", ",", "\"\<d\>\""}], "]"}], "[", "i$", "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Must", " ", "apply", " ", "first", " ", "if", " ", "Slash", " ", 
         "already", " ", "in", " ", 
         RowBox[{"expression", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Conjuation", " ", "of", " ", "vertex", " ", 
         RowBox[{"terms", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Conjugate", "[", 
         RowBox[{
          RowBox[{
           OverscriptBox["v_", "_"], "[", "pv_", "]"}], ".", " ", 
          RowBox[{"FN", "[", "\[Gamma]", "]"}], " ", ".", " ", 
          RowBox[{"(", 
           RowBox[{"u_", "[", "pu_", "]"}], ")"}]}], "]"}], "->", 
        RowBox[{
         RowBox[{
          OverscriptBox["u", "_"], "[", "pu", "]"}], ".", 
         RowBox[{"FN", "[", "\[Gamma]", "]"}], ".", 
         RowBox[{"v", "[", "pv", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"HoldPattern", "[", 
         RowBox[{
          RowBox[{"Conjugate", "[", 
           RowBox[{
            OverscriptBox["v_", "_"], "[", "pv_", "]"}], "]"}], ".", " ", 
          "a___", " ", ".", " ", 
          RowBox[{"Conjugate", "[", 
           RowBox[{"u_", "[", "pu_", "]"}], "]"}]}], "]"}], "\[RuleDelayed]", 
        
        RowBox[{
         RowBox[{
          OverscriptBox["u", "_"], "[", "pu", "]"}], ".", 
         RowBox[{"Conjugate", "[", 
          RowBox[{"Dot", "[", "a", "]"}], "]"}], ".", 
         RowBox[{"v", "[", "pv", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"HoldPattern", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"op", ":", "dotOps"}], ")"}], "[", 
          RowBox[{
           RowBox[{"Conjugate", "[", 
            RowBox[{
             OverscriptBox["v_", "_"], "[", "pv_", "]"}], "]"}], ",", " ", 
           "a___", " ", ",", " ", 
           RowBox[{"Conjugate", "[", 
            RowBox[{"u_", "[", "pu_", "]"}], "]"}]}], "]"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{"op", "[", 
         RowBox[{
          RowBox[{
           OverscriptBox["u", "_"], "[", "pu", "]"}], ",", 
          RowBox[{"Conjugate", "[", 
           RowBox[{"Dot", "[", "a", "]"}], "]"}], ",", 
          RowBox[{"v", "[", "pv", "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
      "}"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.475328123998171*^9, 3.475328144256694*^9}, {
   3.475328304872456*^9, 3.4753283182617693`*^9}, {3.475328351015662*^9, 
   3.475328367009488*^9}, {3.475333524120799*^9, 3.475333628677216*^9}, {
   3.4753337470618677`*^9, 3.4753337530110397`*^9}, {3.475333868765501*^9, 
   3.475333886651235*^9}, {3.475334456651794*^9, 3.4753345339458838`*^9}, {
   3.475341693343952*^9, 3.475341697647821*^9}, 3.475341876350463*^9, {
   3.4753419530979548`*^9, 3.475342024964407*^9}, {3.475342353406999*^9, 
   3.4753424243893642`*^9}, {3.475342462248831*^9, 3.4753425386889257`*^9}, {
   3.475343559647657*^9, 3.4753437477150097`*^9}, {3.475343777804968*^9, 
   3.475343822030724*^9}, {3.475343909796315*^9, 3.47534392259345*^9}, {
   3.4753444450366583`*^9, 3.47534448099774*^9}, {3.4753446155859947`*^9, 
   3.475344631640381*^9}, {3.4753446909124002`*^9, 3.475344747802864*^9}, {
   3.4753448518920717`*^9, 3.475345038209539*^9}, {3.475345079795126*^9, 
   3.475345193773902*^9}, {3.475345238274949*^9, 3.4753452894704227`*^9}, {
   3.475345373246751*^9, 3.475345415460705*^9}, 3.475346528554399*^9, {
   3.475346713288813*^9, 3.475346799296137*^9}, {3.4753468641132097`*^9, 
   3.475346942541623*^9}, 3.475347135703167*^9, {3.4753471990020123`*^9, 
   3.4753472101392813`*^9}, {3.475347557581555*^9, 3.475347653794413*^9}, 
   3.475348054871016*^9, {3.4753525505906153`*^9, 3.475352564725621*^9}, {
   3.481724247809203*^9, 3.481724314769746*^9}, {3.4817243621510277`*^9, 
   3.4817243720012417`*^9}, {3.481724429033697*^9, 3.481724479491053*^9}, {
   3.481724513540463*^9, 3.481724514193734*^9}, {3.481724665987877*^9, 
   3.481724668797902*^9}, {3.487705712785967*^9, 3.487705742226283*^9}, {
   3.487706194970272*^9, 3.487706213699222*^9}, {3.487706265585017*^9, 
   3.487706281576811*^9}, {3.487706318236301*^9, 3.487706375115019*^9}, 
   3.487706620172276*^9, {3.487706663223996*^9, 3.487706686924864*^9}, {
   3.487706771245366*^9, 3.4877068279237413`*^9}, {3.4877072453356752`*^9, 
   3.487707318651052*^9}, {3.4877073916816072`*^9, 3.487707394176783*^9}, {
   3.487707463523397*^9, 3.487707475988884*^9}, {3.48770763124832*^9, 
   3.4877076369364033`*^9}, 3.487707692093889*^9, {3.487707929025633*^9, 
   3.487708016169683*^9}, {3.48770877433328*^9, 3.487708779271811*^9}, {
   3.4877790591220903`*^9, 3.487779311922257*^9}, {3.487779371984054*^9, 
   3.487779388037698*^9}, {3.487812620028296*^9, 3.487812725082752*^9}, {
   3.487812818745019*^9, 3.487812870232193*^9}, {3.487812943142901*^9, 
   3.487812945450954*^9}, {3.487813007178384*^9, 3.4878130086772614`*^9}, {
   3.487813609946493*^9, 3.487813624351432*^9}, {3.487813660959125*^9, 
   3.487813717601482*^9}, {3.487813752638932*^9, 3.487813779547028*^9}, {
   3.487815569895732*^9, 3.487815585851541*^9}, {3.48872473345861*^9, 
   3.488724763438963*^9}, {3.4892426035792713`*^9, 3.489242605919372*^9}, {
   3.489242653804775*^9, 3.489242653944703*^9}, {3.4900141515507793`*^9, 
   3.490014257628776*^9}, 3.490014296697084*^9, {3.490014348878265*^9, 
   3.490014402111279*^9}, 3.4900144540922422`*^9, {3.490014492105418*^9, 
   3.490014522892501*^9}, {3.490014723371307*^9, 3.490014776159576*^9}, {
   3.490015006307776*^9, 3.490015028567522*^9}, {3.490015083940827*^9, 
   3.490015084138937*^9}, 3.4900153169170218`*^9, {3.4900183056327543`*^9, 
   3.4900183803315268`*^9}, {3.490018573885417*^9, 3.490018577586823*^9}, 
   3.4900355572971153`*^9, {3.4900356371025753`*^9, 3.490035648935021*^9}, {
   3.490060075695898*^9, 3.4900601139162292`*^9}, {3.490060196662898*^9, 
   3.490060203037228*^9}, {3.4901905037702503`*^9, 3.490190524434208*^9}, {
   3.490190621342786*^9, 3.49019069998328*^9}, {3.490365830910213*^9, 
   3.490365894647029*^9}, {3.490708256794696*^9, 3.490708257489456*^9}, {
   3.490708854274746*^9, 3.490708898812036*^9}, {3.490708942719329*^9, 
   3.4907089885389423`*^9}, 3.490709408525117*^9, {3.4913404552564173`*^9, 
   3.4913404602073317`*^9}, 3.491343411690154*^9, {3.4913434965792017`*^9, 
   3.4913435579328833`*^9}, {3.491343876917362*^9, 3.491343951418373*^9}, {
   3.491343987430863*^9, 3.491344001492498*^9}, {3.491344705081806*^9, 
   3.491344778561191*^9}, {3.492689917082382*^9, 3.492689937546138*^9}, {
   3.492701922372221*^9, 3.4927019555009203`*^9}, {3.4927019989349747`*^9, 
   3.492702003069899*^9}, {3.49339781042805*^9, 3.493397810572646*^9}, {
   3.493398239783684*^9, 3.493398254671523*^9}, {3.4934374161264544`*^9, 
   3.493437446226315*^9}, {3.49343749040487*^9, 3.493437490751791*^9}, {
   3.493437665036249*^9, 3.4934376661459*^9}, {3.493437697629623*^9, 
   3.4934377248588*^9}, 3.4934377622790947`*^9, {3.493437831185381*^9, 
   3.493437836438717*^9}, 3.4934379231024*^9, {3.493437953145822*^9, 
   3.493437958203628*^9}, {3.493470510269672*^9, 3.493470556861578*^9}, 
   3.494094570540908*^9, {3.494094610921569*^9, 3.4940946904315233`*^9}, {
   3.497098206446824*^9, 3.4970982296361723`*^9}, {3.506205504876287*^9, 
   3.5062055092689447`*^9}, {3.5062056465573397`*^9, 3.506206033772442*^9}, {
   3.506206136487843*^9, 3.5062061507686787`*^9}, {3.50620633539077*^9, 
   3.5062063382848587`*^9}, {3.506206373669936*^9, 3.506206389654976*^9}, {
   3.506206617709961*^9, 3.506206646218466*^9}, {3.506261890679885*^9, 
   3.506261897901165*^9}, {3.506364178634058*^9, 3.506364184618281*^9}, 
   3.5063922538022833`*^9, {3.506393374937334*^9, 3.5063933769725657`*^9}, {
   3.506393412776149*^9, 3.506393451282604*^9}, {3.506393766414308*^9, 
   3.5063937737229*^9}, {3.506394328786034*^9, 3.506394330646834*^9}, {
   3.508792721823238*^9, 3.508792722571313*^9}, {3.508793153084243*^9, 
   3.508793189264172*^9}, {3.508796090245523*^9, 3.508796134655283*^9}, {
   3.509197589988235*^9, 3.509197599248603*^9}, {3.509198396509609*^9, 
   3.509198546891418*^9}, {3.509198734320533*^9, 3.5091987602574778`*^9}, {
   3.509198797794244*^9, 3.5091988003392773`*^9}, {3.509198835006805*^9, 
   3.509198858209819*^9}, {3.509399327515933*^9, 3.5093993497566223`*^9}, {
   3.50940070927345*^9, 3.509400836304667*^9}, {3.509401145291204*^9, 
   3.50940115337348*^9}, {3.5094014890028687`*^9, 3.509401584946743*^9}, {
   3.509401632782152*^9, 3.509401699936858*^9}, {3.509401812692294*^9, 
   3.5094018555080147`*^9}, {3.5094018996934423`*^9, 3.509401933979353*^9}, {
   3.509401987395418*^9, 3.509402037232629*^9}, {3.509402115315948*^9, 
   3.509402132336152*^9}, {3.5094021878415337`*^9, 3.509402188053073*^9}, {
   3.509402425599766*^9, 3.509402433194129*^9}, {3.50940247579313*^9, 
   3.509402490254243*^9}, 3.5094026157353487`*^9, {3.509402806357893*^9, 
   3.509402813841917*^9}, {3.509402940964469*^9, 3.509402961041963*^9}, {
   3.509403075990541*^9, 3.509403143734354*^9}, {3.509403200020081*^9, 
   3.509403287265943*^9}, {3.509403329190311*^9, 3.509403329817976*^9}, {
   3.509403471142651*^9, 3.509403515156438*^9}, {3.509403623843157*^9, 
   3.509403624417441*^9}, {3.5094037445637407`*^9, 3.509403758915851*^9}, 
   3.509403842213624*^9, {3.509625425523638*^9, 3.5096254810094767`*^9}, {
   3.509626546508664*^9, 3.5096265688341703`*^9}, {3.5096288989877768`*^9, 
   3.509628952331007*^9}, {3.509629140453455*^9, 3.509629179154586*^9}, {
   3.509629473563374*^9, 3.509629474904647*^9}, {3.509629578921917*^9, 
   3.509629591631598*^9}, {3.509629637463027*^9, 3.509629647712799*^9}, {
   3.50962974515234*^9, 3.50962974607803*^9}, {3.509802312640616*^9, 
   3.509802397395095*^9}, {3.50980710911132*^9, 3.509807217544896*^9}, 
   3.509808075160274*^9, {3.509808455607091*^9, 3.5098084669963627`*^9}, {
   3.509809346956168*^9, 3.5098093780490828`*^9}, {3.50980948527223*^9, 
   3.509809503725803*^9}, {3.509809573584711*^9, 3.5098096156822033`*^9}, {
   3.509809726352961*^9, 3.509809761597784*^9}, {3.5098101391891193`*^9, 
   3.5098101491471777`*^9}, {3.509849692746481*^9, 3.5098497431853313`*^9}, {
   3.5098497826297617`*^9, 3.509849785382955*^9}, {3.509887205869404*^9, 
   3.509887230221987*^9}, {3.509887770003544*^9, 3.509887771652203*^9}, {
   3.509887882726259*^9, 3.50988801972009*^9}, {3.509888167180912*^9, 
   3.50988820738585*^9}, {3.509888941329359*^9, 3.509888947950171*^9}, 
   3.509892939180502*^9, {3.509893005363188*^9, 3.509893017525523*^9}, {
   3.5098947754088593`*^9, 3.50989480287713*^9}, {3.509993548966296*^9, 
   3.5099936688423443`*^9}, {3.509994829252204*^9, 3.509994831369813*^9}, 
   3.5099957130086613`*^9, {3.509995747911996*^9, 3.50999574889797*^9}, {
   3.5099957868759127`*^9, 3.5099957891380873`*^9}, {3.509997262350204*^9, 
   3.509997281869556*^9}, {3.509997478213192*^9, 3.509997540602841*^9}, {
   3.510425946415751*^9, 3.5104259733421*^9}, {3.510426010389687*^9, 
   3.510426075869892*^9}, {3.510426118139127*^9, 3.5104261366470633`*^9}, {
   3.510927414055094*^9, 3.510927460241446*^9}, {3.5109276112212887`*^9, 
   3.5109277658892183`*^9}, {3.514561184138839*^9, 3.514561189320785*^9}, {
   3.515072644882496*^9, 3.515072682225024*^9}, {3.515072734954527*^9, 
   3.5150727603645678`*^9}, 3.5150729728756647`*^9, {3.515073917134914*^9, 
   3.515073929947475*^9}, {3.515074857537551*^9, 3.515074868417386*^9}, {
   3.5185240263669167`*^9, 3.5185240294977207`*^9}, {3.518525527132008*^9, 
   3.518525552286532*^9}, {3.519041704371387*^9, 3.519041859105596*^9}, {
   3.519041946165062*^9, 3.519041960255762*^9}, 3.51950263457301*^9, {
   3.519502684167368*^9, 3.519502714411707*^9}, {3.519567315092255*^9, 
   3.5195673301820927`*^9}, {3.519567895005218*^9, 3.5195679026083097`*^9}, {
   3.519568125502509*^9, 3.519568427563726*^9}, {3.519569224585948*^9, 
   3.519569224864602*^9}, {3.5195757599065247`*^9, 3.519575799840706*^9}, {
   3.519745616095749*^9, 3.519745630252226*^9}, {3.51974582858055*^9, 
   3.519745829740423*^9}, {3.5197458853720427`*^9, 3.51974588815501*^9}, {
   3.519746001904674*^9, 3.519746003049796*^9}, {3.519747012274577*^9, 
   3.519747061803197*^9}, {3.519747144312601*^9, 3.5197471762868423`*^9}, {
   3.519747228147708*^9, 3.5197472800401087`*^9}, {3.5197473124649467`*^9, 
   3.519747345422388*^9}, {3.519747400712719*^9, 3.519747420039579*^9}, {
   3.519747469015295*^9, 3.5197474712547493`*^9}, 3.519747534709786*^9, {
   3.51974837838233*^9, 3.5197484027115583`*^9}, 3.519748507321594*^9, {
   3.519748660423171*^9, 3.519748686040132*^9}, {3.519759425149289*^9, 
   3.5197594396454144`*^9}, {3.519759513336916*^9, 3.519759521821447*^9}, {
   3.519759590089869*^9, 3.519759646396968*^9}, {3.5197597833420973`*^9, 
   3.51975979422838*^9}, {3.519759915016663*^9, 3.519759990388905*^9}, {
   3.5197603366677237`*^9, 3.51976045506787*^9}, {3.519999488890355*^9, 
   3.5199995951026583`*^9}, {3.519999626589056*^9, 3.519999633051642*^9}, {
   3.519999678363205*^9, 3.5199997001478987`*^9}, {3.5199997398005333`*^9, 
   3.519999753001214*^9}, {3.520004923712969*^9, 3.520004931216284*^9}, {
   3.520089155563867*^9, 3.520089198558292*^9}, {3.520089323790042*^9, 
   3.520089330219534*^9}, {3.5200896825825853`*^9, 3.520089700942443*^9}, {
   3.520090570963269*^9, 3.520090603535788*^9}, {3.5201602201072617`*^9, 
   3.520160254822308*^9}, {3.5202586648361473`*^9, 3.5202586905911922`*^9}, {
   3.5202587939542227`*^9, 3.520258809081503*^9}, {3.520259452379546*^9, 
   3.520259489804469*^9}, {3.5203363516827593`*^9, 3.520336406460698*^9}, {
   3.521556729702318*^9, 3.521556830074217*^9}, {3.521557328458291*^9, 
   3.521557472308979*^9}, {3.5215575278363743`*^9, 3.521557528251974*^9}, {
   3.521557566529171*^9, 3.521557569970725*^9}, {3.523807331791524*^9, 
   3.5238073800307817`*^9}, {3.523807876530875*^9, 3.523807961347372*^9}, {
   3.5238080666482887`*^9, 3.523808159227231*^9}, {3.52380836712639*^9, 
   3.52380846685349*^9}, {3.523812111564426*^9, 3.523812166345319*^9}, {
   3.523824417259457*^9, 3.523824431792706*^9}, {3.523890796000742*^9, 
   3.5238908857885017`*^9}, {3.523909539705181*^9, 3.5239095906407547`*^9}, {
   3.523909864643282*^9, 3.5239098692775593`*^9}, 3.523909982094705*^9, {
   3.523910039130121*^9, 3.5239100517992277`*^9}, {3.523910277144878*^9, 
   3.5239102800791273`*^9}, {3.5239103699500628`*^9, 3.523910475010085*^9}, {
   3.523963892550045*^9, 3.523963926043647*^9}, {3.524320019893518*^9, 
   3.524320046753297*^9}, {3.5243201137551603`*^9, 3.524320135506382*^9}, {
   3.524619986382061*^9, 3.524620018152171*^9}, {3.524620059853795*^9, 
   3.524620066613675*^9}, {3.524620121914598*^9, 3.524620122539904*^9}, {
   3.524620758572171*^9, 3.5246207632856817`*^9}, {3.524620808314406*^9, 
   3.524620808523135*^9}, {3.52462084596142*^9, 3.524620862726181*^9}, {
   3.52462090892738*^9, 3.5246209295208187`*^9}, {3.53053844345358*^9, 
   3.53053859584103*^9}, {3.535983445023314*^9, 3.535983461190105*^9}, 
   3.5414376033510323`*^9, {3.546694294369194*^9, 3.546694503715664*^9}, {
   3.546695076520863*^9, 3.546695129364273*^9}, {3.5502451657105722`*^9, 
   3.550245215444263*^9}, {3.551451615826611*^9, 3.551451736482745*^9}, {
   3.5514517672619257`*^9, 3.551451899814158*^9}, {3.551452000855418*^9, 
   3.551452006167974*^9}, {3.5514520568476686`*^9, 3.5514520571822844`*^9}, 
   3.551811450479108*^9, {3.551967081044716*^9, 3.551967112125988*^9}, {
   3.5526740321855*^9, 3.552674038030902*^9}, {3.5563033615423822`*^9, 
   3.556303400837961*^9}, {3.5563889675658693`*^9, 3.556389014203972*^9}, 
   3.557506128132991*^9, {3.557506994747583*^9, 3.5575069985217323`*^9}, {
   3.557510257227089*^9, 3.557510266204833*^9}, {3.55751029687976*^9, 
   3.557510373047223*^9}, {3.557511238779086*^9, 3.557511265976461*^9}, 
   3.55758045218601*^9, {3.557581052177926*^9, 3.557581056454053*^9}, {
   3.557581580993038*^9, 3.5575815817895603`*^9}, {3.55906508899535*^9, 
   3.5590651039680653`*^9}, 3.5590651797632113`*^9, {3.559065910669778*^9, 
   3.5590659188120327`*^9}, {3.5590666383085127`*^9, 3.559066705287492*^9}, {
   3.559067419509366*^9, 3.559067490714179*^9}, {3.559068141815453*^9, 
   3.5590682172000017`*^9}, {3.559212143665331*^9, 3.5592121587809677`*^9}, {
   3.559212201559013*^9, 3.559212242048627*^9}, {3.561858423771591*^9, 
   3.561858441511072*^9}, {3.561898942363256*^9, 3.561898947643607*^9}, {
   3.5671742126666327`*^9, 3.5671743505049458`*^9}, {3.567346768564597*^9, 
   3.567346770869409*^9}, {3.56734689451858*^9, 3.56734692259127*^9}, {
   3.567347210309844*^9, 3.5673472514174223`*^9}, {3.567348993315476*^9, 
   3.567348995904114*^9}, 3.567434843991501*^9, {3.567435540614634*^9, 
   3.567435574389482*^9}, 3.567435612417879*^9, {3.567435658955977*^9, 
   3.567435694639636*^9}, {3.567447019890517*^9, 3.567447025989505*^9}, {
   3.567456690723363*^9, 3.567456706408719*^9}, {3.567456926984535*^9, 
   3.567456990220914*^9}, {3.567457513854251*^9, 3.567457620220641*^9}, {
   3.5674576554196978`*^9, 3.567457726056574*^9}, {3.567471884467141*^9, 
   3.56747191396204*^9}, {3.5674746105329933`*^9, 3.5674746160959997`*^9}, {
   3.5675246366597643`*^9, 3.567524653793981*^9}, {3.567525000514544*^9, 
   3.567525012132339*^9}, {3.5675257947671347`*^9, 3.567525802680448*^9}, 
   3.567525881969255*^9, {3.5675259223512707`*^9, 3.567525976394291*^9}, {
   3.567526171227613*^9, 3.567526181645297*^9}, {3.567545264463023*^9, 
   3.567545295806501*^9}, {3.5675453515639*^9, 3.5675454336756487`*^9}, {
   3.567545498723241*^9, 3.567545502312738*^9}, {3.567545538652685*^9, 
   3.5675455991693163`*^9}, 3.567546064511285*^9, {3.583370474102181*^9, 
   3.583370475340694*^9}, {3.583372582101879*^9, 3.583372633516017*^9}, {
   3.5833727198122063`*^9, 3.583372779772237*^9}, {3.583372882903399*^9, 
   3.5833729232199583`*^9}, {3.583373865777516*^9, 3.583373875629199*^9}, {
   3.5834061306204853`*^9, 3.5834061553364363`*^9}, 3.5834194338068047`*^9, {
   3.583513515311864*^9, 3.58351361087796*^9}, {3.583513693831208*^9, 
   3.5835137284745398`*^9}, 3.583513759022787*^9, 3.583516069604649*^9, {
   3.585407420377057*^9, 3.58540745425721*^9}, {3.585407501120425*^9, 
   3.585407593097793*^9}, {3.5854077245839643`*^9, 3.585407725069647*^9}, 
   3.594308154885438*^9, {3.623433713166843*^9, 3.623433835954328*^9}, {
   3.626367818900931*^9, 3.626367820554419*^9}, {3.626368027916916*^9, 
   3.626368038337875*^9}, {3.626368195316321*^9, 3.626368196092929*^9}, {
   3.626368233843072*^9, 3.6263682352489223`*^9}, {3.626493750124864*^9, 
   3.626493754782914*^9}, {3.626494004000269*^9, 3.626494006591044*^9}, {
   3.626556795976041*^9, 3.626556807102593*^9}, 3.626556945305953*^9, {
   3.626572439197754*^9, 3.6265724559327993`*^9}, 3.626965264181975*^9, {
   3.6269661901156397`*^9, 3.626966204307691*^9}, {3.626966270731228*^9, 
   3.626966292569701*^9}, {3.626966324470401*^9, 3.626966352369915*^9}, {
   3.626966963197876*^9, 3.626966991850831*^9}, 3.626967027568081*^9, {
   3.626967840421446*^9, 3.626967909687406*^9}, {3.626968018271207*^9, 
   3.626968188631925*^9}, {3.6269710138825703`*^9, 3.6269710234433804`*^9}, {
   3.6270623465741673`*^9, 3.627062351281129*^9}, {3.627063134677422*^9, 
   3.6270631523431177`*^9}, {3.6270956889467916`*^9, 3.627095705868615*^9}, {
   3.638886117248942*^9, 3.63888612052796*^9}, {3.638886165780998*^9, 
   3.638886190539154*^9}, {3.638886222461521*^9, 3.638886411355277*^9}, {
   3.63888644238192*^9, 3.6388864430779657`*^9}, {3.6402738851967363`*^9, 
   3.640273885818573*^9}, {3.641571322454962*^9, 3.641571323215081*^9}, {
   3.642003357709927*^9, 3.64200336078883*^9}, {3.6477805220930767`*^9, 
   3.647780522733921*^9}, {3.647784153627947*^9, 3.64778415442243*^9}, {
   3.652368357531439*^9, 3.6523684190849457`*^9}, {3.660318532444243*^9, 
   3.660318656444878*^9}, {3.66031931766022*^9, 3.660319433655386*^9}, 
   3.6603196304066772`*^9, 3.66032772644191*^9, {3.664554233225499*^9, 
   3.66455423468935*^9}, {3.664673497826886*^9, 3.664673517755089*^9}, {
   3.664673555176223*^9, 3.6646735658283157`*^9}, {3.666724444453431*^9, 
   3.66672465786697*^9}, 3.666725432730706*^9, {3.6667411733210297`*^9, 
   3.6667412495991707`*^9}, {3.666741322892138*^9, 3.6667414565061903`*^9}, 
   3.666741592287162*^9, {3.668004931967349*^9, 3.6680049454822702`*^9}, {
   3.668005108161676*^9, 3.6680051371012573`*^9}, {3.669122173495091*^9, 
   3.669122182196547*^9}, {3.6691223753233128`*^9, 3.669122379473361*^9}, {
   3.669122854207879*^9, 3.669122866506308*^9}, 3.669123239582533*^9, {
   3.669123415324692*^9, 3.66912348871285*^9}, 3.669130803287952*^9, {
   3.6691332718107443`*^9, 3.669133275139317*^9}, {3.67003387571421*^9, 
   3.67003391675738*^9}, {3.670033982616604*^9, 3.670034017653686*^9}, {
   3.6700344975111427`*^9, 3.670034497860816*^9}, {3.6700810004159184`*^9, 
   3.670081003521617*^9}, {3.675947737299419*^9, 3.675947754333535*^9}, {
   3.68467161390455*^9, 3.684671618306753*^9}, {3.7350932537329197`*^9, 
   3.735093279242735*^9}, {3.735093346252406*^9, 3.7350933872755957`*^9}, {
   3.735130965979909*^9, 3.735131002028082*^9}, {3.735133910981823*^9, 
   3.735133965971004*^9}, {3.735134006023082*^9, 3.735134108116609*^9}, 
   3.735134533548481*^9, {3.735144751928677*^9, 3.735144755189522*^9}, {
   3.735144837609149*^9, 3.735144844394949*^9}, {3.7352635410375147`*^9, 
   3.735263582347021*^9}, {3.735263642243475*^9, 3.735263814743232*^9}, {
   3.7352646567256002`*^9, 3.735264702279862*^9}, {3.735264895869811*^9, 
   3.735264904767174*^9}, {3.735265000766062*^9, 3.735265016982171*^9}, {
   3.73526508622367*^9, 3.735265088239196*^9}, {3.735266661216648*^9, 
   3.735266706823542*^9}, {3.735266749125299*^9, 3.735266840583209*^9}, {
   3.7352669296573553`*^9, 3.735266932106256*^9}, {3.735267156623356*^9, 
   3.735267167092615*^9}, {3.735297169426962*^9, 3.735297170916067*^9}, {
   3.735306875269946*^9, 3.73530691929911*^9}, {3.7354004339742393`*^9, 
   3.73540043984063*^9}, 3.735500091554098*^9, 3.735502152206357*^9, {
   3.735562858641604*^9, 3.735562864962389*^9}, {3.73558162873633*^9, 
   3.735581649239715*^9}, {3.735646880595097*^9, 3.735646896200224*^9}, {
   3.73573982775611*^9, 3.735739828834427*^9}, {3.735742134527505*^9, 
   3.7357421702742147`*^9}, {3.736428757932805*^9, 3.736428783002483*^9}, {
   3.745151780538274*^9, 3.74515179117066*^9}, {3.745151895948784*^9, 
   3.745151906065359*^9}, 3.745152362664833*^9, {3.7451570116703253`*^9, 
   3.7451570250882072`*^9}, 3.7451673361644897`*^9, 3.756658304312561*^9, {
   3.7566583371895103`*^9, 3.756658337514024*^9}, {3.7566605016374702`*^9, 
   3.7566605194868793`*^9}, {3.756731435829588*^9, 3.756731549920038*^9}, {
   3.7567326482927437`*^9, 
   3.75673265280159*^9}},ExpressionUUID->"30cf3a39-36a5-4204-91a4-\
9d63e7cce6e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DotExpandMode", "[", "False", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.48379355660535*^9, 3.483793569543653*^9}, {
  3.495369752950612*^9, 3.4953697717785463`*^9}, {3.4953700630626097`*^9, 
  3.4953701206803207`*^9}, {3.495370328659198*^9, 3.4953703325157557`*^9}, {
  3.4953710402817287`*^9, 3.495371046707286*^9}, {3.495380045624301*^9, 
  3.495380098919797*^9}, {3.4953801687431793`*^9, 3.495380208646187*^9}, {
  3.495380360734543*^9, 3.4953803873129883`*^9}, {3.4953804622496357`*^9, 
  3.4953805085792522`*^9}, {3.4953805896547937`*^9, 3.495380601341927*^9}, {
  3.4953807165116568`*^9, 3.495380784795382*^9}, {3.495380823066704*^9, 
  3.495380832620648*^9}, {3.495380867910057*^9, 3.495380882077682*^9}, {
  3.666532436087812*^9, 
  3.666532460510675*^9}},ExpressionUUID->"8022bc9f-8917-4b88-8b6e-\
d2017f356f36"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"tuKetCBDecompose", "::", "usage"}], "=", 
   "\"\<tuKetCBDecompose[j1_,j2_,j_] return a List of \
Ket[j,m]\[Rule]ClebschGordan[{j1,m1},{j2,m2},{j2,m2}] \
Ket[j1,m1]\[CenterDot]Ket[j2,m2] over {jj,j,0,-1} where \
{m1,-j1,j1},{m2,-j2,j2},{m,-jj,jj}. *21Jul2018* \>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"tuKetCBDecompose", "[", 
     RowBox[{"j1_", ",", "j2_", ",", "j_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Ket", "[", 
             RowBox[{"jj", ",", "m"}], "]"}], "\[Rule]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ClebschGordan", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"j1", ",", "m1"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j2", ",", "m2"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"jj", ",", "m"}], "}"}]}], "]"}], 
                  RowBox[{
                   RowBox[{"Ket", "[", 
                    RowBox[{"j1", ",", "m1"}], "]"}], "\[CenterDot]", 
                   RowBox[{"Ket", "[", 
                    RowBox[{"j2", ",", "m2"}], "]"}]}]}], ",", " ", 
                 "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{"m1", ",", 
                   RowBox[{"-", "j1"}], ",", "j1"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"m2", ",", 
                   RowBox[{"-", "j2"}], ",", "j2"}], "}"}]}], "]"}], "//", 
               "Flatten"}], "//", 
              RowBox[{
               RowBox[{"Apply", "[", 
                RowBox[{"Plus", ",", "#"}], "]"}], "&"}]}], ")"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"m", ",", 
             RowBox[{"-", "jj"}], ",", "jj"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "j", ",", "0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], "//", "Flatten"}], "//", 
      "Expand"}], "//", 
     RowBox[{
      RowBox[{"DeleteCases", "[", 
       RowBox[{"#", ",", 
        RowBox[{"_", "\[Rule]", "0"}]}], "]"}], "&"}]}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"TEST", "\[IndentingNewLine]", 
     RowBox[{"tuKetCBDecompose", "[", 
      RowBox[{
       RowBox[{"1", "/", "2"}], ",", 
       RowBox[{"1", "/", "2"}], ",", "1"}], "]"}]}], "//", "Column"}], 
   "\[IndentingNewLine]", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuKetCBDecomposeInv", "::", "usage"}], "=", 
   "\"\<tuKetCBDecomposeInv[j1_,j2_,j_] return an inverted List of results \
from tuKetCBDecompose[j1,j2,j]. *21Jul2018*\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuKetCBDecomposeInv", "[", 
    RowBox[{"j1_", ",", "j2_", ",", "j_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"$", ",", "$s"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"$", "=", 
       RowBox[{"tuKetCBDecompose", "[", 
        RowBox[{"j1", ",", "j2", ",", "j"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"$s", "=", 
       RowBox[{
        RowBox[{"$", "//", 
         RowBox[{"tuExtractPattern", "[", 
          RowBox[{
           RowBox[{"Ket", "[", "__", "]"}], "\[CenterDot]", 
           RowBox[{"Ket", "[", "__", "]"}]}], "]"}]}], "//", 
        "DeleteDuplicates"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"$", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"tuRuleSolve", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"tuRuleEliminate", "[", 
                RowBox[{"DeleteCases", "[", 
                 RowBox[{"$s", ",", "#"}], "]"}], "]"}], "[", "$", "]"}], ",",
               "#"}], "]"}], "&"}], ",", "$s"}], "]"}], "//", "Flatten"}], "//",
         "Expand"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"TEST", "\[IndentingNewLine]", 
     RowBox[{"tuKetCBDecomposeInv", "[", 
      RowBox[{
       RowBox[{"1", "/", "2"}], ",", 
       RowBox[{"1", "/", "2"}], ",", "1"}], "]"}]}], "//", "Column"}], 
   "\[IndentingNewLine]", "*)"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7411716121752243`*^9, 3.7411716455060043`*^9}, {
   3.741171747664192*^9, 3.741171753693161*^9}, {3.7411718474499483`*^9, 
   3.741172163809555*^9}, {3.7411721976829977`*^9, 3.741172266475918*^9}, {
   3.741172309364711*^9, 3.741172311005251*^9}, {3.7411723539629917`*^9, 
   3.7411723573544073`*^9}, {3.741172394234488*^9, 3.74117242698315*^9}, {
   3.741172460388831*^9, 3.74117251952817*^9}, {3.7411725670300083`*^9, 
   3.741172567197209*^9}, {3.741172628517109*^9, 3.741172659502829*^9}, {
   3.741172715844171*^9, 3.74117273615788*^9}, {3.741172775065686*^9, 
   3.741172800295179*^9}, {3.74117289053373*^9, 3.74117289378624*^9}, {
   3.741172934180716*^9, 3.741172991586069*^9}, {3.741173148830818*^9, 
   3.741173152229274*^9}, {3.741173216194347*^9, 3.74117322758344*^9}, {
   3.7411733089773607`*^9, 3.74117331990728*^9}, {3.7411733966534986`*^9, 
   3.741173425449861*^9}, {3.741173513861883*^9, 3.741173529547612*^9}, {
   3.7411735777517157`*^9, 3.741173580072818*^9}, {3.74117838727008*^9, 
   3.741178443229301*^9}, {3.741178602032175*^9, 3.7411786412337227`*^9}, {
   3.7411786810722218`*^9, 3.741178702540086*^9}, {3.7411799294548483`*^9, 
   3.7411799769736233`*^9}, {3.7411800295817137`*^9, 3.741180112218123*^9}, {
   3.74118014364904*^9, 3.7411802340789967`*^9}, {3.741180272152341*^9, 
   3.7411803215039062`*^9}, {3.741181069801299*^9, 3.7411810873702*^9}, {
   3.741181233196357*^9, 3.741181261778467*^9}, {3.741181300289566*^9, 
   3.741181352223742*^9}, {3.741181400953364*^9, 3.741181444061091*^9}, {
   3.741181516273353*^9, 3.7411816589986877`*^9}, {3.741181696948667*^9, 
   3.7411817292852573`*^9}, {3.741181764438472*^9, 3.741181959403048*^9}, {
   3.74118203780766*^9, 3.741182209969494*^9}, {3.741182261714167*^9, 
   3.741182288796019*^9}, {3.741182510690157*^9, 3.741182584049938*^9}, {
   3.741182671162513*^9, 3.7411827754207373`*^9}, {3.74118286370385*^9, 
   3.7411828831272383`*^9}, {3.741183076686488*^9, 3.7411830823484297`*^9}, {
   3.741183131841992*^9, 3.741183245435431*^9}, {3.74118349041387*^9, 
   3.7411839807810497`*^9}, {3.741185252876184*^9, 3.741185300973709*^9}, {
   3.7411855215300713`*^9, 3.7411855499634647`*^9}, {3.741351588512423*^9, 
   3.741351591611766*^9}, 
   3.7413549324162617`*^9},ExpressionUUID->"9dd3725e-5103-446b-8627-\
bbb7f5417967"],

Cell["Dimensional Analysis", "Text",
 CellChangeTimes->{{3.5268218463615103`*^9, 3.526821857016189*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"SUSYdim", ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"dim", "[", "\[Theta]", "]"}], "->", 
        RowBox[{
         RowBox[{"-", "1"}], "/", "2"}]}], ",", 
       RowBox[{"(*", 
        RowBox[{"spinor", " ", "variable"}], "*)"}], "\[IndentingNewLine]", 
       " ", 
       RowBox[{
        RowBox[{"dim", "[", 
         RowBox[{"\[Phi]", "[", "scalar", "]"}], "]"}], "->", "1"}], ",", 
       "\[IndentingNewLine]", " ", 
       RowBox[{
        RowBox[{"dim", "[", 
         RowBox[{"\[Chi]", "[", "fermion", "]"}], "]"}], "->", 
        RowBox[{"3", "/", "2"}]}], ",", "\[IndentingNewLine]", " ", 
       RowBox[{
        RowBox[{"dim", "[", "F", "]"}], "->", "2"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dim", "[", 
         RowBox[{"\[Zeta]", "[", "infinetessimal", "]"}], "]"}], "->", 
        RowBox[{
         RowBox[{"-", "1"}], "/", "2"}]}], " ", ",", 
       RowBox[{"(*", 
        RowBox[{"infinitessimal", " ", "spinor", " ", "parameter"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dim", "[", 
         RowBox[{"Ad", "[", "\[Mu]", "]"}], "]"}], "->", "1"}], ",", 
       RowBox[{"(*", 
        RowBox[{"vector", " ", "field"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dim", "[", 
         RowBox[{"xu", "[", "\[Mu]", "]"}], "]"}], "->", 
        RowBox[{"-", "1"}]}], ",", 
       RowBox[{"(*", 
        RowBox[{"space", " ", "time", " ", "coordinate"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"for", " ", "gauge", " ", "field", " ", "\[CapitalLambda]"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dim", "[", 
         RowBox[{"\[Phi]d", "[", "\[CapitalLambda]", "]"}], "]"}], "->", 
        "0"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dim", "[", 
         RowBox[{"\[Chi]d", "[", "\[CapitalLambda]", "]"}], "]"}], "->", 
        RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dim", "[", 
         RowBox[{"Fd", "[", "\[CapitalLambda]", "]"}], "]"}], "->", "1"}]}], 
      "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"SUSYdim", "//", "ColumnForms"}]}], "Input",
 CellChangeTimes->{{3.526821836979664*^9, 3.526822020670652*^9}, {
  3.526822074747839*^9, 3.526822164047768*^9}, {3.526822245606785*^9, 
  3.52682227605304*^9}, {3.526824269818923*^9, 3.526824313512545*^9}, {
  3.52682443084147*^9, 3.52682444082448*^9}, {3.526824543933147*^9, 
  3.5268245468344507`*^9}, {3.526825163154059*^9, 3.526825173199872*^9}, {
  3.526906129253027*^9, 3.526906225733513*^9}, {3.526907452642823*^9, 
  3.526907555545855*^9}, {3.5269076878661633`*^9, 3.526907741559679*^9}, {
  3.526908571301176*^9, 3.5269086046271763`*^9}, {3.5269891493867083`*^9, 
  3.5269891500030317`*^9}, {3.752936795416765*^9, 
  3.752936811203075*^9}},ExpressionUUID->"a38a411a-dff6-4591-a93c-\
71b53c5f48b3"],

Cell[BoxData[
 TagBox[GridBox[{
    {
     RowBox[{
      RowBox[{"dim", "[", "\[Theta]", "]"}], "\[Rule]", 
      RowBox[{"-", 
       FractionBox["1", "2"]}]}]},
    {
     RowBox[{
      RowBox[{"dim", "[", 
       RowBox[{"\[Phi]", "[", "scalar", "]"}], "]"}], "\[Rule]", "1"}]},
    {
     RowBox[{
      RowBox[{"dim", "[", 
       RowBox[{"\[Chi]", "[", "fermion", "]"}], "]"}], "\[Rule]", 
      FractionBox["3", "2"]}]},
    {
     RowBox[{
      RowBox[{"dim", "[", "F", "]"}], "\[Rule]", "2"}]},
    {
     RowBox[{
      RowBox[{"dim", "[", 
       RowBox[{"\[Zeta]", "[", "infinetessimal", "]"}], "]"}], "\[Rule]", 
      RowBox[{"-", 
       FractionBox["1", "2"]}]}]},
    {
     RowBox[{
      RowBox[{"dim", "[", 
       RowBox[{"Ad", "[", "\[Mu]", "]"}], "]"}], "\[Rule]", "1"}]},
    {
     RowBox[{
      RowBox[{"dim", "[", 
       RowBox[{"xu", "[", "\[Mu]", "]"}], "]"}], "\[Rule]", 
      RowBox[{"-", "1"}]}]},
    {
     RowBox[{
      RowBox[{"dim", "[", 
       RowBox[{"\[Phi]d", "[", "\[CapitalLambda]", "]"}], "]"}], "\[Rule]", 
      "0"}]},
    {
     RowBox[{
      RowBox[{"dim", "[", 
       RowBox[{"\[Chi]d", "[", "\[CapitalLambda]", "]"}], "]"}], "\[Rule]", 
      FractionBox["1", "2"]}]},
    {
     RowBox[{
      RowBox[{"dim", "[", 
       RowBox[{"Fd", "[", "\[CapitalLambda]", "]"}], "]"}], "\[Rule]", "1"}]}
   },
   AutoDelete->False,
   FrameStyle->Directive[
     RGBColor[0.7, 0, 1, 1], 
     Thickness[Tiny]],
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxDividers->{"Columns" -> {True}, "Rows" -> {False}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
  "Grid"]], "Output",
 CellChangeTimes->{{3.5563769764691973`*^9, 3.556376995047852*^9}, 
   3.566226555240838*^9, 3.56626928068027*^9, {3.566271131568739*^9, 
   3.566271149911047*^9}, 3.580212785842008*^9, 3.580212826047483*^9, 
   3.580213015296174*^9, 3.583153798699925*^9, 3.6203981312668*^9, 
   3.62039893931568*^9, 3.620398984913376*^9, 3.631375895895873*^9, 
   3.631800808664074*^9, 3.631800842799983*^9, 3.633462823299404*^9, 
   3.634309615610485*^9, 3.634310216168269*^9, 3.6724462781826153`*^9, 
   3.6724463104187603`*^9, {3.69514164123324*^9, 3.695141664254431*^9}, 
   3.735089946981249*^9, 3.744973073017747*^9, 3.752936818289339*^9, 
   3.79958923968285*^9, 
   3.799589279577196*^9},ExpressionUUID->"39ff9da7-88f5-45e0-a889-\
691a4eb20968"]
}, Open  ]],

Cell["String functions", "Text",
 CellChangeTimes->{{3.655341209420809*^9, 3.655341217381756*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "OPEContract", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"OPEContract", "::", "usage"}], "=", 
   "\"\<OPEContract[e1_,e2_] performs OPE contraction product of two \
NormalOrder[]d operators. BraKet indicates contraction. *30Oct2015*\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"OPEContract", "[", 
    RowBox[{"e1_", ",", "e2_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"$", ",", 
       RowBox[{"$1", "=", 
        RowBox[{"List", "@@", "e1"}]}], ",", 
       RowBox[{"$2", "=", 
        RowBox[{"List", "@@", "e2"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"$", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"BraKet", "@@", "#"}], " ", ")"}], 
           RowBox[{
            RowBox[{"NormalOrder", "[", 
             RowBox[{"Complement", "[", 
              RowBox[{"$1", ",", "#"}], "]"}], "]"}], "\[CenterDot]", 
            RowBox[{"NormalOrder", "[", 
             RowBox[{"Complement", "[", 
              RowBox[{"$2", ",", "#"}], "]"}], "]"}]}]}], "&"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"$1", ",", "$2"}], "}"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Apply", "[", 
       RowBox[{"Plus", ",", "$"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuOPEWick", "::", "usage"}], "=", 
   "\"\<tuOPEWick[exp_] applies Wick's Theorem for OPE on exp_.  Only does 2 \
levels of nesting *30Oct2015*\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuOPEWick", "[", "exp_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"$", "=", "exp"}], ",", "$sNO"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"$sNO", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"NormalOrder", "[", "a_List", "]"}], "\[CenterDot]", 
         RowBox[{"NormalOrder", "[", "b_List", "]"}]}], ":>", 
        RowBox[{
         RowBox[{"NormalOrder", "[", 
          RowBox[{"Join", "[", 
           RowBox[{"a", ",", "b"}], "]"}], "]"}], "+", 
         RowBox[{"xOPEContract", "[", 
          RowBox[{"a", ",", "b"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"$", "=", 
       RowBox[{"$", "/.", "$sNO"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"$", "=", 
       RowBox[{"$", "/.", 
        RowBox[{"xOPEContract", "->", "OPEContract"}]}]}], ";", 
      RowBox[{"xPrint", "[", "$", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"$", "=", 
       RowBox[{"$", "/.", "$sNO"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"$", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"$", "/.", 
           RowBox[{
            RowBox[{"xOPEContract", "[", "a__", "]"}], "\[Rule]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "/", "2"}], ")"}], 
             RowBox[{"OPEContract", "[", "a", "]"}]}]}]}], "/.", 
          RowBox[{
           RowBox[{"NormalOrder", "[", 
            RowBox[{"{", "}"}], "]"}], "\[Rule]", "1"}]}], "//", "Expand"}], "//", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"#", "//.", 
           RowBox[{"tuOpSimplify", "[", "CenterDot", "]"}]}], ")"}], 
         "&"}]}]}], ";", "\[IndentingNewLine]", "$"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tuArXiv", "[", "num_String", "]"}], ":=", 
   RowBox[{"URL", "[", 
    RowBox[{"\"\<https://arxiv.org/abs/\>\"", "<>", "num"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655341234318075*^9, 3.655341240015217*^9}, {
  3.684671621218925*^9, 3.684671622034068*^9}, {3.7144129720797453`*^9, 
  3.714413053548071*^9}, {3.7144131348216887`*^9, 3.714413139443213*^9}, {
  3.7162191744378633`*^9, 
  3.7162192060215273`*^9}},ExpressionUUID->"6b9f79f0-f361-4336-b259-\
afb951a573b7"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"DateString", "[", "]"}], 
  RowBox[{"(*", 
   RowBox[{"add", " ", "current", " ", "date", " ", "to", " ", "output"}], 
   "*)"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.749214128717964*^9, 3.7492141315426407`*^9}, {
  3.749214186205669*^9, 
  3.7492142168335123`*^9}},ExpressionUUID->"058e6931-095b-4fe8-9377-\
ea5cac18221f"],

Cell[BoxData["\<\"Wed 27 May 2020 10:36:38\"\>"], "Output",
 CellChangeTimes->{
  3.750954481417316*^9, 3.7529368179572897`*^9, 3.7560493056102057`*^9, 
   3.759072055621729*^9, 3.796393441664248*^9, {3.799589232375564*^9, 
   3.7995892397955647`*^9}, {3.799589271413095*^9, 3.799589279726118*^9}, 
   3.799589492780401*^9, 3.799589715194895*^9, 
   3.79958979815203*^9},ExpressionUUID->"a1aee57c-87cc-4042-9ce3-\
b562e34d247b"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"EndPackage", "[", "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.666498661228813*^9, 3.666498664357287*^9}, 
   3.666541697370132*^9},ExpressionUUID->"43ad7b72-c86e-4995-a376-\
eb32f4b45bb6"]
},
AutoGeneratedPackage->Automatic,
WindowToolbars->{},
WindowSize->{781, 664},
WindowMargins->{{112, Automatic}, {Automatic, 0}},
ShowSelection->True,
FrontEndVersion->"11.2 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
10, 2017)",
StyleDefinitions->"tuTensorialStyle.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[545, 20, 413, 10, 47, "Text",ExpressionUUID->"8490fecd-4fd3-426c-855f-640bdb564157"],
Cell[961, 32, 358, 8, 42, "Input",ExpressionUUID->"e9b3371a-a3e5-4d39-b046-0e708a41bc22"],
Cell[1322, 42, 1280, 21, 119, "Text",ExpressionUUID->"e96418e5-ebbc-4725-a249-b488bf3a3d83"],
Cell[CellGroupData[{
Cell[2627, 67, 176172, 4233, 12633, "Input",ExpressionUUID->"7fe73395-1254-4288-b8f3-24670935a812",
 InitializationCell->True],
Cell[178802, 4302, 4790, 68, 25, "Output",ExpressionUUID->"7715a8bd-f761-45f7-aca0-165de23d7920"],
Cell[183595, 4372, 4797, 68, 26, "Output",ExpressionUUID->"3523df20-645e-404c-b9d3-8f0188bfbb47"]
}, Open  ]],
Cell[188407, 4443, 317, 5, 29, "Text",ExpressionUUID->"2f7f58f1-24a3-4ba3-a5f7-f16176f77457"],
Cell[188727, 4450, 534174, 13073, 40521, "Input",ExpressionUUID->"92917c7a-6652-4ea1-89e2-3f5ff51323ca",
 InitializationCell->True],
Cell[722904, 17525, 370, 7, 29, "Text",ExpressionUUID->"b330affb-d9e4-445d-8121-2f0026fa4623"],
Cell[723277, 17534, 76304, 1840, 4956, "Input",ExpressionUUID->"c74bf4d0-9eea-4635-8794-7d5fbe1add2e",
 InitializationCell->True],
Cell[799584, 19376, 75939, 1728, 4857, "Input",ExpressionUUID->"b94ada48-112c-4ee5-9028-b11122088dd1",
 InitializationCell->True],
Cell[875526, 21106, 166, 3, 29, "Text",ExpressionUUID->"b8870235-8f15-4918-a05b-7fdb8e7e533f"],
Cell[875695, 21111, 214863, 5068, 15029, "Input",ExpressionUUID->"a4aac333-28c8-45c5-95de-46a1c66b075e",
 InitializationCell->True],
Cell[1090561, 26181, 216, 7, 29, "Text",ExpressionUUID->"5a18b0df-c814-424b-8ee5-256e918ba3a9"],
Cell[CellGroupData[{
Cell[1090802, 26192, 421063, 9939, 29729, "Input",ExpressionUUID->"7a04b535-6c36-4a8a-98cb-240b63c315fd",
 InitializationCell->True],
Cell[1511868, 36133, 1944, 28, 42, "Output",ExpressionUUID->"eb0ec73b-b576-4cb3-8593-d4762ba818e4"],
Cell[1513815, 36163, 1901, 27, 26, "Output",ExpressionUUID->"3c3e4bc4-21d8-4697-b52e-09f50965f30a"],
Cell[1515719, 36192, 1967, 28, 42, "Output",ExpressionUUID->"d45e53f2-94de-40ef-8bbe-8f822f66211d"]
}, Open  ]],
Cell[1517701, 36223, 211, 3, 29, "Text",ExpressionUUID->"51f3ab5d-9a04-4058-8fe6-8616f515936f"],
Cell[1517915, 36228, 14011, 327, 572, "Input",ExpressionUUID->"c770fa78-aa24-4097-a7f8-27eea9de20b6",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1531951, 36559, 17180, 403, 957, "Input",ExpressionUUID->"971b6b96-812b-43aa-bfb9-9a1fbb3f1bef"],
Cell[1549134, 36964, 4761, 91, 26, "Output",ExpressionUUID->"7a074377-317e-41e4-98c9-8413c67db62e"],
Cell[1553898, 37057, 2981, 43, 26, "Output",ExpressionUUID->"5af246bd-680d-4321-848e-6e487a9b37cf"]
}, Open  ]],
Cell[1556894, 37103, 99, 1, 29, "Text",ExpressionUUID->"ebbdd55a-0e12-4635-9546-92b595b7722e"],
Cell[1556996, 37106, 42026, 1005, 2115, "Input",ExpressionUUID->"cec0b34e-6af5-48ea-beb3-94ef963f2b5d",
 InitializationCell->True],
Cell[1599025, 38113, 92, 1, 29, "Text",ExpressionUUID->"225ee5ef-55ee-4513-a736-458de7d8adb8"],
Cell[1599120, 38116, 167, 2, 29, "Text",ExpressionUUID->"6ecb8721-eefe-4246-a444-4bef33d9500a"],
Cell[CellGroupData[{
Cell[1599312, 38122, 42247, 1096, 2593, "Input",ExpressionUUID->"88adb9f9-3546-4237-a366-45cac2c5f214",
 InitializationCell->True],
Cell[1641562, 39220, 2300, 54, 52, "Output",ExpressionUUID->"fd0185c9-1d37-4c70-a25a-89f14072dc38"],
Cell[1643865, 39276, 2853, 70, 68, "Output",ExpressionUUID->"7166744c-4752-4cc1-98ac-63e2703393b4"],
Cell[1646721, 39348, 2602, 62, 68, "Output",ExpressionUUID->"2241afc3-f685-4d21-90d1-7f0127830899"],
Cell[1649326, 39412, 2897, 69, 68, "Output",ExpressionUUID->"41f7599f-65d0-4bf4-8af9-712bae8edd4e"],
Cell[1652226, 39483, 1717, 35, 51, "Output",ExpressionUUID->"efd09ae0-a004-4db4-8f52-f83974f8cb68"]
}, Open  ]],
Cell[1653958, 39521, 262, 6, 29, "Text",ExpressionUUID->"d756f207-6c02-4fc2-b681-100fc02a92ec"],
Cell[1654223, 39529, 31107, 728, 1602, "Input",ExpressionUUID->"d8de14d8-e2a0-4cd4-8eeb-ce4fbda04a40",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1685355, 40261, 3437, 92, 158, "Input",ExpressionUUID->"5629597f-dc01-4310-b751-ce90822ccf83"],
Cell[1688795, 40355, 5558, 153, 110, "Output",ExpressionUUID->"f5952000-68a6-4eb2-b48c-3f8279a689b9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1694390, 40513, 5367, 150, 128, "Input",ExpressionUUID->"96614df9-e151-45d5-a3ef-b8c44ba0e8a9"],
Cell[1699760, 40665, 4794, 131, 182, "Output",ExpressionUUID->"fa5f6e9b-4605-4a74-91f3-8a5fd64b9cee"]
}, Open  ]],
Cell[1704569, 40799, 167, 3, 29, "Text",ExpressionUUID->"a1ef8199-5caf-4e7a-872b-111d2d1f4087"],
Cell[1704739, 40804, 187746, 4581, 9365, "Input",ExpressionUUID->"30cf3a39-36a5-4204-91a4-9d63e7cce6e9",
 InitializationCell->True],
Cell[1892488, 45387, 887, 15, 42, "Input",ExpressionUUID->"8022bc9f-8917-4b88-8b6e-d2017f356f36",
 InitializationCell->True],
Cell[1893378, 45404, 6965, 158, 378, "Input",ExpressionUUID->"9dd3725e-5103-446b-8627-bbb7f5417967",
 InitializationCell->True],
Cell[1900346, 45564, 104, 1, 29, "Text",ExpressionUUID->"4f4d5b18-3430-43d3-be43-8f94a5191209"],
Cell[CellGroupData[{
Cell[1900475, 45569, 3135, 73, 266, "Input",ExpressionUUID->"a38a411a-dff6-4591-a93c-71b53c5f48b3"],
Cell[1903613, 45644, 2406, 68, 206, "Output",ExpressionUUID->"39ff9da7-88f5-45e0-a889-691a4eb20968"]
}, Open  ]],
Cell[1906034, 45715, 98, 1, 29, "Text",ExpressionUUID->"5f78dd25-d0a8-4e7d-b479-70366333263d"],
Cell[1906135, 45718, 4144, 108, 410, "Input",ExpressionUUID->"6b9f79f0-f361-4336-b259-afb951a573b7",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1910304, 45830, 382, 10, 42, "Input",ExpressionUUID->"058e6931-095b-4fe8-9377-ea5cac18221f",
 InitializationCell->True],
Cell[1910689, 45842, 428, 7, 26, "Output",ExpressionUUID->"a1aee57c-87cc-4042-9ce3-b562e34d247b"]
}, Open  ]],
Cell[1911132, 45852, 232, 5, 42, "Input",ExpressionUUID->"43ad7b72-c86e-4995-a376-eb32f4b45bb6"]
}
]
*)

